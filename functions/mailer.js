!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=332)}([function(e,t,n){"use strict";const o=n(3).MongoError,i=n(11),r=n(31);var s=t.formatSortValue=function(e){switch((""+e).toLowerCase()){case"ascending":case"asc":case"1":return 1;case"descending":case"desc":case"-1":return-1;default:throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]")}},a=t.formattedOrderClause=function(e){var t={};if(null==e)return null;if(Array.isArray(e)){if(0===e.length)return null;for(var n=0;n<e.length;n++)e[n].constructor===String?t[e[n]]=1:t[e[n][0]]=s(e[n][1])}else if(null!=e&&"object"==typeof e)t=e;else{if("string"!=typeof e)throw new Error("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");t[e]=1}return t},c=t.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},l=["w","j","wtimeout","fsync"];const p=process.emitWarning?e=>process.emitWarning(e,"DeprecationWarning"):e=>console.error(e);function u(e,t){return`${e} option [${t}] is deprecated and will be removed in a later version.`}const d={};try{n(93),d.ASYNC_ITERATOR=!0}catch(e){d.ASYNC_ITERATOR=!1}class h{constructor(e,t){this.db=e,this.collection=t}toString(){return this.collection?`${this.db}.${this.collection}`:this.db}withCollection(e){return new h(this.db,e)}static fromString(e){if(!e)throw new Error(`Cannot parse namespace from "${e}"`);const t=e.indexOf(".");return new h(e.substring(0,t),e.substring(t+1))}}e.exports={filterOptions:function(e,t){var n={};for(var o in e)-1!==t.indexOf(o)&&(n[o]=e[o]);return n},mergeOptions:function(e,t){for(var n in t)e[n]=t[n];return e},translateOptions:function(e,t){var n={sslCA:"ca",sslCRL:"crl",sslValidate:"rejectUnauthorized",sslKey:"key",sslCert:"cert",sslPass:"passphrase",socketTimeoutMS:"socketTimeout",connectTimeoutMS:"connectionTimeout",replicaSet:"setName",rs_name:"setName",secondaryAcceptableLatencyMS:"acceptableLatency",connectWithNoPrimary:"secondaryOnlyConnectionAllowed",acceptableLatencyMS:"localThresholdMS"};for(var o in t)n[o]?e[n[o]]=t[o]:e[o]=t[o];return e},shallowClone:function(e){var t={};for(var n in e)t[n]=e[n];return t},getSingleProperty:function(e,t,n){Object.defineProperty(e,t,{enumerable:!0,get:function(){return n}})},checkCollectionName:function(e){if("string"!=typeof e)throw new o("collection name must be a String");if(!e||-1!==e.indexOf(".."))throw new o("collection names cannot be empty");if(-1!==e.indexOf("$")&&null==e.match(/((^\$cmd)|(oplog\.\$main))/))throw new o("collection names must not contain '$'");if(null!=e.match(/^\.|\.$/))throw new o("collection names must not start or end with '.'");if(-1!==e.indexOf("\0"))throw new o("collection names cannot contain a null character")},toError:function(e){if(e instanceof Error)return e;for(var t=e.err||e.errmsg||e.errMessage||e,n=o.create({message:t,driver:!0}),i="object"==typeof e?Object.keys(e):[],r=0;r<i.length;r++)try{n[i[r]]=e[i[r]]}catch(e){}return n},formattedOrderClause:a,parseIndexOptions:function(e){var t,n={},o=[];return"string"==typeof e?(o.push(e+"_1"),n[e]=1):Array.isArray(e)?e.forEach((function(e){"string"==typeof e?(o.push(e+"_1"),n[e]=1):Array.isArray(e)?(o.push(e[0]+"_"+(e[1]||1)),n[e[0]]=e[1]||1):c(e)&&(t=Object.keys(e)).forEach((function(t){o.push(t+"_"+e[t]),n[t]=e[t]}))})):c(e)&&(t=Object.keys(e)).forEach((function(t){o.push(t+"_"+e[t]),n[t]=e[t]})),{name:o.join("_"),keys:t,fieldHash:n}},normalizeHintField:function(e){var t=null;if("string"==typeof e)t=e;else if(Array.isArray(e))t={},e.forEach((function(e){t[e]=1}));else if(null!=e&&"object"==typeof e)for(var n in t={},e)t[n]=e[n];return t},handleCallback:function(e,t,n,o){try{if(null==e)return;if(e)return o?e(t,n,o):e(t,n)}catch(t){return process.nextTick((function(){throw t})),!1}return!0},decorateCommand:function(e,t,n){for(var o in t)-1===n.indexOf(o)&&(e[o]=t[o]);return e},isObject:c,debugOptions:function(e,t){var n={};return e.forEach((function(e){n[e]=t[e]})),n},MAX_JS_INT:Number.MAX_SAFE_INTEGER+1,mergeOptionsAndWriteConcern:function(e,t,n,o){for(var i=0;i<n.length;i++)e[n[i]]||void 0===t[n[i]]||(e[n[i]]=t[n[i]]);if(!o)return e;var r=!1;for(i=0;i<l.length;i++)if(e[l[i]]){r=!0;break}if(!r)for(i=0;i<l.length;i++)t[l[i]]&&(e[l[i]]=t[l[i]]);return e},translateReadPreference:function(e){var t=null;if(!e.readPreference)return e;if("string"==typeof(t=e.readPreference))e.readPreference=new i(t);else if(!t||t instanceof i||"object"!=typeof t){if(!(t instanceof i))throw new TypeError("Invalid read preference: "+t)}else{const n=t.mode||t.preference;n&&"string"==typeof n&&(e.readPreference=new i(n,t.tags,{maxStalenessSeconds:t.maxStalenessSeconds}))}return e},executeLegacyOperation:(e,t,n,i)=>{if(null==e)throw new TypeError("This method requires a valid topology instance");if(!Array.isArray(n))throw new TypeError("This method requires an array of arguments to apply");i=i||{};const r=e.s.promiseLibrary;let s,a,c,l=n[n.length-1];if(!i.skipSessions&&e.hasSessionSupport())if(null==(a=n[n.length-2])||null==a.session){c=Symbol(),s=e.startSession({owner:c});const t=n.length-2;n[t]=Object.assign({},n[t],{session:s})}else if(a.session&&a.session.hasEnded)throw new o("Use of expired sessions is not permitted");const p=(e,t)=>(function(n,o){if(s&&s.owner===c&&!i.returnsCursor)s.endSession(()=>{if(delete a.session,n)return t(n);e(o)});else{if(n)return t(n);e(o)}});if("function"==typeof l){l=n.pop();const e=p(e=>l(null,e),e=>l(e,null));n.push(e);try{return t.apply(null,n)}catch(t){throw e(t),t}}if(null!=n[n.length-1])throw new TypeError("final argument to `executeLegacyOperation` must be a callback");return new r((function(e,o){const i=p(e,o);n[n.length-1]=i;try{return t.apply(null,n)}catch(e){i(e)}}))},applyRetryableWrites:function(e,t){return t&&t.s.options.retryWrites&&(e.retryWrites=!0),e},applyWriteConcern:function(e,t,n){n=n||{};const o=t.db,i=t.collection;if(n.session&&n.session.inTransaction())return e.writeConcern&&delete e.writeConcern,e;const s=r.fromOptions(n);return s?Object.assign(e,{writeConcern:s}):i&&i.writeConcern?Object.assign(e,{writeConcern:Object.assign({},i.writeConcern)}):o&&o.writeConcern?Object.assign(e,{writeConcern:Object.assign({},o.writeConcern)}):e},isPromiseLike:function(e){return e&&"function"==typeof e.then},decorateWithCollation:function(e,t,n){const i=t.s&&t.s.topology||t.topology;if(!i)throw new TypeError('parameter "target" is missing a topology');const r=i.capabilities();if(n.collation&&"object"==typeof n.collation){if(!r||!r.commandsTakeCollation)throw new o("Current topology does not support collation");e.collation=n.collation}},decorateWithReadConcern:function(e,t,n){if(n&&n.session&&n.session.inTransaction())return;let o=Object.assign({},e.readConcern||{});t.s.readConcern&&Object.assign(o,t.s.readConcern),Object.keys(o).length>0&&Object.assign(e,{readConcern:o})},deprecateOptions:function(e,t){if(!0===process.noDeprecation)return t;const n=e.msgHandler?e.msgHandler:u,o=new Set;function i(){const i=arguments[e.optionsIndex];return c(i)&&0!==Object.keys(i).length?(e.deprecatedOptions.forEach(t=>{if(i.hasOwnProperty(t)&&!o.has(t)){o.add(t);const i=n(e.name,t);if(p(i),this&&this.getLogger){const e=this.getLogger();e&&e.warn(i)}}}),t.apply(this,arguments)):t.apply(this,arguments)}return Object.setPrototypeOf(i,t),t.prototype&&(i.prototype=t.prototype),i},SUPPORTS:d,MongoDBNamespace:h,resolveReadPreference:function(e,t){const n=(t=t||{}).session,o=e.readPreference;let r;if(t.readPreference)r=i.fromOptions(t);else if(n&&n.inTransaction()&&n.transaction.options.readPreference)r=n.transaction.options.readPreference;else{if(null==o)throw new Error("No readPreference was provided or inherited.");r=o}return"string"==typeof r?new i(r):r}}},function(e,t,n){"use strict";const o={READ_OPERATION:Symbol("READ_OPERATION"),SKIP_SESSION:Symbol("SKIP_SESSION"),WRITE_OPERATION:Symbol("WRITE_OPERATION"),RETRYABLE:Symbol("RETRYABLE"),EXECUTE_WITH_SELECTION:Symbol("EXECUTE_WITH_SELECTION")};e.exports={Aspect:o,defineAspects:function(e,t){return Array.isArray(t)||t instanceof Set||(t=[t]),t=new Set(t),Object.defineProperty(e,"aspects",{value:t,writable:!1}),t},OperationBase:class{constructor(e){this.options=Object.assign({},e)}hasAspect(e){return null!=this.constructor.aspects&&this.constructor.aspects.has(e)}set session(e){Object.assign(this.options,{session:e})}get session(){return this.options.session}clearSession(){delete this.options.session}get canRetryRead(){return!0}execute(){throw new TypeError("`execute` must be implemented for OperationBase subclasses")}}}},function(e,t,n){"use strict";let o=n(82);const i=n(69),r=n(5).retrieveEJSON();try{const e=i("bson-ext");e&&(o=e)}catch(e){}e.exports={MongoError:n(3).MongoError,MongoNetworkError:n(3).MongoNetworkError,MongoParseError:n(3).MongoParseError,MongoTimeoutError:n(3).MongoTimeoutError,MongoWriteConcernError:n(3).MongoWriteConcernError,mongoErrorContextSymbol:n(3).mongoErrorContextSymbol,Connection:n(83),Server:n(71),ReplSet:n(145),Mongos:n(147),Logger:n(18),Cursor:n(13).CoreCursor,ReadPreference:n(11),Sessions:n(36),BSON:o,EJSON:r,Topology:n(148),Query:n(21).Query,MongoCredentials:n(151).MongoCredentials,defaultAuthProviders:n(87).defaultAuthProviders,MongoCR:n(88),X509:n(89),Plain:n(90),GSSAPI:n(91),ScramSHA1:n(52).ScramSHA1,ScramSHA256:n(52).ScramSHA256,parseConnectionString:n(152)}},function(e,t,n){"use strict";const o=Symbol("mongoErrorContextSymbol"),i=n(5).maxWireVersion;class r extends Error{constructor(e){if(e instanceof Error)super(e.message),this.stack=e.stack;else{if("string"==typeof e)super(e);else for(var t in super(e.message||e.errmsg||e.$err||"n/a"),e)this[t]=e[t];Error.captureStackTrace(this,this.constructor)}this.name="MongoError",this[o]=this[o]||{}}static create(e){return new r(e)}hasErrorLabel(e){return this.errorLabels&&-1!==this.errorLabels.indexOf(e)}}class s extends r{constructor(e){super(e),this.name="MongoNetworkError",this.errorLabels=["TransientTransactionError"]}}class a extends r{constructor(e){super(e),this.name="MongoParseError"}}const c=new Set([6,7,89,91,189,9001,10107,11600,11602,13435,13436]);const l=new Set([91,189,11600,11602,13436]),p=new Set([10107,13435]),u=new Set([11600,91]);function d(e){return!(!e.code||!l.has(e.code))||(e.message.match(/not master or secondary/)||e.message.match(/node is recovering/))}e.exports={MongoError:r,MongoNetworkError:s,MongoParseError:a,MongoTimeoutError:class extends r{constructor(e){super(e),this.name="MongoTimeoutError"}},MongoWriteConcernError:class extends r{constructor(e,t){super(e),this.name="MongoWriteConcernError",null!=t&&(this.result=function(e){const t=Object.assign({},e);return 0===t.ok&&(t.ok=1,delete t.errmsg,delete t.code,delete t.codeName),t}(t))}},mongoErrorContextSymbol:o,isRetryableError:function(e){return c.has(e.code)||e instanceof s||e.message.match(/not master/)||e.message.match(/node is recovering/)},isSDAMUnrecoverableError:function(e,t){return e instanceof a||!!(d(e)||(n=e,n.code&&p.has(n.code)||!d(n)&&n.message.match(/not master/)))&&!(i(t)>=8&&!function(e){return e.code&&u.has(e.code)}(e));var n}}},function(e,t){e.exports=require("util")},function(e,t,n){"use strict";const o=n(16),i=n(69);const r=function(){throw new Error("The `mongodb-extjson` module was not found. Please install it and try again.")};function s(e){if(e.ismaster)return e.ismaster.maxWireVersion;if("function"==typeof e.lastIsMaster){const t=e.lastIsMaster();if(t)return t.maxWireVersion}return e.description?e.description.maxWireVersion:null}e.exports={uuidV4:()=>{const e=o.randomBytes(16);return e[6]=15&e[6]|64,e[8]=63&e[8]|128,e},calculateDurationInMs:e=>{const t=process.hrtime(e);return(1e9*t[0]+t[1])/1e6},relayEvents:function(e,t,n){n.forEach(n=>e.on(n,e=>t.emit(n,e)))},collationNotSupported:function(e,t){return t&&t.collation&&s(e)<5},retrieveEJSON:function(){let e=null;try{e=i("mongodb-extjson")}catch(e){}return e||(e={parse:r,deserialize:r,serialize:r,stringify:r,setBSONModule:r,BSON:r}),e},retrieveKerberos:function(){let e;try{e=i("kerberos")}catch(e){if("MODULE_NOT_FOUND"===e.code)throw new Error("The `kerberos` module was not found. Please install it and try again.");throw e}return e},maxWireVersion:s,isPromiseLike:function(e){return e&&"function"==typeof e.then},eachAsync:function(e,t,n){if(0===e.length)return void n(null);const o=e.length;let i=0;function r(e){e?n(e,null):++i===o&&n(null)}for(let n=0;n<o;++n)t(e[n],r)},isUnifiedTopology:function(e){return null!=e.description}}},function(e,t,n){"use strict";const o=n(78),i=n(4).format,r=n(11),s=n(17).Buffer,a=n(35).TopologyType,c=n(3).MongoError,l=20;function p(e,t,n){e.listeners(t).length>0&&e.emit(t,n)}var u=n(86).version,d=i("Node.js %s, %s",process.version,o.endianness()),h=o.type(),m=process.platform,f=process.arch,g=o.release();function y(e){return JSON.parse(JSON.stringify(e))}var v=function(e){return e.s.serverDescription||(e.s.serverDescription={address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}),e.s.serverDescription},b=function(e,t){e.listeners("serverDescriptionChanged").length>0&&(e.emit("serverDescriptionChanged",{topologyId:-1!==e.s.topologyId?e.s.topologyId:e.id,address:e.name,previousDescription:v(e),newDescription:t}),e.s.serverDescription=t)},x=function(e){return e.s.topologyDescription||(e.s.topologyDescription={topologyType:"Unknown",servers:[{address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}]}),e.s.topologyDescription},S=function(e,t){return t||(t=e.ismaster),t?t.ismaster&&"isdbgrid"===t.msg?"Mongos":t.ismaster&&!t.hosts?"Standalone":t.ismaster?"RSPrimary":t.secondary?"RSSecondary":t.arbiterOnly?"RSArbiter":"Unknown":"Unknown"},w=function(e){return function(t){if("destroyed"!==e.s.state){var n=(new Date).getTime();p(e,"serverHeartbeatStarted",{connectionId:e.name}),e.command("admin.$cmd",{ismaster:!0},{monitoring:!0},(function(o,i){if(o)p(e,"serverHeartbeatFailed",{durationMS:r,failure:o,connectionId:e.name});else{e.emit("ismaster",i,e);var r=(new Date).getTime()-n;p(e,"serverHeartbeatSucceeded",{durationMS:r,reply:i.result,connectionId:e.name}),function(e,t,n){var o=S(e,t);return S(e,n)!==o}(e,e.s.ismaster,i.result)&&b(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:e.s.inTopology?S(e):"Standalone"}),e.s.ismaster=i.result,e.s.isMasterLatencyMS=r}if("function"==typeof t)return t(o,i);e.s.inquireServerStateTimeout=setTimeout(w(e),e.s.haInterval)}))}}};const _={endSessions:function(e,t){Array.isArray(e)||(e=[e]),this.command("admin.$cmd",{endSessions:e},{readPreference:r.primaryPreferred},()=>{"function"==typeof t&&t()})}};const O="This MongoDB deployment does not support retryable writes. Please add retryWrites=false to your connection string.";e.exports.SessionMixins=_,e.exports.resolveClusterTime=function(e,t){null==e.clusterTime?e.clusterTime=t:t.clusterTime.greaterThan(e.clusterTime.clusterTime)&&(e.clusterTime=t)},e.exports.inquireServerState=w,e.exports.getTopologyType=S,e.exports.emitServerDescriptionChanged=b,e.exports.emitTopologyDescriptionChanged=function(e,t){e.listeners("topologyDescriptionChanged").length>0&&(e.emit("topologyDescriptionChanged",{topologyId:-1!==e.s.topologyId?e.s.topologyId:e.id,address:e.name,previousDescription:x(e),newDescription:t}),e.s.serverDescription=t)},e.exports.cloneOptions=function(e){var t={};for(var n in e)t[n]=e[n];return t},e.exports.createClientInfo=function(e){var t=e.clientInfo?y(e.clientInfo):{driver:{name:"nodejs-core",version:u},os:{type:h,name:m,architecture:f,version:g}};if(t.platform&&-1===t.platform.indexOf("mongodb-core")?t.platform=i("%s, mongodb-core: %s",t.platform,u):t.platform||(t.platform=d),e.appname){var n=s.from(e.appname),o=n.length>128?n.slice(0,128).toString("utf8"):e.appname;t.application={name:o}}return t},e.exports.createCompressionInfo=function(e){return e.compression&&e.compression.compressors?(e.compression.compressors.forEach((function(e){if("snappy"!==e&&"zlib"!==e)throw new Error("compressors must be at least one of snappy or zlib")})),e.compression.compressors):[]},e.exports.clone=y,e.exports.diff=function(e,t){var n={servers:[]};e||(e={servers:[]});for(var o=0;o<e.servers.length;o++){for(var i=!1,r=0;r<t.servers.length;r++)if(t.servers[r].address.toLowerCase()===e.servers[o].address.toLowerCase()){i=!0;break}i||n.servers.push({address:e.servers[o].address,from:e.servers[o].type,to:"Unknown"})}for(r=0;r<t.servers.length;r++){for(i=!1,o=0;o<e.servers.length;o++)if(e.servers[o].address.toLowerCase()===t.servers[r].address.toLowerCase()){i=!0;break}i||n.servers.push({address:t.servers[r].address,from:"Unknown",to:t.servers[r].type})}for(o=0;o<e.servers.length;o++){var s=e.servers[o];for(r=0;r<t.servers.length;r++){var a=t.servers[r];s.address.toLowerCase()===a.address.toLowerCase()&&s.type!==a.type&&n.servers.push({address:s.address,from:s.type,to:a.type})}}return n},e.exports.Interval=function(e,t){var n=!1;this.start=function(){return this.isRunning()||(n=setInterval(e,t)),this},this.stop=function(){return clearInterval(n),n=!1,this},this.isRunning=function(){return!1!==n}},e.exports.Timeout=function(e,t){var n=!1;this.start=function(){return this.isRunning()||(n=setTimeout(e,t)),this},this.stop=function(){return clearTimeout(n),n=!1,this},this.isRunning=function(){return(!n||!n._called)&&!1!==n}},e.exports.isRetryableWritesSupported=function(e){return!(e.lastIsMaster().maxWireVersion<6)&&(!!e.logicalSessionTimeoutMinutes&&function(e){return e.description?e.description.type:"mongos"===e.type?a.Sharded:"replset"===e.type?a.ReplicaSetWithPrimary:a.Single}(e)!==a.Single)},e.exports.getMMAPError=function(e){return e.code===l&&e.errmsg.includes("Transaction numbers")?new c({message:O,errmsg:O,originalError:e}):e}},function(e,t,n){"use strict";const o=n(11),i=n(3).MongoError,r=n(24).ServerType,s=n(35).TopologyDescription;e.exports={getReadPreference:function(e,t){var n=e.readPreference||new o("primary");if(t.readPreference&&(n=t.readPreference),"string"==typeof n&&(n=new o(n)),!(n instanceof o))throw new i("read preference must be a ReadPreference instance");return n},MESSAGE_HEADER_SIZE:16,COMPRESSION_DETAILS_SIZE:9,opcodes:{OP_REPLY:1,OP_UPDATE:2001,OP_INSERT:2002,OP_QUERY:2004,OP_GETMORE:2005,OP_DELETE:2006,OP_KILL_CURSORS:2007,OP_COMPRESSED:2012,OP_MSG:2013},parseHeader:function(e){return{length:e.readInt32LE(0),requestId:e.readInt32LE(4),responseTo:e.readInt32LE(8),opCode:e.readInt32LE(12)}},applyCommonQueryOptions:function(e,t){return Object.assign(e,{raw:"boolean"==typeof t.raw&&t.raw,promoteLongs:"boolean"!=typeof t.promoteLongs||t.promoteLongs,promoteValues:"boolean"!=typeof t.promoteValues||t.promoteValues,promoteBuffers:"boolean"==typeof t.promoteBuffers&&t.promoteBuffers,monitoring:"boolean"==typeof t.monitoring&&t.monitoring,fullResult:"boolean"==typeof t.fullResult&&t.fullResult}),"number"==typeof t.socketTimeout&&(e.socketTimeout=t.socketTimeout),t.session&&(e.session=t.session),"string"==typeof t.documentsReturnedIn&&(e.documentsReturnedIn=t.documentsReturnedIn),e},isSharded:function(e){if("mongos"===e.type)return!0;if(e.description&&e.description.type===r.Mongos)return!0;if(e.description&&e.description instanceof s){return Array.from(e.description.servers.values()).some(e=>e.type===r.Mongos)}return!1},databaseNamespace:function(e){return e.split(".")[0]},collectionNamespace:function(e){return e.split(".").slice(1).join(".")}}},function(e,t,n){"use strict";const o=n(0).applyRetryableWrites,i=n(0).applyWriteConcern,r=n(0).decorateWithCollation,s=n(0).decorateWithReadConcern,a=n(10).executeCommand,c=n(0).formattedOrderClause,l=n(0).handleCallback,p=n(2).MongoError,u=n(2).ReadPreference,d=n(0).toError,h=n(13).CursorState;function m(e,t,n){const o="boolean"==typeof n.forceServerObjectId?n.forceServerObjectId:e.s.db.options.forceServerObjectId;return!0===o?t:t.map(t=>(!0!==o&&null==t._id&&(t._id=e.s.pkFactory.createPk()),t))}e.exports={buildCountCommand:function(e,t,n){const o=n.skip,i=n.limit;let a=n.hint;const c=n.maxTimeMS;t=t||{};const l={count:n.collectionName,query:t};return e.s.numberOfRetries?(e.options.hint?a=e.options.hint:e.cmd.hint&&(a=e.cmd.hint),r(l,e,e.cmd)):r(l,e,n),"number"==typeof o&&(l.skip=o),"number"==typeof i&&(l.limit=i),"number"==typeof c&&(l.maxTimeMS=c),a&&(l.hint=a),s(l,e),l},deleteCallback:function(e,t,n){if(null!=n){if(e&&n)return n(e);if(null==t)return n(null,{result:{ok:1}});t.deletedCount=t.result.n,n&&n(null,t)}},findAndModify:function(e,t,n,s,p,d){const h={findAndModify:e.collectionName,query:t};(n=c(n))&&(h.sort=n),h.new=!!p.new,h.remove=!!p.remove,h.upsert=!!p.upsert;const m=p.projection||p.fields;m&&(h.fields=m),p.arrayFilters&&(h.arrayFilters=p.arrayFilters,delete p.arrayFilters),s&&!p.remove&&(h.update=s),p.maxTimeMS&&(h.maxTimeMS=p.maxTimeMS),p.serializeFunctions=p.serializeFunctions||e.s.serializeFunctions,p.checkKeys=!1;let f=Object.assign({},p);f=o(f,e.s.db),(f=i(f,{db:e.s.db,collection:e},p)).writeConcern&&(h.writeConcern=f.writeConcern),!0===f.bypassDocumentValidation&&(h.bypassDocumentValidation=f.bypassDocumentValidation),f.readPreference=u.primary;try{r(h,e,f)}catch(e){return d(e,null)}a(e.s.db,h,f,(e,t)=>e?l(d,e,null):l(d,null,t))},indexInformation:function(e,t,n,o){const i=null!=n.full&&n.full;if(e.serverConfig&&e.serverConfig.isDestroyed())return o(new p("topology was destroyed"));e.collection(t).listIndexes(n).toArray((e,t)=>e?o(d(e)):Array.isArray(t)?i?l(o,null,t):void l(o,null,function(e){let t={};for(let n=0;n<e.length;n++){const o=e[n];t[o.name]=[];for(let e in o.key)t[o.name].push([e,o.key[e]])}return t}(t)):l(o,null,[]))},nextObject:function(e,t){if(e.s.state===h.CLOSED||e.isDead&&e.isDead())return l(t,p.create({message:"Cursor is closed",driver:!0}));if(e.s.state===h.INIT&&e.cmd&&e.cmd.sort)try{e.cmd.sort=c(e.cmd.sort)}catch(e){return l(t,e)}e._next((n,o)=>{if(e.s.state=h.OPEN,n)return l(t,n);l(t,null,o)})},prepareDocs:m,insertDocuments:function(e,t,n,r){"function"==typeof n&&(r=n,n={}),n=n||{},t=Array.isArray(t)?t:[t];let s=Object.assign({},n);s=o(s,e.s.db),!0===(s=i(s,{db:e.s.db,collection:e},n)).keepGoing&&(s.ordered=!1),s.serializeFunctions=n.serializeFunctions||e.s.serializeFunctions,t=m(e,t,n),e.s.topology.insert(e.s.namespace,t,s,(e,n)=>{if(null!=r){if(e)return l(r,e);if(null==n)return l(r,null,null);if(n.result.code)return l(r,d(n.result));if(n.result.writeErrors)return l(r,d(n.result.writeErrors[0]));n.ops=t,l(r,null,n)}})},removeDocuments:function(e,t,n,s){"function"==typeof n?(s=n,n={}):"function"==typeof t&&(s=t,n={},t={}),n=n||{};let a=Object.assign({},n);a=o(a,e.s.db),a=i(a,{db:e.s.db,collection:e},n),null==t&&(t={});const c={q:t,limit:0};n.single?c.limit=1:a.retryWrites&&(a.retryWrites=!1);try{r(a,e,n)}catch(e){return s(e,null)}e.s.topology.remove(e.s.namespace,[c],a,(e,t)=>{if(null!=s)return e?l(s,e,null):null==t?l(s,null,null):t.result.code?l(s,d(t.result)):t.result.writeErrors?l(s,d(t.result.writeErrors[0])):void l(s,null,t)})},updateDocuments:function(e,t,n,s,a){if("function"==typeof s&&(a=s,s=null),null==s&&(s={}),"function"!=typeof a&&(a=null),null==t||"object"!=typeof t)return a(d("selector must be a valid JavaScript object"));if(null==n||"object"!=typeof n)return a(d("document must be a valid JavaScript object"));let c=Object.assign({},s);c=o(c,e.s.db),(c=i(c,{db:e.s.db,collection:e},s)).serializeFunctions=s.serializeFunctions||e.s.serializeFunctions;const p={q:t,u:n};p.upsert=void 0!==s.upsert&&!!s.upsert,p.multi=void 0!==s.multi&&!!s.multi,c.arrayFilters&&(p.arrayFilters=c.arrayFilters,delete c.arrayFilters),c.retryWrites&&p.multi&&(c.retryWrites=!1);try{r(c,e,s)}catch(e){return a(e,null)}e.s.topology.update(e.s.namespace,[p],c,(e,t)=>{if(null!=a)return e?l(a,e,null):null==t?l(a,null,null):t.result.code?l(a,d(t.result)):t.result.writeErrors?l(a,d(t.result.writeErrors[0])):void l(a,null,t)})},updateCallback:function(e,t,n){if(null!=n){if(e)return n(e);if(null==t)return n(null,{result:{ok:1}});t.modifiedCount=null!=t.result.nModified?t.result.nModified:t.result.n,t.upsertedId=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?t.result.upserted[0]:null,t.upsertedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length?t.result.upserted.length:0,t.matchedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?0:t.result.n,n(null,t)}}}},function(e,t){e.exports=require("events")},function(e,t,n){"use strict";const o=n(0).applyWriteConcern,i=n(2).BSON.Code,r=n(0).resolveReadPreference,s=n(16),a=n(0).debugOptions,c=n(0).handleCallback,l=n(2).MongoError,p=n(0).parseIndexOptions,u=n(2).ReadPreference,d=n(0).toError,h=n(73),m=n(0).MongoDBNamespace,f=n(19).count,g=n(19).findOne,y=n(19).remove,v=n(19).updateOne;let b,x;function S(){return x||(x=n(39)),x}const w=["authSource","w","wtimeout","j","native_parser","forceServerObjectId","serializeFunctions","raw","promoteLongs","promoteValues","promoteBuffers","bufferMaxEntries","numberOfRetries","retryMiliSeconds","readPreference","pkFactory","parentDb","promiseLibrary","noListener"];function _(e,t,n,i,r){let s=Object.assign({},{readPreference:u.PRIMARY},i);if((s=o(s,{db:e},i)).writeConcern&&"function"!=typeof r)throw l.create({message:"Cannot use a writeConcern without a provided callback",driver:!0});if(e.serverConfig&&e.serverConfig.isDestroyed())return r(new l("topology was destroyed"));!function(e,t,n,i,r){const s=p(n),a="string"==typeof i.name?i.name:s.name,h=[{name:a,key:s.fieldHash}],m=Object.keys(h[0]).concat(["writeConcern","w","wtimeout","j","fsync","readPreference","session"]);for(let e in i)-1===m.indexOf(e)&&(h[0][e]=i[e]);const f=e.s.topology.capabilities();if(h[0].collation&&f&&!f.commandsTakeCollation){const e=new l("server/primary/mongos does not support collation");return e.code=67,r(e)}const g=o({createIndexes:t,indexes:h},{db:e},i);i.readPreference=u.PRIMARY,O(e,g,i,(e,t)=>e?c(r,e,null):0===t.ok?c(r,d(t),null):void c(r,null,a))}(e,t,n,s,(o,a)=>{if(null==o)return c(r,o,a);if(67===o.code||11e3===o.code||85===o.code||86===o.code||11600===o.code||197===o.code)return c(r,o,a);const p=E(e,t,n,i);s.checkKeys=!1,e.s.topology.insert(e.s.namespace.withCollection(h.SYSTEM_INDEX_COLLECTION),p,s,(e,t)=>{if(null!=r)return e?c(r,e):null==t?c(r,null,null):t.result.writeErrors?c(r,l.create(t.result.writeErrors[0]),null):void c(r,null,p.name)})})}function O(e,t,n,o){if(e.serverConfig&&e.serverConfig.isDestroyed())return o(new l("topology was destroyed"));const i=n.dbName||n.authdb||e.databaseName;n.readPreference=r(e,n),e.s.logger.isDebug()&&e.s.logger.debug(`executing command ${JSON.stringify(t)} against ${i}.$cmd with options [${JSON.stringify(a(w,n))}]`),e.s.topology.command(e.s.namespace.withCollection("$cmd"),t,n,(e,t)=>e?c(o,e):n.full?c(o,null,t):void c(o,null,t.result))}function T(e,t,n,o){const i=null!=n.full&&n.full;if(e.serverConfig&&e.serverConfig.isDestroyed())return o(new l("topology was destroyed"));e.collection(t).listIndexes(n).toArray((e,t)=>e?o(d(e)):Array.isArray(t)?i?c(o,null,t):void c(o,null,function(e){let t={};for(let n=0;n<e.length;n++){const o=e[n];t[o.name]=[];for(let e in o.key)t[o.name].push([e,o.key[e]])}return t}(t)):c(o,null,[]))}function E(e,t,n,o){const i=p(n),r=i.fieldHash,s="string"==typeof o.name?o.name:i.name,a={ns:e.s.namespace.withCollection(t).toString(),key:r,name:s},c=null!=o&&"object"!=typeof o&&o;o=null==o||"boolean"==typeof o?{}:o;const l=Object.keys(a);for(let e in o)-1===l.indexOf(e)&&(a[e]=o[e]);null==a.unique&&(a.unique=c);const u=["w","wtimeout","j","fsync","readPreference","session"];for(let e=0;e<u.length;e++)delete a[u[e]];return a}e.exports={addUser:function(e,t,n,i,r){let a=S();if(e.serverConfig&&e.serverConfig.isDestroyed())return r(new l("topology was destroyed"));!function(e,t,n,i,r){"string"==typeof t&&null!=n&&"object"==typeof n&&(i=n,n=null);"function"==typeof i&&(r=i,i={});if(null!=i.digestPassword)return r(d("The digestPassword option is not supported via add_user. Please use db.command('createUser', ...) instead for this option."));const a=null!=i.customData?i.customData:{};let l=Array.isArray(i.roles)?i.roles:[];const p="number"==typeof i.maxTimeMS?i.maxTimeMS:null;0===l.length&&console.log("Creating a user without roles is deprecated in MongoDB >= 2.6");const h={writeCommand:!0};i.dbName&&(h.dbName=i.dbName);null!=p&&(h.maxTimeMS=p);"admin"!==e.databaseName.toLowerCase()&&"admin"!==i.dbName||Array.isArray(i.roles)?Array.isArray(i.roles)||(l=["dbOwner"]):l=["root"];const m=e.s.topology.lastIsMaster().maxWireVersion>=7;let f={createUser:t,customData:a,roles:l,digestPassword:m};f=o(f,{db:e},i);let g=n;if(!m){const e=s.createHash("md5");e.update(t+":mongo:"+n),g=e.digest("hex")}"string"==typeof n&&(f.pwd=g);h.readPreference=u.primary,O(e,f,h,(e,n)=>e&&0===e.ok&&void 0===e.code?c(r,{code:-5e3},null):e?c(r,e,null):void c(r,n.ok?null:d(n),n.ok?[{user:t,pwd:""}]:null))}(e,t,n,i,(l,p)=>{if(l&&-5e3===l.code){const l=o(Object.assign({},i),{db:e},i),p=s.createHash("md5");p.update(t+":mongo:"+n);const u=p.digest("hex"),d=(i.dbName?new a(i.dbName,e.s.topology,e.s.options):e).collection(h.SYSTEM_USER_COLLECTION);f(d,{},l,(e,n)=>{if(null!=e)return c(r,e,null);const o=Object.assign({projection:{dbName:1}},l);d.find({user:t},o).toArray(e=>{if(null!=e)return c(r,e,null);l.upsert=!0,v(d,{user:t},{$set:{user:t,pwd:u}},l,e=>0===n&&e?c(r,null,[{user:t,pwd:u}]):e?c(r,e,null):void c(r,null,[{user:t,pwd:u}]))})})}else{if(l)return c(r,l);c(r,l,p)}})},collections:function(e,t,o){let i=(b||(b=n(32)),b);t=Object.assign({},t,{nameOnly:!0}),e.listCollections({},t).toArray((t,n)=>{if(null!=t)return c(o,t,null);n=n.filter(e=>-1===e.name.indexOf("$")),c(o,null,n.map(t=>new i(e,e.s.topology,e.databaseName,t.name,e.s.pkFactory,e.s.options)))})},createListener:function(e,t,n){return function(o){if(n.listeners(t).length>0){n.emit(t,o,e);for(let n=0;n<e.s.children.length;n++)e.s.children[n].emit(t,o,e.s.children[n])}}},createIndex:_,dropCollection:function(e,t,n,o){O(e,t,n,(t,n)=>e.serverConfig&&e.serverConfig.isDestroyed()?o(new l("topology was destroyed")):t?c(o,t):n.ok?c(o,null,!0):void c(o,null,!1))},dropDatabase:function(e,t,n,o){O(e,t,n,(t,n)=>e.serverConfig&&e.serverConfig.isDestroyed()?o(new l("topology was destroyed")):null!=o?t?c(o,t,null):void c(o,null,!!n.ok):void 0)},ensureIndex:function(e,t,n,i,r){const s=o({},{db:e},i),a=E(e,t,n,i).name;if(e.serverConfig&&e.serverConfig.isDestroyed())return r(new l("topology was destroyed"));s.readPreference=u.PRIMARY,T(e,t,s,(o,s)=>{if(null!=o&&26!==o.code)return c(r,o,null);if(null!=s&&s[a]){if("function"==typeof r)return c(r,null,a)}else _(e,t,n,i,r)})},evaluate:function(e,t,n,o,r){let s=t,a=[];if(e.serverConfig&&e.serverConfig.isDestroyed())return r(new l("topology was destroyed"));s&&"Code"===s._bsontype||(s=new i(s)),null==n||Array.isArray(n)||"function"==typeof n?null!=n&&Array.isArray(n)&&"function"!=typeof n&&(a=n):a=[n];let p={$eval:s,args:a};o.nolock&&(p.nolock=o.nolock),o.readPreference=new u(u.PRIMARY),O(e,p,o,(e,t)=>e?c(r,e,null):t&&1===t.ok?c(r,null,t.retval):t?c(r,l.create({message:`eval failed: ${t.errmsg}`,driver:!0}),null):void c(r,e,t))},executeCommand:O,executeDbAdminCommand:function(e,t,n,o){const i=new m("admin","$cmd");e.s.topology.command(i,t,n,(t,n)=>e.serverConfig&&e.serverConfig.isDestroyed()?o(new l("topology was destroyed")):t?c(o,t):void c(o,null,n.result))},indexInformation:T,profilingInfo:function(e,t,n){try{e.collection("system.profile").find({},t).toArray(n)}catch(e){return n(e,null)}},removeUser:function(e,t,n,i){let r=S();!function(e,t,n,i){"function"==typeof n&&(i=n,n={});if(n=n||{},e.serverConfig&&e.serverConfig.isDestroyed())return i(new l("topology was destroyed"));const r={writeCommand:!0};n.dbName&&(r.dbName=n.dbName);const s="number"==typeof n.maxTimeMS?n.maxTimeMS:null;null!=s&&(r.maxTimeMS=s);let a={dropUser:t};a=o(a,{db:e},n),r.readPreference=u.primary,O(e,a,r,(e,t)=>e&&!e.ok&&void 0===e.code?c(i,{code:-5e3}):e?c(i,e,null):void c(i,null,!!t.ok))}(e,t,n,(e,s)=>{if(e&&-5e3===e.code){const e=o(Object.assign({},n),{db:s},n),s=n.dbName?new r(n.dbName,s.s.topology,s.s.options):s,a=s.collection(h.SYSTEM_USER_COLLECTION);g(a,{user:t},e,(n,o)=>{if(null==o)return c(i,n,!1);y(a,{user:t},e,e=>{c(i,e,!0)})})}else{if(e)return c(i,e);c(i,e,s)}})},validateDatabaseName:function(e){if("string"!=typeof e)throw l.create({message:"database name must be a string",driver:!0});if(0===e.length)throw l.create({message:"database name cannot be the empty string",driver:!0});if("$external"===e)return;const t=[" ",".","$","/","\\"];for(let n=0;n<t.length;n++)if(-1!==e.indexOf(t[n]))throw l.create({message:"database names cannot contain the character '"+t[n]+"'",driver:!0})}}},function(e,t,n){"use strict";const o=function(e,t,n){if(!o.isValid(e))throw new TypeError(`Invalid read preference mode ${e}`);if(t&&!Array.isArray(t)&&(console.warn("ReadPreference tags must be an array, this will change in the next major version"),void 0!==t.maxStalenessSeconds?(n=t,t=void 0):t=[t]),this.mode=e,this.tags=t,null!=(n=n||{}).maxStalenessSeconds){if(n.maxStalenessSeconds<=0)throw new TypeError("maxStalenessSeconds must be a positive integer");this.maxStalenessSeconds=n.maxStalenessSeconds,this.minWireVersion=5}if(this.mode===o.PRIMARY){if(this.tags&&Array.isArray(this.tags)&&this.tags.length>0)throw new TypeError("Primary read preference cannot be combined with tags");if(this.maxStalenessSeconds)throw new TypeError("Primary read preference cannot be combined with maxStalenessSeconds")}};Object.defineProperty(o.prototype,"preference",{enumerable:!0,get:function(){return this.mode}}),o.PRIMARY="primary",o.PRIMARY_PREFERRED="primaryPreferred",o.SECONDARY="secondary",o.SECONDARY_PREFERRED="secondaryPreferred",o.NEAREST="nearest";const i=[o.PRIMARY,o.PRIMARY_PREFERRED,o.SECONDARY,o.SECONDARY_PREFERRED,o.NEAREST,null];o.fromOptions=function(e){const t=e.readPreference,n=e.readPreferenceTags;if(null==t)return null;if("string"==typeof t)return new o(t,n);if(!(t instanceof o)&&"object"==typeof t){const e=t.mode||t.preference;if(e&&"string"==typeof e)return new o(e,t.tags,{maxStalenessSeconds:t.maxStalenessSeconds})}return t},o.isValid=function(e){return-1!==i.indexOf(e)},o.prototype.isValid=function(e){return o.isValid("string"==typeof e?e:this.mode)};const r=["primaryPreferred","secondary","secondaryPreferred","nearest"];o.prototype.slaveOk=function(){return-1!==r.indexOf(this.mode)},o.prototype.equals=function(e){return e.mode===this.mode},o.prototype.toJSON=function(){const e={mode:this.mode};return Array.isArray(this.tags)&&(e.tags=this.tags),this.maxStalenessSeconds&&(e.maxStalenessSeconds=this.maxStalenessSeconds),e},o.primary=new o("primary"),o.primaryPreferred=new o("primaryPreferred"),o.secondary=new o("secondary"),o.secondaryPreferred=new o("secondaryPreferred"),o.nearest=new o("nearest"),e.exports=o},function(e,t,n){"use strict";const o=n(69);function i(){throw new Error("Attempted to use Snappy compression, but Snappy is not installed. Install or disable Snappy compression and try again.")}e.exports={debugOptions:function(e,t){var n={};return e.forEach((function(e){n[e]=t[e]})),n},retrieveBSON:function(){var e=n(82);e.native=!1;try{var t=o("bson-ext");if(t)return t.native=!0,t}catch(e){}return e},retrieveSnappy:function(){var e=null;try{e=o("snappy")}catch(e){}return e||(e={compress:i,uncompress:i,compressSync:i,uncompressSync:i}),e}}},function(e,t,n){"use strict";const o=n(18),i=n(12).retrieveBSON,r=n(3).MongoError,s=n(3).MongoNetworkError,a=n(3).mongoErrorContextSymbol,c=n(5).collationNotSupported,l=n(11),p=n(5).isUnifiedTopology,u=n(30),d=n(14).Readable,h=n(0).SUPPORTS,m=n(0).MongoDBNamespace,f=n(1).OperationBase,g=i().Long,y={INIT:0,OPEN:1,CLOSED:2,GET_MORE:3};function v(e,t,n){try{e(t,n)}catch(t){process.nextTick((function(){throw t}))}}class b extends d{constructor(e,t,n,i){super({objectMode:!0}),i=i||{},t instanceof f&&(this.operation=t,t=this.operation.ns.toString(),i=this.operation.options,n=this.operation.cmd?this.operation.cmd:{}),this.pool=null,this.server=null,this.disconnectHandler=i.disconnectHandler,this.bson=e.s.bson,this.ns=t,this.namespace=m.fromString(t),this.cmd=n,this.options=i,this.topology=e,this.cursorState={cursorId:null,cmd:n,documents:i.documents||[],cursorIndex:0,dead:!1,killed:!1,init:!1,notified:!1,limit:i.limit||n.limit||0,skip:i.skip||n.skip||0,batchSize:i.batchSize||n.batchSize||1e3,currentLimit:0,transforms:i.transforms,raw:i.raw||n&&n.raw},"object"==typeof i.session&&(this.cursorState.session=i.session);const r=e.s.options;"boolean"==typeof r.promoteLongs?this.cursorState.promoteLongs=r.promoteLongs:"boolean"==typeof i.promoteLongs&&(this.cursorState.promoteLongs=i.promoteLongs),"boolean"==typeof r.promoteValues?this.cursorState.promoteValues=r.promoteValues:"boolean"==typeof i.promoteValues&&(this.cursorState.promoteValues=i.promoteValues),"boolean"==typeof r.promoteBuffers?this.cursorState.promoteBuffers=r.promoteBuffers:"boolean"==typeof i.promoteBuffers&&(this.cursorState.promoteBuffers=i.promoteBuffers),r.reconnect&&(this.cursorState.reconnect=r.reconnect),this.logger=o("Cursor",r),"number"==typeof n?(this.cursorState.cursorId=g.fromNumber(n),this.cursorState.lastCursorId=this.cursorState.cursorId):n instanceof g&&(this.cursorState.cursorId=n,this.cursorState.lastCursorId=n),this.operation&&(this.operation.cursorState=this.cursorState)}setCursorBatchSize(e){this.cursorState.batchSize=e}cursorBatchSize(){return this.cursorState.batchSize}setCursorLimit(e){this.cursorState.limit=e}cursorLimit(){return this.cursorState.limit}setCursorSkip(e){this.cursorState.skip=e}cursorSkip(){return this.cursorState.skip}_next(e){!function e(t,n){if(t.cursorState.notified)return n(new Error("cursor is exhausted"));if(function(e,t){if(e.cursorState.killed)return S(e,t),!0;return!1}(t,n))return;if(function(e,t){if(e.cursorState.dead&&!e.cursorState.killed)return e.cursorState.killed=!0,S(e,t),!0;return!1}(t,n))return;if(function(e,t){if(e.cursorState.dead&&e.cursorState.killed)return v(t,new r("cursor is dead")),!0;return!1}(t,n))return;if(!t.cursorState.init){if(!t.topology.isConnected(t.options)){if("server"===t.topology._type&&!t.topology.s.options.reconnect)return n(new r("no connection available"));if(null!=t.disconnectHandler)return t.topology.isDestroyed()?n(new r("Topology was destroyed")):void t.disconnectHandler.addObjectAndMethod("cursor",t,"next",[n],n)}return void t._initializeCursor((o,i)=>{o||null===i?n(o,i):e(t,n)})}if(t.cursorState.limit>0&&t.cursorState.currentLimit>=t.cursorState.limit)return t.kill(),x(t,n);if(t.cursorState.cursorIndex!==t.cursorState.documents.length||g.ZERO.equals(t.cursorState.cursorId)){if(t.cursorState.documents.length===t.cursorState.cursorIndex&&t.cmd.tailable&&g.ZERO.equals(t.cursorState.cursorId))return v(n,new r({message:"No more documents in tailed cursor",tailable:t.cmd.tailable,awaitData:t.cmd.awaitData}));if(t.cursorState.documents.length===t.cursorState.cursorIndex&&g.ZERO.equals(t.cursorState.cursorId))x(t,n);else{if(t.cursorState.limit>0&&t.cursorState.currentLimit>=t.cursorState.limit)return t.kill(),x(t,n);t.cursorState.currentLimit+=1;let e=t.cursorState.documents[t.cursorState.cursorIndex++];if(!e||e.$err)return t.kill(),x(t,(function(){v(n,new r(e?e.$err:void 0))}));t.cursorState.transforms&&"function"==typeof t.cursorState.transforms.doc&&(e=t.cursorState.transforms.doc(e)),v(n,null,e)}}else{if(t.cursorState.documents=[],t.cursorState.cursorIndex=0,t.topology.isDestroyed())return n(new s("connection destroyed, not possible to instantiate cursor"));if(function(e,t){if(e.pool&&e.pool.isDestroyed()){e.cursorState.killed=!0;const n=new s(`connection to host ${e.pool.host}:${e.pool.port} was destroyed`);return w(e,()=>t(n)),!0}return!1}(t,n))return;t._getMore((function(o,i,s){return o?(o instanceof r&&(o[a].isGetMore=!0),v(n,o)):(t.cursorState.cursorId&&t.cursorState.cursorId.isZero()&&t._endSession&&t._endSession(),t.connection=s,0===t.cursorState.documents.length&&t.cmd.tailable&&g.ZERO.equals(t.cursorState.cursorId)?v(n,new r({message:"No more documents in tailed cursor",tailable:t.cmd.tailable,awaitData:t.cmd.awaitData})):0===t.cursorState.documents.length&&t.cmd.tailable&&!g.ZERO.equals(t.cursorState.cursorId)?e(t,n):t.cursorState.limit>0&&t.cursorState.currentLimit>=t.cursorState.limit?x(t,n):void e(t,n))}))}}(this,e)}clone(){return this.topology.cursor(this.ns,this.cmd,this.options)}isDead(){return!0===this.cursorState.dead}isKilled(){return!0===this.cursorState.killed}isNotified(){return!0===this.cursorState.notified}bufferedCount(){return this.cursorState.documents.length-this.cursorState.cursorIndex}readBufferedDocuments(e){const t=this.cursorState.documents.length-this.cursorState.cursorIndex,n=e<t?e:t;let o=this.cursorState.documents.slice(this.cursorState.cursorIndex,this.cursorState.cursorIndex+n);if(this.cursorState.transforms&&"function"==typeof this.cursorState.transforms.doc)for(let e=0;e<o.length;e++)o[e]=this.cursorState.transforms.doc(o[e]);return this.cursorState.limit>0&&this.cursorState.currentLimit+o.length>this.cursorState.limit&&(o=o.slice(0,this.cursorState.limit-this.cursorState.currentLimit),this.kill()),this.cursorState.currentLimit=this.cursorState.currentLimit+o.length,this.cursorState.cursorIndex=this.cursorState.cursorIndex+o.length,o}kill(e){this.cursorState.dead=!0,this.cursorState.killed=!0,this.cursorState.documents=[],null==this.cursorState.cursorId||this.cursorState.cursorId.isZero()||!1===this.cursorState.init?e&&e(null,null):this.server.killCursors(this.ns,this.cursorState,e)}rewind(){this.cursorState.init&&(this.cursorState.dead||this.kill(),this.cursorState.currentLimit=0,this.cursorState.init=!1,this.cursorState.dead=!1,this.cursorState.killed=!1,this.cursorState.notified=!1,this.cursorState.documents=[],this.cursorState.cursorId=null,this.cursorState.cursorIndex=0)}_read(){if(this.s&&this.s.state===y.CLOSED||this.isDead())return this.push(null);this._next((e,t)=>e?(this.listeners("error")&&this.listeners("error").length>0&&this.emit("error",e),this.isDead()||this.close(),this.emit("end"),this.emit("finish")):this.cursorState.streamOptions&&"function"==typeof this.cursorState.streamOptions.transform&&null!=t?this.push(this.cursorState.streamOptions.transform(t)):this.cursorState.transforms&&"function"==typeof this.cursorState.transforms.doc&&null!=t?this.push(this.cursorState.transforms.doc(t)):(this.push(t),void(null===t&&this.isDead()&&this.once("end",()=>{this.close(),this.emit("finish")}))))}_endSession(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=this.cursorState.session;return n&&(e.force||n.owner===this)?(this.cursorState.session=void 0,this.operation&&this.operation.clearSession(),n.endSession(t),!0):(t&&t(),!1)}_getMore(e){this.logger.isDebug()&&this.logger.debug(`schedule getMore call for query [${JSON.stringify(this.query)}]`);let t=this.cursorState.batchSize;this.cursorState.limit>0&&this.cursorState.currentLimit+t>this.cursorState.limit&&(t=this.cursorState.limit-this.cursorState.currentLimit),this.server.getMore(this.ns,this.cursorState,t,this.options,e)}_initializeCursor(e){const t=this;if(p(t.topology)&&t.topology.shouldCheckForSessionSupport())return void t.topology.selectServer(l.primaryPreferred,n=>{n?e(n):t._next(e)});function n(n,o){if(t.cursorState.cursorId&&t.cursorState.cursorId.isZero()&&t._endSession&&t._endSession(),0===t.cursorState.documents.length&&t.cursorState.cursorId&&t.cursorState.cursorId.isZero()&&!t.cmd.tailable&&!t.cmd.awaitData)return S(t,e);e(n,o)}const o=(e,o)=>{if(e)return n(e);const i=o.message;if(i.queryFailure)return n(new r(i.documents[0]),null);if(Array.isArray(i.documents)&&1===i.documents.length&&(!t.cmd.find||t.cmd.find&&!1===t.cmd.virtual)&&("string"!=typeof i.documents[0].cursor||i.documents[0].$err||i.documents[0].errmsg||Array.isArray(i.documents[0].result))){if(i.documents[0].$err||i.documents[0].errmsg)return n(new r(i.documents[0]),null);if(null!=i.documents[0].cursor&&"string"!=typeof i.documents[0].cursor){const e=i.documents[0].cursor.id;return i.documents[0].cursor.ns&&(t.ns=i.documents[0].cursor.ns),t.cursorState.cursorId="number"==typeof e?g.fromNumber(e):e,t.cursorState.lastCursorId=t.cursorState.cursorId,t.cursorState.operationTime=i.documents[0].operationTime,Array.isArray(i.documents[0].cursor.firstBatch)&&(t.cursorState.documents=i.documents[0].cursor.firstBatch),n(null,i)}if(Array.isArray(i.documents[0].result))return t.cursorState.documents=i.documents[0].result,t.cursorState.cursorId=g.ZERO,n(null,i)}const s=i.cursorId||0;t.cursorState.cursorId=s instanceof g?s:g.fromNumber(s),t.cursorState.documents=i.documents,t.cursorState.lastCursorId=i.cursorId,t.cursorState.transforms&&"function"==typeof t.cursorState.transforms.query&&(t.cursorState.documents=t.cursorState.transforms.query(i)),n(null,i)};if(t.operation)return t.logger.isDebug()&&t.logger.debug(`issue initial query [${JSON.stringify(t.cmd)}] with flags [${JSON.stringify(t.query)}]`),void u(t.topology,t.operation,(e,i)=>{if(e)n(e);else{if(t.server=t.operation.server,t.cursorState.init=!0,null!=t.cursorState.cursorId)return n();o(e,i)}});const i={};return t.cursorState.session&&(i.session=t.cursorState.session),t.operation?i.readPreference=t.operation.readPreference:t.options.readPreference&&(i.readPreference=t.options.readPreference),t.topology.selectServer(i,(i,s)=>{if(i){const n=t.disconnectHandler;return null!=n?n.addObjectAndMethod("cursor",t,"next",[e],e):e(i)}if(t.server=s,t.cursorState.init=!0,c(t.server,t.cmd))return e(new r(`server ${t.server.name} does not support collation`));if(null!=t.cursorState.cursorId)return n();if(t.logger.isDebug()&&t.logger.debug(`issue initial query [${JSON.stringify(t.cmd)}] with flags [${JSON.stringify(t.query)}]`),null!=t.cmd.find)return void s.query(t.ns,t.cmd,t.cursorState,t.options,o);const a=Object.assign({session:t.cursorState.session},t.options);s.command(t.ns,t.cmd,a,o)})}}function x(e,t){e.cursorState.dead=!0,S(e,t)}function S(e,t){w(e,()=>v(t,null,null))}function w(e,t){if(e.cursorState.notified=!0,e.cursorState.documents=[],e.cursorState.cursorIndex=0,!e._endSession)return t();e._endSession(void 0,()=>t())}h.ASYNC_ITERATOR&&(b.prototype[Symbol.asyncIterator]=n(93).asyncIterator),e.exports={CursorState:y,CoreCursor:b}},function(e,t){e.exports=require("stream")},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(1).OperationBase,r=n(0).applyWriteConcern,s=n(0).debugOptions,a=n(0).handleCallback,c=n(2).MongoError,l=n(2).ReadPreference,p=n(0).resolveReadPreference,u=n(0).MongoDBNamespace,d=["authSource","w","wtimeout","j","native_parser","forceServerObjectId","serializeFunctions","raw","promoteLongs","promoteValues","promoteBuffers","bufferMaxEntries","numberOfRetries","retryMiliSeconds","readPreference","pkFactory","parentDb","promiseLibrary","noListener"];e.exports=class extends i{constructor(e,t,n,i){super(t),this.hasAspect(o.WRITE_OPERATION)?(r(this.options,null!=n?{db:e,coll:n}:{db:e},this.options),this.options.readPreference=l.primary):this.options.readPreference=p(null!=n?n:e,t),this.db=e,null!=i&&(this.command=i),null!=n&&(this.collection=n)}_buildCommand(){if(null!=this.command)return this.command}execute(e){const t=this.db,n=Object.assign({},this.options);if(t.serverConfig&&t.serverConfig.isDestroyed())return e(new c("topology was destroyed"));let i;try{i=this._buildCommand()}catch(t){return e(t)}const r=n.dbName||n.authdb||t.databaseName;this.hasAspect(o.WRITE_OPERATION)&&(!n.writeConcern||n.session&&n.session.inTransaction()||(i.writeConcern=n.writeConcern)),t.s.logger.isDebug()&&t.s.logger.debug(`executing command ${JSON.stringify(i)} against ${r}.$cmd with options [${JSON.stringify(s(d,n))}]`);const l=null!=this.namespace?this.namespace:new u(r,"$cmd");t.s.topology.command(l,i,n,(t,o)=>t?a(e,t):n.full?a(e,null,o):void a(e,null,o.result))}}},function(e,t){e.exports=require("crypto")},function(e,t,n){var o=n(60),i=o.Buffer;function r(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=o:(r(o,t),t.Buffer=s),r(i,s),s.from=function(e,t,n){if("number"==typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw new TypeError("Argument must be a number");var o=i(e);return void 0!==t?"string"==typeof n?o.fill(t,n):o.fill(t):o.fill(0),o},s.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return o.SlowBuffer(e)}},function(e,t,n){"use strict";var o=n(4).format,i=n(3).MongoError,r={},s={},a=null,c=process.pid,l=null,p=function(e,t){if(!(this instanceof p))return new p(e,t);t=t||{},this.className=e,t.logger?l=t.logger:null==l&&(l=console.log),t.loggerLevel&&(a=t.loggerLevel||"error"),null==s[this.className]&&(r[this.className]=!0)};p.prototype.debug=function(e,t){if(this.isDebug()&&(Object.keys(s).length>0&&s[this.className]||0===Object.keys(s).length&&r[this.className])){var n=(new Date).getTime(),i=o("[%s-%s:%s] %s %s","DEBUG",this.className,c,n,e),a={type:"debug",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),l(i,a)}},p.prototype.warn=function(e,t){if(this.isWarn()&&(Object.keys(s).length>0&&s[this.className]||0===Object.keys(s).length&&r[this.className])){var n=(new Date).getTime(),i=o("[%s-%s:%s] %s %s","WARN",this.className,c,n,e),a={type:"warn",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),l(i,a)}},p.prototype.info=function(e,t){if(this.isInfo()&&(Object.keys(s).length>0&&s[this.className]||0===Object.keys(s).length&&r[this.className])){var n=(new Date).getTime(),i=o("[%s-%s:%s] %s %s","INFO",this.className,c,n,e),a={type:"info",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),l(i,a)}},p.prototype.error=function(e,t){if(this.isError()&&(Object.keys(s).length>0&&s[this.className]||0===Object.keys(s).length&&r[this.className])){var n=(new Date).getTime(),i=o("[%s-%s:%s] %s %s","ERROR",this.className,c,n,e),a={type:"error",message:e,className:this.className,pid:c,date:n};t&&(a.meta=t),l(i,a)}},p.prototype.isInfo=function(){return"info"===a||"debug"===a},p.prototype.isError=function(){return"error"===a||"info"===a||"debug"===a},p.prototype.isWarn=function(){return"error"===a||"warn"===a||"info"===a||"debug"===a},p.prototype.isDebug=function(){return"debug"===a},p.reset=function(){a="error",s={}},p.currentLogger=function(){return l},p.setCurrentLogger=function(e){if("function"!=typeof e)throw new i("current logger must be a function");l=e},p.filter=function(e,t){"class"===e&&Array.isArray(t)&&(s={},t.forEach((function(e){s[e]=!0})))},p.setLevel=function(e){if("info"!==e&&"error"!==e&&"debug"!==e&&"warn"!==e)throw new Error(o("%s is an illegal logging level",e));a=e},e.exports=p},function(e,t,n){"use strict";const o=n(0).applyWriteConcern,i=n(2).BSON.Code,r=n(10).createIndex,s=n(0).decorateWithCollation,a=n(0).decorateWithReadConcern,c=n(10).ensureIndex,l=n(10).evaluate,p=n(10).executeCommand,u=n(0).resolveReadPreference,d=n(0).handleCallback,h=n(10).indexInformation,m=n(2).BSON.Long,f=n(2).MongoError,g=n(2).ReadPreference,y=n(0).toError,v=n(8).insertDocuments,b=n(8).updateDocuments,x='function () {\nvar c = db[ns].find(condition);\nvar map = new Map();\nvar reduce_function = reduce;\n\nwhile (c.hasNext()) {\nvar obj = c.next();\nvar key = {};\n\nfor (var i = 0, len = keys.length; i < len; ++i) {\nvar k = keys[i];\nkey[k] = obj[k];\n}\n\nvar aggObj = map.get(key);\n\nif (aggObj == null) {\nvar newObj = Object.extend({}, key);\naggObj = Object.extend(newObj, initial);\nmap.put(key, aggObj);\n}\n\nreduce_function(obj, aggObj);\n}\n\nreturn { "result": map.values() };\n}';function S(e,t,n){h(e.s.db,e.collectionName,t,n)}e.exports={checkForAtomicOperators:function e(t){if(Array.isArray(t))return t.reduce((t,n)=>t||e(n),null);const n=Object.keys(t);return 0===n.length?y("The update operation document must contain at least one atomic operator."):"$"!==n[0][0]?y("the update operation document must contain atomic operators."):void 0},createIndex:function(e,t,n,o){r(e.s.db,e.collectionName,t,n,o)},createIndexes:function(e,t,n,o){const i=e.s.topology.capabilities();for(let e=0;e<t.length;e++)if(null==t[e].name){const n=[];if(t[e].collation&&i&&!i.commandsTakeCollation)return o(new f("server/primary/mongos does not support collation"));for(let o in t[e].key)n.push(`${o}_${t[e].key[o]}`);t[e].name=n.join("_")}n=Object.assign({},n,{readPreference:g.PRIMARY}),p(e.s.db,{createIndexes:e.collectionName,indexes:t},n,o)},ensureIndex:function(e,t,n,o){c(e.s.db,e.collectionName,t,n,o)},group:function(e,t,n,o,r,c,h,m,f){if(h){const l=r&&"Code"===r._bsontype?r:new i(r),h={group:{ns:e.collectionName,$reduce:l,cond:n,initial:o,out:"inline"}};if(null!=c&&(h.group.finalize=c),"function"==typeof t||t&&"Code"===t._bsontype)h.group.$keyf=t&&"Code"===t._bsontype?t:new i(t);else{const e={};t.forEach(t=>{e[t]=1}),h.group.key=e}(m=Object.assign({},m)).readPreference=u(e,m),a(h,e,m);try{s(h,e,m)}catch(e){return f(e,null)}p(e.s.db,h,m,(e,t)=>{if(e)return d(f,e,null);d(f,null,t.retval)})}else{const s=null!=r&&"Code"===r._bsontype?r.scope:{};s.ns=e.collectionName,s.keys=t,s.condition=n,s.initial=o;const a=x.replace(/ reduce;/,r.toString()+";");l(e.s.db,new i(a,s),null,m,(e,t)=>{if(e)return d(f,e,null);d(f,null,t.result||t)})}},indexes:function(e,t,n){t=Object.assign({},{full:!0},t),h(e.s.db,e.collectionName,t,n)},indexExists:function(e,t,n,o){S(e,n,(e,n)=>{if(null!=e)return d(o,e,null);if(!Array.isArray(t))return d(o,null,null!=n[t]);for(let e=0;e<t.length;e++)if(null==n[t[e]])return d(o,null,!1);return d(o,null,!0)})},indexInformation:S,parallelCollectionScan:function(e,t,n){const o={parallelCollectionScan:e.collectionName,numCursors:t.numCursors};a(o,e,t);const i=t.raw;delete t.raw,p(e.s.db,o,t,(o,r)=>{if(o)return d(n,o,null);if(null==r)return d(n,new Error("no result returned for parallelCollectionScan"),null);t=Object.assign({explicitlyIgnoreSession:!0},t);const s=[];i&&(t.raw=i);for(let n=0;n<r.cursors.length;n++){const o=r.cursors[n].cursor.id,i="number"==typeof o?m.fromNumber(o):o;s.push(e.s.topology.cursor(e.namespace,i,t))}d(n,null,s)})},save:function(e,t,n,i){const r=o(Object.assign({},n),{db:e.s.db,collection:e},n);if(null!=t._id)return r.upsert=!0,b(e,{_id:t._id},t,r,i);v(e,[t],r,(e,n)=>{if(null!=i)return null==t?d(i,null,null):e?d(i,e,null):void d(i,null,n)})}}},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";var o=(0,n(12).retrieveBSON)().Long;const i=n(17).Buffer;var r=0,s=n(7).opcodes,a=function(e,t,n,o){if(null==t)throw new Error("ns must be specified for query");if(null==n)throw new Error("query must be specified for query");if(-1!==t.indexOf("\0"))throw new Error("namespace cannot contain a null character");this.bson=e,this.ns=t,this.query=n,this.numberToSkip=o.numberToSkip||0,this.numberToReturn=o.numberToReturn||0,this.returnFieldSelector=o.returnFieldSelector||null,this.requestId=a.getRequestId(),this.pre32Limit=o.pre32Limit,this.serializeFunctions="boolean"==typeof o.serializeFunctions&&o.serializeFunctions,this.ignoreUndefined="boolean"==typeof o.ignoreUndefined&&o.ignoreUndefined,this.maxBsonSize=o.maxBsonSize||16777216,this.checkKeys="boolean"!=typeof o.checkKeys||o.checkKeys,this.batchSize=this.numberToReturn,this.tailable=!1,this.slaveOk="boolean"==typeof o.slaveOk&&o.slaveOk,this.oplogReplay=!1,this.noCursorTimeout=!1,this.awaitData=!1,this.exhaust=!1,this.partial=!1};a.prototype.incRequestId=function(){this.requestId=r++},a.nextRequestId=function(){return r+1},a.prototype.toBin=function(){var e=[],t=null,n=0;this.tailable&&(n|=2),this.slaveOk&&(n|=4),this.oplogReplay&&(n|=8),this.noCursorTimeout&&(n|=16),this.awaitData&&(n|=32),this.exhaust&&(n|=64),this.partial&&(n|=128),this.batchSize!==this.numberToReturn&&(this.numberToReturn=this.batchSize);var o=i.alloc(20+i.byteLength(this.ns)+1+4+4);e.push(o);var r=this.bson.serialize(this.query,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined});e.push(r),this.returnFieldSelector&&Object.keys(this.returnFieldSelector).length>0&&(t=this.bson.serialize(this.returnFieldSelector,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined}),e.push(t));var a=o.length+r.length+(t?t.length:0),c=4;return o[3]=a>>24&255,o[2]=a>>16&255,o[1]=a>>8&255,o[0]=255&a,o[c+3]=this.requestId>>24&255,o[c+2]=this.requestId>>16&255,o[c+1]=this.requestId>>8&255,o[c]=255&this.requestId,o[(c+=4)+3]=0,o[c+2]=0,o[c+1]=0,o[c]=0,o[(c+=4)+3]=s.OP_QUERY>>24&255,o[c+2]=s.OP_QUERY>>16&255,o[c+1]=s.OP_QUERY>>8&255,o[c]=255&s.OP_QUERY,o[(c+=4)+3]=n>>24&255,o[c+2]=n>>16&255,o[c+1]=n>>8&255,o[c]=255&n,c=(c+=4)+o.write(this.ns,c,"utf8")+1,o[c-1]=0,o[c+3]=this.numberToSkip>>24&255,o[c+2]=this.numberToSkip>>16&255,o[c+1]=this.numberToSkip>>8&255,o[c]=255&this.numberToSkip,o[(c+=4)+3]=this.numberToReturn>>24&255,o[c+2]=this.numberToReturn>>16&255,o[c+1]=this.numberToReturn>>8&255,o[c]=255&this.numberToReturn,c+=4,e},a.getRequestId=function(){return++r};var c=function(e,t,n,o){o=o||{},this.numberToReturn=o.numberToReturn||0,this.requestId=r++,this.bson=e,this.ns=t,this.cursorId=n};c.prototype.toBin=function(){var e=4+i.byteLength(this.ns)+1+4+8+16,t=0,n=i.alloc(e);return n[t+3]=e>>24&255,n[t+2]=e>>16&255,n[t+1]=e>>8&255,n[t]=255&e,n[(t+=4)+3]=this.requestId>>24&255,n[t+2]=this.requestId>>16&255,n[t+1]=this.requestId>>8&255,n[t]=255&this.requestId,n[(t+=4)+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,n[(t+=4)+3]=s.OP_GETMORE>>24&255,n[t+2]=s.OP_GETMORE>>16&255,n[t+1]=s.OP_GETMORE>>8&255,n[t]=255&s.OP_GETMORE,n[(t+=4)+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,t=(t+=4)+n.write(this.ns,t,"utf8")+1,n[t-1]=0,n[t+3]=this.numberToReturn>>24&255,n[t+2]=this.numberToReturn>>16&255,n[t+1]=this.numberToReturn>>8&255,n[t]=255&this.numberToReturn,n[(t+=4)+3]=this.cursorId.getLowBits()>>24&255,n[t+2]=this.cursorId.getLowBits()>>16&255,n[t+1]=this.cursorId.getLowBits()>>8&255,n[t]=255&this.cursorId.getLowBits(),n[(t+=4)+3]=this.cursorId.getHighBits()>>24&255,n[t+2]=this.cursorId.getHighBits()>>16&255,n[t+1]=this.cursorId.getHighBits()>>8&255,n[t]=255&this.cursorId.getHighBits(),t+=4,n};var l=function(e,t,n){this.ns=t,this.requestId=r++,this.cursorIds=n};l.prototype.toBin=function(){var e=24+8*this.cursorIds.length,t=0,n=i.alloc(e);n[t+3]=e>>24&255,n[t+2]=e>>16&255,n[t+1]=e>>8&255,n[t]=255&e,n[(t+=4)+3]=this.requestId>>24&255,n[t+2]=this.requestId>>16&255,n[t+1]=this.requestId>>8&255,n[t]=255&this.requestId,n[(t+=4)+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,n[(t+=4)+3]=s.OP_KILL_CURSORS>>24&255,n[t+2]=s.OP_KILL_CURSORS>>16&255,n[t+1]=s.OP_KILL_CURSORS>>8&255,n[t]=255&s.OP_KILL_CURSORS,n[(t+=4)+3]=0,n[t+2]=0,n[t+1]=0,n[t]=0,n[(t+=4)+3]=this.cursorIds.length>>24&255,n[t+2]=this.cursorIds.length>>16&255,n[t+1]=this.cursorIds.length>>8&255,n[t]=255&this.cursorIds.length,t+=4;for(var o=0;o<this.cursorIds.length;o++)n[t+3]=this.cursorIds[o].getLowBits()>>24&255,n[t+2]=this.cursorIds[o].getLowBits()>>16&255,n[t+1]=this.cursorIds[o].getLowBits()>>8&255,n[t]=255&this.cursorIds[o].getLowBits(),n[(t+=4)+3]=this.cursorIds[o].getHighBits()>>24&255,n[t+2]=this.cursorIds[o].getHighBits()>>16&255,n[t+1]=this.cursorIds[o].getHighBits()>>8&255,n[t]=255&this.cursorIds[o].getHighBits(),t+=4;return n};var p=function(e,t,n,i,r){r=r||{promoteLongs:!0,promoteValues:!0,promoteBuffers:!1},this.parsed=!1,this.raw=t,this.data=i,this.bson=e,this.opts=r,this.length=n.length,this.requestId=n.requestId,this.responseTo=n.responseTo,this.opCode=n.opCode,this.fromCompressed=n.fromCompressed,this.responseFlags=i.readInt32LE(0),this.cursorId=new o(i.readInt32LE(4),i.readInt32LE(8)),this.startingFrom=i.readInt32LE(12),this.numberReturned=i.readInt32LE(16),this.documents=new Array(this.numberReturned),this.cursorNotFound=0!=(1&this.responseFlags),this.queryFailure=0!=(2&this.responseFlags),this.shardConfigStale=0!=(4&this.responseFlags),this.awaitCapable=0!=(8&this.responseFlags),this.promoteLongs="boolean"!=typeof r.promoteLongs||r.promoteLongs,this.promoteValues="boolean"!=typeof r.promoteValues||r.promoteValues,this.promoteBuffers="boolean"==typeof r.promoteBuffers&&r.promoteBuffers};p.prototype.isParsed=function(){return this.parsed},p.prototype.parse=function(e){if(!this.parsed){var t,n,o=(e=e||{}).raw||!1,i=e.documentsReturnedIn||null;n={promoteLongs:"boolean"==typeof e.promoteLongs?e.promoteLongs:this.opts.promoteLongs,promoteValues:"boolean"==typeof e.promoteValues?e.promoteValues:this.opts.promoteValues,promoteBuffers:"boolean"==typeof e.promoteBuffers?e.promoteBuffers:this.opts.promoteBuffers},this.index=20;for(var r=0;r<this.numberReturned;r++)t=this.data[this.index]|this.data[this.index+1]<<8|this.data[this.index+2]<<16|this.data[this.index+3]<<24,this.documents[r]=o?this.data.slice(this.index,this.index+t):this.bson.deserialize(this.data.slice(this.index,this.index+t),n),this.index=this.index+t;if(1===this.documents.length&&null!=i&&o){const e={};e[i]=!0,n.fieldsAsRaw=e;const t=this.bson.deserialize(this.documents[0],n);this.documents=[t]}this.parsed=!0}},e.exports={Query:a,GetMore:c,Response:p,KillCursor:l}},function(e,t,n){"use strict";const o=n(14).Transform,i=n(14).PassThrough,r=n(4).deprecate,s=n(0).handleCallback,a=n(2).ReadPreference,c=n(2).MongoError,l=n(13).CoreCursor,p=n(13).CursorState,u=n(2).BSON.Map,d=n(154).each,h=n(189),m=n(190),f=n(191),g=n(192),y=n(193),v=n(30),b=["tailable","oplogReplay","noCursorTimeout","awaitData","exhaust","partial"],x=["numberOfRetries","tailableRetryInterval"];class S extends l{constructor(e,t,n,o){super(e,t,n,o),this.operation&&(o=this.operation.options);const i=o.numberOfRetries||5,r=o.tailableRetryInterval||500,s=i,a=o.promiseLibrary||Promise;this.s={numberOfRetries:i,tailableRetryInterval:r,currentNumberOfRetries:s,state:p.INIT,promiseLibrary:a,currentDoc:null,explicitlyIgnoreSession:!!o.explicitlyIgnoreSession},!o.explicitlyIgnoreSession&&o.session&&(this.cursorState.session=o.session),!0===this.options.noCursorTimeout&&this.addCursorFlag("noCursorTimeout",!0);let c=1e3;this.cmd.cursor&&this.cmd.cursor.batchSize?c=this.cmd.cursor.batchSize:o.cursor&&o.cursor.batchSize?c=o.cursor.batchSize:"number"==typeof o.batchSize&&(c=o.batchSize),this.setCursorBatchSize(c)}get readPreference(){return this.operation?this.operation.readPreference:this.options.readPreference}get sortValue(){return this.cmd.sort}_initializeCursor(e){this.operation&&null!=this.operation.session?this.cursorState.session=this.operation.session:this.s.explicitlyIgnoreSession||this.cursorState.session||!this.topology.hasSessionSupport()||(this.cursorState.session=this.topology.startSession({owner:this}),this.operation&&(this.operation.session=this.cursorState.session)),super._initializeCursor(e)}hasNext(e){const t=new f(this);return v(this.topology,t,e)}next(e){const t=new g(this);return v(this.topology,t,e)}filter(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.query=e,this}maxScan(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.maxScan=e,this}hint(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.hint=e,this}min(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.min=e,this}max(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.max=e,this}returnKey(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.returnKey=e,this}showRecordId(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.showDiskLoc=e,this}snapshot(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.snapshot=e,this}setCursorOption(e,t){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if(-1===x.indexOf(e))throw c.create({message:`option ${e} is not a supported option ${x}`,driver:!0});return this.s[e]=t,"numberOfRetries"===e&&(this.s.currentNumberOfRetries=t),this}addCursorFlag(e,t){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if(-1===b.indexOf(e))throw c.create({message:`flag ${e} is not a supported flag ${b}`,driver:!0});if("boolean"!=typeof t)throw c.create({message:`flag ${e} must be a boolean value`,driver:!0});return this.cmd[e]=t,this}addQueryModifier(e,t){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if("$"!==e[0])throw c.create({message:`${e} is not a valid query modifier`,driver:!0});const n=e.substr(1);return this.cmd[n]=t,"orderby"===n&&(this.cmd.sort=this.cmd[n]),this}comment(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.comment=e,this}maxAwaitTimeMS(e){if("number"!=typeof e)throw c.create({message:"maxAwaitTimeMS must be a number",driver:!0});if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.maxAwaitTimeMS=e,this}maxTimeMS(e){if("number"!=typeof e)throw c.create({message:"maxTimeMS must be a number",driver:!0});if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.maxTimeMS=e,this}project(e){if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});return this.cmd.fields=e,this}sort(e,t){if(this.options.tailable)throw c.create({message:"Tailable cursor doesn't support sorting",driver:!0});if(this.s.state===p.CLOSED||this.s.state===p.OPEN||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});let n=e;return Array.isArray(n)&&Array.isArray(n[0])&&(n=new u(n.map(e=>{const t=[e[0],null];if("asc"===e[1])t[1]=1;else if("desc"===e[1])t[1]=-1;else{if(1!==e[1]&&-1!==e[1]&&!e[1].$meta)throw new c("Illegal sort clause, must be of the form [['field1', '(ascending|descending)'], ['field2', '(ascending|descending)']]");t[1]=e[1]}return t}))),null!=t&&(n=[[e,t]]),this.cmd.sort=n,this}batchSize(e){if(this.options.tailable)throw c.create({message:"Tailable cursor doesn't support batchSize",driver:!0});if(this.s.state===p.CLOSED||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw c.create({message:"batchSize requires an integer",driver:!0});return this.cmd.batchSize=e,this.setCursorBatchSize(e),this}collation(e){return this.cmd.collation=e,this}limit(e){if(this.options.tailable)throw c.create({message:"Tailable cursor doesn't support limit",driver:!0});if(this.s.state===p.OPEN||this.s.state===p.CLOSED||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw c.create({message:"limit requires an integer",driver:!0});return this.cmd.limit=e,this.setCursorLimit(e),this}skip(e){if(this.options.tailable)throw c.create({message:"Tailable cursor doesn't support skip",driver:!0});if(this.s.state===p.OPEN||this.s.state===p.CLOSED||this.isDead())throw c.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw c.create({message:"skip requires an integer",driver:!0});return this.cmd.skip=e,this.setCursorSkip(e),this}each(e){this.rewind(),this.s.state=p.INIT,d(this,e)}forEach(e,t){if(this.rewind(),this.s.state=p.INIT,"function"!=typeof t)return new this.s.promiseLibrary((t,n)=>{d(this,(o,i)=>o?(n(o),!1):null==i?(t(null),!1):(e(i),!0))});d(this,(n,o)=>{if(n)return t(n),!1;if(null!=o)return e(o),!0;if(null==o&&t){const e=t;return t=null,e(null),!1}})}setReadPreference(e){if(this.s.state!==p.INIT)throw c.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:!0});if(e instanceof a)this.options.readPreference=e;else{if("string"!=typeof e)throw new TypeError("Invalid read preference: "+e);this.options.readPreference=new a(e)}return this}toArray(e){if(this.options.tailable)throw c.create({message:"Tailable cursor cannot be converted to array",driver:!0});const t=new y(this);return v(this.topology,t,e)}count(e,t,n){if(null==this.cmd.query)throw c.create({message:"count can only be used with find command",driver:!0});"function"==typeof t&&(n=t,t={}),t=t||{},"function"==typeof e&&(n=e,e=!0),this.cursorState.session&&(t=Object.assign({},t,{session:this.cursorState.session}));const o=new h(this,e,t);return v(this.topology,o,n)}close(e,t){"function"==typeof e&&(t=e,e={}),e=Object.assign({},{skipKillCursors:!1},e),this.s.state=p.CLOSED,e.skipKillCursors||this.kill();const n=()=>(this.emit("close"),"function"==typeof t?s(t,null,this):new this.s.promiseLibrary(e=>{e()}));return this.cursorState.session?"function"==typeof t?this._endSession(()=>n()):new this.s.promiseLibrary(e=>{this._endSession(()=>n().then(e))}):n()}map(e){if(this.cursorState.transforms&&this.cursorState.transforms.doc){const t=this.cursorState.transforms.doc;this.cursorState.transforms.doc=n=>e(t(n))}else this.cursorState.transforms={doc:e};return this}isClosed(){return this.isDead()}destroy(e){e&&this.emit("error",e),this.pause(),this.close()}stream(e){return this.cursorState.streamOptions=e||{},this}transformStream(e){const t=e||{};if("function"==typeof t.transform){const e=new o({objectMode:!0,transform:function(e,n,o){this.push(t.transform(e)),o()}});return this.pipe(e)}return this.pipe(new i({objectMode:!0}))}explain(e){if(this.operation&&null==this.operation.cmd)return this.operation.options.explain=!0,this.operation.fullResponse=!1,v(this.topology,this.operation,e);this.cmd.explain=!0,this.cmd.readConcern&&delete this.cmd.readConcern;const t=new m(this);return v(this.topology,t,e)}getLogger(){return this.logger}}S.prototype.maxTimeMs=S.prototype.maxTimeMS,r(S.prototype.each,"Cursor.each is deprecated. Use Cursor.forEach instead."),r(S.prototype.maxScan,"Cursor.maxScan is deprecated, and will be removed in a later version"),r(S.prototype.snapshot,"Cursor Snapshot is deprecated, and will be removed in a later version"),e.exports=S},function(e,t){e.exports=require("path")},function(e,t,n){"use strict";const o={Standalone:"Standalone",Mongos:"Mongos",PossiblePrimary:"PossiblePrimary",RSPrimary:"RSPrimary",RSSecondary:"RSSecondary",RSArbiter:"RSArbiter",RSOther:"RSOther",RSGhost:"RSGhost",Unknown:"Unknown"},i=new Set([o.RSPrimary,o.Standalone,o.Mongos]),r=new Set([o.RSPrimary,o.RSSecondary,o.Mongos,o.Standalone]),s=["minWireVersion","maxWireVersion","maxBsonObjectSize","maxMessageSizeBytes","maxWriteBatchSize","compression","me","hosts","passives","arbiters","tags","setName","setVersion","electionId","primary","logicalSessionTimeoutMinutes","saslSupportedMechs","__nodejs_mock_server__","$clusterTime"];e.exports={ServerDescription:class{constructor(e,t,n){n=n||{},t=Object.assign({minWireVersion:0,maxWireVersion:0,hosts:[],passives:[],arbiters:[],tags:[]},t),this.address=e,this.error=n.error||null,this.roundTripTime=n.roundTripTime||0,this.lastUpdateTime=Date.now(),this.lastWriteDate=t.lastWrite?t.lastWrite.lastWriteDate:null,this.opTime=t.lastWrite?t.lastWrite.opTime:null,this.type=function(e){if(!e||!e.ok)return o.Unknown;if(e.isreplicaset)return o.RSGhost;if(e.msg&&"isdbgrid"===e.msg)return o.Mongos;if(e.setName)return e.hidden?o.RSOther:e.ismaster?o.RSPrimary:e.secondary?o.RSSecondary:e.arbiterOnly?o.RSArbiter:o.RSOther;return o.Standalone}(t),s.forEach(e=>{void 0!==t[e]&&(this[e]=t[e])}),this.me&&(this.me=this.me.toLowerCase()),this.hosts=this.hosts.map(e=>e.toLowerCase()),this.passives=this.passives.map(e=>e.toLowerCase()),this.arbiters=this.arbiters.map(e=>e.toLowerCase())}get allHosts(){return this.hosts.concat(this.arbiters).concat(this.passives)}get isReadable(){return this.type===o.RSSecondary||this.isWritable}get isDataBearing(){return r.has(this.type)}get isWritable(){return i.has(this.type)}},ServerType:o}},function(e,t,n){"use strict";function o(e,t){return new Buffer(e,t)}e.exports={normalizedFunctionString:function(e){return e.toString().replace(/function *\(/,"function (")},allocBuffer:"function"==typeof Buffer.alloc?function(){return Buffer.alloc.apply(Buffer,arguments)}:o,toBuffer:"function"==typeof Buffer.from?function(){return Buffer.from.apply(Buffer,arguments)}:o}},function(e,t,n){"use strict";const o=n(9),i=n(2).MongoError,r=n(4).format,s=n(78),a=n(0).translateReadPreference,c=n(2).Sessions.ClientSession;var l=function(e,t){var n=this;t=t||{force:!1,bufferMaxEntries:-1},this.s={storedOps:[],storeOptions:t,topology:e},Object.defineProperty(this,"length",{enumerable:!0,get:function(){return n.s.storedOps.length}})};l.prototype.add=function(e,t,n,o,s){if(this.s.storeOptions.force)return s(i.create({message:"db closed by application",driver:!0}));if(0===this.s.storeOptions.bufferMaxEntries)return s(i.create({message:r("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){this.s.storedOps.shift().c(i.create({message:r("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:e,n:t,o:n,op:o,c:s})},l.prototype.addObjectAndMethod=function(e,t,n,o,s){if(this.s.storeOptions.force)return s(i.create({message:"db closed by application",driver:!0}));if(0===this.s.storeOptions.bufferMaxEntries)return s(i.create({message:r("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}));if(this.s.storeOptions.bufferMaxEntries>0&&this.s.storedOps.length>this.s.storeOptions.bufferMaxEntries)for(;this.s.storedOps.length>0;){this.s.storedOps.shift().c(i.create({message:r("no connection available for operation and number of stored operation > %s",this.s.storeOptions.bufferMaxEntries),driver:!0}))}else this.s.storedOps.push({t:e,m:n,o:t,p:o,c:s})},l.prototype.flush=function(e){for(;this.s.storedOps.length>0;)this.s.storedOps.shift().c(e||i.create({message:r("no connection available for operation"),driver:!0}))};var p=["primary","primaryPreferred","nearest","secondaryPreferred"],u=["secondary","secondaryPreferred"];l.prototype.execute=function(e){e=e||{};var t=this.s.storedOps;this.s.storedOps=[];for(var n="boolean"!=typeof e.executePrimary||e.executePrimary,o="boolean"!=typeof e.executeSecondary||e.executeSecondary;t.length>0;){var i=t.shift();"cursor"===i.t?n&&o?i.o[i.m].apply(i.o,i.p):n&&i.o.options&&i.o.options.readPreference&&-1!==p.indexOf(i.o.options.readPreference.mode)?i.o[i.m].apply(i.o,i.p):!n&&o&&i.o.options&&i.o.options.readPreference&&-1!==u.indexOf(i.o.options.readPreference.mode)&&i.o[i.m].apply(i.o,i.p):"auth"===i.t?this.s.topology[i.t].apply(this.s.topology,i.o):n&&o?this.s.topology[i.t](i.n,i.o,i.op,i.c):n&&i.op&&i.op.readPreference&&-1!==p.indexOf(i.op.readPreference.mode)?this.s.topology[i.t](i.n,i.o,i.op,i.c):!n&&o&&i.op&&i.op.readPreference&&-1!==u.indexOf(i.op.readPreference.mode)&&this.s.topology[i.t](i.n,i.o,i.op,i.c)}},l.prototype.all=function(){return this.s.storedOps};var d=function(e){var t=function(e,t,n){Object.defineProperty(e,t,{enumerable:!0,get:function(){return n}})},n=!1,o=!1,i=!1,r=!1,s=!1,a=!1,c=e.maxWriteBatchSize||1e3,l=!1,p=!1;e.minWireVersion>=0&&(i=!0),e.maxWireVersion>=1&&(n=!0,r=!0),e.maxWireVersion>=2&&(o=!0),e.maxWireVersion>=3&&(s=!0,a=!0),e.maxWireVersion>=5&&(l=!0,p=!0),null==e.minWireVersion&&(e.minWireVersion=0),null==e.maxWireVersion&&(e.maxWireVersion=0),t(this,"hasAggregationCursor",n),t(this,"hasWriteCommands",o),t(this,"hasTextSearch",i),t(this,"hasAuthCommands",r),t(this,"hasListCollectionsCommand",s),t(this,"hasListIndexesCommand",a),t(this,"minWireVersion",e.minWireVersion),t(this,"maxWireVersion",e.maxWireVersion),t(this,"maxNumberOfDocsInBatch",c),t(this,"commandsTakeWriteConcern",l),t(this,"commandsTakeCollation",p)};const h=n(86).version,m=r("Node.js %s, %s",process.version,s.endianness()),f=s.type(),g=process.platform,y=process.arch,v=s.release();class b extends o{constructor(){super(),this.clientInfo={driver:{name:"nodejs",version:h},os:{type:f,name:g,architecture:y,version:v},platform:m},this.setMaxListeners(1/0)}hasSessionSupport(){return null!=this.logicalSessionTimeoutMinutes}startSession(e,t){const n=new c(this,this.s.sessionPool,e,t);return n.once("ended",()=>{this.s.sessions.delete(n)}),this.s.sessions.add(n),n}endSessions(e,t){return this.s.coreTopology.endSessions(e,t)}capabilities(){return this.s.sCapabilities?this.s.sCapabilities:null==this.s.coreTopology.lastIsMaster()?null:(this.s.sCapabilities=new d(this.s.coreTopology.lastIsMaster()),this.s.sCapabilities)}command(e,t,n,o){this.s.coreTopology.command(e.toString(),t,a(n),o)}insert(e,t,n,o){this.s.coreTopology.insert(e.toString(),t,n,o)}update(e,t,n,o){this.s.coreTopology.update(e.toString(),t,n,o)}remove(e,t,n,o){this.s.coreTopology.remove(e.toString(),t,n,o)}isConnected(e){return e=a(e=e||{}),this.s.coreTopology.isConnected(e)}isDestroyed(){return this.s.coreTopology.isDestroyed()}cursor(e,t,n){return(n=a(n=n||{})).disconnectHandler=this.s.store,n.topology=this,this.s.coreTopology.cursor(e,t,n)}lastIsMaster(){return this.s.coreTopology.lastIsMaster()}selectServer(e,t,n){return this.s.coreTopology.selectServer(e,t,n)}unref(){return this.s.coreTopology.unref()}connections(){return this.s.coreTopology.connections()}close(e,t){this.s.sessions.forEach(e=>e.endSession()),this.s.sessionPool&&this.s.sessionPool.endAllPooledSessions(),!0===e&&(this.s.storeOptions.force=e,this.s.store.flush()),this.s.coreTopology.destroy({force:"boolean"==typeof e&&e},t)}}Object.defineProperty(b.prototype,"bson",{enumerable:!0,get:function(){return this.s.coreTopology.s.bson}}),Object.defineProperty(b.prototype,"parserType",{enumerable:!0,get:function(){return this.s.coreTopology.parserType}}),Object.defineProperty(b.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.s.coreTopology.logicalSessionTimeoutMinutes}}),Object.defineProperty(b.prototype,"type",{enumerable:!0,get:function(){return this.s.coreTopology.type}}),t.Store=l,t.ServerCapabilities=d,t.TopologyBase=b},function(e,t){e.exports=require("url")},function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);this._bsontype="Long",this.low_=0|e,this.high_=0|t}n.prototype.toInt=function(){return this.low_},n.prototype.toNumber=function(){return this.high_*n.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},n.prototype.toJSON=function(){return this.toString()},n.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(n.MIN_VALUE)){var o=n.fromNumber(t),i=this.div(o),r=i.multiply(o).subtract(this);return i.toString(t)+r.toInt().toString(t)}return"-"+this.negate().toString(t)}var s=n.fromNumber(Math.pow(t,6));r=this;for(var a="";!r.isZero();){var c=r.div(s),l=r.subtract(c.multiply(s)).toInt().toString(t);if((r=c).isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},n.prototype.getHighBits=function(){return this.high_},n.prototype.getLowBits=function(){return this.low_},n.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:n.TWO_PWR_32_DBL_+this.low_},n.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(n.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!==this.high_?this.high_:this.low_,t=31;t>0&&0==(e&1<<t);t--);return 0!==this.high_?t+33:t+1},n.prototype.isZero=function(){return 0===this.high_&&0===this.low_},n.prototype.isNegative=function(){return this.high_<0},n.prototype.isOdd=function(){return 1==(1&this.low_)},n.prototype.equals=function(e){return this.high_===e.high_&&this.low_===e.low_},n.prototype.notEquals=function(e){return this.high_!==e.high_||this.low_!==e.low_},n.prototype.lessThan=function(e){return this.compare(e)<0},n.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},n.prototype.greaterThan=function(e){return this.compare(e)>0},n.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},n.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.subtract(e).isNegative()?-1:1},n.prototype.negate=function(){return this.equals(n.MIN_VALUE)?n.MIN_VALUE:this.not().add(n.ONE)},n.prototype.add=function(e){var t=this.high_>>>16,o=65535&this.high_,i=this.low_>>>16,r=65535&this.low_,s=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,l=0,p=0,u=0,d=0;return u+=(d+=r+(65535&e.low_))>>>16,d&=65535,p+=(u+=i+c)>>>16,u&=65535,l+=(p+=o+a)>>>16,p&=65535,l+=t+s,l&=65535,n.fromBits(u<<16|d,l<<16|p)},n.prototype.subtract=function(e){return this.add(e.negate())},n.prototype.multiply=function(e){if(this.isZero())return n.ZERO;if(e.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE))return e.isOdd()?n.MIN_VALUE:n.ZERO;if(e.equals(n.MIN_VALUE))return this.isOdd()?n.MIN_VALUE:n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(n.TWO_PWR_24_)&&e.lessThan(n.TWO_PWR_24_))return n.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,o=65535&this.high_,i=this.low_>>>16,r=65535&this.low_,s=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,l=65535&e.low_,p=0,u=0,d=0,h=0;return d+=(h+=r*l)>>>16,h&=65535,u+=(d+=i*l)>>>16,d&=65535,u+=(d+=r*c)>>>16,d&=65535,p+=(u+=o*l)>>>16,u&=65535,p+=(u+=i*c)>>>16,u&=65535,p+=(u+=r*a)>>>16,u&=65535,p+=t*l+o*c+i*a+r*s,p&=65535,n.fromBits(d<<16|h,p<<16|u)},n.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE)){if(e.equals(n.ONE)||e.equals(n.NEG_ONE))return n.MIN_VALUE;if(e.equals(n.MIN_VALUE))return n.ONE;var t=this.shiftRight(1).div(e).shiftLeft(1);if(t.equals(n.ZERO))return e.isNegative()?n.ONE:n.NEG_ONE;var o=this.subtract(e.multiply(t));return t.add(o.div(e))}if(e.equals(n.MIN_VALUE))return n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();var i=n.ZERO;for(o=this;o.greaterThanOrEqual(e);){t=Math.max(1,Math.floor(o.toNumber()/e.toNumber()));for(var r=Math.ceil(Math.log(t)/Math.LN2),s=r<=48?1:Math.pow(2,r-48),a=n.fromNumber(t),c=a.multiply(e);c.isNegative()||c.greaterThan(o);)t-=s,c=(a=n.fromNumber(t)).multiply(e);a.isZero()&&(a=n.ONE),i=i.add(a),o=o.subtract(c)}return i},n.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))},n.prototype.not=function(){return n.fromBits(~this.low_,~this.high_)},n.prototype.and=function(e){return n.fromBits(this.low_&e.low_,this.high_&e.high_)},n.prototype.or=function(e){return n.fromBits(this.low_|e.low_,this.high_|e.high_)},n.prototype.xor=function(e){return n.fromBits(this.low_^e.low_,this.high_^e.high_)},n.prototype.shiftLeft=function(e){if(0===(e&=63))return this;var t=this.low_;if(e<32){var o=this.high_;return n.fromBits(t<<e,o<<e|t>>>32-e)}return n.fromBits(0,t<<e-32)},n.prototype.shiftRight=function(e){if(0===(e&=63))return this;var t=this.high_;if(e<32){var o=this.low_;return n.fromBits(o>>>e|t<<32-e,t>>e)}return n.fromBits(t>>e-32,t>=0?0:-1)},n.prototype.shiftRightUnsigned=function(e){if(0===(e&=63))return this;var t=this.high_;if(e<32){var o=this.low_;return n.fromBits(o>>>e|t<<32-e,t>>>e)}return 32===e?n.fromBits(t,0):n.fromBits(t>>>e-32,0)},n.fromInt=function(e){if(-128<=e&&e<128){var t=n.INT_CACHE_[e];if(t)return t}var o=new n(0|e,e<0?-1:0);return-128<=e&&e<128&&(n.INT_CACHE_[e]=o),o},n.fromNumber=function(e){return isNaN(e)||!isFinite(e)?n.ZERO:e<=-n.TWO_PWR_63_DBL_?n.MIN_VALUE:e+1>=n.TWO_PWR_63_DBL_?n.MAX_VALUE:e<0?n.fromNumber(-e).negate():new n(e%n.TWO_PWR_32_DBL_|0,e/n.TWO_PWR_32_DBL_|0)},n.fromBits=function(e,t){return new n(e,t)},n.fromString=function(e,t){if(0===e.length)throw Error("number format error: empty string");var o=t||10;if(o<2||36<o)throw Error("radix out of range: "+o);if("-"===e.charAt(0))return n.fromString(e.substring(1),o).negate();if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+e);for(var i=n.fromNumber(Math.pow(o,8)),r=n.ZERO,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),c=parseInt(e.substring(s,s+a),o);if(a<8){var l=n.fromNumber(Math.pow(o,a));r=r.multiply(l).add(n.fromNumber(c))}else r=(r=r.multiply(i)).add(n.fromNumber(c))}return r},n.INT_CACHE_={},n.TWO_PWR_16_DBL_=65536,n.TWO_PWR_24_DBL_=1<<24,n.TWO_PWR_32_DBL_=n.TWO_PWR_16_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_31_DBL_=n.TWO_PWR_32_DBL_/2,n.TWO_PWR_48_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_64_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_32_DBL_,n.TWO_PWR_63_DBL_=n.TWO_PWR_64_DBL_/2,n.ZERO=n.fromInt(0),n.ONE=n.fromInt(1),n.NEG_ONE=n.fromInt(-1),n.MAX_VALUE=n.fromBits(-1,2147483647),n.MIN_VALUE=n.fromBits(0,-2147483648),n.TWO_PWR_24_=n.fromInt(1<<24),e.exports=n,e.exports.Long=n},function(e,t,n){"use strict";const o=n(3).MongoError;e.exports={AuthProvider:class{constructor(e){this.bson=e,this.authStore=[]}auth(e,t,n,i){let r=t.length;if(0===r)return void i(null,null);let s=0,a=null;const c=t=>{this._authenticateSingleConnection(e,t,n,(e,t)=>{r-=1,e?a=new o(e):t&&(t.$err||t.errmsg)?a=new o(t):s+=1,0===r&&(s>0?(this.addCredentials(n),i(null,!0)):(null==a&&(a=new o(`failed to authenticate using ${n.mechanism}`)),i(a,!1)))})},l=e=>process.nextTick(()=>c(e));for(;t.length>0;)l(t.shift())}_authenticateSingleConnection(){throw new Error("_authenticateSingleConnection must be overridden")}addCredentials(e){this.authStore.some(t=>t.equals(e))||this.authStore.push(e)}reauthenticate(e,t,n){const o=this.authStore.slice(0);let i=o.length;if(0===i)return n(null,null);for(let r=0;r<o.length;r++)this.auth(e,t,o[r],(function(e){0===(i-=1)&&n(e,null)}))}logout(e){this.authStore=this.authStore.filter(t=>t.source!==e)}}}},function(e,t,n){"use strict";const o=n(3).MongoError,i=n(1).Aspect,r=n(1).OperationBase,s=n(11),a=n(3).isRetryableError,c=n(5).maxWireVersion,l=n(5).isUnifiedTopology;function p(e,t,n){if(null==e)throw new TypeError("This method requires a valid topology instance");if(!(t instanceof r))throw new TypeError("This method requires a valid operation instance");if(l(e)&&!t.hasAspect(i.SKIP_SESSION)&&e.shouldCheckForSessionSupport())return function(e,t,n){const o=e.s.promiseLibrary;let i;"function"!=typeof n&&(i=new o((e,t)=>{n=(n,o)=>{if(n)return t(n);e(o)}}));return e.selectServer(s.primaryPreferred,o=>{o?n(o):p(e,t,n)}),i}(e,t,n);const a=e.s.promiseLibrary;let c,u;if(!t.hasAspect(i.SKIP_SESSION)&&e.hasSessionSupport())if(null==t.session)u=Symbol(),c=e.startSession({owner:u}),t.session=c;else if(t.session.hasEnded)throw new o("Use of expired sessions is not permitted");const h=(e,n)=>(function(o,i){if(c&&c.owner===u)c.endSession(()=>{if(t.session===c&&t.clearSession(),o)return n(o);e(i)});else{if(o)return n(o);e(i)}});if("function"==typeof n){const o=h(e=>n(null,e),e=>n(e,null));try{return t.hasAspect(i.EXECUTE_WITH_SELECTION)?d(e,t,o):t.execute(o)}catch(e){throw o(e),e}}return new a((function(n,o){const r=h(n,o);try{return t.hasAspect(i.EXECUTE_WITH_SELECTION)?d(e,t,r):t.execute(r)}catch(e){r(e)}}))}function u(e){return c(e)>=6}function d(e,t,n){const r=t.readPreference||s.primary,c=t.session&&t.session.inTransaction();if(c&&!r.equals(s.primary))return void n(new o(`Read preference in a transaction must be primary, not: ${r.mode}`));const l={readPreference:r,session:t.session};function p(o,i){return null==o?n(null,i):a(o)?void e.selectServer(l,(e,o)=>{!e&&u(o)?t.execute(o,n):n(e,null)}):n(o)}e.selectServer(l,(o,r)=>{if(o)return void n(o,null);const s=!1!==e.s.options.retryReads&&t.session&&!c&&u(r)&&t.canRetryRead;t.hasAspect(i.RETRYABLE)&&s?t.execute(r,p):t.execute(r,n)})}e.exports=p},function(e,t,n){"use strict";class o{constructor(e,t,n,o){null!=e&&(this.w=e),null!=t&&(this.wtimeout=t),null!=n&&(this.j=n),null!=o&&(this.fsync=o)}static fromOptions(e){if(null!=e&&(null!=e.writeConcern||null!=e.w||null!=e.wtimeout||null!=e.j||null!=e.fsync))return e.writeConcern?new o(e.writeConcern.w,e.writeConcern.wtimeout,e.writeConcern.j,e.writeConcern.fsync):new o(e.w,e.wtimeout,e.j,e.fsync)}}e.exports=o},function(e,t,n){"use strict";const o=n(4).deprecate,i=n(0).deprecateOptions,r=n(0).checkCollectionName,s=n(2).BSON.ObjectID,a=n(2).MongoError,c=n(0).toError,l=n(0).normalizeHintField,p=n(0).decorateCommand,u=n(0).decorateWithCollation,d=n(0).decorateWithReadConcern,h=n(0).formattedOrderClause,m=n(2).ReadPreference,f=n(155),g=n(156),y=n(72),v=n(0).executeLegacyOperation,b=n(0).resolveReadPreference,x=n(31),S=n(38),w=n(0).MongoDBNamespace,_=n(74),O=n(75),T=n(19).checkForAtomicOperators,E=n(19).ensureIndex,C=n(19).group,k=n(19).parallelCollectionScan,A=n(8).removeDocuments,N=n(19).save,I=n(8).updateDocuments,M=n(55),B=n(98),R=n(157),P=n(99),D=n(158),L=n(159),j=n(160),z=n(161),U=n(76).DropCollectionOperation,H=n(100),q=n(162),F=n(163),$=n(164),W=n(165),V=n(56),K=n(166),G=n(167),Y=n(168),J=n(169),X=n(170),Z=n(171),Q=n(101),ee=n(172),te=n(173),ne=n(174),oe=n(175),ie=n(176),re=n(102),se=n(106),ae=n(184),ce=n(185),le=n(186),pe=n(187),ue=n(188),de=n(30),he=["ignoreUndefined"];function me(e,t,n,o,i,a){r(o);const c=null==a||null==a.slaveOk?e.slaveOk:a.slaveOk,l=null==a||null==a.serializeFunctions?e.s.options.serializeFunctions:a.serializeFunctions,p=null==a||null==a.raw?e.s.options.raw:a.raw,u=null==a||null==a.promoteLongs?e.s.options.promoteLongs:a.promoteLongs,d=null==a||null==a.promoteValues?e.s.options.promoteValues:a.promoteValues,h=null==a||null==a.promoteBuffers?e.s.options.promoteBuffers:a.promoteBuffers,f=new w(n,o),g=a.promiseLibrary||Promise;i=null==i?s:i,this.s={pkFactory:i,db:e,topology:t,options:a,namespace:f,readPreference:m.fromOptions(a),slaveOk:c,serializeFunctions:l,raw:p,promoteLongs:u,promoteValues:d,promoteBuffers:h,internalHint:null,collectionHint:null,promiseLibrary:g,readConcern:S.fromOptions(a),writeConcern:x.fromOptions(a)}}Object.defineProperty(me.prototype,"dbName",{enumerable:!0,get:function(){return this.s.namespace.db}}),Object.defineProperty(me.prototype,"collectionName",{enumerable:!0,get:function(){return this.s.namespace.collection}}),Object.defineProperty(me.prototype,"namespace",{enumerable:!0,get:function(){return this.s.namespace.toString()}}),Object.defineProperty(me.prototype,"readConcern",{enumerable:!0,get:function(){return null==this.s.readConcern?this.s.db.readConcern:this.s.readConcern}}),Object.defineProperty(me.prototype,"readPreference",{enumerable:!0,get:function(){return null==this.s.readPreference?this.s.db.readPreference:this.s.readPreference}}),Object.defineProperty(me.prototype,"writeConcern",{enumerable:!0,get:function(){return null==this.s.writeConcern?this.s.db.writeConcern:this.s.writeConcern}}),Object.defineProperty(me.prototype,"hint",{enumerable:!0,get:function(){return this.s.collectionHint},set:function(e){this.s.collectionHint=l(e)}});const fe=["maxScan","fields","snapshot"];function ge(e,t,n,o,i){const r=Array.prototype.slice.call(arguments,1);return i="function"==typeof r[r.length-1]?r.pop():void 0,t=r.length&&r.shift()||[],n=r.length?r.shift():null,o=r.length&&r.shift()||{},(o=Object.assign({},o)).readPreference=m.PRIMARY,de(this.s.topology,new V(this,e,t,n,o),i)}me.prototype.find=i({name:"collection.find",deprecatedOptions:fe,optionsIndex:1},(function(e,t,n){"object"==typeof n&&console.warn("Third parameter to `find()` must be a callback or undefined");let o=e;"function"!=typeof n&&("function"==typeof t?(n=t,t=void 0):null==t&&(n="function"==typeof o?o:void 0,o="object"==typeof o?o:void 0));const i=o=null==o?{}:o;if(Buffer.isBuffer(i)){const e=i[0]|i[1]<<8|i[2]<<16|i[3]<<24;if(e!==i.length){const t=new Error("query selector raw message size does not match message header size ["+i.length+"] != ["+e+"]");throw t.name="MongoError",t}}null!=o&&"ObjectID"===o._bsontype&&(o={_id:o}),t||(t={});let r=t.projection||t.fields;r&&!Buffer.isBuffer(r)&&Array.isArray(r)&&(r=r.length?r.reduce((e,t)=>(e[t]=1,e),{}):{_id:1});let s=Object.assign({},t);for(let e in this.s.options)-1!==he.indexOf(e)&&(s[e]=this.s.options[e]);if(s.skip=t.skip?t.skip:0,s.limit=t.limit?t.limit:0,s.raw="boolean"==typeof t.raw?t.raw:this.s.raw,s.hint=null!=t.hint?l(t.hint):this.s.collectionHint,s.timeout=void 0===t.timeout?void 0:t.timeout,s.slaveOk=null!=t.slaveOk?t.slaveOk:this.s.db.slaveOk,s.readPreference=b(this,s),null==s.readPreference||"primary"===s.readPreference&&"primary"===s.readPreference.mode||(s.slaveOk=!0),null!=o&&"object"!=typeof o)throw a.create({message:"query selector must be an object",driver:!0});const c={find:this.s.namespace.toString(),limit:s.limit,skip:s.skip,query:o};"boolean"==typeof s.awaitdata&&(s.awaitData=s.awaitdata),"boolean"==typeof s.timeout&&(s.noCursorTimeout=s.timeout),p(c,s,["session","collation"]),r&&(c.fields=r),s.db=this.s.db,s.promiseLibrary=this.s.promiseLibrary,null==s.raw&&"boolean"==typeof this.s.raw&&(s.raw=this.s.raw),null==s.promoteLongs&&"boolean"==typeof this.s.promoteLongs&&(s.promoteLongs=this.s.promoteLongs),null==s.promoteValues&&"boolean"==typeof this.s.promoteValues&&(s.promoteValues=this.s.promoteValues),null==s.promoteBuffers&&"boolean"==typeof this.s.promoteBuffers&&(s.promoteBuffers=this.s.promoteBuffers),c.sort&&(c.sort=h(c.sort)),d(c,this,t);try{u(c,this,t)}catch(e){if("function"==typeof n)return n(e,null);throw e}const m=this.s.topology.cursor(new $(this,this.s.namespace,c,s),s);if("function"!=typeof n)return m;n(null,m)})),me.prototype.insertOne=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{},this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined);const o=new te(this,e,t);return de(this.s.topology,o,n)},me.prototype.insertMany=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=t?Object.assign({},t):{ordered:!0};const o=new ee(this,e,t);return de(this.s.topology,o,n)},me.prototype.bulkWrite=function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{ordered:!0},!Array.isArray(e))throw a.create({message:"operations must be an array of documents",driver:!0});const o=new B(this,e,t);return de(this.s.topology,o,n)},me.prototype.insert=o((function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{ordered:!1},e=Array.isArray(e)?e:[e],!0===t.keepGoing&&(t.ordered=!1),this.insertMany(e,t,n)}),"collection.insert is deprecated. Use insertOne, insertMany or bulkWrite instead."),me.prototype.updateOne=function(e,t,n,o){"function"==typeof n&&(o=n,n={}),n=n||{};const i=T(t);if(i)return"function"==typeof o?o(i):this.s.promiseLibrary.reject(i);n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined);const r=new ue(this,e,t,n);return de(this.s.topology,r,o)},me.prototype.replaceOne=function(e,t,n,o){"function"==typeof n&&(o=n,n={}),n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined);const i=new ce(this,e,t,n);return de(this.s.topology,i,o)},me.prototype.updateMany=function(e,t,n,o){"function"==typeof n&&(o=n,n={}),n=n||{};const i=T(t);if(i)return"function"==typeof o?o(i):this.s.promiseLibrary.reject(i);n=Object.assign({},n),this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined);const r=new pe(this,e,t,n);return de(this.s.topology,r,o)},me.prototype.update=o((function(e,t,n,o){return"function"==typeof n&&(o=n,n={}),n=n||{},this.s.options.ignoreUndefined&&((n=Object.assign({},n)).ignoreUndefined=this.s.options.ignoreUndefined),v(this.s.topology,I,[this,e,t,n,o])}),"collection.update is deprecated. Use updateOne, updateMany, or bulkWrite instead."),me.prototype.deleteOne=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=Object.assign({},t),this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined);const o=new j(this,e,t);return de(this.s.topology,o,n)},me.prototype.removeOne=me.prototype.deleteOne,me.prototype.deleteMany=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=Object.assign({},t),this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined);const o=new L(this,e,t);return de(this.s.topology,o,n)},me.prototype.removeMany=me.prototype.deleteMany,me.prototype.remove=o((function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined),v(this.s.topology,A,[this,e,t,n])}),"collection.remove is deprecated. Use deleteOne, deleteMany, or bulkWrite instead."),me.prototype.save=o((function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},this.s.options.ignoreUndefined&&((t=Object.assign({},t)).ignoreUndefined=this.s.options.ignoreUndefined),v(this.s.topology,N,[this,e,t,n])}),"collection.save is deprecated. Use insertOne, insertMany, updateOne, or updateMany instead."),me.prototype.findOne=i({name:"collection.find",deprecatedOptions:fe,optionsIndex:1},(function(e,t,n){"object"==typeof n&&console.warn("Third parameter to `findOne()` must be a callback or undefined"),"function"==typeof e&&(n=e,e={},t={}),"function"==typeof t&&(n=t,t={});const o=new W(this,e=e||{},t=t||{});return de(this.s.topology,o,n)})),me.prototype.rename=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=Object.assign({},t,{readPreference:m.PRIMARY});const o=new se(this,e,t);return de(this.s.topology,o,n)},me.prototype.drop=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=new U(this.s.db,this.collectionName,e);return de(this.s.topology,n,t)},me.prototype.options=function(e,t){"function"==typeof e&&(t=e,e={});const n=new re(this,e=e||{});return de(this.s.topology,n,t)},me.prototype.isCapped=function(e,t){"function"==typeof e&&(t=e,e={});const n=new ne(this,e=e||{});return de(this.s.topology,n,t)},me.prototype.createIndex=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{};const o=new P(this.s.db,this.collectionName,e,t);return de(this.s.topology,o,n)},me.prototype.createIndexes=function(e,t,n){"function"==typeof t&&(n=t,t={}),"number"!=typeof(t=t?Object.assign({},t):{}).maxTimeMS&&delete t.maxTimeMS;const o=new D(this,e,t);return de(this.s.topology,o,n)},me.prototype.dropIndex=function(e,t,n){const o=Array.prototype.slice.call(arguments,1);n="function"==typeof o[o.length-1]?o.pop():void 0,(t=o.length&&o.shift()||{}).readPreference=m.PRIMARY;const i=new H(this,e,t);return de(this.s.topology,i,n)},me.prototype.dropIndexes=function(e,t){"function"==typeof e&&(t=e,e={}),"number"!=typeof(e=e?Object.assign({},e):{}).maxTimeMS&&delete e.maxTimeMS;const n=new q(this,e);return de(this.s.topology,n,t)},me.prototype.dropAllIndexes=o(me.prototype.dropIndexes,"collection.dropAllIndexes is deprecated. Use dropIndexes instead."),me.prototype.reIndex=function(e,t){"function"==typeof e&&(t=e,e={});const n=new ae(this,e=e||{});return de(this.s.topology,n,t)},me.prototype.listIndexes=function(e){return new O(this.s.topology,new oe(this,e),e)},me.prototype.ensureIndex=o((function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},v(this.s.topology,E,[this,e,t,n])}),"collection.ensureIndex is deprecated. Use createIndexes instead."),me.prototype.indexExists=function(e,t,n){"function"==typeof t&&(n=t,t={});const o=new Z(this,e,t=t||{});return de(this.s.topology,o,n)},me.prototype.indexInformation=function(e,t){const n=Array.prototype.slice.call(arguments,0);t="function"==typeof n[n.length-1]?n.pop():void 0,e=n.length&&n.shift()||{};const o=new Q(this.s.db,this.collectionName,e);return de(this.s.topology,o,t)},me.prototype.count=o((function(e,t,n){const o=Array.prototype.slice.call(arguments,0);return n="function"==typeof o[o.length-1]?o.pop():void 0,e=o.length&&o.shift()||{},"function"==typeof(t=o.length&&o.shift()||{})&&(n=t,t={}),t=t||{},de(this.s.topology,new F(this,e,t),n)}),"collection.count is deprecated, and will be removed in a future version. Use Collection.countDocuments or Collection.estimatedDocumentCount instead"),me.prototype.estimatedDocumentCount=function(e,t){"function"==typeof e&&(t=e,e={});const n=new F(this,e=e||{});return de(this.s.topology,n,t)},me.prototype.countDocuments=function(e,t,n){const o=Array.prototype.slice.call(arguments,0);n="function"==typeof o[o.length-1]?o.pop():void 0,e=o.length&&o.shift()||{},t=o.length&&o.shift()||{};const i=new R(this,e,t);return de(this.s.topology,i,n)},me.prototype.distinct=function(e,t,n,o){const i=Array.prototype.slice.call(arguments,1);o="function"==typeof i[i.length-1]?i.pop():void 0;const r=i.length&&i.shift()||{},s=i.length&&i.shift()||{},a=new z(this,e,r,s);return de(this.s.topology,a,o)},me.prototype.indexes=function(e,t){"function"==typeof e&&(t=e,e={});const n=new X(this,e=e||{});return de(this.s.topology,n,t)},me.prototype.stats=function(e,t){const n=Array.prototype.slice.call(arguments,0);t="function"==typeof n[n.length-1]?n.pop():void 0,e=n.length&&n.shift()||{};const o=new le(this,e);return de(this.s.topology,o,t)},me.prototype.findOneAndDelete=function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},null==e||"object"!=typeof e)throw c("filter parameter must be an object");const o=new K(this,e,t);return de(this.s.topology,o,n)},me.prototype.findOneAndReplace=function(e,t,n,o){if("function"==typeof n&&(o=n,n={}),n=n||{},null==e||"object"!=typeof e)throw c("filter parameter must be an object");if(null==t||"object"!=typeof t)throw c("replacement parameter must be an object");const i=Object.keys(t);if(i[0]&&"$"===i[0][0])throw c("The replacement document must not contain atomic operators.");const r=new G(this,e,t,n);return de(this.s.topology,r,o)},me.prototype.findOneAndUpdate=function(e,t,n,o){if("function"==typeof n&&(o=n,n={}),n=n||{},null==e||"object"!=typeof e)throw c("filter parameter must be an object");if(null==t||"object"!=typeof t)throw c("update parameter must be an object");const i=T(t);if(i)return"function"==typeof o?o(i):this.s.promiseLibrary.reject(i);const r=new Y(this,e,t,n);return de(this.s.topology,r,o)},me.prototype.findAndModify=o(ge,"collection.findAndModify is deprecated. Use findOneAndUpdate, findOneAndReplace or findOneAndDelete instead."),me.prototype._findAndModify=ge,me.prototype.findAndRemove=o((function(e,t,n,o){const i=Array.prototype.slice.call(arguments,1);return o="function"==typeof i[i.length-1]?i.pop():void 0,t=i.length&&i.shift()||[],(n=i.length&&i.shift()||{}).remove=!0,de(this.s.topology,new V(this,e,t,null,n),o)}),"collection.findAndRemove is deprecated. Use findOneAndDelete instead."),me.prototype.aggregate=function(e,t,n){if(Array.isArray(e))"function"==typeof t&&(n=t,t={}),null==t&&null==n&&(t={});else{const o=Array.prototype.slice.call(arguments,0);n=o.pop();const i=o[o.length-1];t=i&&(i.readPreference||i.explain||i.cursor||i.out||i.maxTimeMS||i.hint||i.allowDiskUse)?o.pop():{},e=o}const o=new _(this.s.topology,new M(this,e,t),t);if("function"!=typeof n)return o;n(null,o)},me.prototype.watch=function(e,t){return e=e||[],t=t||{},Array.isArray(e)||(t=e,e=[]),new y(this,e,t)},me.prototype.parallelCollectionScan=o((function(e,t){return"function"==typeof e&&(t=e,e={numCursors:1}),e.numCursors=e.numCursors||1,e.batchSize=e.batchSize||1e3,(e=Object.assign({},e)).readPreference=b(this,e),e.promiseLibrary=this.s.promiseLibrary,e.session&&(e.session=void 0),v(this.s.topology,k,[this,e,t],{skipSessions:!0})}),"parallelCollectionScan is deprecated in MongoDB v4.1"),me.prototype.geoHaystackSearch=function(e,t,n,o){const i=Array.prototype.slice.call(arguments,2);o="function"==typeof i[i.length-1]?i.pop():void 0,n=i.length&&i.shift()||{};const r=new J(this,e,t,n);return de(this.s.topology,r,o)},me.prototype.group=o((function(e,t,n,o,i,r,s,a){const c=Array.prototype.slice.call(arguments,3);return a="function"==typeof c[c.length-1]?c.pop():void 0,o=c.length?c.shift():null,i=c.length?c.shift():null,r=c.length?c.shift():null,s=c.length&&c.shift()||{},"function"!=typeof i&&(r=i,i=null),!Array.isArray(e)&&e instanceof Object&&"function"!=typeof e&&"Code"!==e._bsontype&&(e=Object.keys(e)),"function"==typeof o&&(o=o.toString()),"function"==typeof i&&(i=i.toString()),r=null==r||r,v(this.s.topology,C,[this,e,t,n,o,i,r,s,a])}),"MongoDB 3.6 or higher no longer supports the group command. We recommend rewriting using the aggregation framework."),me.prototype.mapReduce=function(e,t,n,o){if("function"==typeof n&&(o=n,n={}),null==n.out)throw new Error("the out option parameter must be defined, see mongodb docs for possible values");"function"==typeof e&&(e=e.toString()),"function"==typeof t&&(t=t.toString()),"function"==typeof n.finalize&&(n.finalize=n.finalize.toString());const i=new ie(this,e,t,n);return de(this.s.topology,i,o)},me.prototype.initializeUnorderedBulkOp=function(e){return null==(e=e||{}).ignoreUndefined&&(e.ignoreUndefined=this.s.options.ignoreUndefined),e.promiseLibrary=this.s.promiseLibrary,f(this.s.topology,this,e)},me.prototype.initializeOrderedBulkOp=function(e){return null==(e=e||{}).ignoreUndefined&&(e.ignoreUndefined=this.s.options.ignoreUndefined),e.promiseLibrary=this.s.promiseLibrary,g(this.s.topology,this,e)},me.prototype.getLogger=function(){return this.s.db.s.logger},e.exports=me},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(1).OperationBase,r=n(0).resolveReadPreference,s=n(38),a=n(31),c=n(5).maxWireVersion,l=n(36).commandSupportsReadConcern,p=n(96).MongoError,u=5;e.exports=class extends i{constructor(e,t,n){super(t),this.ns=e.s.namespace.withCollection("$cmd"),this.readPreference=r(e,this.options),this.readConcern=function(e,t){return s.fromOptions(t)||e.readConcern}(e,this.options),this.writeConcern=function(e,t){return a.fromOptions(t)||e.writeConcern}(e,this.options),this.explain=!1,n&&"boolean"==typeof n.fullResponse&&(this.fullResponse=!0),this.options.readPreference=this.readPreference,e.s.logger?this.logger=e.s.logger:e.s.db&&e.s.db.logger&&(this.logger=e.s.db.logger)}executeCommand(e,t,n){this.server=e;const i=this.options,r=c(e),s=this.session&&this.session.inTransaction();this.readConcern&&l(t)&&!s&&Object.assign(t,{readConcern:this.readConcern}),i.collation&&r<u?n(new p(`Server ${e.name}, which reports wire version ${r}, does not support collation`)):(r>=u&&(this.writeConcern&&this.hasAspect(o.WRITE_OPERATION)&&Object.assign(t,{writeConcern:this.writeConcern}),i.collation&&"object"==typeof i.collation&&Object.assign(t,{collation:i.collation})),"number"==typeof i.maxTimeMS&&(t.maxTimeMS=i.maxTimeMS),"string"==typeof i.comment&&(t.comment=i.comment),this.logger&&this.logger.isDebug()&&this.logger.debug(`executing command ${JSON.stringify(t)} against ${this.ns}`),e.command(this.ns.toString(),t,this.options,(e,t)=>{e?n(e,null):this.fullResponse?n(null,t):n(null,t.result)}))}}},function(e,t,n){if("undefined"!=typeof global)var o=n(60).Buffer;var i=n(25);function r(e,t){if(!(this instanceof r))return new r(e,t);if(!(null==e||"string"==typeof e||o.isBuffer(e)||e instanceof Uint8Array||Array.isArray(e)))throw new Error("only String, Buffer, Uint8Array or Array accepted");if(this._bsontype="Binary",e instanceof Number?(this.sub_type=e,this.position=0):(this.sub_type=null==t?s:t,this.position=0),null==e||e instanceof Number)void 0!==o?this.buffer=i.allocBuffer(r.BUFFER_SIZE):"undefined"!=typeof Uint8Array?this.buffer=new Uint8Array(new ArrayBuffer(r.BUFFER_SIZE)):this.buffer=new Array(r.BUFFER_SIZE),this.position=0;else{if("string"==typeof e)if(void 0!==o)this.buffer=i.toBuffer(e);else{if("undefined"==typeof Uint8Array&&"[object Array]"!==Object.prototype.toString.call(e))throw new Error("only String, Buffer, Uint8Array or Array accepted");this.buffer=a(e)}else this.buffer=e;this.position=e.length}}r.prototype.put=function(e){if(null!=e.length&&"number"!=typeof e&&1!==e.length)throw new Error("only accepts single character String, Uint8Array or Array");if("number"!=typeof e&&e<0||e>255)throw new Error("only accepts number in a valid unsigned byte range 0-255");var t=null;if(t="string"==typeof e?e.charCodeAt(0):null!=e.length?e[0]:e,this.buffer.length>this.position)this.buffer[this.position++]=t;else if(void 0!==o&&o.isBuffer(this.buffer)){var n=i.allocBuffer(r.BUFFER_SIZE+this.buffer.length);this.buffer.copy(n,0,0,this.buffer.length),this.buffer=n,this.buffer[this.position++]=t}else{n=null,n="[object Uint8Array]"===Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(r.BUFFER_SIZE+this.buffer.length)):new Array(r.BUFFER_SIZE+this.buffer.length);for(var s=0;s<this.buffer.length;s++)n[s]=this.buffer[s];this.buffer=n,this.buffer[this.position++]=t}},r.prototype.write=function(e,t){if(t="number"==typeof t?t:this.position,this.buffer.length<t+e.length){var n=null;if(void 0!==o&&o.isBuffer(this.buffer))n=i.allocBuffer(this.buffer.length+e.length),this.buffer.copy(n,0,0,this.buffer.length);else if("[object Uint8Array]"===Object.prototype.toString.call(this.buffer)){n=new Uint8Array(new ArrayBuffer(this.buffer.length+e.length));for(var r=0;r<this.position;r++)n[r]=this.buffer[r]}this.buffer=n}if(void 0!==o&&o.isBuffer(e)&&o.isBuffer(this.buffer))e.copy(this.buffer,t,0,e.length),this.position=t+e.length>this.position?t+e.length:this.position;else if(void 0!==o&&"string"==typeof e&&o.isBuffer(this.buffer))this.buffer.write(e,t,"binary"),this.position=t+e.length>this.position?t+e.length:this.position;else if("[object Uint8Array]"===Object.prototype.toString.call(e)||"[object Array]"===Object.prototype.toString.call(e)&&"string"!=typeof e){for(r=0;r<e.length;r++)this.buffer[t++]=e[r];this.position=t>this.position?t:this.position}else if("string"==typeof e){for(r=0;r<e.length;r++)this.buffer[t++]=e.charCodeAt(r);this.position=t>this.position?t:this.position}},r.prototype.read=function(e,t){if(t=t&&t>0?t:this.position,this.buffer.slice)return this.buffer.slice(e,e+t);for(var n="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(t)):new Array(t),o=0;o<t;o++)n[o]=this.buffer[e++];return n},r.prototype.value=function(e){if((e=null!=e&&e)&&void 0!==o&&o.isBuffer(this.buffer)&&this.buffer.length===this.position)return this.buffer;if(void 0!==o&&o.isBuffer(this.buffer))return e?this.buffer.slice(0,this.position):this.buffer.toString("binary",0,this.position);if(e){if(null!=this.buffer.slice)return this.buffer.slice(0,this.position);for(var t="[object Uint8Array]"===Object.prototype.toString.call(this.buffer)?new Uint8Array(new ArrayBuffer(this.position)):new Array(this.position),n=0;n<this.position;n++)t[n]=this.buffer[n];return t}return c(this.buffer,0,this.position)},r.prototype.length=function(){return this.position},r.prototype.toJSON=function(){return null!=this.buffer?this.buffer.toString("base64"):""},r.prototype.toString=function(e){return null!=this.buffer?this.buffer.slice(0,this.position).toString(e):""};var s=0,a=function(e){for(var t="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(e.length)):new Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t},c=function(e,t,n){for(var o="",i=t;i<n;i++)o+=String.fromCharCode(e[i]);return o};r.BUFFER_SIZE=256,r.SUBTYPE_DEFAULT=0,r.SUBTYPE_FUNCTION=1,r.SUBTYPE_BYTE_ARRAY=2,r.SUBTYPE_UUID_OLD=3,r.SUBTYPE_UUID=4,r.SUBTYPE_MD5=5,r.SUBTYPE_USER_DEFINED=128,e.exports=r,e.exports.Binary=r},function(e,t,n){"use strict";const o=n(24).ServerType,i=n(24).ServerDescription,r=n(84),s=r.MIN_SUPPORTED_SERVER_VERSION,a=r.MAX_SUPPORTED_SERVER_VERSION,c=r.MIN_SUPPORTED_WIRE_VERSION,l=r.MAX_SUPPORTED_WIRE_VERSION,p={Single:"Single",ReplicaSetNoPrimary:"ReplicaSetNoPrimary",ReplicaSetWithPrimary:"ReplicaSetWithPrimary",Sharded:"Sharded",Unknown:"Unknown"};class u{constructor(e,t,n,i,r,u,d,h){d=d||{},this.type=e||p.Unknown,this.setName=n||null,this.maxSetVersion=i||null,this.maxElectionId=r||null,this.servers=t||new Map,this.stale=!1,this.compatible=!0,this.compatibilityError=null,this.logicalSessionTimeoutMinutes=null,this.heartbeatFrequencyMS=d.heartbeatFrequencyMS||0,this.localThresholdMS=d.localThresholdMS||0,this.options=d,this.error=h,this.commonWireVersion=u||null;for(const e of this.servers.values())if(e.type!==o.Unknown&&(e.minWireVersion>l&&(this.compatible=!1,this.compatibilityError=`Server at ${e.address} requires wire version ${e.minWireVersion}, but this version of the driver only supports up to ${l} (MongoDB ${a})`),e.maxWireVersion<c)){this.compatible=!1,this.compatibilityError=`Server at ${e.address} reports wire version ${e.maxWireVersion}, but this version of the driver requires at least ${c} (MongoDB ${s}).`;break}const m=Array.from(this.servers.values()).filter(e=>e.isReadable);this.logicalSessionTimeoutMinutes=m.reduce((e,t)=>null==t.logicalSessionTimeoutMinutes?null:null==e?t.logicalSessionTimeoutMinutes:Math.min(e,t.logicalSessionTimeoutMinutes),null)}updateFromSrvPollingEvent(e){const t=e.addresses(),n=new Map(this.servers);for(const e of this.servers)t.has(e[0])?t.delete(e[0]):n.delete(e[0]);if(n.size===this.servers.size&&0===t.size)return this;for(const e of t)n.set(e,new i(e));return new u(this.type,n,this.setName,this.maxSetVersion,this.maxElectionId,this.commonWireVersion,this.options,null)}update(e){const t=e.address;let n=this.type,r=this.setName,s=this.maxSetVersion,a=this.maxElectionId,c=this.commonWireVersion,l=e.error||null;const m=e.type;let f=new Map(this.servers);if(0!==e.maxWireVersion&&(c=null==c?e.maxWireVersion:Math.min(c,e.maxWireVersion)),f.set(t,e),n===p.Single)return new u(p.Single,f,r,s,a,c,this.options,l);if(n===p.Unknown&&(m===o.Standalone?f.delete(t):n=function(e){return e===o.Mongos?p.Sharded:e===o.RSPrimary?p.ReplicaSetWithPrimary:p.ReplicaSetNoPrimary}(m)),n===p.Sharded&&-1===[o.Mongos,o.Unknown].indexOf(m)&&f.delete(t),n===p.ReplicaSetNoPrimary)if([o.Mongos,o.Unknown].indexOf(m)>=0&&f.delete(t),m===o.RSPrimary){const t=d(f,r,e,s,a);n=t[0],r=t[1],s=t[2],a=t[3]}else if([o.RSSecondary,o.RSArbiter,o.RSOther].indexOf(m)>=0){const t=function(e,t,n){let o=p.ReplicaSetNoPrimary;if((t=t||n.setName)!==n.setName)return e.delete(n.address),[o,t];n.allHosts.forEach(t=>{e.has(t)||e.set(t,new i(t))}),n.me&&n.address!==n.me&&e.delete(n.address);return[o,t]}(f,r,e);n=t[0],r=t[1]}if(n===p.ReplicaSetWithPrimary)if([o.Standalone,o.Mongos].indexOf(m)>=0)f.delete(t),n=h(f);else if(m===o.RSPrimary){const t=d(f,r,e,s,a);n=t[0],r=t[1],s=t[2],a=t[3]}else n=[o.RSSecondary,o.RSArbiter,o.RSOther].indexOf(m)>=0?function(e,t,n){if(null==t)throw new TypeError("setName is required");(t!==n.setName||n.me&&n.address!==n.me)&&e.delete(n.address);return h(e)}(f,r,e):h(f);return new u(n,f,r,s,a,c,this.options,l)}get hasKnownServers(){return Array.from(this.servers.values()).some(e=>e.type!==i.Unknown)}get hasDataBearingServers(){return Array.from(this.servers.values()).some(e=>e.isDataBearing)}hasServer(e){return this.servers.has(e)}}function d(e,t,n,r,s){if((t=t||n.setName)!==n.setName)return e.delete(n.address),[h(e),t,r,s];const a=n.electionId?n.electionId.$oid:null,c=s?s.$oid:null;if(null!=n.setVersion&&null!=a){if(null!=r&&null!=c&&(r>n.setVersion||c>a))return e.set(n.address,new i(n.address)),[h(e),t,r,s];s=n.electionId}null!=n.setVersion&&(null==r||n.setVersion>r)&&(r=n.setVersion);for(const t of e.keys()){const r=e.get(t);if(r.type===o.RSPrimary&&r.address!==n.address){e.set(t,new i(r.address));break}}n.allHosts.forEach(t=>{e.has(t)||e.set(t,new i(t))});const l=Array.from(e.keys()),p=n.allHosts;return l.filter(e=>-1===p.indexOf(e)).forEach(t=>{e.delete(t)}),[h(e),t,r,s]}function h(e){for(const t of e.keys())if(e.get(t).type===o.RSPrimary)return p.ReplicaSetWithPrimary;return p.ReplicaSetNoPrimary}e.exports={TopologyType:p,TopologyDescription:u}},function(e,t,n){"use strict";const o=n(12).retrieveBSON,i=n(9),r=o(),s=r.Binary,a=n(5).uuidV4,c=n(3).MongoError,l=n(3).isRetryableError,p=n(3).MongoNetworkError,u=n(3).MongoWriteConcernError,d=n(53).Transaction,h=n(53).TxnState,m=n(5).isPromiseLike,f=n(11),g=n(53).isTransactionCommand,y=n(6).resolveClusterTime,v=n(7).isSharded,b=n(5).maxWireVersion,x=8;function S(e,t){if(null==e.serverSession){const e=new c("Cannot use a session that has ended");if("function"==typeof t)return t(e,null),!1;throw e}return!0}class w extends i{constructor(e,t,n,o){if(super(),null==e)throw new Error("ClientSession requires a topology");if(null==t||!(t instanceof R))throw new Error("ClientSession requires a ServerSessionPool");n=n||{},o=o||{},this.topology=e,this.sessionPool=t,this.hasEnded=!1,this.serverSession=t.acquire(),this.clientOptions=o,this.supports={causalConsistency:void 0===n.causalConsistency||n.causalConsistency},this.clusterTime=n.initialClusterTime,this.operationTime=null,this.explicit=!!n.explicit,this.owner=n.owner,this.defaultTransactionOptions=Object.assign({},n.defaultTransactionOptions),this.transaction=new d}get id(){return this.serverSession.id}endSession(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},this.hasEnded?"function"==typeof t&&t(null,null):(this.serverSession&&this.inTransaction()&&this.abortTransaction(),this.hasEnded=!0,this.emit("ended",this),this.sessionPool.release(this.serverSession),this.serverSession=null,"function"==typeof t&&t(null,null))}advanceOperationTime(e){null!=this.operationTime?e.greaterThan(this.operationTime)&&(this.operationTime=e):this.operationTime=e}equals(e){return e instanceof w&&this.id.id.buffer.equals(e.id.id.buffer)}incrementTransactionNumber(){this.serverSession.txnNumber++}inTransaction(){return this.transaction.isActive}startTransaction(e){if(S(this),this.inTransaction())throw new c("Transaction already in progress");const t=b(this.topology);if(v(this.topology)&&null!=t&&t<x)throw new c("Transactions are not supported on sharded clusters in MongoDB < 4.2.");this.incrementTransactionNumber(),this.transaction=new d(Object.assign({},this.clientOptions,e||this.defaultTransactionOptions)),this.transaction.transition(h.STARTING_TRANSACTION)}commitTransaction(e){if("function"!=typeof e)return new Promise((e,t)=>{M(this,"commitTransaction",(n,o)=>n?t(n):e(o))});M(this,"commitTransaction",e)}abortTransaction(e){if("function"!=typeof e)return new Promise((e,t)=>{M(this,"abortTransaction",(n,o)=>n?t(n):e(o))});M(this,"abortTransaction",e)}toBSON(){throw new Error("ClientSession cannot be serialized to BSON.")}withTransaction(e,t){return I(this,Date.now(),e,t)}}const _=12e4,O=100,T=79,E=50,C=new Set(["CannotSatisfyWriteConcern","UnknownReplWriteConcern","UnsatisfiableWriteConcern"]);function k(e,t){return Date.now()-e<t}function A(e){return e.code===E||e.writeConcernError&&e.writeConcernError.code===E}const N=new Set([h.NO_TRANSACTION,h.TRANSACTION_COMMITTED,h.TRANSACTION_ABORTED]);function I(e,t,n,o){let i;e.startTransaction(o);try{i=n(e)}catch(e){i=Promise.reject(e)}if(!m(i))throw e.abortTransaction(),new TypeError("Function provided to `withTransaction` must return a Promise");return i.then(()=>{if(!function(e){return N.has(e.transaction.state)}(e))return function e(t,n,o,i){return t.commitTransaction().catch(r=>{if(r instanceof c&&k(n,_)&&!A(r)){if(r.hasErrorLabel("UnknownTransactionCommitResult"))return e(t,n,o,i);if(r.hasErrorLabel("TransientTransactionError"))return I(t,n,o,i)}throw r})}(e,t,n,o)}).catch(i=>{function r(i){if(i instanceof c&&i.hasErrorLabel("TransientTransactionError")&&k(t,_))return I(e,t,n,o);throw A(i)&&(null==i.errorLabels&&(i.errorLabels=[]),i.errorLabels.push("UnknownTransactionCommitResult")),i}return e.transaction.isActive?e.abortTransaction().then(()=>r(i)):r(i)})}function M(e,t,n){if(!S(e,n))return;let o=e.transaction.state;if(o===h.NO_TRANSACTION)return void n(new c("No transaction started"));if("commitTransaction"===t){if(o===h.STARTING_TRANSACTION||o===h.TRANSACTION_COMMITTED_EMPTY)return e.transaction.transition(h.TRANSACTION_COMMITTED_EMPTY),void n(null,null);if(o===h.TRANSACTION_ABORTED)return void n(new c("Cannot call commitTransaction after calling abortTransaction"))}else{if(o===h.STARTING_TRANSACTION)return e.transaction.transition(h.TRANSACTION_ABORTED),void n(null,null);if(o===h.TRANSACTION_ABORTED)return void n(new c("Cannot call abortTransaction twice"));if(o===h.TRANSACTION_COMMITTED||o===h.TRANSACTION_COMMITTED_EMPTY)return void n(new c("Cannot call abortTransaction after calling commitTransaction"))}const i={[t]:1};let r;function s(o,i){if("commitTransaction"===t){if(e.transaction.transition(h.TRANSACTION_COMMITTED),o&&(o instanceof p||o instanceof u||l(o)||A(o))){if(o.errorLabels){const e=o.errorLabels.indexOf("TransientTransactionError");-1!==e&&o.errorLabels.splice(e,1)}else o.errorLabels=[];(A(r=o)||!C.has(r.codeName)&&r.code!==O&&r.code!==T)&&(o.errorLabels.push("UnknownTransactionCommitResult"),e.transaction.unpinServer())}}else e.transaction.transition(h.TRANSACTION_ABORTED);var r;n(o,i)}function a(e){return"commitTransaction"===t?e:null}e.transaction.options.writeConcern?r=Object.assign({},e.transaction.options.writeConcern):e.clientOptions&&e.clientOptions.w&&(r={w:e.clientOptions.w}),o===h.TRANSACTION_COMMITTED&&(r=Object.assign({wtimeout:1e4},r,{w:"majority"})),r&&Object.assign(i,{writeConcern:r}),"commitTransaction"===t&&e.transaction.options.maxTimeMS&&Object.assign(i,{maxTimeMS:e.transaction.options.maxTimeMS}),e.transaction.recoveryToken&&function(e){return!!e.topology.s.options.useRecoveryToken}(e)&&(i.recoveryToken=e.transaction.recoveryToken),e.topology.command("admin.$cmd",i,{session:e},(t,n)=>{if(t&&l(t))return i.commitTransaction&&(e.transaction.unpinServer(),i.writeConcern=Object.assign({wtimeout:1e4},i.writeConcern,{w:"majority"})),e.topology.command("admin.$cmd",i,{session:e},(e,t)=>s(a(e),t));s(a(t),n)})}class B{constructor(){this.id={id:new s(a(),s.SUBTYPE_UUID)},this.lastUse=Date.now(),this.txnNumber=0,this.isDirty=!1}hasTimedOut(e){return Math.round((Date.now()-this.lastUse)%864e5%36e5/6e4)>e-1}}class R{constructor(e){if(null==e)throw new Error("ServerSessionPool requires a topology");this.topology=e,this.sessions=[]}endAllPooledSessions(){this.sessions.length&&(this.topology.endSessions(this.sessions.map(e=>e.id)),this.sessions=[])}acquire(){const e=this.topology.logicalSessionTimeoutMinutes;for(;this.sessions.length;){const t=this.sessions.shift();if(!t.hasTimedOut(e))return t}return new B}release(e){const t=this.topology.logicalSessionTimeoutMinutes;for(;this.sessions.length;){if(!this.sessions[this.sessions.length-1].hasTimedOut(t))break;this.sessions.pop()}if(!e.hasTimedOut(t)){if(e.isDirty)return;this.sessions.unshift(e)}}}function P(e,t){return!!(e.aggregate||e.count||e.distinct||e.find||e.parallelCollectionScan||e.geoNear||e.geoSearch)||!(!e.mapReduce||!t.out||1!==t.out.inline&&"inline"!==t.out)}e.exports={ClientSession:w,ServerSession:B,ServerSessionPool:R,TxnState:h,applySession:function(e,t,n){const o=e.serverSession;if(null==o)return new c("Cannot use a session that has ended");o.lastUse=Date.now(),t.lsid=o.id;const i=e.inTransaction()||g(t),s=n.willRetryWrite,a=P(t);if(o.txnNumber&&(s||i)&&(t.txnNumber=r.Long.fromNumber(o.txnNumber)),!i)return e.transaction.state!==h.NO_TRANSACTION&&e.transaction.transition(h.NO_TRANSACTION),void(e.supports.causalConsistency&&e.operationTime&&a&&(t.readConcern=t.readConcern||{},Object.assign(t.readConcern,{afterClusterTime:e.operationTime})));if(n.readPreference&&!n.readPreference.equals(f.primary))return new c(`Read preference in a transaction must be primary, not: ${n.readPreference.mode}`);if(t.autocommit=!1,e.transaction.state===h.STARTING_TRANSACTION){e.transaction.transition(h.TRANSACTION_IN_PROGRESS),t.startTransaction=!0;const n=e.transaction.options.readConcern||e.clientOptions.readConcern;n&&(t.readConcern=n),e.supports.causalConsistency&&e.operationTime&&(t.readConcern=t.readConcern||{},Object.assign(t.readConcern,{afterClusterTime:e.operationTime}))}},updateSessionFromResponse:function(e,t){t.$clusterTime&&y(e,t.$clusterTime),t.operationTime&&e&&e.supports.causalConsistency&&e.advanceOperationTime(t.operationTime),t.recoveryToken&&e&&e.inTransaction()&&(e.transaction._recoveryToken=t.recoveryToken)},commandSupportsReadConcern:P}},function(e,t,n){"use strict";const o=n(21).Query,i=n(51).Msg,r=n(3).MongoError,s=n(7).getReadPreference,a=n(7).isSharded,c=n(7).databaseNamespace,l=n(53).isTransactionCommand,p=n(36).applySession;function u(e,t,n,u,d){const h=e.s.bson,m=e.s.pool,f=s(n,u),g=function(e){const t=e.ismaster?e.ismaster:e.description;if(null==t)return!1;return t.maxWireVersion>=6&&null==t.__nodejs_mock_server__}(e),y=u.session;let v=e.clusterTime,b=Object.assign({},n);if(function(e){if(null==e)return!1;if(e.description)return e.description.maxWireVersion>=6;return null!=e.ismaster&&e.ismaster.maxWireVersion>=6}(e)&&y){y.clusterTime&&y.clusterTime.clusterTime.greaterThan(v.clusterTime)&&(v=y.clusterTime);const e=p(y,b,u);if(e)return d(e)}v&&(b.$clusterTime=v),a(e)&&!g&&f&&"primary"!==f.preference&&(b={$query:b,$readPreference:f.toJSON()});const x=Object.assign({command:!0,numberToSkip:0,numberToReturn:-1,checkKeys:!1},u);x.slaveOk=f.slaveOk();const S=`${c(t)}.$cmd`,w=g?new i(h,S,b,x):new o(h,S,b,x),_=y&&(y.inTransaction()||l(b))?function(e){return!n.commitTransaction&&e&&e instanceof r&&e.hasErrorLabel("TransientTransactionError")&&y.transaction.unpinServer(),d.apply(null,arguments)}:d;try{m.write(w,x,_)}catch(e){_(e)}}e.exports=function(e,t,n,o,i){if("function"==typeof o&&(i=o,o={}),o=o||{},null==n)return i(new r(`command ${JSON.stringify(n)} does not return a cursor`));!function(e){return e.autoEncrypter}(e)?u(e,t,n,o,i):function(e,t,n,o,i){const r=!!e.s.options.bypassAutoEncryption,s=e.autoEncrypter;function a(e,t){e||null==t?i(e,t):s.decrypt(t.result,(e,n)=>{e?i(e,null):(t.result=n,t.message.documents=[n],i(null,t))})}if(r)return void u(e,t,n,o,a);s.encrypt(t,n,(n,r)=>{n?i(n,null):u(e,t,r,o,a)})}(e,t,n,o,i)}},function(e,t,n){"use strict";class o{constructor(e){null!=e&&(this.level=e)}static fromOptions(e){if(null!=e)return e.readConcern?e.readConcern instanceof o?e.readConcern:new o(e.readConcern.level):e.level?new o(e.level):void 0}static get MAJORITY(){return"majority"}static get AVAILABLE(){return"available"}static get LINEARIZABLE(){return"linearizable"}static get SNAPSHOT(){return"snapshot"}}e.exports=o},function(e,t,n){"use strict";const o=n(9).EventEmitter,i=n(4).inherits,r=n(0).getSingleProperty,s=n(75),a=n(0).handleCallback,c=n(0).filterOptions,l=n(0).toError,p=n(2).ReadPreference,u=n(2).MongoError,d=n(2).ObjectID,h=n(2).Logger,m=n(32),f=n(0).mergeOptionsAndWriteConcern,g=n(0).executeLegacyOperation,y=n(0).resolveReadPreference,v=n(72),b=n(4).deprecate,x=n(0).deprecateOptions,S=n(0).MongoDBNamespace,w=n(73),_=n(31),O=n(38),T=n(74),E=n(10).createListener,C=n(10).ensureIndex,k=n(10).evaluate,A=n(10).profilingInfo,N=n(10).validateDatabaseName,I=n(55),M=n(103),B=n(177),R=n(15),P=n(178),D=n(99),L=n(76).DropCollectionOperation,j=n(76).DropDatabaseOperation,z=n(104),U=n(101),H=n(179),q=n(180),F=n(105),$=n(106),W=n(181),V=n(30),K=["w","wtimeout","fsync","j","readPreference","readPreferenceTags","native_parser","forceServerObjectId","pkFactory","serializeFunctions","raw","bufferMaxEntries","authSource","ignoreUndefined","promoteLongs","promiseLibrary","readConcern","retryMiliSeconds","numberOfRetries","parentDb","noListener","loggerLevel","logger","promoteBuffers","promoteLongs","promoteValues","compression","retryWrites"];function G(e,t,n){if(n=n||{},!(this instanceof G))return new G(e,t,n);o.call(this);const i=n.promiseLibrary||Promise;(n=c(n,K)).promiseLibrary=i,this.s={dbCache:{},children:[],topology:t,options:n,logger:h("Db",n),bson:t?t.bson:null,readPreference:p.fromOptions(n),bufferMaxEntries:"number"==typeof n.bufferMaxEntries?n.bufferMaxEntries:-1,parentDb:n.parentDb||null,pkFactory:n.pkFactory||d,nativeParser:n.nativeParser||n.native_parser,promiseLibrary:i,noListener:"boolean"==typeof n.noListener&&n.noListener,readConcern:O.fromOptions(n),writeConcern:_.fromOptions(n),namespace:new S(e)},N(e),r(this,"serverConfig",this.s.topology),r(this,"bufferMaxEntries",this.s.bufferMaxEntries),r(this,"databaseName",this.s.namespace.db),n.parentDb||this.s.noListener||(t.on("error",E(this,"error",this)),t.on("timeout",E(this,"timeout",this)),t.on("close",E(this,"close",this)),t.on("parseError",E(this,"parseError",this)),t.once("open",E(this,"open",this)),t.once("fullsetup",E(this,"fullsetup",this)),t.once("all",E(this,"all",this)),t.on("reconnect",E(this,"reconnect",this)))}i(G,o),Object.defineProperty(G.prototype,"topology",{enumerable:!0,get:function(){return this.s.topology}}),Object.defineProperty(G.prototype,"options",{enumerable:!0,get:function(){return this.s.options}}),Object.defineProperty(G.prototype,"slaveOk",{enumerable:!0,get:function(){return null!=this.s.options.readPreference&&("primary"!==this.s.options.readPreference||"primary"!==this.s.options.readPreference.mode)}}),Object.defineProperty(G.prototype,"readConcern",{enumerable:!0,get:function(){return this.s.readConcern}}),Object.defineProperty(G.prototype,"readPreference",{enumerable:!0,get:function(){return null==this.s.readPreference?p.primary:this.s.readPreference}}),Object.defineProperty(G.prototype,"writeConcern",{enumerable:!0,get:function(){return this.s.writeConcern}}),Object.defineProperty(G.prototype,"namespace",{enumerable:!0,get:function(){return this.s.namespace.toString()}}),G.prototype.command=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=Object.assign({},t);const o=new R(this,t,null,e);return V(this.s.topology,o,n)},G.prototype.aggregate=function(e,t,n){"function"==typeof t&&(n=t,t={}),null==t&&null==n&&(t={});const o=new T(this.s.topology,new I(this,e,t),t);if("function"!=typeof n)return o;n(null,o)},G.prototype.admin=function(){return new(n(107))(this,this.s.topology,this.s.promiseLibrary)};const Y=["pkFactory","readPreference","serializeFunctions","strict","readConcern","ignoreUndefined","promoteValues","promoteBuffers","promoteLongs"];G.prototype.collection=function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},(t=Object.assign({},t)).promiseLibrary=this.s.promiseLibrary,t.readConcern=t.readConcern?new O(t.readConcern.level):this.readConcern,this.s.options.ignoreUndefined&&(t.ignoreUndefined=this.s.options.ignoreUndefined),null==(t=f(t,this.s.options,Y,!0))||!t.strict)try{const o=new m(this,this.s.topology,this.databaseName,e,this.s.pkFactory,t);return n&&n(null,o),o}catch(e){if(e instanceof u&&n)return n(e);throw e}if("function"!=typeof n)throw l(`A callback is required in strict mode. While getting collection ${e}`);if(this.serverConfig&&this.serverConfig.isDestroyed())return n(new u("topology was destroyed"));const o=Object.assign({},t,{nameOnly:!0});this.listCollections({name:e},o).toArray((o,i)=>{if(null!=o)return a(n,o,null);if(0===i.length)return a(n,l(`Collection ${e} does not exist. Currently in strict mode.`),null);try{return a(n,null,new m(this,this.s.topology,this.databaseName,e,this.s.pkFactory,t))}catch(o){return a(n,o,null)}})},G.prototype.createCollection=x({name:"Db.createCollection",deprecatedOptions:["autoIndexId"],optionsIndex:1},(function(e,t,n){"function"==typeof t&&(n=t,t={}),(t=t||{}).promiseLibrary=t.promiseLibrary||this.s.promiseLibrary,t.readConcern=t.readConcern?new O(t.readConcern.level):this.readConcern;const o=new P(this,e,t);return V(this.s.topology,o,n)})),G.prototype.stats=function(e,t){"function"==typeof e&&(t=e,e={});const n={dbStats:!0};null!=(e=e||{}).scale&&(n.scale=e.scale),null==e.readPreference&&this.s.readPreference&&(e.readPreference=this.s.readPreference);const o=new R(this,e,null,n);return V(this.s.topology,o,t)},G.prototype.listCollections=function(e,t){return e=e||{},t=t||{},new s(this.s.topology,new H(this,e,t),t)},G.prototype.eval=b((function(e,t,n,o){const i=Array.prototype.slice.call(arguments,1);return o="function"==typeof i[i.length-1]?i.pop():void 0,t=i.length?i.shift():t,n=i.length&&i.shift()||{},g(this.s.topology,k,[this,e,t,n,o])}),"Db.eval is deprecated as of MongoDB version 3.2"),G.prototype.renameCollection=function(e,t,n,o){"function"==typeof n&&(o=n,n={}),(n=Object.assign({},n,{readPreference:p.PRIMARY})).new_collection=!0;const i=new $(this.collection(e),t,n);return V(this.s.topology,i,o)},G.prototype.dropCollection=function(e,t,n){"function"==typeof t&&(n=t,t={});const o=new L(this,e,t=t||{});return V(this.s.topology,o,n)},G.prototype.dropDatabase=function(e,t){"function"==typeof e&&(t=e,e={});const n=new j(this,e=e||{});return V(this.s.topology,n,t)},G.prototype.collections=function(e,t){"function"==typeof e&&(t=e,e={});const n=new B(this,e=e||{});return V(this.s.topology,n,t)},G.prototype.executeDbAdminCommand=function(e,t,n){"function"==typeof t&&(n=t,t={}),(t=t||{}).readPreference=y(this,t);const o=new z(this,e,t);return V(this.s.topology,o,n)},G.prototype.createIndex=function(e,t,n,o){"function"==typeof n&&(o=n,n={}),n=n?Object.assign({},n):{};const i=new D(this,e,t,n);return V(this.s.topology,i,o)},G.prototype.ensureIndex=b((function(e,t,n,o){return"function"==typeof n&&(o=n,n={}),n=n||{},g(this.s.topology,C,[this,e,t,n,o])}),"Db.ensureIndex is deprecated as of MongoDB version 3.0 / driver version 2.0"),G.prototype.addChild=function(e){if(this.s.parentDb)return this.s.parentDb.addChild(e);this.s.children.push(e)},G.prototype.addUser=function(e,t,n,o){"function"==typeof n&&(o=n,n={}),n=n||{},"string"==typeof e&&null!=t&&"object"==typeof t&&(n=t,t=null);const i=new M(this,e,t,n);return V(this.s.topology,i,o)},G.prototype.removeUser=function(e,t,n){"function"==typeof t&&(n=t,t={});const o=new F(this,e,t=t||{});return V(this.s.topology,o,n)},G.prototype.setProfilingLevel=function(e,t,n){"function"==typeof t&&(n=t,t={});const o=new W(this,e,t=t||{});return V(this.s.topology,o,n)},G.prototype.profilingInfo=b((function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},g(this.s.topology,A,[this,e,t])}),"Db.profilingInfo is deprecated. Query the system.profile collection directly."),G.prototype.profilingLevel=function(e,t){"function"==typeof e&&(t=e,e={});const n=new q(this,e=e||{});return V(this.s.topology,n,t)},G.prototype.indexInformation=function(e,t,n){"function"==typeof t&&(n=t,t={});const o=new U(this,e,t=t||{});return V(this.s.topology,o,n)},G.prototype.unref=function(){this.s.topology.unref()},G.prototype.watch=function(e,t){return e=e||[],t=t||{},Array.isArray(e)||(t=e,e=[]),new v(this,e,t)},G.prototype.getLogger=function(){return this.s.logger},G.SYSTEM_NAMESPACE_COLLECTION=w.SYSTEM_NAMESPACE_COLLECTION,G.SYSTEM_INDEX_COLLECTION=w.SYSTEM_INDEX_COLLECTION,G.SYSTEM_PROFILE_COLLECTION=w.SYSTEM_PROFILE_COLLECTION,G.SYSTEM_USER_COLLECTION=w.SYSTEM_USER_COLLECTION,G.SYSTEM_COMMAND_COLLECTION=w.SYSTEM_COMMAND_COLLECTION,G.SYSTEM_JS_COLLECTION=w.SYSTEM_JS_COLLECTION,e.exports=G},function(e,t){function n(e){if(!(this instanceof n))return new n(e);this._bsontype="Double",this.value=e}n.prototype.valueOf=function(){return this.value},n.prototype.toJSON=function(){return this.value},e.exports=n,e.exports.Double=n},function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);this._bsontype="Timestamp",this.low_=0|e,this.high_=0|t}n.prototype.toInt=function(){return this.low_},n.prototype.toNumber=function(){return this.high_*n.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},n.prototype.toJSON=function(){return this.toString()},n.prototype.toString=function(e){var t=e||10;if(t<2||36<t)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(n.MIN_VALUE)){var o=n.fromNumber(t),i=this.div(o),r=i.multiply(o).subtract(this);return i.toString(t)+r.toInt().toString(t)}return"-"+this.negate().toString(t)}var s=n.fromNumber(Math.pow(t,6));r=this;for(var a="";!r.isZero();){var c=r.div(s),l=r.subtract(c.multiply(s)).toInt().toString(t);if((r=c).isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},n.prototype.getHighBits=function(){return this.high_},n.prototype.getLowBits=function(){return this.low_},n.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:n.TWO_PWR_32_DBL_+this.low_},n.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(n.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var e=0!==this.high_?this.high_:this.low_,t=31;t>0&&0==(e&1<<t);t--);return 0!==this.high_?t+33:t+1},n.prototype.isZero=function(){return 0===this.high_&&0===this.low_},n.prototype.isNegative=function(){return this.high_<0},n.prototype.isOdd=function(){return 1==(1&this.low_)},n.prototype.equals=function(e){return this.high_===e.high_&&this.low_===e.low_},n.prototype.notEquals=function(e){return this.high_!==e.high_||this.low_!==e.low_},n.prototype.lessThan=function(e){return this.compare(e)<0},n.prototype.lessThanOrEqual=function(e){return this.compare(e)<=0},n.prototype.greaterThan=function(e){return this.compare(e)>0},n.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},n.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.subtract(e).isNegative()?-1:1},n.prototype.negate=function(){return this.equals(n.MIN_VALUE)?n.MIN_VALUE:this.not().add(n.ONE)},n.prototype.add=function(e){var t=this.high_>>>16,o=65535&this.high_,i=this.low_>>>16,r=65535&this.low_,s=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,l=0,p=0,u=0,d=0;return u+=(d+=r+(65535&e.low_))>>>16,d&=65535,p+=(u+=i+c)>>>16,u&=65535,l+=(p+=o+a)>>>16,p&=65535,l+=t+s,l&=65535,n.fromBits(u<<16|d,l<<16|p)},n.prototype.subtract=function(e){return this.add(e.negate())},n.prototype.multiply=function(e){if(this.isZero())return n.ZERO;if(e.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE))return e.isOdd()?n.MIN_VALUE:n.ZERO;if(e.equals(n.MIN_VALUE))return this.isOdd()?n.MIN_VALUE:n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().multiply(e.negate()):this.negate().multiply(e).negate();if(e.isNegative())return this.multiply(e.negate()).negate();if(this.lessThan(n.TWO_PWR_24_)&&e.lessThan(n.TWO_PWR_24_))return n.fromNumber(this.toNumber()*e.toNumber());var t=this.high_>>>16,o=65535&this.high_,i=this.low_>>>16,r=65535&this.low_,s=e.high_>>>16,a=65535&e.high_,c=e.low_>>>16,l=65535&e.low_,p=0,u=0,d=0,h=0;return d+=(h+=r*l)>>>16,h&=65535,u+=(d+=i*l)>>>16,d&=65535,u+=(d+=r*c)>>>16,d&=65535,p+=(u+=o*l)>>>16,u&=65535,p+=(u+=i*c)>>>16,u&=65535,p+=(u+=r*a)>>>16,u&=65535,p+=t*l+o*c+i*a+r*s,p&=65535,n.fromBits(d<<16|h,p<<16|u)},n.prototype.div=function(e){if(e.isZero())throw Error("division by zero");if(this.isZero())return n.ZERO;if(this.equals(n.MIN_VALUE)){if(e.equals(n.ONE)||e.equals(n.NEG_ONE))return n.MIN_VALUE;if(e.equals(n.MIN_VALUE))return n.ONE;var t=this.shiftRight(1).div(e).shiftLeft(1);if(t.equals(n.ZERO))return e.isNegative()?n.ONE:n.NEG_ONE;var o=this.subtract(e.multiply(t));return t.add(o.div(e))}if(e.equals(n.MIN_VALUE))return n.ZERO;if(this.isNegative())return e.isNegative()?this.negate().div(e.negate()):this.negate().div(e).negate();if(e.isNegative())return this.div(e.negate()).negate();var i=n.ZERO;for(o=this;o.greaterThanOrEqual(e);){t=Math.max(1,Math.floor(o.toNumber()/e.toNumber()));for(var r=Math.ceil(Math.log(t)/Math.LN2),s=r<=48?1:Math.pow(2,r-48),a=n.fromNumber(t),c=a.multiply(e);c.isNegative()||c.greaterThan(o);)t-=s,c=(a=n.fromNumber(t)).multiply(e);a.isZero()&&(a=n.ONE),i=i.add(a),o=o.subtract(c)}return i},n.prototype.modulo=function(e){return this.subtract(this.div(e).multiply(e))},n.prototype.not=function(){return n.fromBits(~this.low_,~this.high_)},n.prototype.and=function(e){return n.fromBits(this.low_&e.low_,this.high_&e.high_)},n.prototype.or=function(e){return n.fromBits(this.low_|e.low_,this.high_|e.high_)},n.prototype.xor=function(e){return n.fromBits(this.low_^e.low_,this.high_^e.high_)},n.prototype.shiftLeft=function(e){if(0===(e&=63))return this;var t=this.low_;if(e<32){var o=this.high_;return n.fromBits(t<<e,o<<e|t>>>32-e)}return n.fromBits(0,t<<e-32)},n.prototype.shiftRight=function(e){if(0===(e&=63))return this;var t=this.high_;if(e<32){var o=this.low_;return n.fromBits(o>>>e|t<<32-e,t>>e)}return n.fromBits(t>>e-32,t>=0?0:-1)},n.prototype.shiftRightUnsigned=function(e){if(0===(e&=63))return this;var t=this.high_;if(e<32){var o=this.low_;return n.fromBits(o>>>e|t<<32-e,t>>>e)}return 32===e?n.fromBits(t,0):n.fromBits(t>>>e-32,0)},n.fromInt=function(e){if(-128<=e&&e<128){var t=n.INT_CACHE_[e];if(t)return t}var o=new n(0|e,e<0?-1:0);return-128<=e&&e<128&&(n.INT_CACHE_[e]=o),o},n.fromNumber=function(e){return isNaN(e)||!isFinite(e)?n.ZERO:e<=-n.TWO_PWR_63_DBL_?n.MIN_VALUE:e+1>=n.TWO_PWR_63_DBL_?n.MAX_VALUE:e<0?n.fromNumber(-e).negate():new n(e%n.TWO_PWR_32_DBL_|0,e/n.TWO_PWR_32_DBL_|0)},n.fromBits=function(e,t){return new n(e,t)},n.fromString=function(e,t){if(0===e.length)throw Error("number format error: empty string");var o=t||10;if(o<2||36<o)throw Error("radix out of range: "+o);if("-"===e.charAt(0))return n.fromString(e.substring(1),o).negate();if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+e);for(var i=n.fromNumber(Math.pow(o,8)),r=n.ZERO,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),c=parseInt(e.substring(s,s+a),o);if(a<8){var l=n.fromNumber(Math.pow(o,a));r=r.multiply(l).add(n.fromNumber(c))}else r=(r=r.multiply(i)).add(n.fromNumber(c))}return r},n.INT_CACHE_={},n.TWO_PWR_16_DBL_=65536,n.TWO_PWR_24_DBL_=1<<24,n.TWO_PWR_32_DBL_=n.TWO_PWR_16_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_31_DBL_=n.TWO_PWR_32_DBL_/2,n.TWO_PWR_48_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_16_DBL_,n.TWO_PWR_64_DBL_=n.TWO_PWR_32_DBL_*n.TWO_PWR_32_DBL_,n.TWO_PWR_63_DBL_=n.TWO_PWR_64_DBL_/2,n.ZERO=n.fromInt(0),n.ONE=n.fromInt(1),n.NEG_ONE=n.fromInt(-1),n.MAX_VALUE=n.fromBits(-1,2147483647),n.MIN_VALUE=n.fromBits(0,-2147483648),n.TWO_PWR_24_=n.fromInt(1<<24),e.exports=n,e.exports.Timestamp=n},function(e,t,n){var o="inspect",i=n(25),r=parseInt(16777215*Math.random(),10),s=new RegExp("^[0-9a-fA-F]{24}$");try{if(Buffer&&Buffer.from){var a=!0;o=n(4).inspect.custom||"inspect"}}catch(e){a=!1}for(var c=function e(t){if(t instanceof e)return t;if(!(this instanceof e))return new e(t);if(this._bsontype="ObjectID",null==t||"number"==typeof t)return this.id=this.generate(t),void(e.cacheHexString&&(this.__id=this.toString("hex")));var n=e.isValid(t);if(!n&&null!=t)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(n&&"string"==typeof t&&24===t.length&&a)return new e(i.toBuffer(t,"hex"));if(n&&"string"==typeof t&&24===t.length)return e.createFromHexString(t);if(null==t||12!==t.length){if(null!=t&&t.toHexString)return t;throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}this.id=t,e.cacheHexString&&(this.__id=this.toString("hex"))},l=[],p=0;p<256;p++)l[p]=(p<=15?"0":"")+p.toString(16);c.prototype.toHexString=function(){if(c.cacheHexString&&this.__id)return this.__id;var e="";if(!this.id||!this.id.length)throw new Error("invalid ObjectId, ObjectId.id must be either a string or a Buffer, but is ["+JSON.stringify(this.id)+"]");if(this.id instanceof d)return e=h(this.id),c.cacheHexString&&(this.__id=e),e;for(var t=0;t<this.id.length;t++)e+=l[this.id.charCodeAt(t)];return c.cacheHexString&&(this.__id=e),e},c.prototype.get_inc=function(){return c.index=(c.index+1)%16777215},c.prototype.getInc=function(){return this.get_inc()},c.prototype.generate=function(e){"number"!=typeof e&&(e=~~(Date.now()/1e3));var t=("undefined"==typeof process||1===process.pid?Math.floor(1e5*Math.random()):process.pid)%65535,n=this.get_inc(),o=i.allocBuffer(12);return o[3]=255&e,o[2]=e>>8&255,o[1]=e>>16&255,o[0]=e>>24&255,o[6]=255&r,o[5]=r>>8&255,o[4]=r>>16&255,o[8]=255&t,o[7]=t>>8&255,o[11]=255&n,o[10]=n>>8&255,o[9]=n>>16&255,o},c.prototype.toString=function(e){return this.id&&this.id.copy?this.id.toString("string"==typeof e?e:"hex"):this.toHexString()},c.prototype[o]=c.prototype.toString,c.prototype.toJSON=function(){return this.toHexString()},c.prototype.equals=function(e){return e instanceof c?this.toString()===e.toString():"string"==typeof e&&c.isValid(e)&&12===e.length&&this.id instanceof d?e===this.id.toString("binary"):"string"==typeof e&&c.isValid(e)&&24===e.length?e.toLowerCase()===this.toHexString():"string"==typeof e&&c.isValid(e)&&12===e.length?e===this.id:!(null==e||!(e instanceof c||e.toHexString))&&e.toHexString()===this.toHexString()},c.prototype.getTimestamp=function(){var e=new Date,t=this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24;return e.setTime(1e3*Math.floor(t)),e},c.index=~~(16777215*Math.random()),c.createPk=function(){return new c},c.createFromTime=function(e){var t=i.toBuffer([0,0,0,0,0,0,0,0,0,0,0,0]);return t[3]=255&e,t[2]=e>>8&255,t[1]=e>>16&255,t[0]=e>>24&255,new c(t)};var u=[];for(p=0;p<10;)u[48+p]=p++;for(;p<16;)u[55+p]=u[87+p]=p++;var d=Buffer,h=function(e){return e.toString("hex")};c.createFromHexString=function(e){if(void 0===e||null!=e&&24!==e.length)throw new Error("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");if(a)return new c(i.toBuffer(e,"hex"));for(var t=new d(12),n=0,o=0;o<24;)t[n++]=u[e.charCodeAt(o++)]<<4|u[e.charCodeAt(o++)];return new c(t)},c.isValid=function(e){return null!=e&&("number"==typeof e||("string"==typeof e?12===e.length||24===e.length&&s.test(e):e instanceof c||(e instanceof d||!!e.toHexString&&(12===e.id.length||24===e.id.length&&s.test(e.id)))))},Object.defineProperty(c.prototype,"generationTime",{enumerable:!0,get:function(){return this.id[3]|this.id[2]<<8|this.id[1]<<16|this.id[0]<<24},set:function(e){this.id[3]=255&e,this.id[2]=e>>8&255,this.id[1]=e>>16&255,this.id[0]=e>>24&255}}),e.exports=c,e.exports.ObjectID=c,e.exports.ObjectId=c},function(e,t){function n(e,t){if(!(this instanceof n))return new n;this._bsontype="BSONRegExp",this.pattern=e||"",this.options=t||"";for(var o=0;o<this.options.length;o++)if("i"!==this.options[o]&&"m"!==this.options[o]&&"x"!==this.options[o]&&"l"!==this.options[o]&&"s"!==this.options[o]&&"u"!==this.options[o])throw new Error("the regular expression options ["+this.options[o]+"] is not supported")}e.exports=n,e.exports.BSONRegExp=n},function(e,t,n){var o=Buffer&&n(4).inspect.custom||"inspect";function i(e){if(!(this instanceof i))return new i(e);this._bsontype="Symbol",this.value=e}i.prototype.valueOf=function(){return this.value},i.prototype.toString=function(){return this.value},i.prototype[o]=function(){return this.value},i.prototype.toJSON=function(){return this.value},e.exports=i,e.exports.Symbol=i},function(e,t){var n=function e(t,n){if(!(this instanceof e))return new e(t,n);this._bsontype="Code",this.code=t,this.scope=n};n.prototype.toJSON=function(){return{scope:this.scope,code:this.code}},e.exports=n,e.exports.Code=n},function(e,t,n){"use strict";var o=n(28),i=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,r=/^(\+|-)?(Infinity|inf)$/i,s=/^(\+|-)?NaN$/i,a=6176,c=[124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),l=[248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),p=[120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse(),u=/^([-+])?(\d+)?$/,d=n(25),h=function(e){return!isNaN(parseInt(e,10))},m=function(e){var t=o.fromNumber(1e9),n=o.fromNumber(0),i=0;if(!(e.parts[0]||e.parts[1]||e.parts[2]||e.parts[3]))return{quotient:e,rem:n};for(i=0;i<=3;i++)n=(n=n.shiftLeft(32)).add(new o(e.parts[i],0)),e.parts[i]=n.div(t).low_,n=n.modulo(t);return{quotient:e,rem:n}},f=function(e){this._bsontype="Decimal128",this.bytes=e};f.fromString=function(e){var t,n=!1,m=!1,g=!1,y=0,v=0,b=0,x=0,S=0,w=[0],_=0,O=0,T=0,E=0,C=0,k=0,A=[0,0],N=[0,0],I=0;if((e=e.trim()).length>=7e3)throw new Error(e+" not a valid Decimal128 string");var M=e.match(i),B=e.match(r),R=e.match(s);if(!M&&!B&&!R||0===e.length)throw new Error(e+" not a valid Decimal128 string");if(M&&M[4]&&void 0===M[2])throw new Error(e+" not a valid Decimal128 string");if("+"!==e[I]&&"-"!==e[I]||(n="-"===e[I++]),!h(e[I])&&"."!==e[I]){if("i"===e[I]||"I"===e[I])return new f(d.toBuffer(n?l:p));if("N"===e[I])return new f(d.toBuffer(c))}for(;h(e[I])||"."===e[I];)if("."!==e[I])_<34&&("0"!==e[I]||g)&&(g||(S=v),g=!0,w[O++]=parseInt(e[I],10),_+=1),g&&(b+=1),m&&(x+=1),v+=1,I+=1;else{if(m)return new f(d.toBuffer(c));m=!0,I+=1}if(m&&!v)throw new Error(e+" not a valid Decimal128 string");if("e"===e[I]||"E"===e[I]){var P=e.substr(++I).match(u);if(!P||!P[2])return new f(d.toBuffer(c));C=parseInt(P[0],10),I+=P[0].length}if(e[I])return new f(d.toBuffer(c));if(T=0,_){if(E=_-1,y=b,0!==C&&1!==y)for(;"0"===e[S+y-1];)y-=1}else T=0,E=0,w[0]=0,b=1,_=1,y=0;for(C<=x&&x-C>16384?C=-6176:C-=x;C>6111;){if((E+=1)-T>34){var D=w.join("");if(D.match(/^0+$/)){C=6111;break}return new f(d.toBuffer(n?l:p))}C-=1}for(;C<-6176||_<b;){if(0===E){C=-6176,y=0;break}if(_<b?b-=1:E-=1,!(C<6111)){if((D=w.join("")).match(/^0+$/)){C=6111;break}return new f(d.toBuffer(n?l:p))}C+=1}if(E-T+1<y&&"0"!==e[y]){var L=v;m&&-6176===C&&(S+=1,L+=1);var j=parseInt(e[S+E+1],10),z=0;if(j>=5&&(z=1,5===j))for(z=w[E]%2==1,k=S+E+2;k<L;k++)if(parseInt(e[k],10)){z=1;break}if(z)for(var U=E;U>=0&&++w[U]>9;U--)if(w[U]=0,0===U){if(!(C<6111))return new f(d.toBuffer(n?l:p));C+=1,w[U]=1}}if(A=o.fromNumber(0),N=o.fromNumber(0),0===y)A=o.fromNumber(0),N=o.fromNumber(0);else if(E-T<17)for(U=T,N=o.fromNumber(w[U++]),A=new o(0,0);U<=E;U++)N=(N=N.multiply(o.fromNumber(10))).add(o.fromNumber(w[U]));else{for(U=T,A=o.fromNumber(w[U++]);U<=E-17;U++)A=(A=A.multiply(o.fromNumber(10))).add(o.fromNumber(w[U]));for(N=o.fromNumber(w[U++]);U<=E;U++)N=(N=N.multiply(o.fromNumber(10))).add(o.fromNumber(w[U]))}var H,q,F,$,W=function(e,t){if(!e&&!t)return{high:o.fromNumber(0),low:o.fromNumber(0)};var n=e.shiftRightUnsigned(32),i=new o(e.getLowBits(),0),r=t.shiftRightUnsigned(32),s=new o(t.getLowBits(),0),a=n.multiply(r),c=n.multiply(s),l=i.multiply(r),p=i.multiply(s);return a=a.add(c.shiftRightUnsigned(32)),c=new o(c.getLowBits(),0).add(l).add(p.shiftRightUnsigned(32)),{high:a=a.add(c.shiftRightUnsigned(32)),low:p=c.shiftLeft(32).add(new o(p.getLowBits(),0))}}(A,o.fromString("100000000000000000"));W.low=W.low.add(N),H=W.low,q=N,F=H.high_>>>0,$=q.high_>>>0,(F<$||F===$&&H.low_>>>0<q.low_>>>0)&&(W.high=W.high.add(o.fromNumber(1))),t=C+a;var V={low:o.fromNumber(0),high:o.fromNumber(0)};W.high.shiftRightUnsigned(49).and(o.fromNumber(1)).equals(o.fromNumber)?(V.high=V.high.or(o.fromNumber(3).shiftLeft(61)),V.high=V.high.or(o.fromNumber(t).and(o.fromNumber(16383).shiftLeft(47))),V.high=V.high.or(W.high.and(o.fromNumber(0x7fffffffffff)))):(V.high=V.high.or(o.fromNumber(16383&t).shiftLeft(49)),V.high=V.high.or(W.high.and(o.fromNumber(562949953421311)))),V.low=W.low,n&&(V.high=V.high.or(o.fromString("9223372036854775808")));var K=d.allocBuffer(16);return I=0,K[I++]=255&V.low.low_,K[I++]=V.low.low_>>8&255,K[I++]=V.low.low_>>16&255,K[I++]=V.low.low_>>24&255,K[I++]=255&V.low.high_,K[I++]=V.low.high_>>8&255,K[I++]=V.low.high_>>16&255,K[I++]=V.low.high_>>24&255,K[I++]=255&V.high.low_,K[I++]=V.high.low_>>8&255,K[I++]=V.high.low_>>16&255,K[I++]=V.high.low_>>24&255,K[I++]=255&V.high.high_,K[I++]=V.high.high_>>8&255,K[I++]=V.high.high_>>16&255,K[I++]=V.high.high_>>24&255,new f(K)};a=6176,f.prototype.toString=function(){for(var e,t,n,i,r,s,c=0,l=new Array(36),p=0;p<l.length;p++)l[p]=0;var u,d,h,f,g,y=0,v=!1,b={parts:new Array(4)},x=[];y=0;var S=this.bytes;if(i=S[y++]|S[y++]<<8|S[y++]<<16|S[y++]<<24,n=S[y++]|S[y++]<<8|S[y++]<<16|S[y++]<<24,t=S[y++]|S[y++]<<8|S[y++]<<16|S[y++]<<24,e=S[y++]|S[y++]<<8|S[y++]<<16|S[y++]<<24,y=0,{low:new o(i,n),high:new o(t,e)}.high.lessThan(o.ZERO)&&x.push("-"),(r=e>>26&31)>>3==3){if(30===r)return x.join("")+"Infinity";if(31===r)return"NaN";s=e>>15&16383,h=8+(e>>14&1)}else h=e>>14&7,s=e>>17&16383;if(u=s-a,b.parts[0]=(16383&e)+((15&h)<<14),b.parts[1]=t,b.parts[2]=n,b.parts[3]=i,0===b.parts[0]&&0===b.parts[1]&&0===b.parts[2]&&0===b.parts[3])v=!0;else for(g=3;g>=0;g--){var w=0,_=m(b);if(b=_.quotient,w=_.rem.low_)for(f=8;f>=0;f--)l[9*g+f]=w%10,w=Math.floor(w/10)}if(v)c=1,l[y]=0;else for(c=36,p=0;!l[y];)p++,c-=1,y+=1;if((d=c-1+u)>=34||d<=-7||u>0){for(x.push(l[y++]),(c-=1)&&x.push("."),p=0;p<c;p++)x.push(l[y++]);x.push("E"),d>0?x.push("+"+d):x.push(d)}else if(u>=0)for(p=0;p<c;p++)x.push(l[y++]);else{var O=c+u;if(O>0)for(p=0;p<O;p++)x.push(l[y++]);else x.push("0");for(x.push(".");O++<0;)x.push("0");for(p=0;p<c-Math.max(O-1,0);p++)x.push(l[y++])}return x.join("")},f.prototype.toJSON=function(){return{$numberDecimal:this.toString()}},e.exports=f,e.exports.Decimal128=f},function(e,t){function n(){if(!(this instanceof n))return new n;this._bsontype="MinKey"}e.exports=n,e.exports.MinKey=n},function(e,t){function n(){if(!(this instanceof n))return new n;this._bsontype="MaxKey"}e.exports=n,e.exports.MaxKey=n},function(e,t){function n(e,t,o){if(!(this instanceof n))return new n(e,t,o);this._bsontype="DBRef",this.namespace=e,this.oid=t,this.db=o}n.prototype.toJSON=function(){return{$ref:this.namespace,$id:this.oid,$db:null==this.db?"":this.db}},e.exports=n,e.exports.DBRef=n},function(e,t,n){"use strict";var o=n(12).retrieveSnappy(),i=n(114),r={snappy:1,zlib:2};e.exports={compressorIDs:r,uncompressibleCommands:["ismaster","saslStart","saslContinue","getnonce","authenticate","createUser","updateUser","copydbSaslStart","copydbgetnonce","copydb"],compress:function(e,t,n){switch(e.options.agreedCompressor){case"snappy":o.compress(t,n);break;case"zlib":var r={};e.options.zlibCompressionLevel&&(r.level=e.options.zlibCompressionLevel),i.deflate(t,r,n);break;default:throw new Error('Attempt to compress message using unknown compressor "'+e.options.agreedCompressor+'".')}},decompress:function(e,t,n){if(e<0||e>r.length)throw new Error("Server sent message compressed using an unsupported compressor. (Received compressor ID "+e+")");switch(e){case r.snappy:o.uncompress(t,n);break;case r.zlib:i.inflate(t,n);break;default:n(null,t)}}}},function(e,t,n){"use strict";const o=n(7).opcodes,i=n(7).databaseNamespace,r=n(11);let s=0;const a=1,c=2,l=65536;class p{constructor(e,t,n,o){if(null==n)throw new Error("query must be specified for query");this.bson=e,this.ns=t,this.command=n,this.command.$db=i(t),o.readPreference&&o.readPreference.mode!==r.PRIMARY&&(this.command.$readPreference=o.readPreference.toJSON()),this.options=o||{},this.requestId=p.getRequestId(),this.serializeFunctions="boolean"==typeof o.serializeFunctions&&o.serializeFunctions,this.ignoreUndefined="boolean"==typeof o.ignoreUndefined&&o.ignoreUndefined,this.checkKeys="boolean"==typeof o.checkKeys&&o.checkKeys,this.maxBsonSize=o.maxBsonSize||16777216,this.checksumPresent=!1,this.moreToCome=o.moreToCome||!1,this.exhaustAllowed=!1}toBin(){const e=[];let t=0;this.checksumPresent&&(t|=a),this.moreToCome&&(t|=c),this.exhaustAllowed&&(t|=l);const n=new Buffer(20);e.push(n);let i=n.length;const r=this.command;return i+=this.makeDocumentSegment(e,r),n.writeInt32LE(i,0),n.writeInt32LE(this.requestId,4),n.writeInt32LE(0,8),n.writeInt32LE(o.OP_MSG,12),n.writeUInt32LE(t,16),e}makeDocumentSegment(e,t){const n=new Buffer(1);n[0]=0;const o=this.serializeBson(t);return e.push(n),e.push(o),n.length+o.length}serializeBson(e){return this.bson.serialize(e,{checkKeys:this.checkKeys,serializeFunctions:this.serializeFunctions,ignoreUndefined:this.ignoreUndefined})}}p.getRequestId=function(){return s=s+1&2147483647};e.exports={Msg:p,BinMsg:class{constructor(e,t,n,o,i){i=i||{promoteLongs:!0,promoteValues:!0,promoteBuffers:!1},this.parsed=!1,this.raw=t,this.data=o,this.bson=e,this.opts=i,this.length=n.length,this.requestId=n.requestId,this.responseTo=n.responseTo,this.opCode=n.opCode,this.fromCompressed=n.fromCompressed,this.responseFlags=o.readInt32LE(0),this.checksumPresent=0!=(this.responseFlags&a),this.moreToCome=0!=(this.responseFlags&c),this.exhaustAllowed=0!=(this.responseFlags&l),this.promoteLongs="boolean"!=typeof i.promoteLongs||i.promoteLongs,this.promoteValues="boolean"!=typeof i.promoteValues||i.promoteValues,this.promoteBuffers="boolean"==typeof i.promoteBuffers&&i.promoteBuffers,this.documents=[]}isParsed(){return this.parsed}parse(e){if(this.parsed)return;e=e||{},this.index=4;const t=e.raw||!1,n=e.documentsReturnedIn||null,o={promoteLongs:"boolean"==typeof e.promoteLongs?e.promoteLongs:this.opts.promoteLongs,promoteValues:"boolean"==typeof e.promoteValues?e.promoteValues:this.opts.promoteValues,promoteBuffers:"boolean"==typeof e.promoteBuffers?e.promoteBuffers:this.opts.promoteBuffers};for(;this.index<this.data.length;){const e=this.data.readUInt8(this.index++);if(1===e)console.error("TYPE 1");else if(0===e){const e=this.data.readUInt32LE(this.index),n=this.data.slice(this.index,this.index+e);this.documents.push(t?n:this.bson.deserialize(n,o)),this.index+=e}}if(1===this.documents.length&&null!=n&&t){const e={};e[n]=!0,o.fieldsAsRaw=e;const t=this.bson.deserialize(this.documents[0],o);this.documents=[t]}this.parsed=!0}}}},function(e,t,n){"use strict";const o=n(16),i=n(17).Buffer,r=n(12).retrieveBSON,s=n(3).MongoError,a=n(29).AuthProvider,c=r().Binary;let l;try{l=n(137)}catch(e){}var p=function(e){for(var t={},n=e.split(","),o=0;o<n.length;o++){var i=n[o].split("=");t[i[0]]=i[1]}return t},u=function(e,t){if("string"!=typeof e)throw new s("username must be a string");if("string"!=typeof t)throw new s("password must be a string");if(0===t.length)throw new s("password cannot be empty");var n=o.createHash("md5");return n.update(e+":mongo:"+t,"utf8"),n.digest("hex")};function d(e,t,n){return o.createHmac(e,t).update(n).digest()}var h={},m=0,f=function(){h={},m=0};const g={sha256:32,sha1:20};class y extends a{constructor(e,t){super(e),this.cryptoMethod=t||"sha1"}static _getError(e,t){return e||(t.$err||t.errmsg?new s(t):void 0)}_executeScram(e,t,n,r,a){let v=n.username;const b=n.password,x=n.source,S=this.cryptoMethod;let w,_="SCRAM-SHA-1";if("sha256"===S)_="SCRAM-SHA-256",w=l?l(b):b;else try{w=u(v,b)}catch(e){return a(e)}v=v.replace("=","=3D").replace(",","=2C");const O=i.concat([i.from("n=","utf8"),i.from(v,"utf8"),i.from(",r=","utf8"),i.from(r,"utf8")]),T={saslStart:1,mechanism:_,payload:new c(i.concat([i.from("n,,","utf8"),O])),autoAuthorize:1};e(t,`${x}.$cmd`,T,(n,r)=>{let l=y._getError(n,r);if(l)return a(l,null);const u=i.isBuffer(r.payload)?new c(r.payload):r.payload,v=p(u.value()),b=parseInt(v.i,10),_=v.s,T=`c=biws,r=${v.r}`,E=function(e,t,n,i){const r=[e,t.toString("base64"),n].join("_");if(void 0!==h[r])return h[r];const s=o.pbkdf2Sync(e,t,n,g[i],i);return m>=200&&f(),h[r]=s,m+=1,s}(w,i.from(_,"base64"),b,S);if(b&&b<4096){const e=new s(`Server returned an invalid iteration count ${b}`);return a(e,!1)}const C=d(S,E,"Client Key"),k=function(e,t){return o.createHash(e).update(t).digest()}(S,C),A=[O,u.value().toString("base64"),T].join(","),N=[T,`p=${function(e,t){i.isBuffer(e)||(e=i.from(e)),i.isBuffer(t)||(t=i.from(t));const n=Math.max(e.length,t.length),o=[];for(let i=0;i<n;i+=1)o.push(e[i]^t[i]);return i.from(o).toString("base64")}(C,d(S,k,A))}`].join(","),I={saslContinue:1,conversationId:r.conversationId,payload:new c(i.from(N))};e(t,`${x}.$cmd`,I,(n,o)=>{if(!o||!1!==o.done)return a(n,o);const r={saslContinue:1,conversationId:o.conversationId,payload:i.alloc(0)};e(t,`${x}.$cmd`,r,a)})})}_authenticateSingleConnection(e,t,n,i){o.randomBytes(24,(o,r)=>o?i(o,null):this._executeScram(e,t,n,r.toString("base64"),i))}auth(e,t,n,o){this._checkSaslprep(),super.auth(e,t,n,o)}_checkSaslprep(){"sha256"===this.cryptoMethod&&(l||console.warn("Warning: no saslprep library specified. Passwords will not be sanitized"))}}e.exports={ScramSHA1:class extends y{constructor(e){super(e,"sha1")}},ScramSHA256:class extends y{constructor(e){super(e,"sha256")}}}},function(e,t,n){"use strict";const o=n(3).MongoError;let i,r;i={NO_TRANSACTION:"NO_TRANSACTION",STARTING_TRANSACTION:"STARTING_TRANSACTION",TRANSACTION_IN_PROGRESS:"TRANSACTION_IN_PROGRESS",TRANSACTION_COMMITTED:"TRANSACTION_COMMITTED",TRANSACTION_COMMITTED_EMPTY:"TRANSACTION_COMMITTED_EMPTY",TRANSACTION_ABORTED:"TRANSACTION_ABORTED"},r={NO_TRANSACTION:["NO_TRANSACTION","STARTING_TRANSACTION"],STARTING_TRANSACTION:["TRANSACTION_IN_PROGRESS","TRANSACTION_COMMITTED","TRANSACTION_COMMITTED_EMPTY","TRANSACTION_ABORTED"],TRANSACTION_IN_PROGRESS:["TRANSACTION_IN_PROGRESS","TRANSACTION_COMMITTED","TRANSACTION_ABORTED"],TRANSACTION_COMMITTED:["TRANSACTION_COMMITTED","TRANSACTION_COMMITTED_EMPTY","STARTING_TRANSACTION","NO_TRANSACTION"],TRANSACTION_ABORTED:["STARTING_TRANSACTION","NO_TRANSACTION"],TRANSACTION_COMMITTED_EMPTY:["TRANSACTION_COMMITTED_EMPTY","NO_TRANSACTION"]};e.exports={TxnState:i,Transaction:class{constructor(e){if(e=e||{},this.state=i.NO_TRANSACTION,this.options={},e.writeConcern||void 0!==e.w){if((e.writeConcern?e.writeConcern.w:e.w)<=0)throw new o("Transactions do not support unacknowledged write concern");this.options.writeConcern=e.writeConcern?e.writeConcern:{w:e.w}}e.readConcern&&(this.options.readConcern=e.readConcern),e.readPreference&&(this.options.readPreference=e.readPreference),e.maxCommitTimeMS&&(this.options.maxTimeMS=e.maxCommitTimeMS),this._pinnedServer=void 0,this._recoveryToken=void 0}get server(){return this._pinnedServer}get recoveryToken(){return this._recoveryToken}get isPinned(){return!!this.server}get isActive(){return-1!==[i.STARTING_TRANSACTION,i.TRANSACTION_IN_PROGRESS].indexOf(this.state)}transition(e){const t=r[this.state];if(t&&-1!==t.indexOf(e))return this.state=e,void(this.state!==i.NO_TRANSACTION&&this.state!==i.STARTING_TRANSACTION||this.unpinServer());throw new o(`Attempted illegal state transition from [${this.state}] to [${e}]`)}pinServer(e){this.isActive&&(this._pinnedServer=e)}unpinServer(){this._pinnedServer=void 0}},isTransactionCommand:function(e){return!(!e.commitTransaction&&!e.abortTransaction)}}},function(e,t,n){"use strict";const o=n(72),i=n(39),r=n(9).EventEmitter,s=n(30),a=n(4).inherits,c=n(2).MongoError,l=n(4).deprecate,p=n(31),u=n(0).MongoDBNamespace,d=n(11),h=n(194),m=n(202);function f(e,t){if(!(this instanceof f))return new f(e,t);r.call(this),this.s={url:e,options:t||{},promiseLibrary:null,dbCache:new Map,sessions:new Set,writeConcern:p.fromOptions(t),namespace:new u("admin")};const n=this.s.options.promiseLibrary||Promise;this.s.promiseLibrary=n}a(f,r),Object.defineProperty(f.prototype,"writeConcern",{enumerable:!0,get:function(){return this.s.writeConcern}}),Object.defineProperty(f.prototype,"readPreference",{enumerable:!0,get:function(){return d.primary}}),f.prototype.connect=function(e){if("string"==typeof e)throw new TypeError("`connect` only accepts a callback");const t=new h(this);return s(this,t,e)},f.prototype.logout=l((function(e,t){"function"==typeof e&&(t=e,e={}),"function"==typeof t&&t(null,!0)}),"Multiple authentication is prohibited on a connected client, please only authenticate once per MongoClient"),f.prototype.close=function(e,t){"function"==typeof e&&(t=e,e=!1);const n=new m(this,e);return s(this,n,t)},f.prototype.db=function(e,t){t=t||{},e||(e=this.s.options.dbName);const n=Object.assign({},this.s.options,t);if(this.s.dbCache.has(e)&&!0!==n.returnNonCachedInstance)return this.s.dbCache.get(e);if(n.promiseLibrary=this.s.promiseLibrary,!this.topology)throw new c("MongoClient must be connected before calling MongoClient.prototype.db");const o=new i(e,this.topology,n);return this.s.dbCache.set(e,o),o},f.prototype.isConnected=function(e){return e=e||{},!!this.topology&&this.topology.isConnected(e)},f.connect=function(e,t,n){const o=Array.prototype.slice.call(arguments,1);n="function"==typeof o[o.length-1]?o.pop():void 0;const i=new f(e,t=(t=o.length?o.shift():null)||{});return i.connect(n)},f.prototype.startSession=function(e){if(e=Object.assign({explicit:!0},e),!this.topology)throw new c("Must connect to a server before calling this method");if(!this.topology.hasSessionSupport())throw new c("Current topology does not support sessions");return this.topology.startSession(e,this.s.options)},f.prototype.withSession=function(e,t){"function"==typeof e&&(t=e,e=void 0);const n=this.startSession(e);let o=(e,t,i)=>{if(o=()=>{throw new ReferenceError("cleanupHandler was called too many times")},i=Object.assign({throw:!0},i),n.endSession(),e){if(i.throw)throw e;return Promise.reject(e)}};try{const e=t(n);return Promise.resolve(e).then(e=>o(null,e)).catch(e=>o(e,null,{throw:!0}))}catch(e){return o(e,null,{throw:!1})}},f.prototype.watch=function(e,t){return e=e||[],t=t||{},Array.isArray(e)||(t=e,e=[]),new o(this,e,t)},f.prototype.getLogger=function(){return this.s.options.logger},e.exports=f},function(e,t,n){"use strict";const o=n(33),i=n(2).MongoError,r=n(5).maxWireVersion,s=n(2).ReadPreference,a=n(1).Aspect,c=n(1).defineAspects,l=1,p=8;class u extends o{constructor(e,t,n){if(super(e,n,{fullResponse:!0}),this.target=e.s.namespace&&e.s.namespace.collection?e.s.namespace.collection:l,this.pipeline=t,this.hasWriteStage=!1,"string"==typeof n.out)this.pipeline=this.pipeline.concat({$out:n.out}),this.hasWriteStage=!0;else if(t.length>0){const e=t[t.length-1];(e.$out||e.$merge)&&(this.hasWriteStage=!0)}if(this.hasWriteStage&&(this.readPreference=s.primary),n.explain&&(this.readConcern||this.writeConcern))throw new i('"explain" cannot be used on an aggregate call with readConcern/writeConcern');if(null!=n.cursor&&"object"!=typeof n.cursor)throw new i("cursor options must be an object")}get canRetryRead(){return!this.hasWriteStage}addToPipeline(e){this.pipeline.push(e)}execute(e,t){const n=this.options,o=r(e),i={aggregate:this.target,pipeline:this.pipeline};this.hasWriteStage&&o<p&&(this.readConcern=null),o>=5&&this.hasWriteStage&&this.writeConcern&&Object.assign(i,{writeConcern:this.writeConcern}),!0===n.bypassDocumentValidation&&(i.bypassDocumentValidation=n.bypassDocumentValidation),"boolean"==typeof n.allowDiskUse&&(i.allowDiskUse=n.allowDiskUse),n.hint&&(i.hint=n.hint),n.explain&&(n.full=!1,i.explain=n.explain),i.cursor=n.cursor||{},n.batchSize&&!this.hasWriteStage&&(i.cursor.batchSize=n.batchSize),super.executeCommand(e,i,t)}}c(u,[a.READ_OPERATION,a.RETRYABLE,a.EXECUTE_WITH_SELECTION]),e.exports=u},function(e,t,n){"use strict";const o=n(1).OperationBase,i=n(0).applyRetryableWrites,r=n(0).applyWriteConcern,s=n(0).decorateWithCollation,a=n(10).executeCommand,c=n(0).formattedOrderClause,l=n(0).handleCallback,p=n(2).ReadPreference;e.exports=class extends o{constructor(e,t,n,o,i){super(i),this.collection=e,this.query=t,this.sort=n,this.doc=o}execute(e){const t=this.collection,n=this.query,o=c(this.sort),u=this.doc;let d=this.options;const h={findAndModify:t.collectionName,query:n};o&&(h.sort=o),h.new=!!d.new,h.remove=!!d.remove,h.upsert=!!d.upsert;const m=d.projection||d.fields;m&&(h.fields=m),d.arrayFilters&&(h.arrayFilters=d.arrayFilters),u&&!d.remove&&(h.update=u),d.maxTimeMS&&(h.maxTimeMS=d.maxTimeMS),d.serializeFunctions=d.serializeFunctions||t.s.serializeFunctions,d.checkKeys=!1,d=i(d,t.s.db),(d=r(d,{db:t.s.db,collection:t},d)).writeConcern&&(h.writeConcern=d.writeConcern),!0===d.bypassDocumentValidation&&(h.bypassDocumentValidation=d.bypassDocumentValidation),d.readPreference=p.primary;try{s(h,t,d)}catch(t){return e(t,null)}a(t.s.db,h,d,(t,n)=>t?l(e,t,null):l(e,null,n))}}},function(e,t,n){"use strict";let o,i,r;e.exports={loadCollection:function(){return o||(o=n(32)),o},loadCursor:function(){return i||(i=n(22)),i},loadDb:function(){return r||(r=n(39)),r}}},function(e,t,n){"use strict";const o=n(2).Server,i=n(22),r=n(26).TopologyBase,s=n(26).Store,a=n(2).MongoError,c=n(0).MAX_JS_INT,l=n(0).translateOptions,p=n(0).filterOptions,u=n(0).mergeOptions;var d=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCRL","sslCert","ciphers","ecdhCurve","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","family","loggerLevel","logger","reconnectTries","reconnectInterval","monitoring","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","compression","promiseLibrary","monitorCommands"];class h extends r{constructor(e,t,n){super();const r=(n=p(n,d)).promiseLibrary;var h={force:!1,bufferMaxEntries:"number"==typeof n.bufferMaxEntries?n.bufferMaxEntries:c},m=n.store||new s(this,h);if(-1!==e.indexOf("/"))null!=t&&"object"==typeof t&&(n=t,t=null);else if(null==t)throw a.create({message:"port must be specified",driver:!0});var f="boolean"!=typeof n.auto_reconnect||n.auto_reconnect;f="boolean"==typeof n.autoReconnect?n.autoReconnect:f;var g=u({},{host:e,port:t,disconnectHandler:m,cursorFactory:i,reconnect:f,emitError:"boolean"!=typeof n.emitError||n.emitError,size:"number"==typeof n.poolSize?n.poolSize:5,monitorCommands:"boolean"==typeof n.monitorCommands&&n.monitorCommands});g=l(g,n);var y=n.socketOptions&&Object.keys(n.socketOptions).length>0?n.socketOptions:n;(g=l(g,y)).clientInfo=this.clientInfo,n.appname&&(g.clientInfo.application={name:n.appname}),this.s={coreTopology:new o(g),sCapabilities:null,clonedOptions:g,reconnect:g.reconnect,emitError:g.emitError,poolSize:g.size,storeOptions:h,store:m,host:e,port:t,options:n,sessionPool:null,sessions:new Set,promiseLibrary:r||Promise}}connect(e,t){var n=this;"function"==typeof e&&(t=e,e={}),null==e&&(e=this.s.clonedOptions),"function"!=typeof t&&(t=null),e=Object.assign({},this.s.clonedOptions,e),n.s.options=e,n.s.storeOptions.bufferMaxEntries="number"==typeof e.bufferMaxEntries?e.bufferMaxEntries:-1;var o=function(){return function(e){["timeout","error","close"].forEach((function(e){n.s.coreTopology.removeListener(e,a[e])})),n.s.coreTopology.removeListener("connect",o);try{t(e)}catch(e){process.nextTick((function(){throw e}))}}},i=function(e){return function(t){"error"!==e&&n.emit(e,t)}},r=function(){n.s.store.flush()},s=function(e){return function(t,o){n.emit(e,t,o)}},a={timeout:o("timeout"),error:o("error"),close:o("close")};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed"].forEach((function(e){n.s.coreTopology.removeAllListeners(e)})),n.s.coreTopology.once("timeout",a.timeout),n.s.coreTopology.once("error",a.error),n.s.coreTopology.once("close",a.close),n.s.coreTopology.once("connect",(function(){["timeout","error","close","destroy"].forEach((function(e){n.s.coreTopology.removeAllListeners(e)})),n.s.coreTopology.on("timeout",i("timeout")),n.s.coreTopology.once("error",i("error")),n.s.coreTopology.on("close",i("close")),n.s.coreTopology.on("destroy",r),n.emit("open",null,n);try{t(null,n)}catch(e){process.nextTick((function(){throw e}))}})),n.s.coreTopology.on("reconnect",(function(){n.emit("reconnect",n),n.s.store.execute()})),n.s.coreTopology.on("reconnectFailed",(function(e){n.emit("reconnectFailed",e),n.s.store.flush(e)})),n.s.coreTopology.on("serverDescriptionChanged",s("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",s("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",s("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",s("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",s("serverOpening")),n.s.coreTopology.on("serverClosed",s("serverClosed")),n.s.coreTopology.on("topologyOpening",s("topologyOpening")),n.s.coreTopology.on("topologyClosed",s("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",s("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",s("commandStarted")),n.s.coreTopology.on("commandSucceeded",s("commandSucceeded")),n.s.coreTopology.on("commandFailed",s("commandFailed")),n.s.coreTopology.on("attemptReconnect",s("attemptReconnect")),n.s.coreTopology.on("monitoring",s("monitoring")),n.s.coreTopology.connect(e)}}Object.defineProperty(h.prototype,"poolSize",{enumerable:!0,get:function(){return this.s.coreTopology.connections().length}}),Object.defineProperty(h.prototype,"autoReconnect",{enumerable:!0,get:function(){return this.s.reconnect}}),Object.defineProperty(h.prototype,"host",{enumerable:!0,get:function(){return this.s.host}}),Object.defineProperty(h.prototype,"port",{enumerable:!0,get:function(){return this.s.port}}),e.exports=h},function(e,t,n){"use strict";class o extends Error{constructor(e){super(e),this.name="MongoCryptError",Error.captureStackTrace(this,this.constructor)}}e.exports={debug:function(e){process.env.MONGODB_CRYPT_DEBUG&&console.log(e)},databaseNamespace:function(e){return e.split(".")[0]},collectionNamespace:function(e){return e.split(".").slice(1).join(".")},MongoCryptError:o,promiseOrCallback:function(e,t){if("function"!=typeof e)return new Promise((e,n)=>{t((function(t,o){return null!=t?n(t):arguments.length>2?e(Array.prototype.slice.call(arguments,1)):void e(o)}))});t((function(t){if(null==t)e.apply(this,arguments);else try{e(t)}catch(e){return process.nextTick(()=>{throw e})}}))}}},function(e,t){e.exports=require("buffer")},function(e,t){e.exports=require("querystring")},function(e,t){e.exports=require("dns")},function(e,t,n){"use strict";const o=n(27),i=n(4),r=n(20),s=n(216),a=n(62),c=n(66),l=(e,t,n)=>{a["resolve"+e](t,(e,t)=>{if(e){switch(e.code){case a.NODATA:case a.NOTFOUND:case a.NOTIMP:return n(null,[])}return n(e)}return n(null,Array.isArray(t)?t:[].concat(t||[]))})},p=e.exports.dnsCache=new Map;function u(e,t){let n=!1,o=[],i=0;e.on("error",e=>{n||(n=!0,t(e))}),e.on("readable",()=>{let t;for(;null!==(t=e.read());)o.push(t),i+=t.length}),e.on("end",()=>{if(n)return;let e;n=!0;try{e=Buffer.concat(o,i)}catch(e){return t(e)}t(null,e)})}e.exports.resolveHostname=(e,t)=>{if(!(e=e||{}).host||c.isIP(e.host)){let n={host:e.host,servername:e.servername||!1};return t(null,n)}let n;if(p.has(e.host)&&(!(n=p.get(e.host)).expires||n.expires>=Date.now()))return t(null,{host:n.value.host,servername:n.value.servername,_cached:!0});l(4,e.host,(o,i)=>{if(o)return n?t(null,n.value):t(o);if(i&&i.length){let n={host:i[0]||e.host,servername:e.servername||e.host};return p.set(e.host,{value:n,expires:Date.now()+3e5}),t(null,n)}l(6,e.host,(o,i)=>{if(o)return n?t(null,n.value):t(o);if(i&&i.length){let n={host:i[0]||e.host,servername:e.servername||e.host};return p.set(e.host,{value:n,expires:Date.now()+3e5}),t(null,n)}try{a.lookup(e.host,{},(o,i)=>{if(o)return n?t(null,n.value):t(o);if(!i&&n)return t(null,n.value);let r={host:i||e.host,servername:e.servername||e.host};return p.set(e.host,{value:r,expires:Date.now()+3e5}),t(null,r)})}catch(o){return n?t(null,n.value):t(o)}})})},e.exports.parseConnectionUrl=e=>{e=e||"";let t={};return[o.parse(e,!0)].forEach(e=>{let n;switch(e.protocol){case"smtp:":t.secure=!1;break;case"smtps:":t.secure=!0;break;case"direct:":t.direct=!0}!isNaN(e.port)&&Number(e.port)&&(t.port=Number(e.port)),e.hostname&&(t.host=e.hostname),e.auth&&(n=e.auth.split(":"),t.auth||(t.auth={}),t.auth.user=n.shift(),t.auth.pass=n.join(":")),Object.keys(e.query||{}).forEach(n=>{let o=t,i=n,r=e.query[n];switch(isNaN(r)||(r=Number(r)),r){case"true":r=!0;break;case"false":r=!1}if(0===n.indexOf("tls."))i=n.substr(4),t.tls||(t.tls={}),o=t.tls;else if(n.indexOf(".")>=0)return;i in o||(o[i]=r)})}),t},e.exports._logFunc=(e,t,n,o,i,...r)=>{let s={};Object.keys(n||{}).forEach(e=>{"level"!==e&&(s[e]=n[e])}),Object.keys(o||{}).forEach(e=>{"level"!==e&&(s[e]=o[e])}),e[t](s,i,...r)},e.exports.getLogger=(t,n)=>{let o={},r=["trace","debug","info","warn","error","fatal"];if(!(t=t||{}).logger)return r.forEach(e=>{o[e]=()=>!1}),o;let s=t.logger;return!0===t.logger&&(s=function(e){let t=0,n=new Map;e.forEach(e=>{e.length>t&&(t=e.length)}),e.forEach(e=>{let o=e.toUpperCase();o.length<t&&(o+=" ".repeat(t-o.length)),n.set(e,o)});let o=(e,t,o,...r)=>{let s="";t&&("server"===t.tnx?s="S: ":"client"===t.tnx&&(s="C: "),t.sid&&(s="["+t.sid+"] "+s),t.cid&&(s="[#"+t.cid+"] "+s)),(o=i.format(o,...r)).split(/\r?\n/).forEach(t=>{console.log("[%s] %s %s",(new Date).toISOString().substr(0,19).replace(/T/," "),n.get(e),s+t)})},r={};return e.forEach(e=>{r[e]=o.bind(null,e)}),r}(r)),r.forEach(t=>{o[t]=(o,i,...r)=>{e.exports._logFunc(s,t,n,o,i,...r)}}),o},e.exports.callbackPromise=(e,t)=>(function(){let n=Array.from(arguments),o=n.shift();o?t(o):e(...n)}),e.exports.resolveContent=(t,n,o)=>{let i;o||(i=new Promise((t,n)=>{o=e.exports.callbackPromise(t,n)}));let a,c=t&&t[n]&&t[n].content||t[n],l=("object"==typeof t[n]&&t[n].encoding||"utf8").toString().toLowerCase().replace(/[-_\s]/g,"");if(!c)return o(null,c);if("object"==typeof c){if("function"==typeof c.pipe)return u(c,(e,i)=>{if(e)return o(e);t[n]=i,o(null,i)});if(/^https?:\/\//i.test(c.path||c.href))return u(a=s(c.path||c.href),o);if(/^data:/i.test(c.path||c.href)){let e=(c.path||c.href).match(/^data:((?:[^;]*;)*(?:[^,]*)),(.*)$/i);return o(null,e?/\bbase64$/i.test(e[1])?Buffer.from(e[2],"base64"):Buffer.from(decodeURIComponent(e[2])):Buffer.from(0))}if(c.path)return u(r.createReadStream(c.path),o)}return"string"!=typeof t[n].content||["utf8","usascii","ascii"].includes(l)||(c=Buffer.from(t[n].content,l)),setImmediate(()=>o(null,c)),i},e.exports.assign=function(){let e=Array.from(arguments),t=e.shift()||{};return e.forEach(e=>{Object.keys(e||{}).forEach(n=>{["tls","auth"].includes(n)&&e[n]&&"object"==typeof e[n]?(t[n]||(t[n]={}),Object.keys(e[n]).forEach(o=>{t[n][o]=e[n][o]})):t[n]=e[n]})}),t},e.exports.encodeXText=e=>{if(!/[^\x21-\x2A\x2C-\x3C\x3E-\x7E]/.test(e))return e;let t=Buffer.from(e),n="";for(let e=0,o=t.length;e<o;e++){let o=t[e];n+=o<33||o>126||43===o||61===o?"+"+(o<16?"0":"")+o.toString(16).toUpperCase():String.fromCharCode(o)}return n}},function(e,t){e.exports=require("http")},,function(e,t){e.exports=require("net")},function(e,t,n){"use strict";if(void 0!==global.Map)e.exports=global.Map,e.exports.Map=global.Map;else{var o=function(e){this._keys=[],this._values={};for(var t=0;t<e.length;t++)if(null!=e[t]){var n=e[t],o=n[0],i=n[1];this._keys.push(o),this._values[o]={v:i,i:this._keys.length-1}}};o.prototype.clear=function(){this._keys=[],this._values={}},o.prototype.delete=function(e){var t=this._values[e];return null!=t&&(delete this._values[e],this._keys.splice(t.i,1),!0)},o.prototype.entries=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?[n,e._values[n].v]:void 0,done:void 0===n}}}},o.prototype.forEach=function(e,t){t=t||this;for(var n=0;n<this._keys.length;n++){var o=this._keys[n];e.call(t,this._values[o].v,o,t)}},o.prototype.get=function(e){return this._values[e]?this._values[e].v:void 0},o.prototype.has=function(e){return null!=this._values[e]},o.prototype.keys=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?n:void 0,done:void 0===n}}}},o.prototype.set=function(e,t){return this._values[e]?(this._values[e].v=t,this):(this._keys.push(e),this._values[e]={v:t,i:this._keys.length-1},this)},o.prototype.values=function(){var e=this,t=0;return{next:function(){var n=e._keys[t++];return{value:void 0!==n?e._values[n].v:void 0,done:void 0===n}}}},Object.defineProperty(o.prototype,"size",{enumerable:!0,get:function(){return this._keys.length}}),e.exports=o,e.exports.Map=o}},function(e,t){var n=function(e){if(!(this instanceof n))return new n(e);this._bsontype="Int32",this.value=e};n.prototype.valueOf=function(){return this.value},n.prototype.toJSON=function(){return this.value},e.exports=n,e.exports.Int32=n},function(e,t,n){(function(e){var t=n(23),o=n(20),i=n(4).format,r=n(130),s=n(132),a=o.existsSync||t.existsSync,c=function(e){for(var n=!1;!n;)if(a(e+"/package.json"))n=e;else{if("/"===e)return!1;e=t.dirname(e)}return e},l=function(t,a){(a=a||{}).strict="boolean"!=typeof a.strict||a.strict;var l=function(t){for(var n=e,r=!1;n;){s=n.filename;var s=c(s);if(s){var a=JSON.parse(o.readFileSync(i("%s/package.json",s))),l=t.split(/\//);if(a.peerOptionalDependencies&&(!a.peerOptionalDependencies||a.peerOptionalDependencies[l[0]])){r=!0;break}n=n.parent}else n=n.parent}if(!r)throw new Error(i("no optional dependency [%s] defined in peerOptionalDependencies in any package.json",l[0]));return{object:a,parts:l}}(t),p=l.object,u=l.parts,d=p.peerOptionalDependencies[u[0]],h=void 0,m=t;try{h=n(70)(m)}catch(e){try{if(null==(m=r(process.cwd(),t)))return;h=n(70)(m)}catch(e){if("MODULE_NOT_FOUND"===e.code)return}}var f=c(n(70).resolve(m));if(!f)throw new Error("package.json can not be located");var g=JSON.parse(o.readFileSync(i("%s/package.json",f))).version;if(0==s.satisfies(g,d)&&a.strict){var y=new Error(i("optional dependency [%s] found but version [%s] did not satisfy constraint [%s]",u[0],g,d));throw y.code="OPTIONAL_MODULE_NOT_FOUND",y}return h};l.exists=function(e){try{return void 0!==l(e)}catch(e){return!1}},e.exports=l}).call(this,n(117)(e))},function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=70},function(e,t,n){"use strict";var o=n(4).inherits,i=n(4).format,r=n(9).EventEmitter,s=n(11),a=n(18),c=n(12).debugOptions,l=n(12).retrieveBSON,p=n(85),u=n(3).MongoError,d=n(3).MongoNetworkError,h=n(92),m=n(13).CoreCursor,f=n(6),g=n(6).createClientInfo,y=n(6).createCompressionInfo,v=n(6).resolveClusterTime,b=n(6).SessionMixins,x=n(5).relayEvents;const S=n(5).collationNotSupported;var w=["reconnect","reconnectTries","reconnectInterval","emitError","cursorFactory","host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","checkServerIdentity","socketTimeout","ssl","ca","crl","cert","key","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","servername"],_=0,O=!1,T={},E=l(),C=function(e){e=e||{},r.call(this),this.id=_++,this.s={options:e,logger:a("Server",e),Cursor:e.cursorFactory||m,bson:e.bson||new E([E.Binary,E.Code,E.DBRef,E.Decimal128,E.Double,E.Int32,E.Long,E.Map,E.MaxKey,E.MinKey,E.ObjectId,E.BSONRegExp,E.Symbol,E.Timestamp]),pool:null,disconnectHandler:e.disconnectHandler,monitoring:"boolean"!=typeof e.monitoring||e.monitoring,inTopology:!!e.parent,monitoringInterval:"number"==typeof e.monitoringInterval?e.monitoringInterval:5e3,topologyId:-1,compression:{compressors:y(e)},parent:e.parent},this.s.parent||(this.s.clusterTime=null),this.ismaster=null,this.lastIsMasterMS=-1,this.monitoringProcessId=null,this.initialConnect=!0,this._type="server",this.clientInfo=g(e),this.lastUpdateTime=0,this.lastWriteDate=0,this.staleness=0};function k(e,t,n,o,r,s){return e.s.pool.isConnected()||!e.s.options.reconnect||null==e.s.disconnectHandler||r.monitoring?e.s.pool.isConnected()?void 0:(s(new u(i("no connection available to server %s",e.name))),!0):(e.s.disconnectHandler.add(t,n,o,r,s),!0)}o(C,r),Object.assign(C.prototype,b),Object.defineProperty(C.prototype,"type",{enumerable:!0,get:function(){return this._type}}),Object.defineProperty(C.prototype,"parserType",{enumerable:!0,get:function(){return E.native?"c++":"js"}}),Object.defineProperty(C.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.ismaster&&this.ismaster.logicalSessionTimeoutMinutes||null}}),Object.defineProperty(C.prototype,"clusterTime",{enumerable:!0,set:function(e){const t=this.s.parent?this.s.parent:this.s;v(t,e)},get:function(){return(this.s.parent?this.s.parent:this.s).clusterTime||null}}),C.enableServerAccounting=function(){O=!0,T={}},C.disableServerAccounting=function(){O=!1},C.servers=function(){return T},Object.defineProperty(C.prototype,"name",{enumerable:!0,get:function(){return this.s.options.host+":"+this.s.options.port}});var A=function(e,t){return function(n,o){if(e.s.logger.isInfo()){var r=n instanceof u?JSON.stringify(n):{};e.s.logger.info(i("server %s fired event %s out with message %s",e.name,t,r))}if("connect"===t){if(e.initialConnect=!1,e.ismaster=o.ismaster,e.lastIsMasterMS=o.lastIsMasterMS,o.agreedCompressor&&(e.s.pool.options.agreedCompressor=o.agreedCompressor),o.zlibCompressionLevel&&(e.s.pool.options.zlibCompressionLevel=o.zlibCompressionLevel),o.ismaster.$clusterTime){const t=o.ismaster.$clusterTime;e.clusterTime=t}"isdbgrid"===e.ismaster.msg&&(e._type="mongos"),e.s.monitoring&&(e.monitoringProcessId=setTimeout(function e(t){return function(){if(!t.s.pool.isDestroyed()){t.emit("monitoring",t);var n=(new Date).getTime();t.command("admin.$cmd",{ismaster:!0},{socketTimeout:"number"!=typeof t.s.options.connectionTimeout?2e3:t.s.options.connectionTimeout,monitoring:!0},(o,i)=>{t.lastIsMasterMS=(new Date).getTime()-n,t.s.pool.isDestroyed()||(i&&(t.ismaster=i.result),t.monitoringProcessId=setTimeout(e(t),t.s.monitoringInterval))})}}}(e),e.s.monitoringInterval)),f.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:f.getTopologyType(e)}),e.s.inTopology||f.emitTopologyDescriptionChanged(e,{topologyType:"Single",servers:[{address:e.name,arbiters:[],hosts:[],passives:[],type:f.getTopologyType(e)}]}),e.s.logger.isInfo()&&e.s.logger.info(i("server %s connected with ismaster [%s]",e.name,JSON.stringify(e.ismaster))),e.emit("connect",e)}else{if(O&&-1!==["close","timeout","error","parseError","reconnectFailed"].indexOf(t)&&(e.s.inTopology||e.emit("topologyOpening",{topologyId:e.id}),delete T[e.id]),"close"===t&&f.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:"Unknown"}),"reconnectFailed"===t)return e.emit("reconnectFailed",n),void(e.listeners("error").length>0&&e.emit("error",n));if(-1!==["disconnected","connecting"].indexOf(e.s.pool.state)&&e.initialConnect&&-1!==["close","timeout","error","parseError"].indexOf(t))return e.initialConnect=!1,e.emit("error",new d(i("failed to connect to server [%s] on first connect [%s]",e.name,n)));if("reconnect"===t)return f.emitServerDescriptionChanged(e,{address:e.name,arbiters:[],hosts:[],passives:[],type:f.getTopologyType(e)}),e.emit(t,e);e.emit(t,n)}}};function N(e){return e.s.pool?e.s.pool.isDestroyed()?new u("server instance pool was destroyed"):void 0:new u("server instance is not connected")}C.prototype.connect=function(e){if(e=e||{},O&&(T[this.id]=this),this.s.pool&&!this.s.pool.isDisconnected()&&!this.s.pool.isDestroyed())throw new u(i("server instance in invalid state %s",this.s.pool.state));this.s.pool=new p(this,Object.assign(this.s.options,e,{bson:this.s.bson})),this.s.pool.on("close",A(this,"close")),this.s.pool.on("error",A(this,"error")),this.s.pool.on("timeout",A(this,"timeout")),this.s.pool.on("parseError",A(this,"parseError")),this.s.pool.on("connect",A(this,"connect")),this.s.pool.on("reconnect",A(this,"reconnect")),this.s.pool.on("reconnectFailed",A(this,"reconnectFailed")),x(this.s.pool,this,["commandStarted","commandSucceeded","commandFailed"]),this.s.inTopology||this.emit("topologyOpening",{topologyId:this.id}),this.emit("serverOpening",{topologyId:-1!==this.s.topologyId?this.s.topologyId:this.id,address:this.name}),this.s.pool.connect()},C.prototype.auth=function(e,t){"function"==typeof t&&t(null,null)},C.prototype.getDescription=function(){var e=this.ismaster||{},t={type:f.getTopologyType(this),address:this.name};return e.hosts&&(t.hosts=e.hosts),e.arbiters&&(t.arbiters=e.arbiters),e.passives&&(t.passives=e.passives),e.setName&&(t.setName=e.setName),t},C.prototype.lastIsMaster=function(){return this.ismaster},C.prototype.unref=function(){this.s.pool.unref()},C.prototype.isConnected=function(){return!!this.s.pool&&this.s.pool.isConnected()},C.prototype.isDestroyed=function(){return!!this.s.pool&&this.s.pool.isDestroyed()},C.prototype.command=function(e,t,n,o){"function"==typeof n&&(o=n,n=(n={})||{});var r=function(e,t){if(N(e),t.readPreference&&!(t.readPreference instanceof s))throw new Error("readPreference must be an instance of ReadPreference")}(this,n);return r?o(r):(n=Object.assign({},n,{wireProtocolCommand:!1}),this.s.logger.isDebug()&&this.s.logger.debug(i("executing command [%s] against %s",JSON.stringify({ns:e,cmd:t,options:c(w,n)}),this.name)),k(this,"command",e,t,n,o)?void 0:S(this,t)?o(new u(`server ${this.name} does not support collation`)):void h.command(this,e,t,n,o))},C.prototype.query=function(e,t,n,o,i){h.query(this,e,t,n,o,i)},C.prototype.getMore=function(e,t,n,o,i){h.getMore(this,e,t,n,o,i)},C.prototype.killCursors=function(e,t,n){h.killCursors(this,e,t,n)},C.prototype.insert=function(e,t,n,o){"function"==typeof n&&(o=n,n=(n={})||{});var i=N(this);return i?o(i):k(this,"insert",e,t,n,o)?void 0:(t=Array.isArray(t)?t:[t],h.insert(this,e,t,n,o))},C.prototype.update=function(e,t,n,o){"function"==typeof n&&(o=n,n=(n={})||{});var i=N(this);return i?o(i):k(this,"update",e,t,n,o)?void 0:S(this,n)?o(new u(`server ${this.name} does not support collation`)):(t=Array.isArray(t)?t:[t],h.update(this,e,t,n,o))},C.prototype.remove=function(e,t,n,o){"function"==typeof n&&(o=n,n=(n={})||{});var i=N(this);return i?o(i):k(this,"remove",e,t,n,o)?void 0:S(this,n)?o(new u(`server ${this.name} does not support collation`)):(t=Array.isArray(t)?t:[t],h.remove(this,e,t,n,o))},C.prototype.cursor=function(e,t,n){const o=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(o,e,t,n)},C.prototype.equals=function(e){return"string"==typeof e?this.name.toLowerCase()===e.toLowerCase():!!e.name&&this.name.toLowerCase()===e.name.toLowerCase()},C.prototype.connections=function(){return this.s.pool.allConnections()},C.prototype.selectServer=function(e,t,n){"function"==typeof e&&void 0===n&&(n=e,e=void 0,t={}),"function"==typeof t&&(n=t,t=e,e=void 0),n(null,this)};var I=["close","error","timeout","parseError","connect"];C.prototype.destroy=function(e,t){if(this._destroyed)"function"==typeof t&&t(null,null);else{e=e||{};var n=this;if(O&&delete T[this.id],this.monitoringProcessId&&clearTimeout(this.monitoringProcessId),!n.s.pool)return this._destroyed=!0,void("function"==typeof t&&t(null,null));e.emitClose&&n.emit("close",n),e.emitDestroy&&n.emit("destroy",n),I.forEach((function(e){n.s.pool.removeAllListeners(e)})),n.listeners("serverClosed").length>0&&n.emit("serverClosed",{topologyId:-1!==n.s.topologyId?n.s.topologyId:n.id,address:n.name}),n.listeners("topologyClosed").length>0&&!n.s.inTopology&&n.emit("topologyClosed",{topologyId:n.id}),n.s.logger.isDebug()&&n.s.logger.debug(i("destroy called on server %s",n.name)),this.s.pool.destroy(e.force,t),this._destroyed=!0}},e.exports=C},function(e,t,n){"use strict";const o=n(9),i=n(96).isResumableError,r=n(2).MongoError,s=n(22),a=n(5).relayEvents,c=n(5).maxWireVersion,l=n(55),p=["resumeAfter","startAfter","startAtOperationTime","fullDocument"],u=["batchSize","maxAwaitTimeMS","collation","readPreference"].concat(p),d={COLLECTION:Symbol("Collection"),DATABASE:Symbol("Database"),CLUSTER:Symbol("Cluster")};class h extends s{constructor(e,t,n){super(e,t,n),n=n||{},this._resumeToken=null,this.startAtOperationTime=n.startAtOperationTime,n.startAfter?this.resumeToken=n.startAfter:n.resumeAfter&&(this.resumeToken=n.resumeAfter)}set resumeToken(e){this._resumeToken=e,this.emit("resumeTokenChanged",e)}get resumeToken(){return this._resumeToken}get resumeOptions(){const e={};for(const t of u)this.options[t]&&(e[t]=this.options[t]);return(this.resumeToken||this.startAtOperationTime)&&(["resumeAfter","startAfter","startAtOperationTime"].forEach(t=>delete e[t]),this.resumeToken?e.resumeAfter=this.resumeToken:this.startAtOperationTime&&c(this.server)>=7&&(e.startAtOperationTime=this.startAtOperationTime)),e}_initializeCursor(e){super._initializeCursor((t,n)=>{if(t)return void e(t,null);const o=n.documents[0];null==this.startAtOperationTime&&null==this.resumeAfter&&null==this.startAfter&&c(this.server)>=7&&(this.startAtOperationTime=o.operationTime);const i=o.cursor;i.postBatchResumeToken&&(this.cursorState.postBatchResumeToken=i.postBatchResumeToken,0===i.firstBatch.length&&(this.resumeToken=i.postBatchResumeToken)),this.emit("response"),e(t,n)})}_getMore(e){super._getMore((t,n)=>{if(t)return void e(t,null);const o=n.cursor;o.postBatchResumeToken&&(this.cursorState.postBatchResumeToken=o.postBatchResumeToken,0===o.nextBatch.length&&(this.resumeToken=o.postBatchResumeToken)),this.emit("response"),e(t,n)})}}function m(e,t){const n={fullDocument:t.fullDocument||"default"};f(n,t,p),e.type===d.CLUSTER&&(n.allChangesForCluster=!0);const o=[{$changeStream:n}].concat(e.pipeline),i=f({},t,u),r=new h(e.topology,new l(e.parent,o,t),i);if(a(r,e,["resumeTokenChanged","end","close"]),e.listenerCount("change")>0&&r.on("data",(function(t){v({changeStream:e,change:t,eventEmitter:!0})})),r.on("error",(function(t){v({changeStream:e,error:t,eventEmitter:!0})})),e.pipeDestinations){const t=r.stream(e.streamOptions);for(let n in e.pipeDestinations)t.pipe(n)}return r}function f(e,t,n){return n.forEach(n=>{t[n]&&(e[n]=t[n])}),e}const g=3e4;function y(e,t,n){setTimeout(()=>{t&&null==t.start&&(t.start=process.hrtime());const o=t.start||process.hrtime(),i=t.timeout||g,s=t.readPreference;if(e.isConnected({readPreference:s}))return n(null,null);const a=process.hrtime(o);if((1e9*a[0]+a[1])/1e6>i)return n(new r("Timed out waiting for connection"));y(e,t,n)},3e3)}function v(e){const t=e.changeStream,n=e.error,o=e.change,s=e.callback,a=e.eventEmitter||!1;if(t.isClosed()){if(a)return;const e=new r("ChangeStream is closed");return"function"==typeof s?s(e,null):t.promiseLibrary.reject(e)}const c=t.cursor,l=t.topology,p=t.cursor.options;if(n)return i(n)&&!t.attemptingResume?(t.attemptingResume=!0,["data","close","end","error"].forEach(e=>t.cursor.removeAllListeners(e)),t.cursor.close(),a?void y(l,{readPreference:p.readPreference},e=>{if(e)return t.emit("error",e),void t.emit("close");t.cursor=m(t,c.resumeOptions)}):s?void y(l,{readPreference:p.readPreference},e=>{if(e)return s(e,null);t.cursor=m(t,c.resumeOptions),t.next(s)}):new Promise((e,t)=>{y(l,{readPreference:p.readPreference},n=>{if(n)return t(n);e()})}).then(()=>t.cursor=m(t,c.resumeOptions)).then(()=>t.next())):a?t.emit("error",n):"function"==typeof s?s(n,null):t.promiseLibrary.reject(n);if(t.attemptingResume=!1,o&&!o._id){const e=new Error("A change stream document has been received that lacks a resume token (_id).");return a?t.emit("error",e):"function"==typeof s?s(e,null):t.promiseLibrary.reject(e)}return 0===c.bufferedCount()&&c.cursorState.postBatchResumeToken?c.resumeToken=c.cursorState.postBatchResumeToken:c.resumeToken=o._id,t.options.startAtOperationTime=void 0,a?t.emit("change",o):"function"==typeof s?s(n,o):t.promiseLibrary.resolve(o)}e.exports=class extends o{constructor(e,t,o){super();const i=n(32),r=n(39),s=n(54);if(this.pipeline=t||[],this.options=o||{},this.parent=e,this.namespace=e.s.namespace,e instanceof i)this.type=d.COLLECTION,this.topology=e.s.db.serverConfig;else if(e instanceof r)this.type=d.DATABASE,this.topology=e.serverConfig;else{if(!(e instanceof s))throw new TypeError("parent provided to ChangeStream constructor is not an instance of Collection, Db, or MongoClient");this.type=d.CLUSTER,this.topology=e.topology}this.promiseLibrary=e.s.promiseLibrary,!this.options.readPreference&&e.s.readPreference&&(this.options.readPreference=e.s.readPreference),this.cursor=m(this,o),this.on("newListener",e=>{"change"===e&&this.cursor&&0===this.listenerCount("change")&&this.cursor.on("data",e=>v({changeStream:this,change:e,eventEmitter:!0}))}),this.on("removeListener",e=>{"change"===e&&0===this.listenerCount("change")&&this.cursor&&this.cursor.removeAllListeners("data")})}get resumeToken(){return this.cursor.resumeToken}hasNext(e){return this.cursor.hasNext(e)}next(e){var t=this;return this.isClosed()?e?e(new Error("Change Stream is not open."),null):t.promiseLibrary.reject(new Error("Change Stream is not open.")):this.cursor.next().then(n=>v({changeStream:t,change:n,callback:e})).catch(n=>v({changeStream:t,error:n,callback:e}))}isClosed(){return!this.cursor||this.cursor.isClosed()}close(e){if(!this.cursor)return e?e():this.promiseLibrary.resolve();const t=this.cursor;return e?t.close(n=>(["data","close","end","error"].forEach(e=>t.removeAllListeners(e)),delete this.cursor,e(n))):new(this.promiseLibrary||Promise)((e,n)=>{t.close(o=>{if(["data","close","end","error"].forEach(e=>t.removeAllListeners(e)),delete this.cursor,o)return n(o);e()})})}pipe(e,t){return this.pipeDestinations||(this.pipeDestinations=[]),this.pipeDestinations.push(e),this.cursor.pipe(e,t)}unpipe(e){return this.pipeDestinations&&this.pipeDestinations.indexOf(e)>-1&&this.pipeDestinations.splice(this.pipeDestinations.indexOf(e),1),this.cursor.unpipe(e)}stream(e){return this.streamOptions=e,this.cursor.stream(e)}pause(){return this.cursor.pause()}resume(){return this.cursor.resume()}}},function(e,t,n){"use strict";e.exports={SYSTEM_NAMESPACE_COLLECTION:"system.namespaces",SYSTEM_INDEX_COLLECTION:"system.indexes",SYSTEM_PROFILE_COLLECTION:"system.profile",SYSTEM_USER_COLLECTION:"system.users",SYSTEM_COMMAND_COLLECTION:"$cmd",SYSTEM_JS_COLLECTION:"system.js"}},function(e,t,n){"use strict";const o=n(2).MongoError,i=n(22),r=n(13).CursorState,s=n(4).deprecate;class a extends i{constructor(e,t,n){super(e,t,n)}batchSize(e){if(this.s.state===r.CLOSED||this.isDead())throw o.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw o.create({message:"batchSize requires an integer",driver:!0});return this.operation.options.batchSize=e,this.setCursorBatchSize(e),this}geoNear(e){return this.operation.addToPipeline({$geoNear:e}),this}group(e){return this.operation.addToPipeline({$group:e}),this}limit(e){return this.operation.addToPipeline({$limit:e}),this}match(e){return this.operation.addToPipeline({$match:e}),this}maxTimeMS(e){return this.operation.options.maxTimeMS=e,this}out(e){return this.operation.addToPipeline({$out:e}),this}project(e){return this.operation.addToPipeline({$project:e}),this}lookup(e){return this.operation.addToPipeline({$lookup:e}),this}redact(e){return this.operation.addToPipeline({$redact:e}),this}skip(e){return this.operation.addToPipeline({$skip:e}),this}sort(e){return this.operation.addToPipeline({$sort:e}),this}unwind(e){return this.operation.addToPipeline({$unwind:e}),this}getLogger(){return this.logger}}a.prototype.get=a.prototype.toArray,s(a.prototype.geoNear,"The `$geoNear` stage is deprecated in MongoDB 4.0, and removed in version 4.2."),e.exports=a},function(e,t,n){"use strict";const o=n(2).ReadPreference,i=n(2).MongoError,r=n(22),s=n(13).CursorState;class a extends r{constructor(e,t,n,o){super(e,t,n,o)}setReadPreference(e){if(this.s.state===s.CLOSED||this.isDead())throw i.create({message:"Cursor is closed",driver:!0});if(this.s.state!==s.INIT)throw i.create({message:"cannot change cursor readPreference after cursor has been accessed",driver:!0});if(e instanceof o)this.options.readPreference=e;else{if("string"!=typeof e)throw new TypeError("Invalid read preference: "+e);this.options.readPreference=new o(e)}return this}batchSize(e){if(this.s.state===s.CLOSED||this.isDead())throw i.create({message:"Cursor is closed",driver:!0});if("number"!=typeof e)throw i.create({message:"batchSize requires an integer",driver:!0});return this.cmd.cursor&&(this.cmd.cursor.batchSize=e),this.setCursorBatchSize(e),this}maxTimeMS(e){return this.topology.lastIsMaster().minWireVersion>2&&(this.cmd.maxTimeMS=e),this}getLogger(){return this.logger}}a.prototype.get=a.prototype.toArray,e.exports=a},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(15),r=n(1).defineAspects,s=n(0).handleCallback;class a extends i{constructor(e,t){const n=Object.assign({},t,e.s.options);t.session&&(n.session=t.session),super(e,n)}execute(e){super.execute((t,n)=>t?s(e,t):n.ok?s(e,null,!0):void s(e,null,!1))}}r(a,o.WRITE_OPERATION);e.exports={DropOperation:a,DropCollectionOperation:class extends a{constructor(e,t,n){super(e,n),this.name=t,this.namespace=`${e.namespace}.${t}`}_buildCommand(){return{drop:this.name}}},DropDatabaseOperation:class extends a{_buildCommand(){return{dropDatabase:1}}}}},function(e,t){e.exports=require("tls")},function(e,t){e.exports=require("os")},function(e){e.exports=JSON.parse('{"_args":[[{"raw":"nodemailer","scope":null,"escapedName":"nodemailer","name":"nodemailer","rawSpec":"","spec":"latest","type":"tag"},"C:\\\\Users\\\\USUARIO\\\\Desktop\\\\Chubascos-API"]],"_from":"nodemailer@latest","_hasShrinkwrap":false,"_id":"nodemailer@6.3.0","_inCache":true,"_location":"/nodemailer","_nodeVersion":"12.2.0","_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/nodemailer_6.3.0_1563103388420_0.6212164306590284"},"_npmUser":{"name":"andris","email":"andris@kreata.ee"},"_npmVersion":"6.9.0","_phantomChildren":{},"_requested":{"raw":"nodemailer","scope":null,"escapedName":"nodemailer","name":"nodemailer","rawSpec":"","spec":"latest","type":"tag"},"_requiredBy":["#USER","/"],"_resolved":"https://registry.npmjs.org/nodemailer/-/nodemailer-6.3.0.tgz","_shasum":"a89b0c62d3937bdcdeecbf55687bd7911b627e12","_shrinkwrap":null,"_spec":"nodemailer","_where":"C:\\\\Users\\\\USUARIO\\\\Desktop\\\\Chubascos-API","author":{"name":"Andris Reinman"},"bugs":{"url":"https://github.com/nodemailer/nodemailer/issues"},"dependencies":{},"description":"Easy as cake e-mail sending from your Node.js applications","devDependencies":{"bunyan":"1.8.12","chai":"4.2.0","eslint-config-nodemailer":"1.2.0","eslint-config-prettier":"6.0.0","grunt":"1.0.4","grunt-cli":"1.3.2","grunt-eslint":"22.0.0","grunt-mocha-test":"0.13.3","libbase64":"1.0.3","libmime":"4.1.3","libqp":"1.1.0","mocha":"6.1.4","nodemailer-ntlm-auth":"1.0.1","proxy":"0.2.4","proxy-test-server":"1.0.0","sinon":"7.3.2","smtp-server":"3.5.0"},"directories":{},"dist":{"integrity":"sha512-TEHBNBPHv7Ie/0o3HXnb7xrPSSQmH1dXwQKRaMKDBGt/ZN54lvDVujP6hKkO/vjkIYL9rK8kHSG11+G42Nhxuw==","shasum":"a89b0c62d3937bdcdeecbf55687bd7911b627e12","tarball":"https://registry.npmjs.org/nodemailer/-/nodemailer-6.3.0.tgz","fileCount":41,"unpackedSize":478343,"npm-signature":"-----BEGIN PGP SIGNATURE-----\\r\\nVersion: OpenPGP.js v3.0.4\\r\\nComment: https://openpgpjs.org\\r\\n\\r\\nwsFcBAEBCAAQBQJdKxCdCRA9TVsSAnZWagAA+igP/3C373laFB0PfUZ0glSC\\neIvfGWcFPGRTXDkhcmnM3PWjrGmOMJ0fOH2zNpSZWQqhSibSiv1CZ2m55u+O\\np1XfT3yI17LJ4zhQIk3VuFlGTSPaKRf63G5jT4rqH77PMGe7bR7KY41+vsg+\\nA34Hznrf+hcQCrqqr9eQ0pO27ymkq2yVUSKxtR/OwF7taLb1eFRqE7e7VCWi\\nmJ+4HooO4/S77Keh2vZfiDWeOHnGuWAbzIp0A/a0Agq31E6ukt+7IUKXefPr\\nBL20ldwNVJCHXyL9Au+crXqIBGmfpFh2dS1rXViTzHpiLf7Kbqv7saVJm52Q\\n2XwSTY4Zxqf3RTJ5V8MCQYCfK0wIR1cJ5y0KPMFgdYi6XskVyRYn1EvTtzLF\\nz1IsYTYKFBJlkGzd7UVKLdxS/f+HxODqegmY7p0Y13fKqfDrXthqyg2WR7g3\\nlrgi2Ma4xRcvZ7Ka9Sc5vaehpO/MNZzRZCunMxkHgp44mKucYCpKZKg6h8Dh\\nfMJEPm3GY9KagXLpVT41LISzklZADihXy5USifIPCThKoo+Dh6mBiBprNAUw\\nL9OKO/fKEkecSn3uR4y1HqQn7y3T2ndfA295pwLsh7nImekHUGBVGpEumro2\\no2AApN0c2Wf5y0qPDevDj9rY3KACo4zLi/0eSHX+WYGPkr4EdPEc07VUxC6G\\nneSf\\r\\n=bQ9+\\r\\n-----END PGP SIGNATURE-----\\r\\n"},"engines":{"node":">=6.0.0"},"gitHead":"3c013532cc37999a017b6d5e942ee7a2e410616d","homepage":"https://nodemailer.com/","keywords":["Nodemailer"],"license":"MIT","main":"lib/nodemailer.js","maintainers":[{"name":"andris","email":"andris@node.ee"}],"name":"nodemailer","optionalDependencies":{},"readme":"ERROR: No README data found!","repository":{"type":"git","url":"git+https://github.com/nodemailer/nodemailer.git"},"scripts":{"test":"grunt"},"version":"6.3.0"}')},,function(e,t,n){"use strict";const o=n(2),i=n(153),r=n(54).connect;r.MongoError=o.MongoError,r.MongoNetworkError=o.MongoNetworkError,r.MongoTimeoutError=o.MongoTimeoutError,r.Admin=n(107),r.MongoClient=n(54),r.Db=n(39),r.Collection=n(32),r.Server=n(58),r.ReplSet=n(109),r.Mongos=n(108),r.ReadPreference=o.ReadPreference,r.GridStore=n(203),r.Chunk=n(113),r.Logger=o.Logger,r.AggregationCursor=n(74),r.CommandCursor=n(75),r.Cursor=n(22),r.GridFSBucket=n(204),r.CoreServer=o.Server,r.CoreConnection=o.Connection,r.Binary=o.BSON.Binary,r.Code=o.BSON.Code,r.Map=o.BSON.Map,r.DBRef=o.BSON.DBRef,r.Double=o.BSON.Double,r.Int32=o.BSON.Int32,r.Long=o.BSON.Long,r.MinKey=o.BSON.MinKey,r.MaxKey=o.BSON.MaxKey,r.ObjectID=o.BSON.ObjectID,r.ObjectId=o.BSON.ObjectID,r.Symbol=o.BSON.Symbol,r.Timestamp=o.BSON.Timestamp,r.BSONRegExp=o.BSON.BSONRegExp,r.Decimal128=o.BSON.Decimal128,r.connect=r,r.instrument=function(e,t){"function"==typeof e&&(t=e,e={});const n=new i;return n.instrument(r.MongoClient,t),n},e.exports=r},function(e,t,n){var o=n(125),i=n(34),r=n(45),s=n(49),a=n(46),c=n(40),l=n(68),p=n(28),u=n(67),d=n(48),h=n(47),m=n(42),f=n(43),g=n(44),y=n(41);o.BSON_INT32_MAX=2147483647,o.BSON_INT32_MIN=-2147483648,o.BSON_INT64_MAX=Math.pow(2,63)-1,o.BSON_INT64_MIN=-Math.pow(2,63),o.JS_INT_MAX=9007199254740992,o.JS_INT_MIN=-9007199254740992,o.Binary=i,o.Code=r,o.DBRef=s,o.Decimal128=a,o.Double=c,o.Int32=l,o.Long=p,o.Map=u,o.MaxKey=d,o.MinKey=h,o.ObjectId=m,o.ObjectID=m,o.BSONRegExp=f,o.Symbol=g,o.Timestamp=y,e.exports=o},function(e,t,n){"use strict";const o=n(9).EventEmitter,i=n(16),r=n(12).debugOptions,s=n(7).parseHeader,a=n(50).decompress,c=n(21).Response,l=n(51).BinMsg,p=n(3).MongoNetworkError,u=n(3).MongoError,d=n(18),h=n(7).opcodes.OP_COMPRESSED,m=n(7).opcodes.OP_MSG,f=n(7).MESSAGE_HEADER_SIZE,g=n(17).Buffer;let y=0;const v=67108864,b=["host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","socketTimeout","ssl","ca","crl","cert","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","checkServerIdentity"];let x=void 0,S=!1,w={};function _(e){delete w[e],x&&x.deleteConnection(e)}function O(e,t){const n=s(t);if(n.opCode!==h){const o=n.opCode===m?l:c;return void e.emit("message",new o(e.bson,t,n,t.slice(f),e.responseOptions),e)}n.fromCompressed=!0;let o=f;n.opCode=t.readInt32LE(o),o+=4,n.length=t.readInt32LE(o);const i=t[o+=4];o++,a(i,t.slice(o),(o,i)=>{if(o)return void e.emit("error",o);if(i.length!==n.length)return void e.emit("error",new u("Decompressing a compressed message from the server failed. The message is corrupt."));const r=n.opCode===m?l:c;e.emit("message",new r(e.bson,t,n,i,e.responseOptions),e)})}e.exports=class extends o{constructor(e,t){if(super(),!(t=t||{}).bson)throw new TypeError("must pass in valid bson parser");this.id=y++,this.options=t,this.logger=d("Connection",t),this.bson=t.bson,this.tag=t.tag,this.maxBsonMessageSize=t.maxBsonMessageSize||v,this.port=t.port||27017,this.host=t.host||"localhost",this.socketTimeout="number"==typeof t.socketTimeout?t.socketTimeout:36e4,this.keepAlive="boolean"!=typeof t.keepAlive||t.keepAlive,this.keepAliveInitialDelay="number"==typeof t.keepAliveInitialDelay?t.keepAliveInitialDelay:3e5,this.connectionTimeout="number"==typeof t.connectionTimeout?t.connectionTimeout:3e4,this.keepAliveInitialDelay>this.socketTimeout&&(this.keepAliveInitialDelay=Math.round(this.socketTimeout/2)),this.logger.isDebug()&&this.logger.debug(`creating connection ${this.id} with options [${JSON.stringify(r(b,t))}]`),this.responseOptions={promoteLongs:"boolean"!=typeof t.promoteLongs||t.promoteLongs,promoteValues:"boolean"!=typeof t.promoteValues||t.promoteValues,promoteBuffers:"boolean"==typeof t.promoteBuffers&&t.promoteBuffers},this.flushing=!1,this.queue=[],this.writeStream=null,this.destroyed=!1;const n=i.createHash("sha1");var o,s,a;n.update(this.address),this.hashedName=n.digest("hex"),this.workItems=[],this.socket=e,this.socket.once("error",(o=this,function(e){S&&_(o.id),o.logger.isDebug()&&o.logger.debug(`connection ${o.id} for [${o.address}] errored out with [${JSON.stringify(e)}]`),o.emit("error",new p(e),o)})),this.socket.once("timeout",function(e){return function(){S&&_(e.id),e.logger.isDebug()&&e.logger.debug(`connection ${e.id} for [${e.address}] timed out`),e.emit("timeout",new p(`connection ${e.id} to ${e.address} timed out`),e)}}(this)),this.socket.once("close",function(e){return function(t){S&&_(e.id),e.logger.isDebug()&&e.logger.debug(`connection ${e.id} with for [${e.address}] closed`),t||e.emit("close",new p(`connection ${e.id} to ${e.address} closed`),e)}}(this)),this.socket.on("data",function(e){return function(t){for(;t.length>0;)if(e.bytesRead>0&&e.sizeOfMessage>0){const n=e.sizeOfMessage-e.bytesRead;if(n>t.length)t.copy(e.buffer,e.bytesRead),e.bytesRead=e.bytesRead+t.length,t=g.alloc(0);else{t.copy(e.buffer,e.bytesRead,0,n),t=t.slice(n);const o=e.buffer;e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,O(e,o)}}else if(null!=e.stubBuffer&&e.stubBuffer.length>0)if(e.stubBuffer.length+t.length>4){const n=g.alloc(e.stubBuffer.length+t.length);e.stubBuffer.copy(n,0),t.copy(n,e.stubBuffer.length),t=n,e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null}else{const n=g.alloc(e.stubBuffer.length+t.length);e.stubBuffer.copy(n,0),t.copy(n,e.stubBuffer.length),t=g.alloc(0)}else if(t.length>4){const n=t[0]|t[1]<<8|t[2]<<16|t[3]<<24;if(n<0||n>e.maxBsonMessageSize){const t={err:"socketHandler",trace:"",bin:e.buffer,parseState:{sizeOfMessage:n,bytesRead:e.bytesRead,stubBuffer:e.stubBuffer}};return void e.emit("parseError",t,e)}if(n>4&&n<e.maxBsonMessageSize&&n>t.length)e.buffer=g.alloc(n),t.copy(e.buffer,0),e.bytesRead=t.length,e.sizeOfMessage=n,e.stubBuffer=null,t=g.alloc(0);else if(n>4&&n<e.maxBsonMessageSize&&n===t.length){const n=t;e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=g.alloc(0),O(e,n)}else if(n<=4||n>e.maxBsonMessageSize){const o={err:"socketHandler",trace:null,bin:t,parseState:{sizeOfMessage:n,bytesRead:0,buffer:null,stubBuffer:null}};e.emit("parseError",o,e),e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=g.alloc(0)}else{const o=t.slice(0,n);e.buffer=null,e.sizeOfMessage=0,e.bytesRead=0,e.stubBuffer=null,t=t.slice(n),O(e,o)}}else e.stubBuffer=g.alloc(t.length),t.copy(e.stubBuffer,0),t=g.alloc(0)}}(this)),S&&(s=this.id,a=this,w[s]=a,x&&x.addConnection(s,a))}setSocketTimeout(e){this.socket&&this.socket.setTimeout(e)}resetSocketTimeout(){this.socket&&this.socket.setTimeout(this.socketTimeout)}static enableConnectionAccounting(e){e&&(x=e),S=!0,w={}}static disableConnectionAccounting(){S=!1,x=void 0}static connections(){return w}get address(){return`${this.host}:${this.port}`}unref(){null!=this.socket?this.socket.unref():this.once("connect",()=>this.socket.unref())}destroy(e,t){if("function"==typeof e&&(t=e,e={}),e=Object.assign({force:!1},e),S&&_(this.id),null!=this.socket)return e.force?(this.socket.destroy(),this.destroyed=!0,void("function"==typeof t&&t(null,null))):void this.socket.end(e=>{this.destroyed=!0,"function"==typeof t&&t(e,null)});this.destroyed=!0}write(e){if(this.logger.isDebug())if(Array.isArray(e))for(let t=0;t<e.length;t++)this.logger.debug(`writing buffer [${e[t].toString("hex")}] to ${this.address}`);else this.logger.debug(`writing buffer [${e.toString("hex")}] to ${this.address}`);if(!1===this.socket.destroyed){if(!Array.isArray(e))return this.socket.write(e,"binary"),!0;for(let t=0;t<e.length;t++)this.socket.write(e[t],"binary");return!0}return!1}toString(){return""+this.id}toJSON(){return{id:this.id,host:this.host,port:this.port}}isConnected(){return!this.destroyed&&(!this.socket.destroyed&&this.socket.writable)}}},function(e,t,n){"use strict";e.exports={MIN_SUPPORTED_SERVER_VERSION:"2.6",MAX_SUPPORTED_SERVER_VERSION:"4.2",MIN_SUPPORTED_WIRE_VERSION:2,MAX_SUPPORTED_WIRE_VERSION:8}},function(e,t,n){"use strict";const o=n(4).inherits,i=n(9).EventEmitter,r=n(3).MongoError,s=n(3).MongoNetworkError,a=n(3).MongoWriteConcernError,c=n(18),l=n(4).format,p=n(51).Msg,u=n(133),d=n(7).MESSAGE_HEADER_SIZE,h=n(7).COMPRESSION_DETAILS_SIZE,m=n(7).opcodes,f=n(50).compress,g=n(50).compressorIDs,y=n(50).uncompressibleCommands,v=n(134),b=n(17).Buffer,x=n(135),S=n(36).updateSessionFromResponse,w=n(5).eachAsync;var _="disconnected",O="connecting",T="connected",E="destroying",C="destroyed";const k=new Set(["error","close","timeout","parseError","connect","message"]);var A=0,N=function(e,t){if(i.call(this),this.topology=e,this.options=Object.assign({host:"localhost",port:27017,size:5,minSize:0,connectionTimeout:3e4,socketTimeout:36e4,keepAlive:!0,keepAliveInitialDelay:3e5,noDelay:!0,ssl:!1,checkServerIdentity:!0,ca:null,crl:null,cert:null,key:null,passPhrase:null,rejectUnauthorized:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,reconnect:!0,reconnectInterval:1e3,reconnectTries:30,domainsEnabled:!1},t),this.id=A++,this.retriesLeft=this.options.reconnectTries,this.reconnectId=null,!t.bson||t.bson&&("function"!=typeof t.bson.serialize||"function"!=typeof t.bson.deserialize))throw new Error("must pass in valid bson parser");this.logger=c("Pool",t),this.state=_,this.availableConnections=[],this.inUseConnections=[],this.connectingConnections=0,this.executing=!1,this.queue=[],this.reconnectConnection=null,this.numberOfConsecutiveTimeouts=0,this.connectionIndex=0;const n=this;var o;this._messageHandler=(o=this,function(e,t){for(var n=null,i=0;i<t.workItems.length;i++)t.workItems[i].requestId===e.responseTo&&(n=t.workItems[i],t.workItems.splice(i,1));function s(e,t,n,o){if(!e.options.domainsEnabled)return process.nextTick((function(){return t(n,o)}));t(n,o)}if(n&&n.monitoring&&P(t,o.inUseConnections,o.availableConnections),o.numberOfConsecutiveTimeouts=0,n&&n.socketTimeout&&t.resetSocketTimeout(),o.logger.isDebug()&&o.logger.debug(l("message [%s] received from %s:%s",e.raw.toString("hex"),o.options.host,o.options.port)),o.executing||process.nextTick((function(){$(o)()})),n&&!n.immediateRelease){try{e.parse(n)}catch(e){return s(o,n.cb,new r(e))}if(e.documents[0]){const t=e.documents[0],i=n.session;i&&S(i,t),t.$clusterTime&&(o.topology.clusterTime=t.$clusterTime)}if(n.command&&e.documents[0]){const t=e.documents[0];if(t.writeConcernError){const e=new a(t.writeConcernError,t);return s(o,n.cb,e)}if(0===t.ok||t.$err||t.errmsg||t.code)return s(o,n.cb,new r(t))}e.hashedName=t.hashedName,s(o,n.cb,null,new u(n.fullResult?e:e.documents[0],t,e))}}),this._connectionCloseHandler=function(e){B(n,"close",e,this)},this._connectionErrorHandler=function(e){B(n,"error",e,this)},this._connectionTimeoutHandler=function(e){B(n,"timeout",e,this)},this._connectionParseErrorHandler=function(e){B(n,"parseError",e,this)}};function I(e){e.inUseConnections=[],e.availableConnections=[],e.connectingConnections=0,e.executing=!1,e.reconnectConnection=null,e.numberOfConsecutiveTimeouts=0,e.connectionIndex=0,e.retriesLeft=e.options.reconnectTries,e.reconnectId=null}function M(e,t){var n={disconnected:[O,E,_],connecting:[O,E,T,_],connected:[T,_,E],destroying:[E,C],destroyed:[C]}[e.state];n&&-1!==n.indexOf(t)?(e.emit("stateChanged",e.state,t),e.state=t):e.logger.error(l("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,n))}function B(e,t,n,o){if(o){if(o._connectionFailHandled)return;for(o._connectionFailHandled=!0,o.destroy(),U(e,o);o.workItems.length>0;){const e=o.workItems.shift();e.cb&&e.cb(n)}}if("timeout"===t&&(e.numberOfConsecutiveTimeouts=e.numberOfConsecutiveTimeouts+1,e.numberOfConsecutiveTimeouts>e.options.reconnectTries))return e.numberOfConsecutiveTimeouts=0,e.destroy(!0),e.emit("close",e);0===e.socketCount()&&(e.state!==C&&e.state!==E&&M(e,_),t="error"===t?"close":t,e.emit(t,n)),!e.reconnectId&&e.options.reconnect&&(e.reconnectId=setTimeout(R(e),e.options.reconnectInterval)),D(e)<e.minSize&&q(e)}function R(e){return function(){e.emit("attemptReconnect",e),e.state!==C&&e.state!==E&&(e.isConnected()?e.reconnectId=null:(e.connectingConnections++,x(e.options,(t,n)=>(e.connectingConnections--,t?(e.logger.isDebug()&&e.logger.debug(`connection attempt failed with error [${JSON.stringify(t)}]`),e.retriesLeft=e.retriesLeft-1,void(e.retriesLeft<=0?(e.destroy(),e.emit("reconnectFailed",new s(l("failed to reconnect after %s attempts with interval %s ms",e.options.reconnectTries,e.options.reconnectInterval)))):e.reconnectId=setTimeout(R(e),e.options.reconnectInterval))):e.state===C||e.state===E?n.destroy():(e.reconnectId=null,H.forEach(e=>n.removeAllListeners(e)),n.on("error",e._connectionErrorHandler),n.on("close",e._connectionCloseHandler),n.on("timeout",e._connectionTimeoutHandler),n.on("parseError",e._connectionParseErrorHandler),n.on("message",e._messageHandler),e.retriesLeft=e.options.reconnectTries,e.availableConnections.push(n),e.reconnectConnection=null,e.emit("reconnect",e),void $(e)())))))}}function P(e,t,n){var o=t.indexOf(e);-1!==o&&(t.splice(o,1),n.push(e))}function D(e){return e.availableConnections.length+e.inUseConnections.length+e.connectingConnections}function L(e,t,n,o){w(t,(e,t)=>{for(const t of k)e.removeAllListeners(t);e.destroy(n,t)},t=>{t?"function"==typeof o&&o(t,null):(I(e),e.queue=[],M(e,C),"function"==typeof o&&o(null,null))})}function j(e,t,n){const o=t.toBin();if(!!!e.options.agreedCompressor||!function(e){const t=e instanceof p?e.command:e.query,n=Object.keys(t)[0];return-1===y.indexOf(n)}(t))return n(null,o);const i=b.concat(o),r=i.slice(d),s=i.readInt32LE(12);f(e,r,(function(o,i){if(o)return n(o,null);const a=b.alloc(d);a.writeInt32LE(d+h+i.length,0),a.writeInt32LE(t.requestId,4),a.writeInt32LE(0,8),a.writeInt32LE(m.OP_COMPRESSED,12);const c=b.alloc(h);return c.writeInt32LE(s,0),c.writeInt32LE(r.length,4),c.writeUInt8(g[e.options.agreedCompressor],8),n(null,[a,c,i])}))}function z(e,t){for(var n=0;n<t.length;n++)if(t[n]===e)return t.splice(n,1),!0}function U(e,t){z(t,e.availableConnections)||z(t,e.inUseConnections)}o(N,i),Object.defineProperty(N.prototype,"size",{enumerable:!0,get:function(){return this.options.size}}),Object.defineProperty(N.prototype,"minSize",{enumerable:!0,get:function(){return this.options.minSize}}),Object.defineProperty(N.prototype,"connectionTimeout",{enumerable:!0,get:function(){return this.options.connectionTimeout}}),Object.defineProperty(N.prototype,"socketTimeout",{enumerable:!0,get:function(){return this.options.socketTimeout}}),N.prototype.socketCount=function(){return this.availableConnections.length+this.inUseConnections.length},N.prototype.allConnections=function(){return this.availableConnections.concat(this.inUseConnections)},N.prototype.get=function(){return this.allConnections()[0]},N.prototype.isConnected=function(){if(this.state===C||this.state===E)return!1;for(var e=this.availableConnections.concat(this.inUseConnections),t=0;t<e.length;t++)if(e[t].isConnected())return!0;return!1},N.prototype.isDestroyed=function(){return this.state===C||this.state===E},N.prototype.isDisconnected=function(){return this.state===_},N.prototype.connect=function(){if(this.state!==_)throw new r("connection in unlawful state "+this.state);const e=this;M(this,O),e.connectingConnections++,x(e.options,(t,n)=>{if(e.connectingConnections--,t)return e.logger.isDebug()&&e.logger.debug(`connection attempt failed with error [${JSON.stringify(t)}]`),void(e.state===O&&e.emit("error",t));if(e.state===C||e.state===E)return e.destroy();if(n.on("error",e._connectionErrorHandler),n.on("close",e._connectionCloseHandler),n.on("timeout",e._connectionTimeoutHandler),n.on("parseError",e._connectionParseErrorHandler),n.on("message",e._messageHandler),e.options.inTopology)return M(e,T),e.availableConnections.push(n),e.emit("connect",e,n);if(e.state===C||e.state===E)return e.destroy();if(t)return e.destroy(),e.emit("error",t);if(M(e,T),e.availableConnections.push(n),e.minSize)for(let t=0;t<e.minSize;t++)q(e);e.emit("connect",e,n)})},N.prototype.auth=function(e,t){"function"==typeof t&&t(null,null)},N.prototype.logout=function(e,t){"function"==typeof t&&t(null,null)},N.prototype.unref=function(){this.availableConnections.concat(this.inUseConnections).forEach((function(e){e.unref()}))},N.prototype.destroy=function(e,t){var n=this;if(this.state!==C&&n.state!==E){if(M(this,E),e){for(var o=n.availableConnections.concat(n.inUseConnections);n.queue.length>0;){var i=n.queue.shift();"function"==typeof i.cb&&i.cb(new r("Pool was force destroyed"))}return L(n,o,{force:!0},t)}this.reconnectId&&clearTimeout(this.reconnectId),this.reconnectConnection&&this.reconnectConnection.destroy(),function e(){if(F(n.queue),0===n.queue.length){for(var o=n.availableConnections.concat(n.inUseConnections),i=0;i<o.length;i++)if(o[i].workItems.length>0)return setTimeout(e,1);L(n,o,{force:!1},t)}else $(n)(),setTimeout(e,1)}()}else"function"==typeof t&&t(null,null)},N.prototype.reset=function(e){const t=this.availableConnections.concat(this.inUseConnections);w(t,(e,t)=>{for(const t of k)e.removeAllListeners(t);e.destroy({force:!0},t)},t=>{t&&"function"==typeof e?e(t,null):(I(this),q(this),"function"==typeof e&&e(null,null))})},N.prototype.write=function(e,t,n){var o=this;if("function"==typeof t&&(n=t),t=t||{},"function"!=typeof n&&!t.noResponse)throw new r("write method must provide a callback");if(this.state!==C&&this.state!==E){if(this.options.domainsEnabled&&process.domain&&"function"==typeof n){var i=n;n=process.domain.bind((function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;t++)e[t]=arguments[t];process.nextTick((function(){i.apply(null,e)}))}))}var s={cb:n,raw:!1,promoteLongs:!0,promoteValues:!0,promoteBuffers:!1,fullResult:!1};s.promoteLongs="boolean"!=typeof t.promoteLongs||t.promoteLongs,s.promoteValues="boolean"!=typeof t.promoteValues||t.promoteValues,s.promoteBuffers="boolean"==typeof t.promoteBuffers&&t.promoteBuffers,s.raw="boolean"==typeof t.raw&&t.raw,s.immediateRelease="boolean"==typeof t.immediateRelease&&t.immediateRelease,s.documentsReturnedIn=t.documentsReturnedIn,s.command="boolean"==typeof t.command&&t.command,s.fullResult="boolean"==typeof t.fullResult&&t.fullResult,s.noResponse="boolean"==typeof t.noResponse&&t.noResponse,s.session=t.session||null,s.socketTimeout=t.socketTimeout,s.monitoring=t.monitoring,t.socketTimeout&&(s.socketTimeout=t.socketTimeout),s.requestId=e.requestId,o.options.monitorCommands&&(this.emit("commandStarted",new v.CommandStartedEvent(this,e)),s.started=process.hrtime(),s.cb=(t,i)=>{t?o.emit("commandFailed",new v.CommandFailedEvent(this,e,t,s.started)):i&&i.result&&(0===i.result.ok||i.result.$err)?o.emit("commandFailed",new v.CommandFailedEvent(this,e,i.result,s.started)):o.emit("commandSucceeded",new v.CommandSucceededEvent(this,e,i,s.started)),"function"==typeof n&&n(t,i)}),j(o,e,(e,n)=>{if(e)throw e;s.buffer=n,t.monitoring?o.queue.unshift(s):o.queue.push(s),o.executing||process.nextTick((function(){$(o)()}))})}else if(n)try{n(new r("pool destroyed"))}catch(e){process.nextTick((function(){throw e}))}};const H=["close","message","error","timeout","parseError","connect"];function q(e){e.state!==C&&e.state!==E&&(e.connectingConnections++,x(e.options,(t,n)=>(e.connectingConnections--,t?(e.logger.isDebug()&&e.logger.debug(`connection attempt failed with error [${JSON.stringify(t)}]`),void(!e.reconnectId&&e.options.reconnect&&(e.reconnectId=setTimeout(R(e),e.options.reconnectInterval)))):e.state===C||e.state===E?(U(e,n),n.destroy()):(n.on("error",e._connectionErrorHandler),n.on("close",e._connectionCloseHandler),n.on("timeout",e._connectionTimeoutHandler),n.on("parseError",e._connectionParseErrorHandler),n.on("message",e._messageHandler),e.state===C||e.state===E?n.destroy():(U(e,n),t?n.destroy():(e.availableConnections.push(n),void $(e)()))))))}function F(e){for(var t=0;t<e.length;t++)if(e[t].monitoring){var n=e[t];e.splice(t,1),n.cb(new r({message:"no connection available for monitoring",driver:!0}))}}function $(e){return function(){if(e.state!==C&&!e.executing)if(e.executing=!0,e.connectingConnections>0)e.executing=!1;else{for(;;){const s=D(e);if(0===e.availableConnections.length){F(e.queue);break}if(0===e.queue.length)break;var t=null;const a=e.availableConnections.filter(e=>0===e.workItems.length);if(!(t=0===a.length?e.availableConnections[e.connectionIndex++%e.availableConnections.length]:a[e.connectionIndex++%a.length]).isConnected()){U(e,t),F(e.queue);break}var n=e.queue.shift();if(n.monitoring){var o=!1;for(let n=0;n<e.availableConnections.length;n++)if(e.availableConnections[n].isConnected()&&0===e.availableConnections[n].workItems.length){o=!0,t=e.availableConnections[n];break}if(!o){e.queue.unshift(n),s<e.options.size&&e.queue.length>0&&q(e),setTimeout((function(){$(e)()}),10);break}}if(s<e.options.size&&t.workItems.length>0){e.queue.unshift(n),q(e);break}var i=n.buffer;n.monitoring&&P(t,e.availableConnections,e.inUseConnections),n.noResponse||t.workItems.push(n),n.immediateRelease||"number"!=typeof n.socketTimeout||t.setSocketTimeout(n.socketTimeout);var r=!0;if(Array.isArray(i))for(let e=0;e<i.length;e++)r=t.write(i[e]);else r=t.write(i);if(n.noResponse&&"function"==typeof n.cb&&n.cb(null,null),!1===r){e.queue.unshift(n),U(e,t),F(e.queue);break}}e.executing=!1}}}N._execute=$,e.exports=N},function(e){e.exports=JSON.parse('{"_args":[[{"raw":"mongodb","scope":null,"escapedName":"mongodb","name":"mongodb","rawSpec":"","spec":"latest","type":"tag"},"C:\\\\Users\\\\USUARIO\\\\Desktop\\\\Chubascos-API"]],"_from":"mongodb@latest","_hasShrinkwrap":false,"_id":"mongodb@3.3.2","_inCache":true,"_location":"/mongodb","_nodeVersion":"8.16.0","_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/mongodb_3.3.2_1567014028825_0.977088727806279"},"_npmUser":{"name":"mbroadst","email":"mbroadst@gmail.com"},"_npmVersion":"6.4.1","_phantomChildren":{},"_requested":{"raw":"mongodb","scope":null,"escapedName":"mongodb","name":"mongodb","rawSpec":"","spec":"latest","type":"tag"},"_requiredBy":["#USER","/"],"_resolved":"https://registry.npmjs.org/mongodb/-/mongodb-3.3.2.tgz","_shasum":"ff086b5f552cf07e24ce098694210f3d42d668b2","_shrinkwrap":null,"_spec":"mongodb","_where":"C:\\\\Users\\\\USUARIO\\\\Desktop\\\\Chubascos-API","bugs":{"url":"https://github.com/mongodb/node-mongodb-native/issues"},"dependencies":{"bson":"^1.1.1","require_optional":"^1.0.1","safe-buffer":"^5.1.2"},"description":"The official MongoDB driver for Node.js","devDependencies":{"bluebird":"3.5.0","chai":"^4.1.1","chai-subset":"^1.6.0","co":"4.6.0","coveralls":"^2.11.6","eslint":"^4.5.0","eslint-plugin-prettier":"^2.2.0","istanbul":"^0.4.5","jsdoc":"3.5.5","lodash.camelcase":"^4.3.0","mocha-sinon":"^2.1.0","mongodb-extjson":"^2.1.1","mongodb-mock-server":"^1.0.1","mongodb-test-runner":"^1.1.18","prettier":"~1.12.0","semver":"^5.5.0","sinon":"^4.3.0","sinon-chai":"^3.2.0","snappy":"^6.1.2","standard-version":"^4.4.0","worker-farm":"^1.5.0","wtfnode":"^0.8.0"},"directories":{},"dist":{"integrity":"sha512-fqJt3iywelk4yKu/lfwQg163Bjpo5zDKhXiohycvon4iQHbrfflSAz9AIlRE6496Pm/dQKQK5bMigdVo2s6gBg==","shasum":"ff086b5f552cf07e24ce098694210f3d42d668b2","tarball":"https://registry.npmjs.org/mongodb/-/mongodb-3.3.2.tgz","fileCount":144,"unpackedSize":1367134,"npm-signature":"-----BEGIN PGP SIGNATURE-----\\r\\nVersion: OpenPGP.js v3.0.4\\r\\nComment: https://openpgpjs.org\\r\\n\\r\\nwsFcBAEBCAAQBQJdZryNCRA9TVsSAnZWagAA9YYP/jOFnO6x3Q3kXVnya42e\\n5Id8snoxmUVpK8+pdcmgY94ujiRRWvLAtMOe2nvfNQNsCtjcMZufZlAYk77i\\nvKIFzmbBW9Zebi5Uv0jI7w+RVXQZNGG46qUdX6SPbvlW9wlYofTr0Pmbdd4R\\nYvNxk94LZAjsplBJBHQ9bF6/KapdU+lyHGTiPy3kl6bs2w3JtkZF2fXSU9ku\\nx//lPonxd6RXXUHFMLU5mnuskUtAlc775R5g/Jlk93dCiqiZcvuqQm3o7bZ/\\nuUjbSLDGaMFe63AxLZ0QC8p4M4vLy669AUhlO7O3mnJl5T4jtm43fZ/wFuqS\\nvAkUJo4xIRumcfg5gVWDyxTHzXFJnb3447qrp7q5gqVabXqDOv6WW5AM8wRd\\niedHuoJKLOfHWmBfyQ4EIwWoU/c08JUT8vRfggiv4dGw4u1d+PcrV5LdJQOM\\nMWAtOzj6QOgPl4YShkvIbfVxPREEdgo31mk+FdDaR9QBkvQ+zFkrRlKlEahT\\nNsPp5oo2PPjFwartcgefHd33DcLG7ael6VTrYdzf8b9IYE2afSkcZeOEVpb2\\nOnQmwevg1a4aRrl6vWRGhPxH/JkF5G8cHdLEm3gpZXtyTd9nD26GyojtaNTW\\nB/VitbsnIA/aiNDqeLRp80Y35eLXm/cSqJpmPXaiojidhdkFNCEXJ3JJZGUW\\nqNQE\\r\\n=dEBO\\r\\n-----END PGP SIGNATURE-----\\r\\n"},"engines":{"node":">=4"},"gitHead":"b542d348ca9ef447b7fd8a33de40aa3734568c7f","homepage":"https://github.com/mongodb/node-mongodb-native","keywords":["mongodb","driver","official"],"license":"Apache-2.0","main":"index.js","maintainers":[{"name":"daprahamian","email":"dan.aprahamian@gmail.com"},{"name":"mbroadst","email":"mbroadst@gmail.com"}],"name":"mongodb","optionalDependencies":{},"peerOptionalDependencies":{"kerberos":"^1.0.0","mongodb-client-encryption":"^1.0.0","mongodb-extjson":"^2.1.2","snappy":"^6.1.1","bson-ext":"^2.0.0"},"readme":"ERROR: No README data found!","repository":{"type":"git","url":"git+ssh://git@github.com/mongodb/node-mongodb-native.git"},"scripts":{"atlas":"node ./test/atlas_connectivity_tests.js","bench":"node test/driverBench/","coverage":"istanbul cover mongodb-test-runner -- -t 60000 test/core test/unit test/functional","format":"prettier --print-width 100 --tab-width 2 --single-quote --write \'test/**/*.js\' \'lib/**/*.js\'","generate-evergreen":"node .evergreen/generate_evergreen_tasks.js","lint":"eslint lib test","release":"standard-version -i HISTORY.md","test":"npm run lint && mongodb-test-runner -t 60000 test/core test/unit test/functional"},"version":"3.3.2"}')},function(e,t,n){"use strict";const o=n(88),i=n(89),r=n(90),s=n(91),a=n(136),c=n(52).ScramSHA1,l=n(52).ScramSHA256;e.exports={defaultAuthProviders:function(e){return{mongocr:new o(e),x509:new i(e),plain:new r(e),gssapi:new s(e),sspi:new a(e),"scram-sha-1":new c(e),"scram-sha-256":new l(e)}}}},function(e,t,n){"use strict";const o=n(16),i=n(29).AuthProvider;e.exports=class extends i{_authenticateSingleConnection(e,t,n,i){const r=n.username,s=n.password,a=n.source;e(t,`${a}.$cmd`,{getnonce:1},(n,c)=>{let l=null,p=null;if(null==n){l=c.nonce;let e=o.createHash("md5");e.update(r+":mongo:"+s,"utf8");const t=e.digest("hex");(e=o.createHash("md5")).update(l+r+t,"utf8"),p=e.digest("hex")}e(t,`${a}.$cmd`,{authenticate:1,user:r,nonce:l,key:p},i)})}}},function(e,t,n){"use strict";const o=n(29).AuthProvider;e.exports=class extends o{_authenticateSingleConnection(e,t,n,o){const i=n.username,r={authenticate:1,mechanism:"MONGODB-X509"};i&&(r.user=i),e(t,"$external.$cmd",r,o)}}},function(e,t,n){"use strict";const o=n(12).retrieveBSON,i=n(29).AuthProvider,r=o().Binary;e.exports=class extends i{_authenticateSingleConnection(e,t,n,o){const i=n.username,s=n.password;e(t,"$external.$cmd",{saslStart:1,mechanism:"PLAIN",payload:new r(`\0${i}\0${s}`),autoAuthorize:1},o)}}},function(e,t,n){"use strict";const o=n(29).AuthProvider,i=n(5).retrieveKerberos;let r;var s=function(e,t,n,o,i,r,s,c,l,p,u){var d=new t(l.host,l.port,s,p);d.init(o,i,(function(t){if(t)return u(t,!1);d.transition("",(function(t,s){if(t)return u(t,!1);a(e,d,s,n,o,i,r,c,l,u)}))}))},a=function(e,t,n,o,i,r,s,a,l,p){a(l,"$external.$cmd",{saslStart:1,mechanism:"GSSAPI",payload:n,autoAuthorize:1},(n,u)=>{if(n)return p(n,!1);t.transition(u.payload,(function(n,d){if(n)return p(n,!1);c(e,t,d,u,o,i,r,s,a,l,p)}))})},c=function(e,t,n,o,i,r,s,a,c,p,u){var d={saslContinue:1,conversationId:o.conversationId,payload:n};c(p,"$external.$cmd",d,(n,o)=>{if(n)return u(n,!1);t.transition(o.payload,(function(n,d){if(n)return u(n,!1);l(e,t,d,o,i,r,s,a,c,p,u)}))})},l=function(e,t,n,o,i,r,s,a,c,l,p){c(l,"$external.$cmd",{saslContinue:1,conversationId:o.conversationId,payload:n},(e,n)=>{if(e)return p(e,!1);t.transition(null,(function(e){if(e)return p(e,null);p(null,n)}))})};e.exports=class extends o{_authenticateSingleConnection(e,t,n,o){const i=n.source,a=n.username,c=n.password,l=n.mechanismProperties,p=l.gssapiservicename||l.gssapiServiceName||"mongodb";s(this,r.processes.MongoAuthProcess,i,a,c,i,p,e,t,l,o)}auth(e,t,n,o){if(null==r)try{r=i()}catch(e){return o(e,null)}super.auth(e,t,n,o)}}},function(e,t,n){"use strict";const o=n(141);e.exports={insert:function(e,t,n,i,r){o(e,"insert","documents",t,n,i,r)},update:function(e,t,n,i,r){o(e,"update","updates",t,n,i,r)},remove:function(e,t,n,i,r){o(e,"delete","deletes",t,n,i,r)},killCursors:n(142),getMore:n(143),query:n(144),command:n(37)}},function(e,t,n){"use strict";t.asyncIterator=function(){const e=this;return{next:function(){return Promise.resolve().then(()=>e.next()).then(t=>t?{value:t,done:!1}:e.close().then(()=>({value:t,done:!0})))}}}},function(e,t,n){"use strict";const o=n(24).ServerDescription,i=n(5).calculateDurationInMs;class r{constructor(e){Object.assign(this,{connectionId:e})}}class s{constructor(e,t,n){Object.assign(this,{duration:e,reply:t,connectionId:n})}}class a{constructor(e,t,n){Object.assign(this,{duration:e,failure:t,connectionId:n})}}e.exports={ServerDescriptionChangedEvent:class{constructor(e,t,n,o){Object.assign(this,{topologyId:e,address:t,previousDescription:n,newDescription:o})}},ServerOpeningEvent:class{constructor(e,t){Object.assign(this,{topologyId:e,address:t})}},ServerClosedEvent:class{constructor(e,t){Object.assign(this,{topologyId:e,address:t})}},TopologyDescriptionChangedEvent:class{constructor(e,t,n){Object.assign(this,{topologyId:e,previousDescription:t,newDescription:n})}},TopologyOpeningEvent:class{constructor(e){Object.assign(this,{topologyId:e})}},TopologyClosedEvent:class{constructor(e){Object.assign(this,{topologyId:e})}},ServerHeartbeatStartedEvent:r,ServerHeartbeatSucceededEvent:s,ServerHeartbeatFailedEvent:a,monitorServer:function e(t,n){const c=(n=n||{}).heartbeatFrequencyMS||1e4;if(!0===n.initial)return void(t.s.monitorId=setTimeout(()=>e(t),c));const l=e=>{let n=process.hrtime();t.emit("serverHeartbeatStarted",new r(t.name)),process.nextTick(()=>t.emit("monitoring",t)),t.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:t.s.options.connectionTimeout||2e3},(o,r)=>{let c=i(n);if(o)return t.emit("serverHeartbeatFailed",new a(c,o,t.name)),e(o,null);const l=r.result;return t.emit("serverHeartbeatSucceded",new s(c,l,t.name)),e(null,l)})},p=n=>{t.s.monitoring=!1,t.emit("descriptionReceived",new o(t.description.address,n)),t.s.monitorId=setTimeout(()=>e(t),c)};t.s.monitoring=!0,l((e,n)=>{e?t.s.pool.reset(()=>{l((e,n)=>{if(e)return t.s.monitoring=!1,void t.emit("descriptionReceived",new o(t.description.address,null,{error:e}));p(n)})}):p(n)})}}},function(e,t,n){"use strict";const o=n(24).ServerType,i=n(35).TopologyType,r=n(11),s=n(3).MongoError,a=1e4,c=90;function l(e,t,n){if(null==e.maxStalenessSeconds||e.maxStalenessSeconds<0)return n;const o=e.maxStalenessSeconds,r=(t.heartbeatFrequencyMS+a)/1e3;if(o<r)throw new s(`maxStalenessSeconds must be at least ${r} seconds`);if(o<c)throw new s(`maxStalenessSeconds must be at least ${c} seconds`);if(t.type===i.ReplicaSetWithPrimary){const o=n.filter(h)[0];return n.reduce((n,i)=>{return(i.lastUpdateTime-i.lastWriteDate-(o.lastUpdateTime-o.lastWriteDate)+t.heartbeatFrequencyMS)/1e3<=e.maxStalenessSeconds&&n.push(i),n},[])}if(t.type===i.ReplicaSetNoPrimary){const o=n.reduce((e,t)=>t.lastWriteDate>e.lastWriteDate?t:e);return n.reduce((n,i)=>{return(o.lastWriteDate-i.lastWriteDate+t.heartbeatFrequencyMS)/1e3<=e.maxStalenessSeconds&&n.push(i),n},[])}return n}function p(e,t){const n=Object.keys(e),o=Object.keys(t);for(let i=0;i<n.length;++i){const r=n[i];if(-1===o.indexOf(r)||t[r]!==e[r])return!1}return!0}function u(e,t){if(null==e.tags||Array.isArray(e.tags)&&0===e.tags.length)return t;for(let n=0;n<e.tags.length;++n){const o=e.tags[n],i=t.reduce((e,t)=>(p(o,t.tags)&&e.push(t),e),[]);if(i.length)return i}return[]}function d(e,t){const n=t.reduce((e,t)=>-1===e?t.roundTripTime:Math.min(t.roundTripTime,e),-1),o=n+e.localThresholdMS;return t.reduce((e,t)=>(t.roundTripTime<=o&&t.roundTripTime>=n&&e.push(t),e),[])}function h(e){return e.type===o.RSPrimary}function m(e){return e.type===o.RSSecondary}function f(e){return e.type===o.RSSecondary||e.type===o.RSPrimary}function g(e){return e.type!==o.Unknown}e.exports={writableServerSelector:function(){return function(e,t){return d(e,t.filter(e=>e.isWritable))}},readPreferenceServerSelector:function(e){if(!e.isValid())throw new TypeError("Invalid read preference specified");return function(t,n){const o=t.commonWireVersion;if(o&&e.minWireVersion&&e.minWireVersion>o)throw new s(`Minimum wire version '${e.minWireVersion}' required, but found '${o}'`);if(t.type===i.Single||t.type===i.Sharded)return d(t,n.filter(g));if(e.mode===r.PRIMARY)return n.filter(h);if(e.mode===r.SECONDARY)return d(t,u(e,l(e,t,n))).filter(m);if(e.mode===r.NEAREST)return d(t,u(e,l(e,t,n))).filter(f);if(e.mode===r.SECONDARY_PREFERRED){const o=d(t,u(e,l(e,t,n))).filter(m);return 0===o.length?n.filter(h):o}if(e.mode===r.PRIMARY_PREFERRED){const o=n.filter(h);return o.length?o:d(t,u(e,l(e,t,n))).filter(m)}}}}},function(e,t,n){"use strict";const o=n(2).MongoNetworkError,i=n(2).mongoErrorContextSymbol,r=new Set([136,237,11601]);e.exports={GET_MORE_NON_RESUMABLE_CODES:r,isResumableError:function(e){return!!function(e){if(e[i])return e[i].isGetMore}(e)&&(e instanceof o||!(r.has(e.code)||e.hasErrorLabel("NonRetryableChangeStreamError")))}}},function(e,t,n){"use strict";const o=n(2).BSON.Long,i=n(2).MongoError,r=n(2).BSON.ObjectID,s=n(2).BSON,a=n(2).MongoWriteConcernError,c=n(0).toError,l=n(0).handleCallback,p=n(0).applyRetryableWrites,u=n(0).applyWriteConcern,d=n(0).executeLegacyOperation,h=n(0).isPromiseLike,m=64,f=1,g=2,y=3,v=new s([s.Binary,s.Code,s.DBRef,s.Decimal128,s.Double,s.Int32,s.Long,s.Map,s.MaxKey,s.MinKey,s.ObjectId,s.BSONRegExp,s.Symbol,s.Timestamp]);class b{constructor(e){this.result=e}get ok(){return this.result.ok}get nInserted(){return this.result.nInserted}get nUpserted(){return this.result.nUpserted}get nMatched(){return this.result.nMatched}get nModified(){return this.result.nModified}get nRemoved(){return this.result.nRemoved}getInsertedIds(){return this.result.insertedIds}getUpsertedIds(){return this.result.upserted}getUpsertedIdAt(e){return this.result.upserted[e]}getRawResponse(){return this.result}hasWriteErrors(){return this.result.writeErrors.length>0}getWriteErrorCount(){return this.result.writeErrors.length}getWriteErrorAt(e){return e<this.result.writeErrors.length?this.result.writeErrors[e]:null}getWriteErrors(){return this.result.writeErrors}getLastOp(){return this.result.lastOp}getWriteConcernError(){if(0===this.result.writeConcernErrors.length)return null;if(1===this.result.writeConcernErrors.length)return this.result.writeConcernErrors[0];{let e="";for(let t=0;t<this.result.writeConcernErrors.length;t++){e+=this.result.writeConcernErrors[t].errmsg,0===t&&(e+=" and ")}return new x({errmsg:e,code:m})}}toJSON(){return this.result}toString(){return`BulkWriteResult(${this.toJSON(this.result)})`}isOk(){return 1===this.result.ok}}class x{constructor(e){this.err=e}get code(){return this.err.code}get errmsg(){return this.err.errmsg}toJSON(){return{code:this.err.code,errmsg:this.err.errmsg}}toString(){return`WriteConcernError(${this.err.errmsg})`}}class S{constructor(e){this.err=e}get code(){return this.err.code}get index(){return this.err.index}get errmsg(){return this.err.errmsg}getOperation(){return this.err.op}toJSON(){return{code:this.err.code,index:this.err.index,errmsg:this.err.errmsg,op:this.err.op}}toString(){return`WriteError(${JSON.stringify(this.toJSON())})`}}function w(e,t,n,i){if(n)i=n;else if(i&&i.result)i=i.result;else if(null==i)return;if(0===i.ok&&1===t.ok){t.ok=0;const n={index:0,code:i.code||0,errmsg:i.message,op:e.operations[0]};return void t.writeErrors.push(new S(n))}if(0===i.ok&&0===t.ok)return;if(i.opTime||i.lastOp){const e=i.lastOp||i.opTime;let n=null,r=null;if(e&&"Timestamp"===e._bsontype)null==t.lastOp?t.lastOp=e:e.greaterThan(t.lastOp)&&(t.lastOp=e);else{t.lastOp&&(n="number"==typeof t.lastOp.ts?o.fromNumber(t.lastOp.ts):t.lastOp.ts,r="number"==typeof t.lastOp.t?o.fromNumber(t.lastOp.t):t.lastOp.t);const i="number"==typeof e.ts?o.fromNumber(e.ts):e.ts,s="number"==typeof e.t?o.fromNumber(e.t):e.t;null==t.lastOp?t.lastOp=e:i.greaterThan(n)?t.lastOp=e:i.equals(n)&&s.greaterThan(r)&&(t.lastOp=e)}}e.batchType===f&&i.n&&(t.nInserted=t.nInserted+i.n),e.batchType===y&&i.n&&(t.nRemoved=t.nRemoved+i.n);let r=0;if(Array.isArray(i.upserted)){r=i.upserted.length;for(let n=0;n<i.upserted.length;n++)t.upserted.push({index:i.upserted[n].index+e.originalZeroIndex,_id:i.upserted[n]._id})}else i.upserted&&(r=1,t.upserted.push({index:e.originalZeroIndex,_id:i.upserted}));if(e.batchType===g&&i.n){const e=i.nModified;t.nUpserted=t.nUpserted+r,t.nMatched=t.nMatched+(i.n-r),t.nModified="number"==typeof e?t.nModified+e:null}if(Array.isArray(i.writeErrors))for(let n=0;n<i.writeErrors.length;n++){const o={index:e.originalZeroIndex+i.writeErrors[n].index,code:i.writeErrors[n].code,errmsg:i.writeErrors[n].errmsg,op:e.operations[i.writeErrors[n].index]};t.writeErrors.push(new S(o))}i.writeConcernError&&t.writeConcernErrors.push(new x(i.writeConcernError))}function _(e,t,n){if(0===e.s.batches.length)return l(n,null,new b(e.s.bulkResult));const o=e.s.batches.shift();e.finalOptionsHandler({options:t,batch:o,resultHandler:function(i,r){if((i&&i.driver||i&&i.message)&&!(i instanceof a))return l(n,i);if(i&&(i.ok=0),i instanceof a)return function(e,t,n,o){w(e,t,null,n.result);const i=new x({errmsg:n.result.writeConcernError.errmsg,code:n.result.writeConcernError.result});return l(o,new O(c(i),new b(t)),null)}(o,e.s.bulkResult,i,n);const s=new b(e.s.bulkResult);if(null!=w(o,e.s.bulkResult,i,r))return l(n,null,s);e.handleWriteError(n,s)||_(e,t,n)}},n)}class O extends i{constructor(e,t){super(e.err||e.errmsg||e.errMessage||e),Object.assign(this,e),this.name="BulkWriteError",this.result=t}}class T{constructor(e){this.s=e.s}update(e){const t="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:e,multi:!0,upsert:t};return this.s.currentOp=null,this.s.options.addToOperationsList(this,g,n)}updateOne(e){const t="boolean"==typeof this.s.currentOp.upsert&&this.s.currentOp.upsert,n={q:this.s.currentOp.selector,u:e,multi:!1,upsert:t};return this.s.currentOp=null,this.s.options.addToOperationsList(this,g,n)}replaceOne(e){this.updateOne(e)}upsert(){return this.s.currentOp.upsert=!0,this}deleteOne(){const e={q:this.s.currentOp.selector,limit:1};return this.s.currentOp=null,this.s.options.addToOperationsList(this,y,e)}delete(){const e={q:this.s.currentOp.selector,limit:0};return this.s.currentOp=null,this.s.options.addToOperationsList(this,y,e)}removeOne(){return this.deleteOne()}remove(){return this.delete()}}class E{constructor(e,t,n,o){this.isOrdered=o,n=null==n?{}:n;const i=t.s.namespace,r=e.bson,s=e.lastIsMaster(),a=s&&s.maxBsonObjectSize?s.maxBsonObjectSize:16777216,c=s&&s.maxWriteBatchSize?s.maxWriteBatchSize:1e3,l=(c-1).toString(10).length+2;let d=Object.assign({},n);d=p(d,t.s.db);const h=(d=u(d,{collection:t},n)).writeConcern,m=n.promiseLibrary||Promise;this.s={bulkResult:{ok:1,writeErrors:[],writeConcernErrors:[],insertedIds:[],nInserted:0,nUpserted:0,nMatched:0,nModified:0,nRemoved:0,upserted:[]},currentBatch:null,currentIndex:0,currentBatchSize:0,currentBatchSizeBytes:0,currentInsertBatch:null,currentUpdateBatch:null,currentRemoveBatch:null,batches:[],writeConcern:h,maxBatchSizeBytes:a,maxWriteBatchSize:c,maxKeySize:l,namespace:i,bson:r,topology:e,options:d,currentOp:null,executed:!1,collection:t,promiseLibrary:m,err:null,checkKeys:"boolean"!=typeof n.checkKeys||n.checkKeys},!0===n.bypassDocumentValidation&&(this.s.bypassDocumentValidation=!0)}insert(e){return!0!==this.s.collection.s.db.options.forceServerObjectId&&null==e._id&&(e._id=new r),this.s.options.addToOperationsList(this,f,e)}find(e){if(!e)throw c("Bulk find operation must specify a selector");return this.s.currentOp={selector:e},new T(this)}raw(e){const t=Object.keys(e)[0],n="boolean"==typeof this.s.options.forceServerObjectId?this.s.options.forceServerObjectId:this.s.collection.s.db.options.forceServerObjectId;if(e.updateOne&&e.updateOne.q||e.updateMany&&e.updateMany.q||e.replaceOne&&e.replaceOne.q)return e[t].multi=!e.updateOne&&!e.replaceOne,this.s.options.addToOperationsList(this,g,e[t]);if(e.updateOne||e.updateMany||e.replaceOne){const n=!e.updateOne&&!e.replaceOne,o={q:e[t].filter,u:e[t].update||e[t].replacement,multi:n};return this.isOrdered?(o.upsert=!!e[t].upsert,e.collation&&(o.collation=e.collation)):e[t].upsert&&(o.upsert=!0),e[t].arrayFilters&&(o.arrayFilters=e[t].arrayFilters),this.s.options.addToOperationsList(this,g,o)}if(e.removeOne||e.removeMany||e.deleteOne&&e.deleteOne.q||e.deleteMany&&e.deleteMany.q)return e[t].limit=e.removeOne?1:0,this.s.options.addToOperationsList(this,y,e[t]);if(e.deleteOne||e.deleteMany){const n=e.deleteOne?1:0,o={q:e[t].filter,limit:n};return this.isOrdered&&e.collation&&(o.collation=e.collation),this.s.options.addToOperationsList(this,y,o)}if(e.insertOne&&null==e.insertOne.document)return!0!==n&&null==e.insertOne._id&&(e.insertOne._id=new r),this.s.options.addToOperationsList(this,f,e.insertOne);if(e.insertOne&&e.insertOne.document)return!0!==n&&null==e.insertOne.document._id&&(e.insertOne.document._id=new r),this.s.options.addToOperationsList(this,f,e.insertOne.document);if(!e.insertMany)throw c("bulkWrite only supports insertOne, insertMany, updateOne, updateMany, removeOne, removeMany, deleteOne, deleteMany");for(let t=0;t<e.insertMany.length;t++)!0!==n&&null==e.insertMany[t]._id&&(e.insertMany[t]._id=new r),this.s.options.addToOperationsList(this,f,e.insertMany[t])}_handleEarlyError(e,t){if("function"!=typeof t)return this.s.promiseLibrary.reject(e);t(e,null)}bulkExecute(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},"function"==typeof e?n=e:e&&"object"==typeof e&&(this.s.writeConcern=e),this.s.executed){const e=c("batch cannot be re-executed");return this._handleEarlyError(e,n)}if(this.isOrdered?this.s.currentBatch&&this.s.batches.push(this.s.currentBatch):(this.s.currentInsertBatch&&this.s.batches.push(this.s.currentInsertBatch),this.s.currentUpdateBatch&&this.s.batches.push(this.s.currentUpdateBatch),this.s.currentRemoveBatch&&this.s.batches.push(this.s.currentRemoveBatch)),0===this.s.batches.length){const e=c("Invalid Operation, no operations specified");return this._handleEarlyError(e,n)}return{options:t,callback:n}}execute(e,t,n){const o=this.bulkExecute(e,t,n);return!o||h(o)?o:(t=o.options,n=o.callback,d(this.s.topology,_,[this,t,n]))}finalOptionsHandler(e,t){const n=Object.assign({ordered:this.isOrdered},e.options);null!=this.s.writeConcern&&(n.writeConcern=this.s.writeConcern),!0!==n.bypassDocumentValidation&&delete n.bypassDocumentValidation,this.operationId&&(e.resultHandler.operationId=this.operationId),this.s.options.serializeFunctions&&(n.serializeFunctions=!0),this.s.options.ignoreUndefined&&(n.ignoreUndefined=!0),!0===this.s.bypassDocumentValidation&&(n.bypassDocumentValidation=!0),!1===this.s.checkKeys&&(n.checkKeys=!1),n.retryWrites&&(e.batch.batchType===g&&(n.retryWrites=n.retryWrites&&!e.batch.operations.some(e=>e.multi)),e.batch.batchType===y&&(n.retryWrites=n.retryWrites&&!e.batch.operations.some(e=>0===e.limit)));try{e.batch.batchType===f?this.s.topology.insert(this.s.namespace,e.batch.operations,n,e.resultHandler):e.batch.batchType===g?this.s.topology.update(this.s.namespace,e.batch.operations,n,e.resultHandler):e.batch.batchType===y&&this.s.topology.remove(this.s.namespace,e.batch.operations,n,e.resultHandler)}catch(n){n.ok=0,l(t,null,w(e.batch,this.s.bulkResult,n,null))}}handleWriteError(e,t){if(this.s.bulkResult.writeErrors.length>0){if(1===this.s.bulkResult.writeErrors.length)return l(e,new O(c(this.s.bulkResult.writeErrors[0]),t),null),!0;const n=this.s.bulkResult.writeErrors[0].errmsg?this.s.bulkResult.writeErrors[0].errmsg:"write operation failed";return l(e,new O(c({message:n,code:this.s.bulkResult.writeErrors[0].code,writeErrors:this.s.bulkResult.writeErrors}),t),null),!0}if(t.getWriteConcernError())return l(e,new O(c(t.getWriteConcernError()),t),null),!0}}Object.defineProperty(E.prototype,"length",{enumerable:!0,get:function(){return this.s.currentIndex}}),e.exports={Batch:class{constructor(e,t){this.originalZeroIndex=t,this.currentIndex=0,this.originalIndexes=[],this.batchType=e,this.operations=[],this.size=0,this.sizeBytes=0}},BulkOperationBase:E,bson:v,INSERT:f,UPDATE:g,REMOVE:y,BulkWriteError:O}},function(e,t,n){"use strict";const o=n(0).applyRetryableWrites,i=n(0).applyWriteConcern,r=n(2).MongoError,s=n(1).OperationBase;e.exports=class extends s{constructor(e,t,n){super(n),this.collection=e,this.operations=t}execute(e){const t=this.collection,n=this.operations;let s=this.options;t.s.options.ignoreUndefined&&((s=Object.assign({},s)).ignoreUndefined=t.s.options.ignoreUndefined);const a=!0===s.ordered||null==s.ordered?t.initializeOrderedBulkOp(s):t.initializeUnorderedBulkOp(s);let c=!1;try{for(let e=0;e<n.length;e++){const t=Object.keys(n[e])[0];n[e][t].collation&&(c=!0),a.raw(n[e])}}catch(t){return e(t,null)}let l=Object.assign({},s);l=o(l,t.s.db);const p=(l=i(l,{db:t.s.db,collection:t},s)).writeConcern?l.writeConcern:{},u=t.s.topology.capabilities();if(c&&u&&!u.commandsTakeCollation)return e(new r("server/primary/mongos does not support collation"));a.execute(p,l,(t,n)=>{if(!n&&t)return e(t,null);n.insertedCount=n.nInserted,n.matchedCount=n.nMatched,n.modifiedCount=n.nModified||0,n.deletedCount=n.nRemoved,n.upsertedCount=n.getUpsertedIds().length,n.upsertedIds={},n.insertedIds={},n.n=n.insertedCount;const o=n.getInsertedIds();for(let e=0;e<o.length;e++)n.insertedIds[o[e].index]=o[e]._id;const i=n.getUpsertedIds();for(let e=0;e<i.length;e++)n.upsertedIds[i[e].index]=i[e]._id;e(null,n)})}}},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(15),r=n(1).defineAspects,s=n(0).handleCallback,a=n(2).MongoError,c=n(0).parseIndexOptions,l=new Set(["name","key","writeConcern","w","wtimeout","j","fsync","readPreference","session"]);class p extends i{constructor(e,t,n,o){super(e,o);const i=c(n),r={name:"string"==typeof o.name?o.name:i.name,key:i.fieldHash};this.name=t,this.fieldOrSpec=n,this.indexes=r}_buildCommand(){const e=this.options,t=this.name,n=this.indexes;for(let t in e)l.has(t)||(n[t]=e[t]);return{createIndexes:t,indexes:[n]}}execute(e){const t=this.db,n=this.options,o=this.indexes,i=t.s.topology.capabilities();if(n.collation&&i&&!i.commandsTakeCollation){const t=new a("server/primary/mongos does not support collation");return t.code=67,e(t)}if(n.writeConcern&&"function"!=typeof e)throw a.create({message:"Cannot use a writeConcern without a provided callback",driver:!0});super.execute((t,n)=>s(e,t,null==t?o.name:n))}}r(p,o.WRITE_OPERATION),e.exports=p},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(1).defineAspects,r=n(15),s=n(0).applyWriteConcern,a=n(0).handleCallback;class c extends r{constructor(e,t,n){super(e.s.db,n,e),this.collection=e,this.indexName=t}_buildCommand(){const e=this.collection,t=this.indexName,n=this.options;let o={dropIndexes:e.collectionName,index:t};return o=s(o,{db:e.s.db,collection:e},n)}execute(e){super.execute((t,n)=>{if("function"==typeof e)return t?a(e,t,null):void a(e,null,n)})}}i(c,o.WRITE_OPERATION),e.exports=c},function(e,t,n){"use strict";const o=n(1).OperationBase,i=n(8).indexInformation;e.exports=class extends o{constructor(e,t,n){super(n),this.db=e,this.name=t}execute(e){const t=this.db,n=this.name,o=this.options;i(t,n,o,e)}}},function(e,t,n){"use strict";const o=n(1).OperationBase,i=n(0).handleCallback,r=n(2).MongoError;e.exports=class extends o{constructor(e,t){super(t),this.collection=e}execute(e){const t=this.collection,n=this.options;t.s.db.listCollections({name:t.collectionName},n).toArray((n,o)=>n?i(e,n):0===o.length?i(e,r.create({message:`collection ${t.namespace} not found`,driver:!0})):void i(e,n,o[0].options||null))}}},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(15),r=n(1).defineAspects,s=n(16),a=n(0).handleCallback,c=n(0).toError;class l extends i{constructor(e,t,n,o){super(e,o),this.username=t,this.password=n}_buildCommand(){const e=this.db,t=this.username,n=this.password,o=this.options;let i=Array.isArray(o.roles)?o.roles:[];0===i.length&&console.log("Creating a user without roles is deprecated in MongoDB >= 2.6"),"admin"!==e.databaseName.toLowerCase()&&"admin"!==o.dbName||Array.isArray(o.roles)?Array.isArray(o.roles)||(i=["dbOwner"]):i=["root"];const r=e.s.topology.lastIsMaster().maxWireVersion>=7;let a=n;if(!r){const e=s.createHash("md5");e.update(t+":mongo:"+n),a=e.digest("hex")}const c={createUser:t,customData:o.customData||{},roles:i,digestPassword:r};return"string"==typeof n&&(c.pwd=a),c}execute(e){if(null!=this.options.digestPassword)return e(c("The digestPassword option is not supported via add_user. Please use db.command('createUser', ...) instead for this option."));super.execute((t,n)=>a(e,t,t?null:n))}}r(l,o.WRITE_OPERATION),e.exports=l},function(e,t,n){"use strict";const o=n(1).OperationBase,i=n(0).handleCallback,r=n(2).MongoError,s=n(0).MongoDBNamespace;e.exports=class extends o{constructor(e,t,n){super(n),this.db=e,this.selector=t}execute(e){const t=this.db,n=this.selector,o=this.options,a=new s("admin","$cmd");t.s.topology.command(a,n,o,(n,o)=>t.serverConfig&&t.serverConfig.isDestroyed()?e(new r("topology was destroyed")):n?i(e,n):void i(e,null,o.result))}}},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(15),r=n(1).defineAspects,s=n(0).handleCallback,a=n(31);class c extends i{constructor(e,t,n){const o={},i=a.fromOptions(n);null!=i&&(o.writeConcern=i),n.dbName&&(o.dbName=n.dbName),"number"==typeof n.maxTimeMS&&(o.maxTimeMS=n.maxTimeMS),super(e,o),this.username=t}_buildCommand(){return{dropUser:this.username}}execute(e){super.execute((t,n)=>{if(t)return s(e,t,null);s(e,t,!!n.ok)})}}r(c,[o.WRITE_OPERATION,o.SKIP_SESSIONS]),e.exports=c},function(e,t,n){"use strict";const o=n(1).OperationBase,i=n(0).applyWriteConcern,r=n(0).checkCollectionName,s=n(10).executeDbAdminCommand,a=n(0).handleCallback,c=n(57).loadCollection,l=n(0).toError;e.exports=class extends o{constructor(e,t,n){super(n),this.collection=e,this.newName=t}execute(e){const t=this.collection,n=this.newName,o=this.options;let p=c();r(n);const u={renameCollection:t.namespace,to:t.s.namespace.withCollection(n).toString(),dropTarget:"boolean"==typeof o.dropTarget&&o.dropTarget};i(u,{db:t.s.db,collection:t},o),s(t.s.db.admin().s.db,u,o,(o,i)=>{if(o)return a(e,o,null);if(i.errmsg)return a(e,l(i),null);try{return a(e,null,new p(t.s.db,t.s.topology,t.s.namespace.db,n,t.s.pkFactory,t.s.options))}catch(o){return a(e,l(o),null)}})}}},function(e,t,n){"use strict";const o=n(0).applyWriteConcern,i=n(103),r=n(104),s=n(105),a=n(182),c=n(183),l=n(30);function p(e,t,n){if(!(this instanceof p))return new p(e,t);this.s={db:e,topology:t,promiseLibrary:n}}p.prototype.command=function(e,t,n){const o=Array.prototype.slice.call(arguments,1);n="function"==typeof o[o.length-1]?o.pop():void 0,t=o.length?o.shift():{};const i=new r(this.s.db,e,t);return l(this.s.db.s.topology,i,n)},p.prototype.buildInfo=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=new r(this.s.db,{buildinfo:1},e);return l(this.s.db.s.topology,n,t)},p.prototype.serverInfo=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=new r(this.s.db,{buildinfo:1},e);return l(this.s.db.s.topology,n,t)},p.prototype.serverStatus=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=new r(this.s.db,{serverStatus:1},e);return l(this.s.db.s.topology,n,t)},p.prototype.ping=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=new r(this.s.db,{ping:1},e);return l(this.s.db.s.topology,n,t)},p.prototype.addUser=function(e,t,n,r){const s=Array.prototype.slice.call(arguments,2);r="function"==typeof s[s.length-1]?s.pop():void 0,"string"==typeof e&&null!=t&&"object"==typeof t&&(n=t,t=null),n=s.length?s.shift():{},n=Object.assign({},n),(n=o(n,{db:this.s.db})).dbName="admin";const a=new i(this.s.db,e,t,n);return l(this.s.db.s.topology,a,r)},p.prototype.removeUser=function(e,t,n){const i=Array.prototype.slice.call(arguments,1);n="function"==typeof i[i.length-1]?i.pop():void 0,t=i.length?i.shift():{},t=Object.assign({},t),(t=o(t,{db:this.s.db})).dbName="admin";const r=new s(this.s.db,e,t);return l(this.s.db.s.topology,r,n)},p.prototype.validateCollection=function(e,t,n){"function"==typeof t&&(n=t,t={});const o=new a(this,e,t=t||{});return l(this.s.db.s.topology,o,n)},p.prototype.listDatabases=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},l(this.s.db.s.topology,new c(this.s.db,e),t)},p.prototype.replSetGetStatus=function(e,t){"function"==typeof e&&(t=e,e={}),e=e||{};const n=new r(this.s.db,{replSetGetStatus:1},e);return l(this.s.db.s.topology,n,t)},e.exports=p},function(e,t,n){"use strict";const o=n(26).TopologyBase,i=n(2).MongoError,r=n(2).Mongos,s=n(22),a=n(58),c=n(26).Store,l=n(0).MAX_JS_INT,p=n(0).translateOptions,u=n(0).filterOptions,d=n(0).mergeOptions;var h=["ha","haInterval","acceptableLatencyMS","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCRL","sslCert","ciphers","ecdhCurve","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","promiseLibrary","monitorCommands"];class m extends o{constructor(e,t){super();t=u(t=t||{},h);for(var n=0;n<e.length;n++)if(!(e[n]instanceof a))throw i.create({message:"all seed list instances must be of the Server type",driver:!0});var o={force:!1,bufferMaxEntries:"number"==typeof t.bufferMaxEntries?t.bufferMaxEntries:l},m=t.store||new c(this,o),f=e.map((function(e){return{host:e.host,port:e.port}})),g="boolean"!=typeof t.auto_reconnect||t.auto_reconnect;g="boolean"==typeof t.autoReconnect?t.autoReconnect:g;var y=d({},{disconnectHandler:m,cursorFactory:s,reconnect:g,emitError:"boolean"!=typeof t.emitError||t.emitError,size:"number"==typeof t.poolSize?t.poolSize:5,monitorCommands:"boolean"==typeof t.monitorCommands&&t.monitorCommands});y=p(y,t);var v=t.socketOptions&&Object.keys(t.socketOptions).length>0?t.socketOptions:t;(y=p(y,v)).clientInfo=this.clientInfo,t.appname&&(y.clientInfo.application={name:t.appname}),this.s={coreTopology:new r(f,y),sCapabilities:null,debug:y.debug,storeOptions:o,clonedOptions:y,store:m,options:t,sessionPool:null,sessions:new Set,promiseLibrary:t.promiseLibrary||Promise}}connect(e,t){var n=this;"function"==typeof e&&(t=e,e={}),null==e&&(e={}),"function"!=typeof t&&(t=null),e=Object.assign({},this.s.clonedOptions,e),n.s.options=e,n.s.storeOptions.bufferMaxEntries="number"==typeof e.bufferMaxEntries?e.bufferMaxEntries:-1;var o=function(){return function(e){["timeout","error","close"].forEach((function(e){n.removeListener(e,o)})),n.s.coreTopology.removeListener("connect",o),n.close(!0);try{t(e)}catch(e){process.nextTick((function(){throw e}))}}},i=function(e){return function(t){"error"!==e&&n.emit(e,t)}},r=function(e){return function(t,o){n.emit(e,t,o)}};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed"].forEach((function(e){n.s.coreTopology.removeAllListeners(e)})),n.s.coreTopology.on("serverDescriptionChanged",r("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",r("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",r("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",r("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",r("serverOpening")),n.s.coreTopology.on("serverClosed",r("serverClosed")),n.s.coreTopology.on("topologyOpening",r("topologyOpening")),n.s.coreTopology.on("topologyClosed",r("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",r("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",r("commandStarted")),n.s.coreTopology.on("commandSucceeded",r("commandSucceeded")),n.s.coreTopology.on("commandFailed",r("commandFailed")),n.s.coreTopology.once("timeout",o("timeout")),n.s.coreTopology.once("error",o("error")),n.s.coreTopology.once("close",o("close")),n.s.coreTopology.once("connect",(function(){["timeout","error","close","fullsetup"].forEach((function(e){n.s.coreTopology.removeAllListeners(e)})),n.s.coreTopology.on("timeout",i("timeout")),n.s.coreTopology.on("error",i("error")),n.s.coreTopology.on("close",i("close")),n.s.coreTopology.on("fullsetup",(function(){n.emit("fullsetup",n)})),n.emit("open",null,n);try{t(null,n)}catch(e){process.nextTick((function(){throw e}))}})),n.s.coreTopology.on("joined",r("joined")),n.s.coreTopology.on("left",r("left")),n.s.coreTopology.on("reconnect",(function(){n.emit("reconnect"),n.s.store.execute()})),n.s.coreTopology.connect(e)}}Object.defineProperty(m.prototype,"haInterval",{enumerable:!0,get:function(){return this.s.coreTopology.s.haInterval}}),e.exports=m},function(e,t,n){"use strict";const o=n(58),i=n(22),r=n(2).MongoError,s=n(26).TopologyBase,a=n(26).Store,c=n(2).ReplSet,l=n(0).MAX_JS_INT,p=n(0).translateOptions,u=n(0).filterOptions,d=n(0).mergeOptions;var h=["ha","haInterval","replicaSet","rs_name","secondaryAcceptableLatencyMS","connectWithNoPrimary","poolSize","ssl","checkServerIdentity","sslValidate","sslCA","sslCert","ciphers","ecdhCurve","sslCRL","sslKey","sslPass","socketOptions","bufferMaxEntries","store","auto_reconnect","autoReconnect","emitError","keepAlive","keepAliveInitialDelay","noDelay","connectTimeoutMS","socketTimeoutMS","strategy","debug","family","loggerLevel","logger","reconnectTries","appname","domainsEnabled","servername","promoteLongs","promoteValues","promoteBuffers","maxStalenessSeconds","promiseLibrary","minSize","monitorCommands"];class m extends s{constructor(e,t){super();var n=this;t=u(t=t||{},h);for(var s=0;s<e.length;s++)if(!(e[s]instanceof o))throw r.create({message:"all seed list instances must be of the Server type",driver:!0});var m={force:!1,bufferMaxEntries:"number"==typeof t.bufferMaxEntries?t.bufferMaxEntries:l},f=t.store||new a(n,m),g=e.map((function(e){return{host:e.host,port:e.port}})),y=d({},{disconnectHandler:f,cursorFactory:i,reconnect:!1,emitError:"boolean"!=typeof t.emitError||t.emitError,size:"number"==typeof t.poolSize?t.poolSize:5,monitorCommands:"boolean"==typeof t.monitorCommands&&t.monitorCommands});y=p(y,t);var v=t.socketOptions&&Object.keys(t.socketOptions).length>0?t.socketOptions:t;(y=p(y,v)).clientInfo=this.clientInfo,t.appname&&(y.clientInfo.application={name:t.appname});var b=new c(g,y);b.on("reconnect",(function(){n.emit("reconnect"),f.execute()})),this.s={coreTopology:b,sCapabilities:null,tag:t.tag,storeOptions:m,clonedOptions:y,store:f,options:t,sessionPool:null,sessions:new Set,promiseLibrary:t.promiseLibrary||Promise},y.debug&&Object.defineProperty(this,"replset",{enumerable:!0,get:function(){return b}})}connect(e,t){var n=this;"function"==typeof e&&(t=e,e={}),null==e&&(e={}),"function"!=typeof t&&(t=null),e=Object.assign({},this.s.clonedOptions,e),n.s.options=e,n.s.storeOptions.bufferMaxEntries="number"==typeof e.bufferMaxEntries?e.bufferMaxEntries:-1;var o=function(e){return function(t){"error"!==e&&n.emit(e,t)}};["timeout","error","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha"].forEach((function(e){n.s.coreTopology.removeAllListeners(e)}));var i,r=function(e){return function(t,o){n.emit(e,t,o)}};n.s.coreTopology.on("joined",(i="joined",function(e,t){n.emit(i,e,t.lastIsMaster(),t)})),n.s.coreTopology.on("left",r("left")),n.s.coreTopology.on("ping",r("ping")),n.s.coreTopology.on("ha",(function(e,t){n.emit("ha",e,t),"start"===e?n.emit("ha_connect",e,t):"end"===e&&n.emit("ha_ismaster",e,t)})),n.s.coreTopology.on("serverDescriptionChanged",r("serverDescriptionChanged")),n.s.coreTopology.on("serverHeartbeatStarted",r("serverHeartbeatStarted")),n.s.coreTopology.on("serverHeartbeatSucceeded",r("serverHeartbeatSucceeded")),n.s.coreTopology.on("serverHeartbeatFailed",r("serverHeartbeatFailed")),n.s.coreTopology.on("serverOpening",r("serverOpening")),n.s.coreTopology.on("serverClosed",r("serverClosed")),n.s.coreTopology.on("topologyOpening",r("topologyOpening")),n.s.coreTopology.on("topologyClosed",r("topologyClosed")),n.s.coreTopology.on("topologyDescriptionChanged",r("topologyDescriptionChanged")),n.s.coreTopology.on("commandStarted",r("commandStarted")),n.s.coreTopology.on("commandSucceeded",r("commandSucceeded")),n.s.coreTopology.on("commandFailed",r("commandFailed")),n.s.coreTopology.on("fullsetup",(function(){n.emit("fullsetup",n,n)})),n.s.coreTopology.on("all",(function(){n.emit("all",null,n)}));var s=function(){return function(e){["timeout","error","close"].forEach((function(e){n.s.coreTopology.removeListener(e,s)})),n.s.coreTopology.removeListener("connect",s),n.s.coreTopology.destroy();try{t(e)}catch(e){n.s.coreTopology.isConnected()||process.nextTick((function(){throw e}))}}};n.s.coreTopology.once("timeout",s("timeout")),n.s.coreTopology.once("error",s("error")),n.s.coreTopology.once("close",s("close")),n.s.coreTopology.once("connect",(function(){n.s.coreTopology.once("timeout",o("timeout")),n.s.coreTopology.once("error",o("error")),n.s.coreTopology.once("close",o("close")),n.emit("open",null,n);try{t(null,n)}catch(e){process.nextTick((function(){throw e}))}})),n.s.coreTopology.connect(e)}close(e,t){["timeout","error","close","joined","left"].forEach(e=>this.removeAllListeners(e)),super.close(e,t)}}Object.defineProperty(m.prototype,"haInterval",{enumerable:!0,get:function(){return this.s.coreTopology.s.haInterval}}),e.exports=m},function(e,t,n){"use strict";e.exports=function(e){const t={mongodb:e};return t.stateMachine=n(197)(t),t.autoEncrypter=n(198)(t),t.clientEncryption=n(201)(t),{AutoEncrypter:t.autoEncrypter.AutoEncrypter,ClientEncryption:t.clientEncryption.ClientEncryption,MongoCryptError:n(59).MongoCryptError}}},function(e,t,n){(function(o){var i=n(20),r=n(23),s=n(199),a=r.join,c=r.dirname,l=i.accessSync&&function(e){try{i.accessSync(e)}catch(e){return!1}return!0}||i.existsSync||r.existsSync,p={arrow:process.env.NODE_BINDINGS_ARROW||"  ",compiled:process.env.NODE_BINDINGS_COMPILED_DIR||"compiled",platform:process.platform,arch:process.arch,nodePreGyp:"node-v"+process.versions.modules+"-"+process.platform+"-"+process.arch,version:process.versions.node,bindings:"bindings.node",try:[["module_root","build","bindings"],["module_root","build","Debug","bindings"],["module_root","build","Release","bindings"],["module_root","out","Debug","bindings"],["module_root","Debug","bindings"],["module_root","out","Release","bindings"],["module_root","Release","bindings"],["module_root","build","default","bindings"],["module_root","compiled","version","platform","arch","bindings"],["module_root","addon-build","release","install-root","bindings"],["module_root","addon-build","debug","install-root","bindings"],["module_root","addon-build","default","install-root","bindings"],["module_root","lib","binding","nodePreGyp","bindings"]]};e.exports=t=function(e){"string"==typeof e?e={bindings:e}:e||(e={}),Object.keys(p).map((function(t){t in e||(e[t]=p[t])})),e.module_root||(e.module_root=t.getRoot(t.getFileName())),".node"!=r.extname(e.bindings)&&(e.bindings+=".node");for(var n,o,i,s=require,c=[],l=0,u=e.try.length;l<u;l++){n=a.apply(null,e.try[l].map((function(t){return e[t]||t}))),c.push(n);try{return o=e.path?s.resolve(n):s(n),e.path||(o.path=n),o}catch(e){if("MODULE_NOT_FOUND"!==e.code&&"QUALIFIED_PATH_RESOLUTION_FAILED"!==e.code&&!/not find/i.test(e.message))throw e}}throw(i=new Error("Could not locate the bindings file. Tried:\n"+c.map((function(t){return e.arrow+t})).join("\n"))).tries=c,i},t.getFileName=function(e){var t,n=Error.prepareStackTrace,i=Error.stackTraceLimit,r={};Error.stackTraceLimit=10,Error.prepareStackTrace=function(n,i){for(var r=0,s=i.length;r<s;r++)if((t=i[r].getFileName())!==o){if(!e)return;if(t!==e)return}},Error.captureStackTrace(r),Error.prepareStackTrace=n,Error.stackTraceLimit=i;return 0===t.indexOf("file://")&&(t=s(t)),t},t.getRoot=function(e){for(var t,n=c(e);;){if("."===n&&(n=process.cwd()),l(a(n,"package.json"))||l(a(n,"node_modules")))return n;if(t===n)throw new Error('Could not find module root given file: "'+e+'". Do you have a `package.json` file? ');t=n,n=a(n,"..")}}}).call(this,"/index.js")},function(e,t,n){"use strict";const o=n(16);function i(e){return(t,n,i)=>{let r;try{r=o.createHmac(e,t).update(n).digest()}catch(e){return e}return r.copy(i),r.length}}e.exports={aes256CbcEncryptHook:function(e,t,n,i){let r;try{let i=o.createCipheriv("aes-256-cbc",e,t);i.setAutoPadding(!1),r=i.update(n)}catch(e){return e}return r.copy(i),r.length},aes256CbcDecryptHook:function(e,t,n,i){let r;try{let i=o.createDecipheriv("aes-256-cbc",e,t);i.setAutoPadding(!1),r=i.update(n)}catch(e){return e}return r.copy(i),r.length},randomHook:"function"==typeof o.randomFillSync?function(e,t){try{o.randomFillSync(e,0,t)}catch(e){return e}return t}:function(e,t){let n;try{n=o.randomBytes(t)}catch(e){return e}return n.copy(e),t},hmacSha512Hook:i("sha512"),hmacSha256Hook:i("sha256"),sha256Hook:function(e,t){let n;try{n=o.createHash("sha256").update(e).digest()}catch(e){return e}return n.copy(t),n.length}}},function(e,t,n){"use strict";var o=n(2).BSON.Binary,i=n(2).BSON.ObjectID,r=n(17).Buffer,s=function(e,t,n){if(!(this instanceof s))return new s(e,t);this.file=e;var a=null==t?{}:t;if(this.writeConcern=n||{w:1},this.objectId=null==a._id?new i:a._id,this.chunkNumber=null==a.n?0:a.n,this.data=new o,"string"==typeof a.data){var c=r.alloc(a.data.length);c.write(a.data,0,a.data.length,"binary"),this.data=new o(c)}else if(Array.isArray(a.data)){c=r.alloc(a.data.length);var l=a.data.join("");c.write(l,0,l.length,"binary"),this.data=new o(c)}else if(a.data&&"Binary"===a.data._bsontype)this.data=a.data;else if(!r.isBuffer(a.data)&&null!=a.data)throw Error("Illegal chunk format");this.internalPosition=0};s.prototype.write=function(e,t){return this.data.write(e,this.internalPosition,e.length,"binary"),this.internalPosition=this.data.length(),null!=t?t(null,this):this},s.prototype.read=function(e){if(e=null==e||0===e?this.length():e,this.length()-this.internalPosition+1>=e){var t=this.data.read(this.internalPosition,e);return this.internalPosition=this.internalPosition+e,t}return""},s.prototype.readSlice=function(e){if(this.length()-this.internalPosition>=e){var t=null;return null!=this.data.buffer?t=this.data.buffer.slice(this.internalPosition,this.internalPosition+e):(t=r.alloc(e),e=this.data.readInto(t,this.internalPosition)),this.internalPosition=this.internalPosition+e,t}return null},s.prototype.eof=function(){return this.internalPosition===this.length()},s.prototype.getc=function(){return this.read(1)},s.prototype.rewind=function(){this.internalPosition=0,this.data=new o},s.prototype.save=function(e,t){var n=this;"function"==typeof e&&(t=e,e={}),n.file.chunkCollection((function(o,i){if(o)return t(o);var r={upsert:!0};for(var s in e)r[s]=e[s];for(s in n.writeConcern)r[s]=n.writeConcern[s];n.data.length()>0?n.buildMongoObject((function(e){var o={forceServerObjectId:!0};for(var s in n.writeConcern)o[s]=n.writeConcern[s];i.replaceOne({_id:n.objectId},e,r,(function(e){t(e,n)}))})):t(null,n)}))},s.prototype.buildMongoObject=function(e){var t={files_id:this.file.fileId,n:this.chunkNumber,data:this.data};null!=this.objectId&&(t._id=this.objectId),e(t)},s.prototype.length=function(){return this.data.length()},Object.defineProperty(s.prototype,"position",{enumerable:!0,get:function(){return this.internalPosition},set:function(e){this.internalPosition=e}}),s.DEFAULT_CHUNK_SIZE=261120,e.exports=s},function(e,t){e.exports=require("zlib")},,,function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){e.exports=require("child_process")},function(e){e.exports=JSON.parse('{"globalSecret":"Abran la puerta de los sabios","dbName":"poems","collectionNames":["poets"],"connectionURL":"mongodb+srv://LuisArmando-TestCoder:123456t7890y@events-p5hux.azure.mongodb.net/test?retryWrites=true&w=majority"}')},,,,,function(e,t,n){function o(){return"Afghan|Albanian|Algerian|Andorran|Angolan|Antiguan or Barbudan|Argentine|Armenian|Australian|Austrian|Azerbaijani|Azeri|Bahamian|Bahraini|Bengali|Barbadian|Belarusian|Belgian|Belizean|Beninese|Beninois|Bhutanese|Bolivian|Bosnian or Herzegovinian|Motswana|Botswanan|Brazilian|Bruneian|Bulgarian|Burkinab|Burmese|Burundian|Cabo Verdean|Cambodian|Cameroonian|Canadian|Central African|Chadian|Chilean|Chinese|Colombian|Comoran|Comorian|Congolese|Congolese|Costa Rican|Ivorian|Croatian|Cuban|Cypriot|Czech|Danish|Djiboutian|Dominican|Dominican|Timorese|Ecuadorian|Egyptian|Salvadoran|Equatorial Guinean|Equatoguinean|Eritrean|Estonian|Ethiopian|Fijian|Finnish|French|Gabonese|Gambian|Georgian|German|Ghanaian|Gibraltar|Greek|Hellenic|Grenadian|Guatemalan|Guinean|Bissau-Guinean|Guyanese|Haitian|Honduran|Hungarian|Magyar|Icelandic|Indian|Indonesian|Iranian|Persian|Iraqi|Irish|Israeli|Italian|Ivorian|Jamaican|Japanese|Jordanian|Kazakhstani|Kazakh|Kenyan|I-Kiribati|North Korean|South Korean|Kuwaiti|Kyrgyzstani|Kyrgyz|Kirgiz|Kirghiz|Lao|Laotian|Latvian|Lettish|Lebanese|Basotho|Liberian|Libyan|Liechtensteiner|Lithuanian|Luxembourg|Luxembourgish|Macedonian|Malagasy|Malawian|Malaysian|Maldivian|Malian|Malinese|Maltese|Marshallese|Martiniquais|Martinican|Mauritanian|Mauritian|Mexican|Micronesian|Moldovan|Mongasque|Monacan|Mongolian|Montenegrin|Moroccan|Mozambican|Namibian|Nauruan|Nepali|Nepalese|Dutch|Netherlandic|New Zealand|NZ|Zelanian|Nicaraguan|Nigerien|Nigerian|Northern Marianan|Norwegian|Omani|Pakistani|Palauan|Palestinian|Panamanian|Papua New Guinean|Papuan|Paraguayan|Peruvian|Filipino|Philippine|Polish|Portuguese|Puerto Rican|Qatari|Romanian|Russian|Rwandan|Kittitian or Nevisian|Saint Lucian|Saint Vincentian|Vincentian|Samoan|Sammarinese|So Toman|Saudi|Saudi Arabian|Senegalese|Serbian|Seychellois|Sierra Leonean|Singapore|Singaporean|Slovak|Slovenian|Slovene|Solomon Island|Somali|South African|South Sudanese|Spanish|Sri Lankan|Sudanese|Surinamese|Swazi|Swedish|Swiss|Syrian|Tajikistani|Tanzanian|Thai|Timorese|Togolese|Tokelauan|Tongan|Trinidadian or Tobagonian|Tunisian|Turkish|Turkmen|Tuvaluan|Ugandan|Ukrainian|Emirati|Emirian|Emiri|UK|British|United States|U.S.|American|Uruguayan|Uzbekistani|Uzbek|Ni-Vanuatu|Vanuatuan|Vatican|Venezuelan|Vietnamese|Yemeni|Zambian|Zimbabwean"}function i(e){const t=n(20);t.writeFile("poems.json",JSON.stringify(e),e=>{if(e)throw new Error(e);console.log("The file poems.json has been saved")})}e.exports={findWritePoems:function(e){e.find({}).toArray((e,t)=>{if(e)throw new Error(e);t.forEach(e=>{delete e.code,delete e._id}),i(t)})},writeJSONPoems:i,cors:function(e){e.setHeader("Access-Control-Allow-Origin","*"),e.setHeader("Access-Control-Allow-Methods","*"),e.setHeader("Access-Control-Allow-Headers","*")},getLastFullProp:function(e){const t=[];return Object.keys(e).forEach(n=>{e[n]&&(t[0]=n,t[1]=e[n])}),{[t[0]]:t[1]}},filterProps:function(e){const t=JSON.parse(JSON.stringify(e));return Object.keys(t).forEach(e=>{t[e]||delete t[e]}),t},isValidDate:function(e){return!!/(.*)\/(.*)\/(.*)/.test(e)&&!!new Date(e).getDate()},setNaturalNumber:function(e){return Math.abs(Math.floor(+e))},isValidColor:function(e){return new RegExp("^(#[0-9a-fA-F]{6})$").test(e)},isValidPlayerPosition:function(e){return new RegExp("^(defense|forwards|goalkeeper)$","i").test(e)},setBoolean:function(e){try{return!0===JSON.parse(e)}catch(e){return!1}},isValidDay:function(e){return new RegExp("^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)$","i").test(e)},getValidHour:function(e){return+e>0&&+e<24?Math.floor(+e):null},getArray:function(e){try{return JSON.parse(e)}catch(e){return null}},isValidNationality:function(e){return new RegExp("^(Afghan|Albanian|Algerian|Andorran|Angolan|Antiguan or Barbudan|Argentine|Armenian|Australian|Austrian|Azerbaijani|Azeri|Bahamian|Bahraini|Bengali|Barbadian|Belarusian|Belgian|Belizean|Beninese|Beninois|Bhutanese|Bolivian|Bosnian or Herzegovinian|Motswana|Botswanan|Brazilian|Bruneian|Bulgarian|Burkinab|Burmese|Burundian|Cabo Verdean|Cambodian|Cameroonian|Canadian|Central African|Chadian|Chilean|Chinese|Colombian|Comoran|Comorian|Congolese|Congolese|Costa Rican|Ivorian|Croatian|Cuban|Cypriot|Czech|Danish|Djiboutian|Dominican|Dominican|Timorese|Ecuadorian|Egyptian|Salvadoran|Equatorial Guinean|Equatoguinean|Eritrean|Estonian|Ethiopian|Fijian|Finnish|French|Gabonese|Gambian|Georgian|German|Ghanaian|Gibraltar|Greek|Hellenic|Grenadian|Guatemalan|Guinean|Bissau-Guinean|Guyanese|Haitian|Honduran|Hungarian|Magyar|Icelandic|Indian|Indonesian|Iranian|Persian|Iraqi|Irish|Israeli|Italian|Ivorian|Jamaican|Japanese|Jordanian|Kazakhstani|Kazakh|Kenyan|I-Kiribati|North Korean|South Korean|Kuwaiti|Kyrgyzstani|Kyrgyz|Kirgiz|Kirghiz|Lao|Laotian|Latvian|Lettish|Lebanese|Basotho|Liberian|Libyan|Liechtensteiner|Lithuanian|Luxembourg|Luxembourgish|Macedonian|Malagasy|Malawian|Malaysian|Maldivian|Malian|Malinese|Maltese|Marshallese|Martiniquais|Martinican|Mauritanian|Mauritian|Mexican|Micronesian|Moldovan|Mongasque|Monacan|Mongolian|Montenegrin|Moroccan|Mozambican|Namibian|Nauruan|Nepali|Nepalese|Dutch|Netherlandic|New Zealand|NZ|Zelanian|Nicaraguan|Nigerien|Nigerian|Northern Marianan|Norwegian|Omani|Pakistani|Palauan|Palestinian|Panamanian|Papua New Guinean|Papuan|Paraguayan|Peruvian|Filipino|Philippine|Polish|Portuguese|Puerto Rican|Qatari|Romanian|Russian|Rwandan|Kittitian or Nevisian|Saint Lucian|Saint Vincentian|Vincentian|Samoan|Sammarinese|So Toman|Saudi|Saudi Arabian|Senegalese|Serbian|Seychellois|Sierra Leonean|Singapore|Singaporean|Slovak|Slovenian|Slovene|Solomon Island|Somali|South African|South Sudanese|Spanish|Sri Lankan|Sudanese|Surinamese|Swazi|Swedish|Swiss|Syrian|Tajikistani|Tanzanian|Thai|Timorese|Togolese|Tokelauan|Tongan|Trinidadian or Tobagonian|Tunisian|Turkish|Turkmen|Tuvaluan|Ugandan|Ukrainian|Emirati|Emirian|Emiri|UK|British|United States|U.S.|American|Uruguayan|Uzbekistani|Uzbek|Ni-Vanuatu|Vanuatuan|Vatican|Venezuelan|Vietnamese|Yemeni|Zambian|Zimbabwean)$","i").test(e)},getNationalities:o,isValidEmail:function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},parseBoolean:function(e){try{return!!JSON.parse(e)}catch(e){return!1}},getBody:function(e,t){const o=n(61);let i="";function r(){const e=o.parse(i);t(e)}e.on("data",e=>{(i+=e).split("&").length>96&&r()}),e.on("end",r)},getQueries:function(e){const t=n(27);return n(61).parse(t.parse(e).query)},getPath:function(e){return n(27).parse(e).pathname.split("/")},connect:function(e){const t=n(64),o=n(81),i=o.MongoClient,r=o.ObjectId,{serverPort:s,dbName:a,collectionNames:c,connectionURL:l}=n(119),p=process.env.PORT||s;i.connect(l,{useNewUrlParser:!0}).then(n=>{const o=n.db(a);let i={};c.forEach(e=>{i[e]=o.collection(e)}),console.log(`Server started at port ${p}`),t.createServer((t,n)=>{e(t,n,i,r)}).listen(p)}).catch(e=>console.log("could not connect",e))},end:function(e,t,n){const o={error(){e.statusCode=400,e.json({success:!1,error:n,data:null})},success(){e.statusCode=200,e.json({success:!0,error:null,data:n})}};e.setHeader("Content-Type","application/json"),o[t]?o[t]():console.error(`type ${t} is not registered in types object`)},isPathInURL:function(e,t){return new RegExp(`^${t}`).test(e)},year:()=>(new Date).getFullYear(),month:()=>(new Date).getMonth()+1,day:()=>(new Date).getDate(),getDateRegExp:function({month:e,year:t,day:n}){const o=e=>e||"(.*)";return new RegExp(`${o(e)}-${o(n)}-${o(t)}`,"i")}}},function(e,t,n){"use strict";var o=n(67),i=n(28),r=n(40),s=n(41),a=n(42),c=n(43),l=n(44),p=n(68),u=n(45),d=n(46),h=n(47),m=n(48),f=n(49),g=n(34),y=n(126),v=n(127),b=n(129),x=n(25),S=x.allocBuffer(17825792),w=function(){};w.prototype.serialize=function(e,t){var n="boolean"==typeof(t=t||{}).checkKeys&&t.checkKeys,o="boolean"==typeof t.serializeFunctions&&t.serializeFunctions,i="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined,r="number"==typeof t.minInternalBufferSize?t.minInternalBufferSize:17825792;S.length<r&&(S=x.allocBuffer(r));var s=v(S,e,n,0,0,o,i,[]),a=x.allocBuffer(s);return S.copy(a,0,0,a.length),a},w.prototype.serializeWithBufferAndIndex=function(e,t,n){var o="boolean"==typeof(n=n||{}).checkKeys&&n.checkKeys,i="boolean"==typeof n.serializeFunctions&&n.serializeFunctions,r="boolean"!=typeof n.ignoreUndefined||n.ignoreUndefined,s="number"==typeof n.index?n.index:0;return v(t,e,o,s||0,0,i,r)-1},w.prototype.deserialize=function(e,t){return y(e,t)},w.prototype.calculateObjectSize=function(e,t){var n="boolean"==typeof(t=t||{}).serializeFunctions&&t.serializeFunctions,o="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined;return b(e,n,o)},w.prototype.deserializeStream=function(e,t,n,o,i,r){r=null!=r?r:{};for(var s=t,a=0;a<n;a++){var c=e[s]|e[s+1]<<8|e[s+2]<<16|e[s+3]<<24;r.index=s,o[i+a]=this.deserialize(e,r),s+=c}return s},w.BSON_INT32_MAX=2147483647,w.BSON_INT32_MIN=-2147483648,w.BSON_INT64_MAX=Math.pow(2,63)-1,w.BSON_INT64_MIN=-Math.pow(2,63),w.JS_INT_MAX=9007199254740992,w.JS_INT_MIN=-9007199254740992,w.BSON_DATA_NUMBER=1,w.BSON_DATA_STRING=2,w.BSON_DATA_OBJECT=3,w.BSON_DATA_ARRAY=4,w.BSON_DATA_BINARY=5,w.BSON_DATA_OID=7,w.BSON_DATA_BOOLEAN=8,w.BSON_DATA_DATE=9,w.BSON_DATA_NULL=10,w.BSON_DATA_REGEXP=11,w.BSON_DATA_CODE=13,w.BSON_DATA_SYMBOL=14,w.BSON_DATA_CODE_W_SCOPE=15,w.BSON_DATA_INT=16,w.BSON_DATA_TIMESTAMP=17,w.BSON_DATA_LONG=18,w.BSON_DATA_MIN_KEY=255,w.BSON_DATA_MAX_KEY=127,w.BSON_BINARY_SUBTYPE_DEFAULT=0,w.BSON_BINARY_SUBTYPE_FUNCTION=1,w.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,w.BSON_BINARY_SUBTYPE_UUID=3,w.BSON_BINARY_SUBTYPE_MD5=4,w.BSON_BINARY_SUBTYPE_USER_DEFINED=128,e.exports=w,e.exports.Code=u,e.exports.Map=o,e.exports.Symbol=l,e.exports.BSON=w,e.exports.DBRef=f,e.exports.Binary=g,e.exports.ObjectID=a,e.exports.Long=i,e.exports.Timestamp=s,e.exports.Double=r,e.exports.Int32=p,e.exports.MinKey=h,e.exports.MaxKey=m,e.exports.BSONRegExp=c,e.exports.Decimal128=d},function(module,exports,__webpack_require__){"use strict";var Long=__webpack_require__(28).Long,Double=__webpack_require__(40).Double,Timestamp=__webpack_require__(41).Timestamp,ObjectID=__webpack_require__(42).ObjectID,Symbol=__webpack_require__(44).Symbol,Code=__webpack_require__(45).Code,MinKey=__webpack_require__(47).MinKey,MaxKey=__webpack_require__(48).MaxKey,Decimal128=__webpack_require__(46),Int32=__webpack_require__(68),DBRef=__webpack_require__(49).DBRef,BSONRegExp=__webpack_require__(43).BSONRegExp,Binary=__webpack_require__(34).Binary,utils=__webpack_require__(25),deserialize=function(e,t,n){var o=(t=null==t?{}:t)&&t.index?t.index:0,i=e[o]|e[o+1]<<8|e[o+2]<<16|e[o+3]<<24;if(i<5||e.length<i||i+o>e.length)throw new Error("corrupt bson message");if(0!==e[o+i-1])throw new Error("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return deserializeObject(e,o,t,n)},deserializeObject=function(e,t,n,o){var i=null!=n.evalFunctions&&n.evalFunctions,r=null!=n.cacheFunctions&&n.cacheFunctions,s=null!=n.cacheFunctionsCrc32&&n.cacheFunctionsCrc32;if(!s)var a=null;var c=null==n.fieldsAsRaw?null:n.fieldsAsRaw,l=null!=n.raw&&n.raw,p="boolean"==typeof n.bsonRegExp&&n.bsonRegExp,u=null!=n.promoteBuffers&&n.promoteBuffers,d=null==n.promoteLongs||n.promoteLongs,h=null==n.promoteValues||n.promoteValues,m=t;if(e.length<5)throw new Error("corrupt bson message < 5 bytes long");var f=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(f<5||f>e.length)throw new Error("corrupt bson message");for(var g=o?[]:{},y=0;;){var v=e[t++];if(0===v)break;for(var b=t;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");var x=o?y++:e.toString("utf8",t,b);if(t=b+1,v===BSON.BSON_DATA_STRING){var S=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(S<=0||S>e.length-t||0!==e[t+S-1])throw new Error("bad string length in bson");g[x]=e.toString("utf8",t,t+S-1),t+=S}else if(v===BSON.BSON_DATA_OID){var w=utils.allocBuffer(12);e.copy(w,0,t,t+12),g[x]=new ObjectID(w),t+=12}else if(v===BSON.BSON_DATA_INT&&!1===h)g[x]=new Int32(e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24);else if(v===BSON.BSON_DATA_INT)g[x]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;else if(v===BSON.BSON_DATA_NUMBER&&!1===h)g[x]=new Double(e.readDoubleLE(t)),t+=8;else if(v===BSON.BSON_DATA_NUMBER)g[x]=e.readDoubleLE(t),t+=8;else if(v===BSON.BSON_DATA_DATE){var _=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,O=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;g[x]=new Date(new Long(_,O).toNumber())}else if(v===BSON.BSON_DATA_BOOLEAN){if(0!==e[t]&&1!==e[t])throw new Error("illegal boolean type value");g[x]=1===e[t++]}else if(v===BSON.BSON_DATA_OBJECT){var T=t,E=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;if(E<=0||E>e.length-t)throw new Error("bad embedded document length in bson");g[x]=l?e.slice(t,t+E):deserializeObject(e,T,n,!1),t+=E}else if(v===BSON.BSON_DATA_ARRAY){T=t;var C=n,k=t+(E=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24);if(c&&c[x]){for(var A in C={},n)C[A]=n[A];C.raw=!0}if(g[x]=deserializeObject(e,T,C,!0),0!==e[(t+=E)-1])throw new Error("invalid array terminator byte");if(t!==k)throw new Error("corrupted array bson")}else if(v===BSON.BSON_DATA_UNDEFINED)g[x]=void 0;else if(v===BSON.BSON_DATA_NULL)g[x]=null;else if(v===BSON.BSON_DATA_LONG){_=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,O=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;var N=new Long(_,O);g[x]=d&&!0===h&&N.lessThanOrEqual(JS_INT_MAX_LONG)&&N.greaterThanOrEqual(JS_INT_MIN_LONG)?N.toNumber():N}else if(v===BSON.BSON_DATA_DECIMAL128){var I=utils.allocBuffer(16);e.copy(I,0,t,t+16),t+=16;var M=new Decimal128(I);g[x]=M.toObject?M.toObject():M}else if(v===BSON.BSON_DATA_BINARY){var B=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,R=B,P=e[t++];if(B<0)throw new Error("Negative binary type element size found");if(B>e.length)throw new Error("Binary type size larger than document size");if(null!=e.slice){if(P===Binary.SUBTYPE_BYTE_ARRAY){if((B=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<0)throw new Error("Negative binary type element size found for subtype 0x02");if(B>R-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(B<R-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}g[x]=u&&h?e.slice(t,t+B):new Binary(e.slice(t,t+B),P)}else{var D="undefined"!=typeof Uint8Array?new Uint8Array(new ArrayBuffer(B)):new Array(B);if(P===Binary.SUBTYPE_BYTE_ARRAY){if((B=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<0)throw new Error("Negative binary type element size found for subtype 0x02");if(B>R-4)throw new Error("Binary type with subtype 0x02 contains to long binary size");if(B<R-4)throw new Error("Binary type with subtype 0x02 contains to short binary size")}for(b=0;b<B;b++)D[b]=e[t+b];g[x]=u&&h?D:new Binary(D,P)}t+=B}else if(v===BSON.BSON_DATA_REGEXP&&!1===p){for(b=t;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");var L=e.toString("utf8",t,b);for(b=t=b+1;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");var j=e.toString("utf8",t,b);t=b+1;var z=new Array(j.length);for(b=0;b<j.length;b++)switch(j[b]){case"m":z[b]="m";break;case"s":z[b]="g";break;case"i":z[b]="i"}g[x]=new RegExp(L,z.join(""))}else if(v===BSON.BSON_DATA_REGEXP&&!0===p){for(b=t;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");for(L=e.toString("utf8",t,b),b=t=b+1;0!==e[b]&&b<e.length;)b++;if(b>=e.length)throw new Error("Bad BSON Document: illegal CString");j=e.toString("utf8",t,b),t=b+1,g[x]=new BSONRegExp(L,j)}else if(v===BSON.BSON_DATA_SYMBOL){if((S=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||S>e.length-t||0!==e[t+S-1])throw new Error("bad string length in bson");g[x]=new Symbol(e.toString("utf8",t,t+S-1)),t+=S}else if(v===BSON.BSON_DATA_TIMESTAMP)_=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,O=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24,g[x]=new Timestamp(_,O);else if(v===BSON.BSON_DATA_MIN_KEY)g[x]=new MinKey;else if(v===BSON.BSON_DATA_MAX_KEY)g[x]=new MaxKey;else if(v===BSON.BSON_DATA_CODE){if((S=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||S>e.length-t||0!==e[t+S-1])throw new Error("bad string length in bson");var U=e.toString("utf8",t,t+S-1);if(i)if(r){var H=s?a(U):U;g[x]=isolateEvalWithHash(functionCache,H,U,g)}else g[x]=isolateEval(U);else g[x]=new Code(U);t+=S}else if(v===BSON.BSON_DATA_CODE_W_SCOPE){var q=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;if(q<13)throw new Error("code_w_scope total size shorter minimum expected length");if((S=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||S>e.length-t||0!==e[t+S-1])throw new Error("bad string length in bson");U=e.toString("utf8",t,t+S-1),T=t+=S,E=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24;var F=deserializeObject(e,T,n,!1);if(t+=E,q<8+E+S)throw new Error("code_w_scope total size is to short, truncating scope");if(q>8+E+S)throw new Error("code_w_scope total size is to long, clips outer document");i?(r?(H=s?a(U):U,g[x]=isolateEvalWithHash(functionCache,H,U,g)):g[x]=isolateEval(U),g[x].scope=F):g[x]=new Code(U,F)}else{if(v!==BSON.BSON_DATA_DBPOINTER)throw new Error("Detected unknown BSON type "+v.toString(16)+' for fieldname "'+x+'", are you using the latest BSON parser');if((S=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24)<=0||S>e.length-t||0!==e[t+S-1])throw new Error("bad string length in bson");var $=e.toString("utf8",t,t+S-1);t+=S;var W=utils.allocBuffer(12);e.copy(W,0,t,t+12),w=new ObjectID(W),t+=12;var V=$.split("."),K=V.shift(),G=V.join(".");g[x]=new DBRef(G,w,K)}}if(f!==t-m){if(o)throw new Error("corrupt array bson");throw new Error("corrupt object bson")}return null!=g.$id&&(g=new DBRef(g.$ref,g.$id,g.$db)),g},isolateEvalWithHash=function(functionCache,hash,functionString,object){var value=null;return null==functionCache[hash]&&(eval("value = "+functionString),functionCache[hash]=value),functionCache[hash].bind(object)},isolateEval=function(functionString){var value=null;return eval("value = "+functionString),value},BSON={},functionCache=BSON.functionCache={};BSON.BSON_DATA_NUMBER=1,BSON.BSON_DATA_STRING=2,BSON.BSON_DATA_OBJECT=3,BSON.BSON_DATA_ARRAY=4,BSON.BSON_DATA_BINARY=5,BSON.BSON_DATA_UNDEFINED=6,BSON.BSON_DATA_OID=7,BSON.BSON_DATA_BOOLEAN=8,BSON.BSON_DATA_DATE=9,BSON.BSON_DATA_NULL=10,BSON.BSON_DATA_REGEXP=11,BSON.BSON_DATA_DBPOINTER=12,BSON.BSON_DATA_CODE=13,BSON.BSON_DATA_SYMBOL=14,BSON.BSON_DATA_CODE_W_SCOPE=15,BSON.BSON_DATA_INT=16,BSON.BSON_DATA_TIMESTAMP=17,BSON.BSON_DATA_LONG=18,BSON.BSON_DATA_DECIMAL128=19,BSON.BSON_DATA_MIN_KEY=255,BSON.BSON_DATA_MAX_KEY=127,BSON.BSON_BINARY_SUBTYPE_DEFAULT=0,BSON.BSON_BINARY_SUBTYPE_FUNCTION=1,BSON.BSON_BINARY_SUBTYPE_BYTE_ARRAY=2,BSON.BSON_BINARY_SUBTYPE_UUID=3,BSON.BSON_BINARY_SUBTYPE_MD5=4,BSON.BSON_BINARY_SUBTYPE_USER_DEFINED=128,BSON.BSON_INT32_MAX=2147483647,BSON.BSON_INT32_MIN=-2147483648,BSON.BSON_INT64_MAX=Math.pow(2,63)-1,BSON.BSON_INT64_MIN=-Math.pow(2,63),BSON.JS_INT_MAX=9007199254740992,BSON.JS_INT_MIN=-9007199254740992;var JS_INT_MAX_LONG=Long.fromNumber(9007199254740992),JS_INT_MIN_LONG=Long.fromNumber(-9007199254740992);module.exports=deserialize},function(e,t,n){"use strict";var o=n(128).writeIEEE754,i=n(28).Long,r=n(67),s=n(34).Binary,a=n(25).normalizedFunctionString,c=/\x00/,l=["$db","$ref","$id","$clusterTime"],p=function(e){return"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e)},u=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},d=function(e,t,n,o,i){e[o++]=B.BSON_DATA_STRING;var r=i?e.write(t,o,"ascii"):e.write(t,o,"utf8");e[(o=o+r+1)-1]=0;var s=e.write(n,o+4,"utf8");return e[o+3]=s+1>>24&255,e[o+2]=s+1>>16&255,e[o+1]=s+1>>8&255,e[o]=s+1&255,o=o+4+s,e[o++]=0,o},h=function(e,t,n,r,s){if(Math.floor(n)===n&&n>=B.JS_INT_MIN&&n<=B.JS_INT_MAX)if(n>=B.BSON_INT32_MIN&&n<=B.BSON_INT32_MAX){e[r++]=B.BSON_DATA_INT;var a=s?e.write(t,r,"ascii"):e.write(t,r,"utf8");r+=a,e[r++]=0,e[r++]=255&n,e[r++]=n>>8&255,e[r++]=n>>16&255,e[r++]=n>>24&255}else if(n>=B.JS_INT_MIN&&n<=B.JS_INT_MAX)e[r++]=B.BSON_DATA_NUMBER,r+=a=s?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,o(e,n,r,"little",52,8),r+=8;else{e[r++]=B.BSON_DATA_LONG,r+=a=s?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0;var c=i.fromNumber(n),l=c.getLowBits(),p=c.getHighBits();e[r++]=255&l,e[r++]=l>>8&255,e[r++]=l>>16&255,e[r++]=l>>24&255,e[r++]=255&p,e[r++]=p>>8&255,e[r++]=p>>16&255,e[r++]=p>>24&255}else e[r++]=B.BSON_DATA_NUMBER,r+=a=s?e.write(t,r,"ascii"):e.write(t,r,"utf8"),e[r++]=0,o(e,n,r,"little",52,8),r+=8;return r},m=function(e,t,n,o,i){return e[o++]=B.BSON_DATA_NULL,o+=i?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0,o},f=function(e,t,n,o,i){return e[o++]=B.BSON_DATA_BOOLEAN,o+=i?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0,e[o++]=n?1:0,o},g=function(e,t,n,o,r){e[o++]=B.BSON_DATA_DATE,o+=r?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0;var s=i.fromNumber(n.getTime()),a=s.getLowBits(),c=s.getHighBits();return e[o++]=255&a,e[o++]=a>>8&255,e[o++]=a>>16&255,e[o++]=a>>24&255,e[o++]=255&c,e[o++]=c>>8&255,e[o++]=c>>16&255,e[o++]=c>>24&255,o},y=function(e,t,n,o,i){if(e[o++]=B.BSON_DATA_REGEXP,o+=i?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0,n.source&&null!=n.source.match(c))throw Error("value "+n.source+" must not contain null bytes");return o+=e.write(n.source,o,"utf8"),e[o++]=0,n.global&&(e[o++]=115),n.ignoreCase&&(e[o++]=105),n.multiline&&(e[o++]=109),e[o++]=0,o},v=function(e,t,n,o,i){if(e[o++]=B.BSON_DATA_REGEXP,o+=i?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0,null!=n.pattern.match(c))throw Error("pattern "+n.pattern+" must not contain null bytes");return o+=e.write(n.pattern,o,"utf8"),e[o++]=0,o+=e.write(n.options.split("").sort().join(""),o,"utf8"),e[o++]=0,o},b=function(e,t,n,o,i){return null===n?e[o++]=B.BSON_DATA_NULL:"MinKey"===n._bsontype?e[o++]=B.BSON_DATA_MIN_KEY:e[o++]=B.BSON_DATA_MAX_KEY,o+=i?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0,o},x=function(e,t,n,o,i){if(e[o++]=B.BSON_DATA_OID,o+=i?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0,"string"==typeof n.id)e.write(n.id,o,"binary");else{if(!n.id||!n.id.copy)throw new Error("object ["+JSON.stringify(n)+"] is not a valid ObjectId");n.id.copy(e,o,0,12)}return o+12},S=function(e,t,n,o,i){e[o++]=B.BSON_DATA_BINARY,o+=i?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0;var r=n.length;return e[o++]=255&r,e[o++]=r>>8&255,e[o++]=r>>16&255,e[o++]=r>>24&255,e[o++]=B.BSON_BINARY_SUBTYPE_DEFAULT,n.copy(e,o,0,r),o+=r},w=function(e,t,n,o,i,r,s,a,c,l){for(var p=0;p<l.length;p++)if(l[p]===n)throw new Error("cyclic dependency detected");l.push(n),e[o++]=Array.isArray(n)?B.BSON_DATA_ARRAY:B.BSON_DATA_OBJECT,o+=c?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0;var u=M(e,n,i,o,r+1,s,a,l);return l.pop(),u},_=function(e,t,n,o,i){return e[o++]=B.BSON_DATA_DECIMAL128,o+=i?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0,n.bytes.copy(e,o,0,16),o+16},O=function(e,t,n,o,i){e[o++]="Long"===n._bsontype?B.BSON_DATA_LONG:B.BSON_DATA_TIMESTAMP,o+=i?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0;var r=n.getLowBits(),s=n.getHighBits();return e[o++]=255&r,e[o++]=r>>8&255,e[o++]=r>>16&255,e[o++]=r>>24&255,e[o++]=255&s,e[o++]=s>>8&255,e[o++]=s>>16&255,e[o++]=s>>24&255,o},T=function(e,t,n,o,i){return e[o++]=B.BSON_DATA_INT,o+=i?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0,e[o++]=255&n,e[o++]=n>>8&255,e[o++]=n>>16&255,e[o++]=n>>24&255,o},E=function(e,t,n,i,r){return e[i++]=B.BSON_DATA_NUMBER,i+=r?e.write(t,i,"ascii"):e.write(t,i,"utf8"),e[i++]=0,o(e,n,i,"little",52,8),i+=8},C=function(e,t,n,o,i,r,s){e[o++]=B.BSON_DATA_CODE,o+=s?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0;var c=a(n),l=e.write(c,o+4,"utf8")+1;return e[o]=255&l,e[o+1]=l>>8&255,e[o+2]=l>>16&255,e[o+3]=l>>24&255,o=o+4+l-1,e[o++]=0,o},k=function(e,t,n,o,i,r,s,a,c){if(n.scope&&"object"==typeof n.scope){e[o++]=B.BSON_DATA_CODE_W_SCOPE;var l=c?e.write(t,o,"ascii"):e.write(t,o,"utf8");o+=l,e[o++]=0;var p=o,u="string"==typeof n.code?n.code:n.code.toString();o+=4;var d=e.write(u,o+4,"utf8")+1;e[o]=255&d,e[o+1]=d>>8&255,e[o+2]=d>>16&255,e[o+3]=d>>24&255,e[o+4+d-1]=0,o=o+d+4;var h=M(e,n.scope,i,o,r+1,s,a);o=h-1;var m=h-p;e[p++]=255&m,e[p++]=m>>8&255,e[p++]=m>>16&255,e[p++]=m>>24&255,e[o++]=0}else{e[o++]=B.BSON_DATA_CODE,o+=l=c?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0,u=n.code.toString();var f=e.write(u,o+4,"utf8")+1;e[o]=255&f,e[o+1]=f>>8&255,e[o+2]=f>>16&255,e[o+3]=f>>24&255,o=o+4+f-1,e[o++]=0}return o},A=function(e,t,n,o,i){e[o++]=B.BSON_DATA_BINARY,o+=i?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0;var r=n.value(!0),a=n.position;return n.sub_type===s.SUBTYPE_BYTE_ARRAY&&(a+=4),e[o++]=255&a,e[o++]=a>>8&255,e[o++]=a>>16&255,e[o++]=a>>24&255,e[o++]=n.sub_type,n.sub_type===s.SUBTYPE_BYTE_ARRAY&&(a-=4,e[o++]=255&a,e[o++]=a>>8&255,e[o++]=a>>16&255,e[o++]=a>>24&255),r.copy(e,o,0,n.position),o+=n.position},N=function(e,t,n,o,i){e[o++]=B.BSON_DATA_SYMBOL,o+=i?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0;var r=e.write(n.value,o+4,"utf8")+1;return e[o]=255&r,e[o+1]=r>>8&255,e[o+2]=r>>16&255,e[o+3]=r>>24&255,o=o+4+r-1,e[o++]=0,o},I=function(e,t,n,o,i,r,s){e[o++]=B.BSON_DATA_OBJECT,o+=s?e.write(t,o,"ascii"):e.write(t,o,"utf8"),e[o++]=0;var a,c=o,l=(a=null!=n.db?M(e,{$ref:n.namespace,$id:n.oid,$db:n.db},!1,o,i+1,r):M(e,{$ref:n.namespace,$id:n.oid},!1,o,i+1,r))-c;return e[c++]=255&l,e[c++]=l>>8&255,e[c++]=l>>16&255,e[c++]=l>>24&255,a},M=function(e,t,n,o,i,s,a,M){o=o||0,(M=M||[]).push(t);var B=o+4;if(Array.isArray(t))for(var R=0;R<t.length;R++){var P=""+R,D=t[R];if(D&&D.toBSON){if("function"!=typeof D.toBSON)throw new Error("toBSON is not a function");D=D.toBSON()}var L=typeof D;"string"===L?B=d(e,P,D,B,!0):"number"===L?B=h(e,P,D,B,!0):"boolean"===L?B=f(e,P,D,B,!0):D instanceof Date||p(D)?B=g(e,P,D,B,!0):void 0===D?B=m(e,P,0,B,!0):null===D?B=m(e,P,0,B,!0):"ObjectID"===D._bsontype||"ObjectId"===D._bsontype?B=x(e,P,D,B,!0):Buffer.isBuffer(D)?B=S(e,P,D,B,!0):D instanceof RegExp||u(D)?B=y(e,P,D,B,!0):"object"===L&&null==D._bsontype?B=w(e,P,D,B,n,i,s,a,!0,M):"object"===L&&"Decimal128"===D._bsontype?B=_(e,P,D,B,!0):"Long"===D._bsontype||"Timestamp"===D._bsontype?B=O(e,P,D,B,!0):"Double"===D._bsontype?B=E(e,P,D,B,!0):"function"==typeof D&&s?B=C(e,P,D,B,0,0,s):"Code"===D._bsontype?B=k(e,P,D,B,n,i,s,a,!0):"Binary"===D._bsontype?B=A(e,P,D,B,!0):"Symbol"===D._bsontype?B=N(e,P,D,B,!0):"DBRef"===D._bsontype?B=I(e,P,D,B,i,s,!0):"BSONRegExp"===D._bsontype?B=v(e,P,D,B,!0):"Int32"===D._bsontype?B=T(e,P,D,B,!0):"MinKey"!==D._bsontype&&"MaxKey"!==D._bsontype||(B=b(e,P,D,B,!0))}else if(t instanceof r)for(var j=t.entries(),z=!1;!z;){var U=j.next();if(!(z=U.done)){if(P=U.value[0],L=typeof(D=U.value[1]),"string"==typeof P&&-1===l.indexOf(P)){if(null!=P.match(c))throw Error("key "+P+" must not contain null bytes");if(n){if("$"===P[0])throw Error("key "+P+" must not start with '$'");if(~P.indexOf("."))throw Error("key "+P+" must not contain '.'")}}"string"===L?B=d(e,P,D,B):"number"===L?B=h(e,P,D,B):"boolean"===L?B=f(e,P,D,B):D instanceof Date||p(D)?B=g(e,P,D,B):null===D||void 0===D&&!1===a?B=m(e,P,0,B):"ObjectID"===D._bsontype||"ObjectId"===D._bsontype?B=x(e,P,D,B):Buffer.isBuffer(D)?B=S(e,P,D,B):D instanceof RegExp||u(D)?B=y(e,P,D,B):"object"===L&&null==D._bsontype?B=w(e,P,D,B,n,i,s,a,!1,M):"object"===L&&"Decimal128"===D._bsontype?B=_(e,P,D,B):"Long"===D._bsontype||"Timestamp"===D._bsontype?B=O(e,P,D,B):"Double"===D._bsontype?B=E(e,P,D,B):"Code"===D._bsontype?B=k(e,P,D,B,n,i,s,a):"function"==typeof D&&s?B=C(e,P,D,B,0,0,s):"Binary"===D._bsontype?B=A(e,P,D,B):"Symbol"===D._bsontype?B=N(e,P,D,B):"DBRef"===D._bsontype?B=I(e,P,D,B,i,s):"BSONRegExp"===D._bsontype?B=v(e,P,D,B):"Int32"===D._bsontype?B=T(e,P,D,B):"MinKey"!==D._bsontype&&"MaxKey"!==D._bsontype||(B=b(e,P,D,B))}}else{if(t.toBSON){if("function"!=typeof t.toBSON)throw new Error("toBSON is not a function");if(null!=(t=t.toBSON())&&"object"!=typeof t)throw new Error("toBSON function did not return an object")}for(P in t){if((D=t[P])&&D.toBSON){if("function"!=typeof D.toBSON)throw new Error("toBSON is not a function");D=D.toBSON()}if(L=typeof D,"string"==typeof P&&-1===l.indexOf(P)){if(null!=P.match(c))throw Error("key "+P+" must not contain null bytes");if(n){if("$"===P[0])throw Error("key "+P+" must not start with '$'");if(~P.indexOf("."))throw Error("key "+P+" must not contain '.'")}}"string"===L?B=d(e,P,D,B):"number"===L?B=h(e,P,D,B):"boolean"===L?B=f(e,P,D,B):D instanceof Date||p(D)?B=g(e,P,D,B):void 0===D?!1===a&&(B=m(e,P,0,B)):null===D?B=m(e,P,0,B):"ObjectID"===D._bsontype||"ObjectId"===D._bsontype?B=x(e,P,D,B):Buffer.isBuffer(D)?B=S(e,P,D,B):D instanceof RegExp||u(D)?B=y(e,P,D,B):"object"===L&&null==D._bsontype?B=w(e,P,D,B,n,i,s,a,!1,M):"object"===L&&"Decimal128"===D._bsontype?B=_(e,P,D,B):"Long"===D._bsontype||"Timestamp"===D._bsontype?B=O(e,P,D,B):"Double"===D._bsontype?B=E(e,P,D,B):"Code"===D._bsontype?B=k(e,P,D,B,n,i,s,a):"function"==typeof D&&s?B=C(e,P,D,B,0,0,s):"Binary"===D._bsontype?B=A(e,P,D,B):"Symbol"===D._bsontype?B=N(e,P,D,B):"DBRef"===D._bsontype?B=I(e,P,D,B,i,s):"BSONRegExp"===D._bsontype?B=v(e,P,D,B):"Int32"===D._bsontype?B=T(e,P,D,B):"MinKey"!==D._bsontype&&"MaxKey"!==D._bsontype||(B=b(e,P,D,B))}}M.pop(),e[B++]=0;var H=B-o;return e[o++]=255&H,e[o++]=H>>8&255,e[o++]=H>>16&255,e[o++]=H>>24&255,B},B={BSON_DATA_NUMBER:1,BSON_DATA_STRING:2,BSON_DATA_OBJECT:3,BSON_DATA_ARRAY:4,BSON_DATA_BINARY:5,BSON_DATA_UNDEFINED:6,BSON_DATA_OID:7,BSON_DATA_BOOLEAN:8,BSON_DATA_DATE:9,BSON_DATA_NULL:10,BSON_DATA_REGEXP:11,BSON_DATA_CODE:13,BSON_DATA_SYMBOL:14,BSON_DATA_CODE_W_SCOPE:15,BSON_DATA_INT:16,BSON_DATA_TIMESTAMP:17,BSON_DATA_LONG:18,BSON_DATA_DECIMAL128:19,BSON_DATA_MIN_KEY:255,BSON_DATA_MAX_KEY:127,BSON_BINARY_SUBTYPE_DEFAULT:0,BSON_BINARY_SUBTYPE_FUNCTION:1,BSON_BINARY_SUBTYPE_BYTE_ARRAY:2,BSON_BINARY_SUBTYPE_UUID:3,BSON_BINARY_SUBTYPE_MD5:4,BSON_BINARY_SUBTYPE_USER_DEFINED:128,BSON_INT32_MAX:2147483647,BSON_INT32_MIN:-2147483648};B.BSON_INT64_MAX=Math.pow(2,63)-1,B.BSON_INT64_MIN=-Math.pow(2,63),B.JS_INT_MAX=9007199254740992,B.JS_INT_MIN=-9007199254740992,e.exports=M},function(e,t){t.readIEEE754=function(e,t,n,o,i){var r,s,a="big"===n,c=8*i-o-1,l=(1<<c)-1,p=l>>1,u=-7,d=a?0:i-1,h=a?1:-1,m=e[t+d];for(d+=h,r=m&(1<<-u)-1,m>>=-u,u+=c;u>0;r=256*r+e[t+d],d+=h,u-=8);for(s=r&(1<<-u)-1,r>>=-u,u+=o;u>0;s=256*s+e[t+d],d+=h,u-=8);if(0===r)r=1-p;else{if(r===l)return s?NaN:1/0*(m?-1:1);s+=Math.pow(2,o),r-=p}return(m?-1:1)*s*Math.pow(2,r-o)},t.writeIEEE754=function(e,t,n,o,i,r){var s,a,c,l="big"===o,p=8*r-i-1,u=(1<<p)-1,d=u>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,m=l?r-1:0,f=l?-1:1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+d>=1?h/c:h*Math.pow(2,1-d))*c>=2&&(s++,c/=2),s+d>=u?(a=0,s=u):s+d>=1?(a=(t*c-1)*Math.pow(2,i),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,i),s=0));i>=8;e[n+m]=255&a,m+=f,a/=256,i-=8);for(s=s<<i|a,p+=i;p>0;e[n+m]=255&s,m+=f,s/=256,p-=8);e[n+m-f]|=128*g}},function(e,t,n){"use strict";var o=n(28).Long,i=n(40).Double,r=n(41).Timestamp,s=n(42).ObjectID,a=n(44).Symbol,c=n(43).BSONRegExp,l=n(45).Code,p=n(46),u=n(47).MinKey,d=n(48).MaxKey,h=n(49).DBRef,m=n(34).Binary,f=n(25).normalizedFunctionString,g=function(e){return"object"==typeof e&&"[object Date]"===Object.prototype.toString.call(e)},y=function(e,t,n){var o=5;if(Array.isArray(e))for(var i=0;i<e.length;i++)o+=v(i.toString(),e[i],t,!0,n);else for(var r in e.toBSON&&(e=e.toBSON()),e)o+=v(r,e[r],t,!1,n);return o};function v(e,t,n,v,x){switch(t&&t.toBSON&&(t=t.toBSON()),typeof t){case"string":return 1+Buffer.byteLength(e,"utf8")+1+4+Buffer.byteLength(t,"utf8")+1;case"number":return Math.floor(t)===t&&t>=b.JS_INT_MIN&&t<=b.JS_INT_MAX&&t>=b.BSON_INT32_MIN&&t<=b.BSON_INT32_MAX?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+5:(null!=e?Buffer.byteLength(e,"utf8")+1:0)+9;case"undefined":return v||!x?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1:0;case"boolean":return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+2;case"object":if(null==t||t instanceof u||t instanceof d||"MinKey"===t._bsontype||"MaxKey"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1;if(t instanceof s||"ObjectID"===t._bsontype||"ObjectId"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+13;if(t instanceof Date||g(t))return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+9;if("undefined"!=typeof Buffer&&Buffer.isBuffer(t))return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+6+t.length;if(t instanceof o||t instanceof i||t instanceof r||"Long"===t._bsontype||"Double"===t._bsontype||"Timestamp"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+9;if(t instanceof p||"Decimal128"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+17;if(t instanceof l||"Code"===t._bsontype)return null!=t.scope&&Object.keys(t.scope).length>0?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+4+Buffer.byteLength(t.code.toString(),"utf8")+1+y(t.scope,n,x):(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+Buffer.byteLength(t.code.toString(),"utf8")+1;if(t instanceof m||"Binary"===t._bsontype)return t.sub_type===m.SUBTYPE_BYTE_ARRAY?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+(t.position+1+4+1+4):(null!=e?Buffer.byteLength(e,"utf8")+1:0)+(t.position+1+4+1);if(t instanceof a||"Symbol"===t._bsontype)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+Buffer.byteLength(t.value,"utf8")+4+1+1;if(t instanceof h||"DBRef"===t._bsontype){var S={$ref:t.namespace,$id:t.oid};return null!=t.db&&(S.$db=t.db),(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+y(S,n,x)}return t instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(t)?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1:t instanceof c||"BSONRegExp"===t._bsontype?(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.pattern,"utf8")+1+Buffer.byteLength(t.options,"utf8")+1:(null!=e?Buffer.byteLength(e,"utf8")+1:0)+y(t,n,x)+1;case"function":if(t instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(t)||"[object RegExp]"===String.call(t))return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+Buffer.byteLength(t.source,"utf8")+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1;if(n&&null!=t.scope&&Object.keys(t.scope).length>0)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+4+Buffer.byteLength(f(t),"utf8")+1+y(t.scope,n,x);if(n)return(null!=e?Buffer.byteLength(e,"utf8")+1:0)+1+4+Buffer.byteLength(f(t),"utf8")+1}return 0}var b={BSON_INT32_MAX:2147483647,BSON_INT32_MIN:-2147483648,JS_INT_MAX:9007199254740992,JS_INT_MIN:-9007199254740992};e.exports=y},function(e,t,n){"use strict";var o=n(23),i=n(131);e.exports=function(e,t){if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected `fromDir` and `moduleId` to be a string");e=o.resolve(e);var n=o.join(e,"noop.js");try{return i._resolveFilename(t,{id:n,filename:n,paths:i._nodeModulePaths(e)})}catch(e){return null}}},function(e,t){e.exports=require("module")},function(e,t){var n;t=e.exports=K,n="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("SEMVER"),console.log.apply(console,e)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var o=256,i=Number.MAX_SAFE_INTEGER||9007199254740991,r=t.re=[],s=t.src=[],a=0,c=a++;s[c]="0|[1-9]\\d*";var l=a++;s[l]="[0-9]+";var p=a++;s[p]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var u=a++;s[u]="("+s[c]+")\\.("+s[c]+")\\.("+s[c]+")";var d=a++;s[d]="("+s[l]+")\\.("+s[l]+")\\.("+s[l]+")";var h=a++;s[h]="(?:"+s[c]+"|"+s[p]+")";var m=a++;s[m]="(?:"+s[l]+"|"+s[p]+")";var f=a++;s[f]="(?:-("+s[h]+"(?:\\."+s[h]+")*))";var g=a++;s[g]="(?:-?("+s[m]+"(?:\\."+s[m]+")*))";var y=a++;s[y]="[0-9A-Za-z-]+";var v=a++;s[v]="(?:\\+("+s[y]+"(?:\\."+s[y]+")*))";var b=a++,x="v?"+s[u]+s[f]+"?"+s[v]+"?";s[b]="^"+x+"$";var S="[v=\\s]*"+s[d]+s[g]+"?"+s[v]+"?",w=a++;s[w]="^"+S+"$";var _=a++;s[_]="((?:<|>)?=?)";var O=a++;s[O]=s[l]+"|x|X|\\*";var T=a++;s[T]=s[c]+"|x|X|\\*";var E=a++;s[E]="[v=\\s]*("+s[T]+")(?:\\.("+s[T]+")(?:\\.("+s[T]+")(?:"+s[f]+")?"+s[v]+"?)?)?";var C=a++;s[C]="[v=\\s]*("+s[O]+")(?:\\.("+s[O]+")(?:\\.("+s[O]+")(?:"+s[g]+")?"+s[v]+"?)?)?";var k=a++;s[k]="^"+s[_]+"\\s*"+s[E]+"$";var A=a++;s[A]="^"+s[_]+"\\s*"+s[C]+"$";var N=a++;s[N]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var I=a++;s[I]="(?:~>?)";var M=a++;s[M]="(\\s*)"+s[I]+"\\s+",r[M]=new RegExp(s[M],"g");var B=a++;s[B]="^"+s[I]+s[E]+"$";var R=a++;s[R]="^"+s[I]+s[C]+"$";var P=a++;s[P]="(?:\\^)";var D=a++;s[D]="(\\s*)"+s[P]+"\\s+",r[D]=new RegExp(s[D],"g");var L=a++;s[L]="^"+s[P]+s[E]+"$";var j=a++;s[j]="^"+s[P]+s[C]+"$";var z=a++;s[z]="^"+s[_]+"\\s*("+S+")$|^$";var U=a++;s[U]="^"+s[_]+"\\s*("+x+")$|^$";var H=a++;s[H]="(\\s*)"+s[_]+"\\s*("+S+"|"+s[E]+")",r[H]=new RegExp(s[H],"g");var q=a++;s[q]="^\\s*("+s[E]+")\\s+-\\s+("+s[E]+")\\s*$";var F=a++;s[F]="^\\s*("+s[C]+")\\s+-\\s+("+s[C]+")\\s*$";var $=a++;s[$]="(<|>)?=?\\s*\\*";for(var W=0;W<35;W++)n(W,s[W]),r[W]||(r[W]=new RegExp(s[W]));function V(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof K)return e;if("string"!=typeof e)return null;if(e.length>o)return null;if(!(t.loose?r[w]:r[b]).test(e))return null;try{return new K(e,t)}catch(e){return null}}function K(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof K){if(e.loose===t.loose)return e;e=e.version}else if("string"!=typeof e)throw new TypeError("Invalid Version: "+e);if(e.length>o)throw new TypeError("version is longer than "+o+" characters");if(!(this instanceof K))return new K(e,t);n("SemVer",e,t),this.options=t,this.loose=!!t.loose;var s=e.trim().match(t.loose?r[w]:r[b]);if(!s)throw new TypeError("Invalid Version: "+e);if(this.raw=e,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>i||this.major<0)throw new TypeError("Invalid major version");if(this.minor>i||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>i||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map((function(e){if(/^[0-9]+$/.test(e)){var t=+e;if(t>=0&&t<i)return t}return e})):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}t.parse=V,t.valid=function(e,t){var n=V(e,t);return n?n.version:null},t.clean=function(e,t){var n=V(e.trim().replace(/^[=v]+/,""),t);return n?n.version:null},t.SemVer=K,K.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},K.prototype.toString=function(){return this.version},K.prototype.compare=function(e){return n("SemVer.compare",this.version,this.options,e),e instanceof K||(e=new K(e,this.options)),this.compareMain(e)||this.comparePre(e)},K.prototype.compareMain=function(e){return e instanceof K||(e=new K(e,this.options)),Y(this.major,e.major)||Y(this.minor,e.minor)||Y(this.patch,e.patch)},K.prototype.comparePre=function(e){if(e instanceof K||(e=new K(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;var t=0;do{var o=this.prerelease[t],i=e.prerelease[t];if(n("prerelease compare",t,o,i),void 0===o&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===o)return-1;if(o!==i)return Y(o,i)}while(++t)},K.prototype.inc=function(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{for(var n=this.prerelease.length;--n>=0;)"number"==typeof this.prerelease[n]&&(this.prerelease[n]++,n=-2);-1===n&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error("invalid increment argument: "+e)}return this.format(),this.raw=this.version,this},t.inc=function(e,t,n,o){"string"==typeof n&&(o=n,n=void 0);try{return new K(e,n).inc(t,o).version}catch(e){return null}},t.diff=function(e,t){if(Q(e,t))return null;var n=V(e),o=V(t),i="";if(n.prerelease.length||o.prerelease.length){i="pre";var r="prerelease"}for(var s in n)if(("major"===s||"minor"===s||"patch"===s)&&n[s]!==o[s])return i+s;return r},t.compareIdentifiers=Y;var G=/^[0-9]+$/;function Y(e,t){var n=G.test(e),o=G.test(t);return n&&o&&(e=+e,t=+t),e===t?0:n&&!o?-1:o&&!n?1:e<t?-1:1}function J(e,t,n){return new K(e,n).compare(new K(t,n))}function X(e,t,n){return J(e,t,n)>0}function Z(e,t,n){return J(e,t,n)<0}function Q(e,t,n){return 0===J(e,t,n)}function ee(e,t,n){return 0!==J(e,t,n)}function te(e,t,n){return J(e,t,n)>=0}function ne(e,t,n){return J(e,t,n)<=0}function oe(e,t,n,o){switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e===n;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof n&&(n=n.version),e!==n;case"":case"=":case"==":return Q(e,n,o);case"!=":return ee(e,n,o);case">":return X(e,n,o);case">=":return te(e,n,o);case"<":return Z(e,n,o);case"<=":return ne(e,n,o);default:throw new TypeError("Invalid operator: "+t)}}function ie(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof ie){if(e.loose===!!t.loose)return e;e=e.value}if(!(this instanceof ie))return new ie(e,t);n("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===re?this.value="":this.value=this.operator+this.semver.version,n("comp",this)}t.rcompareIdentifiers=function(e,t){return Y(t,e)},t.major=function(e,t){return new K(e,t).major},t.minor=function(e,t){return new K(e,t).minor},t.patch=function(e,t){return new K(e,t).patch},t.compare=J,t.compareLoose=function(e,t){return J(e,t,!0)},t.rcompare=function(e,t,n){return J(t,e,n)},t.sort=function(e,n){return e.sort((function(e,o){return t.compare(e,o,n)}))},t.rsort=function(e,n){return e.sort((function(e,o){return t.rcompare(e,o,n)}))},t.gt=X,t.lt=Z,t.eq=Q,t.neq=ee,t.gte=te,t.lte=ne,t.cmp=oe,t.Comparator=ie;var re={};function se(e,t){if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),e instanceof se)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new se(e.raw,t);if(e instanceof ie)return new se(e.value,t);if(!(this instanceof se))return new se(e,t);if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split(/\s*\|\|\s*/).map((function(e){return this.parseRange(e.trim())}),this).filter((function(e){return e.length})),!this.set.length)throw new TypeError("Invalid SemVer Range: "+e);this.format()}function ae(e){return!e||"x"===e.toLowerCase()||"*"===e}function ce(e,t,n,o,i,r,s,a,c,l,p,u,d){return((t=ae(n)?"":ae(o)?">="+n+".0.0":ae(i)?">="+n+"."+o+".0":">="+t)+" "+(a=ae(c)?"":ae(l)?"<"+(+c+1)+".0.0":ae(p)?"<"+c+"."+(+l+1)+".0":u?"<="+c+"."+l+"."+p+"-"+u:"<="+a)).trim()}function le(e,t,o){for(var i=0;i<e.length;i++)if(!e[i].test(t))return!1;if(t.prerelease.length&&!o.includePrerelease){for(i=0;i<e.length;i++)if(n(e[i].semver),e[i].semver!==re&&e[i].semver.prerelease.length>0){var r=e[i].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0}function pe(e,t,n){try{t=new se(t,n)}catch(e){return!1}return t.test(e)}function ue(e,t,n,o){var i,r,s,a,c;switch(e=new K(e,o),t=new se(t,o),n){case">":i=X,r=ne,s=Z,a=">",c=">=";break;case"<":i=Z,r=te,s=X,a="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(pe(e,t,o))return!1;for(var l=0;l<t.set.length;++l){var p=t.set[l],u=null,d=null;if(p.forEach((function(e){e.semver===re&&(e=new ie(">=0.0.0")),u=u||e,d=d||e,i(e.semver,u.semver,o)?u=e:s(e.semver,d.semver,o)&&(d=e)})),u.operator===a||u.operator===c)return!1;if((!d.operator||d.operator===a)&&r(e,d.semver))return!1;if(d.operator===c&&s(e,d.semver))return!1}return!0}ie.prototype.parse=function(e){var t=this.options.loose?r[z]:r[U],n=e.match(t);if(!n)throw new TypeError("Invalid comparator: "+e);this.operator=n[1],"="===this.operator&&(this.operator=""),n[2]?this.semver=new K(n[2],this.options.loose):this.semver=re},ie.prototype.toString=function(){return this.value},ie.prototype.test=function(e){return n("Comparator.test",e,this.options.loose),this.semver===re||("string"==typeof e&&(e=new K(e,this.options)),oe(e,this.operator,this.semver,this.options))},ie.prototype.intersects=function(e,t){if(!(e instanceof ie))throw new TypeError("a Comparator is required");var n;if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return n=new se(e.value,t),pe(this.value,n,t);if(""===e.operator)return n=new se(this.value,t),pe(e.semver,n,t);var o=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),r=this.semver.version===e.semver.version,s=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),a=oe(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),c=oe(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return o||i||r&&s||a||c},t.Range=se,se.prototype.format=function(){return this.range=this.set.map((function(e){return e.join(" ").trim()})).join("||").trim(),this.range},se.prototype.toString=function(){return this.range},se.prototype.parseRange=function(e){var t=this.options.loose;e=e.trim();var o=t?r[F]:r[q];e=e.replace(o,ce),n("hyphen replace",e),e=e.replace(r[H],"$1$2$3"),n("comparator trim",e,r[H]),e=(e=(e=e.replace(r[M],"$1~")).replace(r[D],"$1^")).split(/\s+/).join(" ");var i=t?r[z]:r[U],s=e.split(" ").map((function(e){return function(e,t){return n("comp",e,t),e=function(e,t){return e.trim().split(/\s+/).map((function(e){return function(e,t){n("caret",e,t);var o=t.loose?r[j]:r[L];return e.replace(o,(function(t,o,i,r,s){var a;return n("caret",e,t,o,i,r,s),ae(o)?a="":ae(i)?a=">="+o+".0.0 <"+(+o+1)+".0.0":ae(r)?a="0"===o?">="+o+"."+i+".0 <"+o+"."+(+i+1)+".0":">="+o+"."+i+".0 <"+(+o+1)+".0.0":s?(n("replaceCaret pr",s),a="0"===o?"0"===i?">="+o+"."+i+"."+r+"-"+s+" <"+o+"."+i+"."+(+r+1):">="+o+"."+i+"."+r+"-"+s+" <"+o+"."+(+i+1)+".0":">="+o+"."+i+"."+r+"-"+s+" <"+(+o+1)+".0.0"):(n("no pr"),a="0"===o?"0"===i?">="+o+"."+i+"."+r+" <"+o+"."+i+"."+(+r+1):">="+o+"."+i+"."+r+" <"+o+"."+(+i+1)+".0":">="+o+"."+i+"."+r+" <"+(+o+1)+".0.0"),n("caret return",a),a}))}(e,t)})).join(" ")}(e,t),n("caret",e),e=function(e,t){return e.trim().split(/\s+/).map((function(e){return function(e,t){var o=t.loose?r[R]:r[B];return e.replace(o,(function(t,o,i,r,s){var a;return n("tilde",e,t,o,i,r,s),ae(o)?a="":ae(i)?a=">="+o+".0.0 <"+(+o+1)+".0.0":ae(r)?a=">="+o+"."+i+".0 <"+o+"."+(+i+1)+".0":s?(n("replaceTilde pr",s),a=">="+o+"."+i+"."+r+"-"+s+" <"+o+"."+(+i+1)+".0"):a=">="+o+"."+i+"."+r+" <"+o+"."+(+i+1)+".0",n("tilde return",a),a}))}(e,t)})).join(" ")}(e,t),n("tildes",e),e=function(e,t){return n("replaceXRanges",e,t),e.split(/\s+/).map((function(e){return function(e,t){e=e.trim();var o=t.loose?r[A]:r[k];return e.replace(o,(function(t,o,i,r,s,a){n("xRange",e,t,o,i,r,s,a);var c=ae(i),l=c||ae(r),p=l||ae(s);return"="===o&&p&&(o=""),c?t=">"===o||"<"===o?"<0.0.0":"*":o&&p?(l&&(r=0),s=0,">"===o?(o=">=",l?(i=+i+1,r=0,s=0):(r=+r+1,s=0)):"<="===o&&(o="<",l?i=+i+1:r=+r+1),t=o+i+"."+r+"."+s):l?t=">="+i+".0.0 <"+(+i+1)+".0.0":p&&(t=">="+i+"."+r+".0 <"+i+"."+(+r+1)+".0"),n("xRange return",t),t}))}(e,t)})).join(" ")}(e,t),n("xrange",e),e=function(e,t){return n("replaceStars",e,t),e.trim().replace(r[$],"")}(e,t),n("stars",e),e}(e,this.options)}),this).join(" ").split(/\s+/);return this.options.loose&&(s=s.filter((function(e){return!!e.match(i)}))),s=s.map((function(e){return new ie(e,this.options)}),this)},se.prototype.intersects=function(e,t){if(!(e instanceof se))throw new TypeError("a Range is required");return this.set.some((function(n){return n.every((function(n){return e.set.some((function(e){return e.every((function(e){return n.intersects(e,t)}))}))}))}))},t.toComparators=function(e,t){return new se(e,t).set.map((function(e){return e.map((function(e){return e.value})).join(" ").trim().split(" ")}))},se.prototype.test=function(e){if(!e)return!1;"string"==typeof e&&(e=new K(e,this.options));for(var t=0;t<this.set.length;t++)if(le(this.set[t],e,this.options))return!0;return!1},t.satisfies=pe,t.maxSatisfying=function(e,t,n){var o=null,i=null;try{var r=new se(t,n)}catch(e){return null}return e.forEach((function(e){r.test(e)&&(o&&-1!==i.compare(e)||(i=new K(o=e,n)))})),o},t.minSatisfying=function(e,t,n){var o=null,i=null;try{var r=new se(t,n)}catch(e){return null}return e.forEach((function(e){r.test(e)&&(o&&1!==i.compare(e)||(i=new K(o=e,n)))})),o},t.minVersion=function(e,t){e=new se(e,t);var n=new K("0.0.0");if(e.test(n))return n;if(n=new K("0.0.0-0"),e.test(n))return n;n=null;for(var o=0;o<e.set.length;++o){e.set[o].forEach((function(e){var t=new K(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":n&&!X(n,t)||(n=t);break;case"<":case"<=":break;default:throw new Error("Unexpected operation: "+e.operator)}}))}if(n&&e.test(n))return n;return null},t.validRange=function(e,t){try{return new se(e,t).range||"*"}catch(e){return null}},t.ltr=function(e,t,n){return ue(e,t,"<",n)},t.gtr=function(e,t,n){return ue(e,t,">",n)},t.outside=ue,t.prerelease=function(e,t){var n=V(e,t);return n&&n.prerelease.length?n.prerelease:null},t.intersects=function(e,t,n){return e=new se(e,n),t=new se(t,n),e.intersects(t)},t.coerce=function(e){if(e instanceof K)return e;if("string"!=typeof e)return null;var t=e.match(r[N]);if(null==t)return null;return V(t[1]+"."+(t[2]||"0")+"."+(t[3]||"0"))}},function(e,t,n){"use strict";var o=function(e,t,n){this.result=e,this.connection=t,this.message=n};o.prototype.toJSON=function(){let e=Object.assign({},this,this.result);return delete e.message,e},o.prototype.toString=function(){return JSON.stringify(this.toJSON())},e.exports=o},function(e,t,n){"use strict";const o=n(51).Msg,i=n(21).KillCursor,r=n(21).GetMore,s=n(5).calculateDurationInMs,a=new Set(["authenticate","saslStart","saslContinue","getnonce","createUser","updateUser","copydbgetnonce","copydbsaslstart","copydb"]),c=e=>Object.keys(e)[0],l=e=>e.ns,p=e=>e.ns.split(".")[0],u=e=>e.ns.split(".")[1],d=e=>`${e.options.host}:${e.options.port}`,h=(e,t)=>a.has(e)?{}:t,m={$query:"filter",$orderby:"sort",$hint:"hint",$comment:"comment",$maxScan:"maxScan",$max:"max",$min:"min",$returnKey:"returnKey",$showDiskLoc:"showRecordId",$maxTimeMS:"maxTimeMS",$snapshot:"snapshot"},f={numberToSkip:"skip",numberToReturn:"batchSize",returnFieldsSelector:"projection"},g=["tailable","oplogReplay","noCursorTimeout","awaitData","partial","exhaust"],y=e=>{if(e instanceof r)return{getMore:e.cursorId,collection:u(e),batchSize:e.numberToReturn};if(e instanceof i)return{killCursors:u(e),cursors:e.cursorIds};if(e instanceof o)return e.command;if(e.query&&e.query.$query){let t;return"admin.$cmd"===e.ns?t=Object.assign({},e.query.$query):(t={find:u(e)},Object.keys(m).forEach(n=>{void 0!==e.query[n]&&(t[m[n]]=e.query[n])})),Object.keys(f).forEach(n=>{void 0!==e[n]&&(t[f[n]]=e[n])}),g.forEach(n=>{e[n]&&(t[n]=e[n])}),void 0!==e.pre32Limit&&(t.limit=e.pre32Limit),e.query.$explain?{explain:t}:t}return e.query?e.query:e},v=(e,t)=>e instanceof r?{ok:1,cursor:{id:t.message.cursorId,ns:l(e),nextBatch:t.message.documents}}:e instanceof i?{ok:1,cursorsUnknown:e.cursorIds}:e.query&&void 0!==e.query.$query?{ok:1,cursor:{id:t.message.cursorId,ns:l(e),firstBatch:t.message.documents}}:null===t?t:t.result;e.exports={CommandStartedEvent:class{constructor(e,t){const n=y(t),o=c(n);a.has(o)&&(this.commandObj={},this.commandObj[o]=!0),Object.assign(this,{command:n,databaseName:p(t),commandName:o,requestId:t.requestId,connectionId:d(e)})}},CommandSucceededEvent:class{constructor(e,t,n,o){const i=y(t),r=c(i);Object.assign(this,{duration:s(o),commandName:r,reply:h(r,v(t,n)),requestId:t.requestId,connectionId:d(e)})}},CommandFailedEvent:class{constructor(e,t,n,o){const i=y(t),r=c(i);Object.assign(this,{duration:s(o),commandName:r,failure:h(r,n),requestId:t.requestId,connectionId:d(e)})}}}},function(e,t,n){"use strict";const o=n(66),i=n(77),r=n(83),s=n(21).Query,a=n(6).createClientInfo,c=n(3).MongoError,l=n(3).MongoNetworkError,p=n(87).defaultAuthProviders,u=n(84),d=u.MAX_SUPPORTED_WIRE_VERSION,h=u.MAX_SUPPORTED_SERVER_VERSION,m=u.MIN_SUPPORTED_WIRE_VERSION,f=u.MIN_SUPPORTED_SERVER_VERSION;let g;function y(e,t,n){const o=function(t,o){t&&e&&e.destroy(),n(t,o)};let i=[];t.compression&&t.compression.compressors&&(i=t.compression.compressors);const r=Object.assign({ismaster:!0,client:a(t),compression:i},function(e){if(!e||!e.credentials)return{};const t=e.credentials,n=t.mechanism,o=t.source||e.dbName||"admin",i=t.username||e.user;return"string"==typeof n&&"DEFAULT"!==n.toUpperCase()?{}:i?{saslSupportedMechs:`${o}.${i}`}:{}}(t)),s=(new Date).getTime();w(e,"admin.$cmd",r,t,(n,r)=>{if(n)return void o(n,null);if(0===r.ok)return void o(new c(r),null);const a=function(e,t){const n=e&&"number"==typeof e.maxWireVersion&&e.maxWireVersion>=m,o=e&&"number"==typeof e.minWireVersion&&e.minWireVersion<=d;if(n){if(o)return null;const n=`Server at ${t.host}:${t.port} reports minimum wire version ${e.minWireVersion}, but this version of the Node.js Driver requires at most ${d} (MongoDB ${h})`;return new c(n)}const i=`Server at ${t.host}:${t.port} reports maximum wire version ${e.maxWireVersion||0}, but this version of the Node.js Driver requires at least ${m} (MongoDB ${f})`;return new c(i)}(r,t);if(a)return void o(a,null);if(r.compression){const n=i.filter(e=>-1!==r.compression.indexOf(e));n.length&&(e.agreedCompressor=n[0]),t.compression&&t.compression.zlibCompressionLevel&&(e.zlibCompressionLevel=t.compression.zlibCompressionLevel)}e.ismaster=r,e.lastIsMasterMS=(new Date).getTime()-s;const l=t.credentials;if(!r.arbiterOnly&&l)return l.resolveAuthMechanism(r),void function(e,t,n){const o=t.mechanism;if(!g[o])return void n(new c(`authMechanism '${o}' not supported`));g[o].auth(w,[e],t,t=>{if(t)return n(t);n(null,e)})}(e,l,o);o(null,e)})}const v=["pfx","key","passphrase","cert","ca","ciphers","NPNProtocols","ALPNProtocols","servername","ecdhCurve","secureProtocol","secureContext","session","minDHSize","crl","rejectUnauthorized"];function b(e,t){const n="string"==typeof t.host?t.host:"localhost";return-1!==n.indexOf("/")?{path:n}:{family:e,host:n,port:"number"==typeof t.port?t.port:27017,rejectUnauthorized:!1}}function x(e,t,n){const r="boolean"==typeof t.ssl&&t.ssl,s="boolean"!=typeof t.keepAlive||t.keepAlive;let a="number"==typeof t.keepAliveInitialDelay?t.keepAliveInitialDelay:3e5;const c="boolean"!=typeof t.noDelay||t.noDelay,p="number"==typeof t.connectionTimeout?t.connectionTimeout:3e4,u="number"==typeof t.socketTimeout?t.socketTimeout:36e4,d="boolean"!=typeof t.rejectUnauthorized||t.rejectUnauthorized;let h;a>u&&(a=Math.round(u/2));const m=function(e,t){e&&h&&h.destroy(),n(e,t)};try{r?"function"==typeof(h=i.connect(function(e,t){const n=b(e,t);for(const e in t)null!=t[e]&&-1!==v.indexOf(e)&&(n[e]=t[e]);return!1===t.checkServerIdentity?n.checkServerIdentity=function(){}:"function"==typeof t.checkServerIdentity&&(n.checkServerIdentity=t.checkServerIdentity),null==n.servername&&(n.servername=n.host),n}(e,t))).disableRenegotiation&&h.disableRenegotiation():h=o.createConnection(b(e,t))}catch(e){return m(e)}h.setKeepAlive(s,a),h.setTimeout(p),h.setNoDelay(c);const f=["error","close","timeout","parseError"];function g(e){return t=>{f.forEach(e=>h.removeAllListeners(e)),h.removeListener("connect",y),m(function(e,t){switch(e){case"error":return new l(t);case"timeout":return new l("connection timed out");case"close":return new l("connection closed");default:return new l("unknown network error")}}(e,t),e)}}function y(){if(f.forEach(e=>h.removeAllListeners(e)),h.authorizationError&&d)return m(h.authorizationError);h.setTimeout(u),m(null,h)}h.once("error",g("error")),h.once("close",g("close")),h.once("timeout",g("timeout")),h.once("parseError",g("parseError")),h.once("connect",y)}const S=["error","close","timeout","parseError"];function w(e,t,n,o,i){"function"==typeof o&&(i=o,o={});const r="number"==typeof o.socketTimeout?o.socketTimeout:36e4,a=e.options.bson,c=new s(a,t,n,{numberToSkip:0,numberToReturn:1});function l(t){e.resetSocketTimeout(),S.forEach(t=>e.removeListener(t,l)),e.removeListener("message",p),i(t,null)}function p(t){t.responseTo===c.requestId&&(e.resetSocketTimeout(),S.forEach(t=>e.removeListener(t,l)),e.removeListener("message",p),t.parse({promoteValues:!0}),i(null,t.documents[0]))}e.setSocketTimeout(r),S.forEach(t=>e.once(t,l)),e.on("message",p),e.write(c.toBin())}e.exports=function(e,t){if(null==g&&(g=p(e.bson)),void 0===e.family)return x(6,e,(n,o)=>{n?x(4,e,(n,o)=>{n?t(n,o):y(new r(o,e),e,t)}):y(new r(o,e),e,t)});x(e.family,e,(n,o)=>{n?t(n,o):y(new r(o,e),e,t)})}},function(e,t,n){"use strict";const o=n(29).AuthProvider,i=n(5).retrieveKerberos;let r;e.exports=class extends o{_authenticateSingleConnection(e,t,n,o){const i=n.username,s=n.password,a=n.mechanismProperties,c=a.gssapiservicename||a.gssapiServiceName||"mongodb";!function(e,t,n,o,i,r,s,a,c){const l=new t(s.host,s.port,i,a);function p(e,t){r(s,"$external.$cmd",e,t)}l.init(n,o,e=>{if(e)return c(e,!1);l.transition("",(e,t)=>{if(e)return c(e,!1);p({saslStart:1,mechanism:"GSSAPI",payload:t,autoAuthorize:1},(e,t)=>{if(e)return c(e,!1);l.transition(t.payload,(e,n)=>{if(e)return c(e,!1);p({saslContinue:1,conversationId:t.conversationId,payload:n},(e,t)=>{if(e)return c(e,!1);l.transition(t.payload,(e,n)=>{if(e)return c(e,!1);p({saslContinue:1,conversationId:t.conversationId,payload:n},(e,t)=>{if(e)return c(e,!1);l.transition(null,e=>{if(e)return c(e,null);c(null,t)})})})})})})})})}(0,r.processes.MongoAuthProcess,i,s,c,e,t,a,o)}auth(e,t,n,o){if(null==r)try{r=i()}catch(e){return o(e,null)}super.auth(e,t,n,o)}}},function(e,t,n){"use strict";const{unassigned_code_points:o,commonly_mapped_to_nothing:i,non_ASCII_space_characters:r,prohibited_characters:s,bidirectional_r_al:a,bidirectional_l:c}=n(138);e.exports=function(e,t={}){if("string"!=typeof e)throw new TypeError("Expected string.");if(0===e.length)return"";const n=m(e).map(e=>l.get(e)?32:e).filter(e=>!p.get(e)),i=String.fromCodePoint.apply(null,n).normalize("NFKC"),r=m(i);if(r.some(e=>s.get(e)))throw new Error("Prohibited character, see https://tools.ietf.org/html/rfc4013#section-2.3");if(!0!==t.allowUnassigned){if(r.some(e=>o.get(e)))throw new Error("Unassigned code point, see https://tools.ietf.org/html/rfc4013#section-2.5")}const f=r.some(e=>a.get(e)),g=r.some(e=>c.get(e));if(f&&g)throw new Error("String must not contain RandALCat and LCat at the same time, see https://tools.ietf.org/html/rfc3454#section-6");const y=a.get(u(d(i))),v=a.get(u(h(i)));if(f&&(!y||!v))throw new Error("Bidirectional RandALCat character must be the first and the last character of the string, see https://tools.ietf.org/html/rfc3454#section-6");return i};const l=r,p=i,u=e=>e.codePointAt(0),d=e=>e[0],h=e=>e[e.length-1];function m(e){const t=[],n=e.length;for(let o=0;o<n;o+=1){const i=e.charCodeAt(o);if(i>=55296&&i<=56319&&n>o+1){const n=e.charCodeAt(o+1);if(n>=56320&&n<=57343){t.push(1024*(i-55296)+n-56320+65536),o+=1;continue}}t.push(i)}return t}},function(e,t,n){"use strict";(function(t){const o=n(20),i=n(23),r=n(139),s=o.readFileSync(i.resolve(t,"../code-points.mem"));let a=0;function c(){const e=s.readUInt32BE(a);a+=4;const t=s.slice(a,a+e);return a+=e,r({buffer:t})}const l=c(),p=c(),u=c(),d=c(),h=c(),m=c();e.exports={unassigned_code_points:l,commonly_mapped_to_nothing:p,non_ASCII_space_characters:u,prohibited_characters:d,bidirectional_r_al:h,bidirectional_l:m}}).call(this,"/")},function(e,t,n){var o=n(140);function i(e){if(!(this instanceof i))return new i(e);if(e||(e={}),Buffer.isBuffer(e)&&(e={buffer:e}),this.pageOffset=e.pageOffset||0,this.pageSize=e.pageSize||1024,this.pages=e.pages||o(this.pageSize),this.byteLength=this.pages.length*this.pageSize,this.length=8*this.byteLength,(t=this.pageSize)&t-1)throw new Error("The page size should be a power of two");var t;if(this._trackUpdates=!!e.trackUpdates,this._pageMask=this.pageSize-1,e.buffer){for(var n=0;n<e.buffer.length;n+=this.pageSize)this.pages.set(n/this.pageSize,e.buffer.slice(n,n+this.pageSize));this.byteLength=e.buffer.length,this.length=8*this.byteLength}}e.exports=i,i.prototype.get=function(e){var t=7&e,n=(e-t)/8;return!!(this.getByte(n)&128>>t)},i.prototype.getByte=function(e){var t=e&this._pageMask,n=(e-t)/this.pageSize,o=this.pages.get(n,!0);return o?o.buffer[t+this.pageOffset]:0},i.prototype.set=function(e,t){var n=7&e,o=(e-n)/8,i=this.getByte(o);return this.setByte(o,t?i|128>>n:i&(255^128>>n))},i.prototype.toBuffer=function(){for(var e=function(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t}(this.pages.length*this.pageSize),t=0;t<this.pages.length;t++){var n=this.pages.get(t,!0),o=t*this.pageSize;n&&n.buffer.copy(e,o,this.pageOffset,this.pageOffset+this.pageSize)}return e},i.prototype.setByte=function(e,t){var n=e&this._pageMask,o=(e-n)/this.pageSize,i=this.pages.get(o,!1);return n+=this.pageOffset,i.buffer[n]!==t&&(i.buffer[n]=t,e>=this.byteLength&&(this.byteLength=e+1,this.length=8*this.byteLength),this._trackUpdates&&this.pages.updated(i),!0)}},function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);this.length=0,this.updates=[],this.path=new Uint16Array(4),this.pages=new Array(32768),this.maxPages=this.pages.length,this.level=0,this.pageSize=e||1024,this.deduplicate=t?t.deduplicate:null,this.zeros=this.deduplicate?o(this.deduplicate.length):null}function o(e){if(Buffer.alloc)return Buffer.alloc(e);var t=new Buffer(e);return t.fill(0),t}function i(e,t){this.offset=e*t.length,this.buffer=t,this.updated=!1,this.deduplicate=0}e.exports=n,n.prototype.updated=function(e){for(;this.deduplicate&&e.buffer[e.deduplicate]===this.deduplicate[e.deduplicate];)if(e.deduplicate++,e.deduplicate===this.deduplicate.length){e.deduplicate=0,e.buffer.equals&&e.buffer.equals(this.deduplicate)&&(e.buffer=this.deduplicate);break}!e.updated&&this.updates&&(e.updated=!0,this.updates.push(e))},n.prototype.lastUpdate=function(){if(!this.updates||!this.updates.length)return null;var e=this.updates.pop();return e.updated=!1,e},n.prototype._array=function(e,t){if(e>=this.maxPages){if(t)return;!function(e,t){for(;e.maxPages<t;){var n=e.pages;e.pages=new Array(32768),e.pages[0]=n,e.level++,e.maxPages*=32768}}(this,e)}var n,o;n=e,o=this.path,n=((n=(n-(o[0]=32767&n))/32768)-(o[1]=32767&n))/32768,o[3]=(n-(o[2]=32767&n))/32768&32767;for(var i=this.pages,r=this.level;r>0;r--){var s=this.path[r],a=i[s];if(!a){if(t)return;a=i[s]=new Array(32768)}i=a}return i},n.prototype.get=function(e,t){var n,r,s=this._array(e,t),a=this.path[0],c=s&&s[a];return c||t||(c=s[a]=new i(e,o(this.pageSize)),e>=this.length&&(this.length=e+1)),c&&c.buffer===this.deduplicate&&this.deduplicate&&!t&&(c.buffer=(n=c.buffer,r=Buffer.allocUnsafe?Buffer.allocUnsafe(n.length):new Buffer(n.length),n.copy(r),r),c.deduplicate=0),c},n.prototype.set=function(e,t){var n=this._array(e,!1),r=this.path[0];if(e>=this.length&&(this.length=e+1),!t||this.zeros&&t.equals&&t.equals(this.zeros))n[r]=void 0;else{this.deduplicate&&t.equals&&t.equals(this.deduplicate)&&(t=this.deduplicate);var s=n[r],a=function(e,t){if(e.length===t)return e;if(e.length>t)return e.slice(0,t);var n=o(t);return e.copy(n),n}(t,this.pageSize);s?s.buffer=a:n[r]=new i(e,a)}},n.prototype.toBuffer=function(){for(var e=new Array(this.length),t=o(this.pageSize),n=0;n<e.length;)for(var i=this._array(n,!0),r=0;r<32768&&n<e.length;r++)e[n++]=i&&i[r]?i[r].buffer:t;return Buffer.concat(e)}},function(e,t,n){"use strict";const o=n(3).MongoError,i=n(7).collectionNamespace,r=n(37);e.exports=function(e,t,n,s,a,c,l){if(0===a.length)throw new o(`${t} must contain at least one document`);"function"==typeof c&&(l=c,c={});const p="boolean"!=typeof(c=c||{}).ordered||c.ordered,u=c.writeConcern,d={};if(d[t]=i(s),d[n]=a,d.ordered=p,u&&Object.keys(u).length>0&&(d.writeConcern=u),c.collation)for(let e=0;e<d[n].length;e++)d[n][e].collation||(d[n][e].collation=c.collation);!0===c.bypassDocumentValidation&&(d.bypassDocumentValidation=c.bypassDocumentValidation);const h=Object.assign({checkKeys:"insert"===t,numberToReturn:1},c);r(e,s,d,h,l)}},function(e,t,n){"use strict";const o=n(21).KillCursor,i=n(3).MongoError,r=n(3).MongoNetworkError,s=n(7).collectionNamespace,a=n(5).maxWireVersion,c=n(37);e.exports=function(e,t,n,l){l="function"==typeof l?l:()=>{};const p=n.cursorId;if(a(e)<4){const i=e.s.bson,r=e.s.pool,s=new o(i,t,[p]),a={immediateRelease:!0,noResponse:!0};if("object"==typeof n.session&&(a.session=n.session),r&&r.isConnected())try{r.write(s,a,l)}catch(e){"function"==typeof l?l(e,null):console.warn(e)}return}const u={killCursors:s(t),cursors:[p]},d={};"object"==typeof n.session&&(d.session=n.session),c(e,t,u,d,(e,t)=>{if(e)return l(e);const n=t.message;return n.cursorNotFound?l(new r("cursor killed or timed out"),null):Array.isArray(n.documents)&&0!==n.documents.length?void l(null,n.documents[0]):l(new i(`invalid killCursors result returned for cursor id ${p}`))})}},function(e,t,n){"use strict";const o=n(21).GetMore,i=n(12).retrieveBSON,r=n(3).MongoError,s=n(3).MongoNetworkError,a=i().Long,c=n(7).collectionNamespace,l=n(5).maxWireVersion,p=n(7).applyCommonQueryOptions,u=n(37);e.exports=function(e,t,n,i,d,h){d=d||{};const m=l(e);function f(e,t){if(e)return h(e);const o=t.message;if(o.cursorNotFound)return h(new s("cursor killed or timed out"),null);if(m<4){const e="number"==typeof o.cursorId?a.fromNumber(o.cursorId):o.cursorId;return n.documents=o.documents,n.cursorId=e,void h(null,null,o.connection)}if(0===o.documents[0].ok)return h(new r(o.documents[0]));const i="number"==typeof o.documents[0].cursor.id?a.fromNumber(o.documents[0].cursor.id):o.documents[0].cursor.id;n.documents=o.documents[0].cursor.nextBatch,n.cursorId=i,h(null,o.documents[0],o.connection)}if(m<4){const r=e.s.bson,s=new o(r,t,n.cursorId,{numberToReturn:i}),a=p({},n);return void e.s.pool.write(s,a,f)}const g={getMore:n.cursorId,collection:c(t),batchSize:Math.abs(i)};n.cmd.tailable&&"number"==typeof n.cmd.maxAwaitTimeMS&&(g.maxTimeMS=n.cmd.maxAwaitTimeMS);const y=Object.assign({returnFieldSelector:null,documentsReturnedIn:"nextBatch"},d);n.session&&(y.session=n.session),u(e,t,g,y,f)}},function(e,t,n){"use strict";const o=n(21).Query,i=n(3).MongoError,r=n(7).getReadPreference,s=n(7).collectionNamespace,a=n(7).isSharded,c=n(5).maxWireVersion,l=n(7).applyCommonQueryOptions,p=n(37);e.exports=function(e,t,n,u,d,h){if(d=d||{},null!=u.cursorId)return h();if(null==n)return h(new i(`command ${JSON.stringify(n)} does not return a cursor`));if(c(e)<4){const s=function(e,t,n,s,c){c=c||{};const l=e.s.bson,p=r(n,c);s.batchSize=n.batchSize||s.batchSize;let u=0;u=s.limit<0||0!==s.limit&&s.limit<s.batchSize||s.limit>0&&0===s.batchSize?s.limit:s.batchSize;const d=s.skip||0,h={};a(e)&&p&&(h.$readPreference=p.toJSON());n.sort&&(h.$orderby=n.sort);n.hint&&(h.$hint=n.hint);n.snapshot&&(h.$snapshot=n.snapshot);void 0!==n.returnKey&&(h.$returnKey=n.returnKey);n.maxScan&&(h.$maxScan=n.maxScan);n.min&&(h.$min=n.min);n.max&&(h.$max=n.max);void 0!==n.showDiskLoc&&(h.$showDiskLoc=n.showDiskLoc);n.comment&&(h.$comment=n.comment);n.maxTimeMS&&(h.$maxTimeMS=n.maxTimeMS);n.explain&&(u=-Math.abs(n.limit||0),h.$explain=!0);if(h.$query=n.query,n.readConcern&&"local"!==n.readConcern.level)throw new i(`server find command does not support a readConcern level of ${n.readConcern.level}`);n.readConcern&&delete(n=Object.assign({},n)).readConcern;const m="boolean"==typeof c.serializeFunctions&&c.serializeFunctions,f="boolean"==typeof c.ignoreUndefined&&c.ignoreUndefined,g=new o(l,t,h,{numberToSkip:d,numberToReturn:u,pre32Limit:void 0!==n.limit?n.limit:void 0,checkKeys:!1,returnFieldSelector:n.fields,serializeFunctions:m,ignoreUndefined:f});"boolean"==typeof n.tailable&&(g.tailable=n.tailable);"boolean"==typeof n.oplogReplay&&(g.oplogReplay=n.oplogReplay);"boolean"==typeof n.noCursorTimeout&&(g.noCursorTimeout=n.noCursorTimeout);"boolean"==typeof n.awaitData&&(g.awaitData=n.awaitData);"boolean"==typeof n.partial&&(g.partial=n.partial);return g.slaveOk=p.slaveOk(),g}(e,t,n,u,d),c=l({},u);return"string"==typeof s.documentsReturnedIn&&(c.documentsReturnedIn=s.documentsReturnedIn),void e.s.pool.write(s,c,h)}const m=r(n,d),f=function(e,t,n,o){o.batchSize=n.batchSize||o.batchSize;let i={find:s(t)};n.query&&(n.query.$query?i.filter=n.query.$query:i.filter=n.query);let r=n.sort;if(Array.isArray(r)){const e={};if(r.length>0&&!Array.isArray(r[0])){let t=r[1];"asc"===t?t=1:"desc"===t&&(t=-1),e[r[0]]=t}else for(let t=0;t<r.length;t++){let n=r[t][1];"asc"===n?n=1:"desc"===n&&(n=-1),e[r[t][0]]=n}r=e}n.sort&&(i.sort=r);n.fields&&(i.projection=n.fields);n.hint&&(i.hint=n.hint);n.skip&&(i.skip=n.skip);n.limit&&(i.limit=n.limit);n.limit<0&&(i.limit=Math.abs(n.limit),i.singleBatch=!0);"number"==typeof n.batchSize&&(n.batchSize<0&&(0!==n.limit&&Math.abs(n.batchSize)<Math.abs(n.limit)&&(i.limit=Math.abs(n.batchSize)),i.singleBatch=!0),i.batchSize=Math.abs(n.batchSize));n.comment&&(i.comment=n.comment);n.maxScan&&(i.maxScan=n.maxScan);n.maxTimeMS&&(i.maxTimeMS=n.maxTimeMS);n.min&&(i.min=n.min);n.max&&(i.max=n.max);i.returnKey=!!n.returnKey&&n.returnKey,i.showRecordId=!!n.showDiskLoc&&n.showDiskLoc,n.snapshot&&(i.snapshot=n.snapshot);n.tailable&&(i.tailable=n.tailable);n.oplogReplay&&(i.oplogReplay=n.oplogReplay);n.noCursorTimeout&&(i.noCursorTimeout=n.noCursorTimeout);n.awaitData&&(i.awaitData=n.awaitData);n.awaitdata&&(i.awaitData=n.awaitdata);n.partial&&(i.partial=n.partial);n.collation&&(i.collation=n.collation);n.readConcern&&(i.readConcern=n.readConcern);n.explain&&(i={explain:i});return i}(0,t,n,u);n.virtual=!1;const g=Object.assign({documentsReturnedIn:"firstBatch",numberToReturn:1,slaveOk:m.slaveOk()},d);n.readPreference&&(g.readPreference=m),u.session&&(g.session=u.session),p(e,t,f,g,h)}},function(e,t,n){"use strict";const o=n(4).inherits,i=n(4).format,r=n(9).EventEmitter,s=n(11),a=n(13).CoreCursor,c=n(12).retrieveBSON,l=n(18),p=n(3).MongoError,u=n(71),d=n(146),h=n(6).clone,m=n(6).Timeout,f=n(6).Interval,g=n(6).createClientInfo,y=n(6).SessionMixins,v=n(6).isRetryableWritesSupported,b=n(5).relayEvents,x=n(3).isRetryableError,S=c(),w=n(5).calculateDurationInMs,_=n(6).getMMAPError;var O="disconnected",T="connecting",E="connected",C="unreferenced",k="destroyed";function A(e,t){var n={disconnected:[T,k,O],connecting:[T,k,E,O],connected:[E,O,k,C],unreferenced:[C,k],destroyed:[k]}[e.state];n&&-1!==n.indexOf(t)?e.state=t:e.s.logger.error(i("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,n))}var N=1,I=["connect","close","error","timeout","parseError"],M=function(e,t){var n=this;if(t=t||{},!Array.isArray(e))throw new p("seedlist must be an array");if(0===e.length)throw new p("seedlist must contain at least one entry");e.forEach((function(e){if("string"!=typeof e.host||"number"!=typeof e.port)throw new p("seedlist entry must contain a host and port")})),r.call(this),this.id=N++;var o=t.localThresholdMS||15;t.acceptableLatency&&(o=t.acceptableLatency);var s=l("ReplSet",t);this.s={options:Object.assign({},t),bson:t.bson||new S([S.Binary,S.Code,S.DBRef,S.Decimal128,S.Double,S.Int32,S.Long,S.Map,S.MaxKey,S.MinKey,S.ObjectId,S.BSONRegExp,S.Symbol,S.Timestamp]),Cursor:t.cursorFactory||a,logger:s,seedlist:e,replicaSetState:new d({id:this.id,setName:t.setName,acceptableLatency:o,heartbeatFrequencyMS:t.haInterval?t.haInterval:1e4,logger:s}),connectingServers:[],haInterval:t.haInterval?t.haInterval:1e4,minHeartbeatFrequencyMS:500,disconnectHandler:t.disconnectHandler,index:0,connectOptions:{},debug:"boolean"==typeof t.debug&&t.debug,clientInfo:g(t)},this.s.replicaSetState.on("topologyDescriptionChanged",(function(e){n.emit("topologyDescriptionChanged",e)})),this.s.logger.isWarn()&&0!==this.s.options.socketTimeout&&this.s.options.socketTimeout<this.s.haInterval&&this.s.logger.warn(i("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval));["joined","left"].forEach((function(e){n.s.replicaSetState.on(e,(function(t,o){n.emit(e,t,o)}))})),this.initialConnectState={connect:!1,fullsetup:!1,all:!1},this.state=O,this.haTimeoutId=null,this.ismaster=null,this.intervalIds=[],this.clusterTime=null};function B(e){e.s.replicaSetState.hasPrimaryAndSecondary()&&e.s.disconnectHandler?e.s.disconnectHandler.execute():e.s.replicaSetState.hasPrimary()&&e.s.disconnectHandler?e.s.disconnectHandler.execute({executePrimary:!0}):e.s.replicaSetState.hasSecondary()&&e.s.disconnectHandler&&e.s.disconnectHandler.execute({executeSecondary:!0})}function R(e,t,n){var o=t.length,i=null,r=function(e,t){return function(r){if(o-=1,e.state===k||e.state===C)return this.destroy({force:!0});if("connect"===t){if(e.state===k||e.state===C)return this.destroy({force:!0});if(e.s.replicaSetState.update(this)){this.lastIsMaster()&&this.lastIsMaster().ismaster&&(e.ismaster=this.lastIsMaster());for(let e=0;e<I.length;e++)this.removeAllListeners(I[e]);this.on("error",j(e,"error")),this.on("close",j(e,"close")),this.on("timeout",j(e,"timeout")),this.on("parseError",j(e,"parseError")),P(this.lastIsMaster().me,e,{}),B(e)}else this.destroy({force:!0})}else"error"===t&&(i=r);B(e),0===o&&n(i)}};if(0===o)return n();function s(t,n){setTimeout((function(){if(e.state!==k&&e.state!==C){var n=new u(Object.assign({},e.s.options,{host:t.split(":")[0],port:parseInt(t.split(":")[1],10),reconnect:!1,monitoring:!1,parent:e,clientInfo:h(e.s.clientInfo)}));n.once("connect",r(e,"connect")),n.once("close",r(e,"close")),n.once("timeout",r(e,"timeout")),n.once("error",r(e,"error")),n.once("parseError",r(e,"parseError")),n.on("serverOpening",t=>e.emit("serverOpening",t)),n.on("serverDescriptionChanged",t=>e.emit("serverDescriptionChanged",t)),n.on("serverClosed",t=>e.emit("serverClosed",t)),b(n,e,["commandStarted","commandSucceeded","commandFailed"]),n.connect(e.s.connectOptions)}}),n)}for(var a=0;a<t.length;a++)s(t[a],a)}o(M,r),Object.assign(M.prototype,y),Object.defineProperty(M.prototype,"type",{enumerable:!0,get:function(){return"replset"}}),Object.defineProperty(M.prototype,"parserType",{enumerable:!0,get:function(){return S.native?"c++":"js"}}),Object.defineProperty(M.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.s.replicaSetState.logicalSessionTimeoutMinutes||null}});var P=function(e,t,n){if(!n.haInterval)for(var o=0;o<t.intervalIds.length;o++)if(t.intervalIds[o].__host===e)return;var i=n.haInterval?m:f,r=n.haInterval?n.haInterval:t.s.haInterval,s=new i((function(){if(t.state!==k&&t.state!==C){var n=t.s.replicaSetState.get(e);return n?function(e,t,n){var o=(new Date).getTime();U(e,"serverHeartbeatStarted",{connectionId:t.name}),t.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:e.s.options.connectionTimeout||2e3},(function(i,r){if(e.state===k||e.state===C)return t.destroy({force:!0}),n(i,r);var s=(new Date).getTime()-o,a=process.hrtime();t.lastUpdateTime=(1e9*a[0]+a[1])/1e6,i?(U(e,"serverHeartbeatFailed",{durationMS:s,failure:i,connectionId:t.name}),e.s.replicaSetState.remove(t)):(t.ismaster=r.result,t.ismaster.lastWrite&&t.ismaster.lastWrite.lastWriteDate&&(t.lastWriteDate=t.ismaster.lastWrite.lastWriteDate.getTime()),-1===t.lastIsMasterMS?t.lastIsMasterMS=s:t.lastIsMasterMS&&(t.lastIsMasterMS=.2*s+.8*t.lastIsMasterMS),e.s.replicaSetState.update(t)&&t.lastIsMaster()&&t.lastIsMaster().ismaster&&(e.ismaster=t.lastIsMaster()),U(e,"serverHeartbeatSucceeded",{durationMS:s,reply:r.result,connectionId:t.name})),e.s.replicaSetState.updateServerMaxStaleness(t,e.s.haInterval),n(i,r)}))}(t,n,(function(e){e||(t.state!==k&&t.state!==C?(t.intervalIds=t.intervalIds.filter((function(e){return e.isRunning()})),i===m?t.state===T&&(t.s.replicaSetState.hasSecondary()&&t.s.options.secondaryOnlyConnectionAllowed||t.s.replicaSetState.hasPrimary())&&(t.state=E,process.nextTick((function(){t.emit("connect",t)})),D(t,{})):t.state===O&&(t.s.replicaSetState.hasSecondary()&&t.s.options.secondaryOnlyConnectionAllowed||t.s.replicaSetState.hasPrimary())&&(t.state=E,B(t),process.nextTick((function(){t.emit("reconnect",t)}))),t.initialConnectState.connect&&!t.initialConnectState.fullsetup&&t.s.replicaSetState.hasPrimaryAndSecondary()&&(t.initialConnectState.fullsetup=!0,t.initialConnectState.all=!0,process.nextTick((function(){t.emit("fullsetup",t),t.emit("all",t)})))):s.stop())})):void 0}s.stop()}),r);s.start(),s.__host=e,t.intervalIds.push(s)};function D(e,t){if(e.state!==k&&e.state!==C){t=t||{};var n=Object.keys(e.s.replicaSetState.set),o=t.haInterval?m:f,i=t.haInterval?t.haInterval:e.s.haInterval;if(o===m)return R(e,e.s.replicaSetState.unknownServers,(function(o){if(e.state!==k&&e.state!==C){if(!e.s.replicaSetState.hasPrimary()&&!e.s.options.secondaryOnlyConnectionAllowed)return o?e.emit("error",o):(e.emit("error",new p("no primary found in replicaset or invalid replica set name")),e.destroy({force:!0}));if(!e.s.replicaSetState.hasSecondary()&&e.s.options.secondaryOnlyConnectionAllowed)return o?e.emit("error",o):(e.emit("error",new p("no secondary found in replicaset or invalid replica set name")),e.destroy({force:!0}));for(var i=0;i<n.length;i++)P(n[i],e,t)}}));for(var r=0;r<n.length;r++)P(n[r],e,t);var s=e.s.replicaSetState.hasPrimary()?i:e.s.minHeartbeatFrequencyMS;e.intervalIds.push(new m(function e(t){return function(){t.state!==k&&t.state!==C&&R(t,t.s.replicaSetState.unknownServers,(function(){var n=t.s.replicaSetState.hasPrimary()?i:t.s.minHeartbeatFrequencyMS;t.intervalIds.push(new m(e(t),n).start())}))}}(e),s).start())}}function L(e,t){for(var n=0;n<e.length;n++)if(e[n].name.toLowerCase()===t.name.toLowerCase())return!0;e.push(t)}function j(e,t){return function(){e.state!==k&&e.state!==C&&(e.s.logger.isDebug()&&e.s.logger.debug(i("handleEvent %s from server %s in replset with id %s",t,this.name,e.id)),e.s.replicaSetState.remove(this),e.state!==k&&e.state!==C&&((e.s.replicaSetState.hasPrimary()||e.s.replicaSetState.hasSecondary()||!e.s.options.secondaryOnlyConnectionAllowed)&&e.s.replicaSetState.hasPrimary()||A(e,O),L(e.s.connectingServers,this)))}}function z(e,t){return function(){if(e.s.logger.isDebug()&&e.s.logger.debug(i("handleInitialConnectEvent %s from server %s in replset with id %s",t,this.name,e.id)),e.state===k||e.state===C)return this.destroy({force:!0});if("connect"===t){var n=e.s.replicaSetState.update(this);if(!0===n){this.lastIsMaster()&&this.lastIsMaster().ismaster&&(e.ismaster=this.lastIsMaster()),e.s.logger.isDebug()&&e.s.logger.debug(i("handleInitialConnectEvent %s from server %s in replset with id %s has state [%s]",t,this.name,e.id,JSON.stringify(e.s.replicaSetState.set)));for(let e=0;e<I.length;e++)this.removeAllListeners(I[e]);this.on("error",j(e,"error")),this.on("close",j(e,"close")),this.on("timeout",j(e,"timeout")),this.on("parseError",j(e,"parseError")),function(e){const t=e.state===T,n=e.s.replicaSetState.hasPrimary(),o=e.s.replicaSetState.hasSecondary(),i=e.s.options.secondaryOnlyConnectionAllowed,r=e.s.connectOptions.readPreference&&e.s.connectOptions.readPreference.equals(s.secondary);return t&&(r&&o||!r&&n)||o&&i}(e)&&(e.state=E,e.initialConnectState.connect=!0,process.nextTick((function(){e.emit("connect",e)})),D(e,{}))}else{if(n instanceof p)return this.destroy({force:!0}),e.destroy({force:!0}),e.emit("error",n);this.destroy({force:!0})}}else e.emit("failed",this),L(e.s.connectingServers,this),e.s.replicaSetState.remove(this);e.initialConnectState.connect&&!e.initialConnectState.fullsetup&&e.s.replicaSetState.hasPrimaryAndSecondary()&&(e.initialConnectState.fullsetup=!0,e.initialConnectState.all=!0,process.nextTick((function(){e.emit("fullsetup",e),e.emit("all",e)})));for(var o=0;o<e.s.connectingServers.length;o++)e.s.connectingServers[o].equals(this)&&e.s.connectingServers.splice(o,1);0===e.s.connectingServers.length&&e.state===T&&D(e,{haInterval:1})}}function U(e,t,n){e.listeners(t).length>0&&e.emit(t,n)}M.prototype.connect=function(e){var t=this;this.s.connectOptions=e||{},A(this,T);var n=this.s.seedlist.map((function(n){return new u(Object.assign({},t.s.options,n,e,{reconnect:!1,monitoring:!1,parent:t,clientInfo:h(t.s.clientInfo)}))}));if(this.s.options.socketTimeout>0&&this.s.options.socketTimeout<=this.s.options.haInterval)return t.emit("error",new p(i("haInterval [%s] MS must be set to less than socketTimeout [%s] MS",this.s.options.haInterval,this.s.options.socketTimeout)));U(this,"topologyOpening",{topologyId:this.id}),function(e,t){e.s.connectingServers=e.s.connectingServers.concat(t);var n=0;function o(t,n){setTimeout((function(){e.s.replicaSetState.update(t)&&t.lastIsMaster()&&t.lastIsMaster().ismaster&&(e.ismaster=t.lastIsMaster()),t.once("close",z(e,"close")),t.once("timeout",z(e,"timeout")),t.once("parseError",z(e,"parseError")),t.once("error",z(e,"error")),t.once("connect",z(e,"connect")),t.on("serverOpening",t=>e.emit("serverOpening",t)),t.on("serverDescriptionChanged",t=>e.emit("serverDescriptionChanged",t)),t.on("serverClosed",t=>e.emit("serverClosed",t)),b(t,e,["commandStarted","commandSucceeded","commandFailed"]),t.connect(e.s.connectOptions)}),n)}for(;t.length>0;)o(t.shift(),n++)}(t,n)},M.prototype.auth=function(e,t){"function"==typeof t&&t(null,null)},M.prototype.destroy=function(e,t){e=e||{};let n=this.s.connectingServers.length+1;const o=()=>{--n>0||(U(this,"topologyClosed",{topologyId:this.id}),A(this,k),"function"==typeof t&&t(null,null))};this.haTimeoutId&&clearTimeout(this.haTimeoutId);for(var i=0;i<this.intervalIds.length;i++)this.intervalIds[i].stop();this.intervalIds=[],0!==n?(this.s.replicaSetState.destroy(e,o),this.s.connectingServers.forEach((function(t){t.destroy(e,o)}))):o()},M.prototype.unref=function(){A(this,C),this.s.replicaSetState.allServers().forEach((function(e){e.unref()})),clearTimeout(this.haTimeoutId)},M.prototype.lastIsMaster=function(){return this.s.options.secondaryOnlyConnectionAllowed&&!this.s.replicaSetState.hasPrimary()&&this.s.replicaSetState.hasSecondary()?this.s.replicaSetState.secondaries[0].lastIsMaster():this.s.replicaSetState.primary?this.s.replicaSetState.primary.lastIsMaster():this.ismaster},M.prototype.connections=function(){for(var e=this.s.replicaSetState.allServers(),t=[],n=0;n<e.length;n++)t=t.concat(e[n].connections());return t},M.prototype.isConnected=function(e){return(e=e||{}).readPreference&&e.readPreference.equals(s.secondary)?this.s.replicaSetState.hasSecondary():e.readPreference&&e.readPreference.equals(s.primary)?this.s.replicaSetState.hasPrimary():e.readPreference&&e.readPreference.equals(s.primaryPreferred)?this.s.replicaSetState.hasSecondary()||this.s.replicaSetState.hasPrimary():e.readPreference&&e.readPreference.equals(s.secondaryPreferred)?this.s.replicaSetState.hasSecondary()||this.s.replicaSetState.hasPrimary():!(!this.s.options.secondaryOnlyConnectionAllowed||!this.s.replicaSetState.hasSecondary())||this.s.replicaSetState.hasPrimary()},M.prototype.isDestroyed=function(){return this.state===k};function H(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{};const o=e.self,r=e.op,s=e.ns,a=e.ops;if(o.state===k)return n(new p(i("topology was destroyed")));const c=!e.retrying&&!!t.retryWrites&&t.session&&v(o)&&!t.session.inTransaction();if(!o.s.replicaSetState.hasPrimary()){if(o.s.disconnectHandler)return o.s.disconnectHandler.add(r,s,a,t,n);if(!c)return n(new p("no primary server found"))}const l=(i,r)=>{if(!i)return n(null,r);if(!x(i))return i=_(i),n(i);if(c){return H(Object.assign({},e,{retrying:!0}),t,n)}return o.s.replicaSetState.primary&&o.s.replicaSetState.remove(o.s.replicaSetState.primary,{force:!0}),n(i)};n.operationId&&(l.operationId=n.operationId),c&&(t.session.incrementTransactionNumber(),t.willRetryWrite=c),o.s.replicaSetState.primary[r](s,a,t,l)}M.prototype.selectServer=function(e,t,n){let o,i;"function"==typeof e&&void 0===n&&(n=e,e=void 0,t={}),"function"==typeof t&&(n=t,t=e),t=t||{},o=e instanceof s?e:t.readPreference||s.primary;const r=process.hrtime(),a=()=>{if(w(r)>=1e4)return void(null!=i?n(i,null):n(new p("Server selection timed out")));const e=this.s.replicaSetState.pickServer(o);if(null!=e){if(!(e instanceof u))return i=e,void setTimeout(a,1e3);this.s.debug&&this.emit("pickedServer",t.readPreference,e),n(null,e)}else setTimeout(a,1e3)};a()},M.prototype.getServers=function(){return this.s.replicaSetState.allServers()},M.prototype.insert=function(e,t,n,o){H({self:this,op:"insert",ns:e,ops:t},n,o)},M.prototype.update=function(e,t,n,o){H({self:this,op:"update",ns:e,ops:t},n,o)},M.prototype.remove=function(e,t,n,o){H({self:this,op:"remove",ns:e,ops:t},n,o)};const q=["findAndModify","insert","update","delete"];M.prototype.command=function(e,t,n,o){if("function"==typeof n&&(o=n,n=(n={})||{}),this.state===k)return o(new p(i("topology was destroyed")));var r=n.readPreference?n.readPreference:s.primary;if("primary"===r.preference&&!this.s.replicaSetState.hasPrimary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,o);if("secondary"===r.preference&&!this.s.replicaSetState.hasSecondary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,o);if("primary"!==r.preference&&!this.s.replicaSetState.hasSecondary()&&!this.s.replicaSetState.hasPrimary()&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,o);var a=this.s.replicaSetState.pickServer(r);if(!(a instanceof u))return o(a);if(this.s.debug&&this.emit("pickedServer",s.primary,a),null==a)return o(new p(i("no server found that matches the provided readPreference %s",r)));const c=!n.retrying&&!!n.retryWrites&&n.session&&v(this)&&!n.session.inTransaction()&&(l=t,q.some(e=>l[e]));var l;c&&(n.session.incrementTransactionNumber(),n.willRetryWrite=c),a.command(e,t,n,(i,r)=>{if(!i)return o(null,r);if(!x(i))return o(i);if(c){const i=Object.assign({},n,{retrying:!0});return this.command(e,t,i,o)}return this.s.replicaSetState.primary&&this.s.replicaSetState.remove(this.s.replicaSetState.primary,{force:!0}),o(i)})},M.prototype.cursor=function(e,t,n){const o=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(o,e,t,n)},e.exports=M},function(e,t,n){"use strict";var o=n(4).inherits,i=n(4).format,r=n(6).diff,s=n(9).EventEmitter,a=n(18),c=n(11),l=n(3).MongoError,p=n(17).Buffer,u="ReplicaSetNoPrimary",d="ReplicaSetWithPrimary",h="Unknown",m="PossiblePrimary",f="RSPrimary",g="RSSecondary",y="RSArbiter",v="RSOther",b="RSGhost",x="Unknown",S=function(e){e=e||{},s.call(this),this.topologyType=u,this.setName=e.setName,this.set={},this.id=e.id,this.setName=e.setName,this.logger=e.logger||a("ReplSet",e),this.index=0,this.acceptableLatency=e.acceptableLatency||15,this.heartbeatFrequencyMS=e.heartbeatFrequencyMS||1e4,this.primary=null,this.secondaries=[],this.arbiters=[],this.passives=[],this.ghosts=[],this.unknownServers=[],this.set={},this.maxElectionId=null,this.maxSetVersion=0,this.replicasetDescription={topologyType:"Unknown",servers:[]},this.logicalSessionTimeoutMinutes=void 0};o(S,s),S.prototype.hasPrimaryAndSecondary=function(){return null!=this.primary&&this.secondaries.length>0},S.prototype.hasPrimaryOrSecondary=function(){return this.hasPrimary()||this.hasSecondary()},S.prototype.hasPrimary=function(){return null!=this.primary},S.prototype.hasSecondary=function(){return this.secondaries.length>0},S.prototype.get=function(e){for(var t=this.allServers(),n=0;n<t.length;n++)if(t[n].name.toLowerCase()===e.toLowerCase())return t[n];return null},S.prototype.allServers=function(e){e=e||{};var t=this.primary?[this.primary]:[];return t=t.concat(this.secondaries),e.ignoreArbiters||(t=t.concat(this.arbiters)),t=t.concat(this.passives)},S.prototype.destroy=function(e,t){const n=this.secondaries.concat(this.arbiters).concat(this.passives).concat(this.ghosts);this.primary&&n.push(this.primary);let o=n.length;const i=()=>{--o>0||(this.secondaries=[],this.arbiters=[],this.passives=[],this.ghosts=[],this.unknownServers=[],this.set={},this.primary=null,N(this),"function"==typeof t&&t(null,null))};0!==o?n.forEach(t=>t.destroy(e,i)):i()},S.prototype.remove=function(e,t){t=t||{};var n=e.name.toLowerCase(),o=this.primary?[this.primary]:[];o=(o=(o=o.concat(this.secondaries)).concat(this.arbiters)).concat(this.passives);for(var i=0;i<o.length;i++)if(!t.force&&o[i].equals(e)&&o[i].isConnected&&o[i].isConnected())return;this.set[n]&&(this.set[n].type=x,this.set[n].electionId=null,this.set[n].setName=null,this.set[n].setVersion=null);var r=null;this.primary&&this.primary.equals(e)&&(this.primary=null,this.topologyType=u,r="primary"),r=A(e,this.secondaries)?"secondary":r,r=A(e,this.arbiters)?"arbiter":r,r=A(e,this.passives)?"secondary":r,A(e,this.ghosts),A(e,this.unknownServers),this.unknownServers.push(n),r&&this.emit("left",r,e)};const w=e=>e.arbiterOnly&&e.setName;S.prototype.update=function(e){var t=e.lastIsMaster(),n=e.name.toLowerCase();if(t){var o=Array.isArray(t.hosts)?t.hosts:[];o=(o=(o=o.concat(Array.isArray(t.arbiters)?t.arbiters:[])).concat(Array.isArray(t.passives)?t.passives:[])).map((function(e){return e.toLowerCase()}));for(var r=0;r<o.length;r++)-1!==this.unknownServers.indexOf(o[r])||this.set[o[r]]&&this.set[o[r]].type!==x||this.unknownServers.push(o[r].toLowerCase()),this.set[o[r]]||(this.set[o[r]]={type:x,electionId:null,setName:null,setVersion:null})}if(!t&&!E(t,e,this.unknownServers))return this.set[n]={type:x,setVersion:null,electionId:null,setName:null},this.set[n].type=x,this.set[n].electionId=t?t.electionId:t,this.set[n].setName=t?t.setName:t,this.set[n].setVersion=t?t.setVersion:t,-1===this.unknownServers.indexOf(e.name)&&this.unknownServers.push(n),!1;if(void 0===t.logicalSessionTimeoutMinutes||w(t)||(void 0===this.logicalSessionTimeoutMinutes||null===t.logicalSessionTimeoutMinutes?this.logicalSessionTimeoutMinutes=t.logicalSessionTimeoutMinutes:this.logicalSessionTimeoutMinutes=Math.min(this.logicalSessionTimeoutMinutes,t.logicalSessionTimeoutMinutes)),t&&"isdbgrid"===t.msg)return this.primary&&this.primary.name===n&&(this.primary=null,this.topologyType=u),!1;if(t.isreplicaset)return this.set[n]={type:b,setVersion:null,electionId:null,setName:t.setName},this.primary&&this.primary.name===n&&(this.primary=null),this.topologyType=this.primary?d:u,t.setName&&(this.setName=t.setName),!1;if(t.setName&&t.hidden||t.setName&&!t.ismaster&&!t.secondary&&!t.arbiterOnly&&!t.passive)return this.set[n]={type:v,setVersion:null,electionId:null,setName:t.setName},this.topologyType=this.primary?d:u,t.setName&&(this.setName=t.setName),!1;if(t&&t.ismaster&&!t.setName)return this.topologyType=this.primary?d:h,this.remove(e,{force:!0}),!1;if(t&&!t.ismaster&&!t.secondary&&!t.arbiterOnly)return this.remove(e,{force:!0}),!1;if(t.me&&t.me.toLowerCase()!==n)return this.logger.isWarn()&&this.logger.warn(i("the seedlist server was removed due to its address %s not matching its ismaster.me address %s",e.name,t.me)),delete this.set[n],A(e,this.unknownServers),e.destroy(),this.primary&&!this.primary.equals(e)?this.topologyType=d:this.topologyType=u,!this.primary&&t.primary&&(this.set[t.primary.toLowerCase()]={type:m,setName:null,electionId:null,setVersion:null}),!1;if(!this.primary&&t.ismaster&&t.setName){var s=e.lastIsMaster().electionId;if(this.setName&&this.setName!==t.setName)return this.topologyType=u,new l(i("setName from ismaster does not match provided connection setName [%s] != [%s]",t.setName,this.setName));if(!this.maxElectionId&&s)this.maxElectionId=s;else if(this.maxElectionId&&s){var a=k(this.maxElectionId,s),c=e.lastIsMaster().setVersion;if(1===a)return this.topologyType=u,!1;if(0===a&&c&&c<this.maxSetVersion)return this.topologyType=u,!1;this.maxSetVersion=c,this.maxElectionId=s}return-1!==t.hosts.map((function(e){return e.toLowerCase()})).indexOf(n)?(this.primary=e,this.set[n]={type:f,setVersion:t.setVersion,electionId:t.electionId,setName:t.setName},this.topologyType=d,t.setName&&(this.setName=t.setName),A(e,this.unknownServers),A(e,this.secondaries),A(e,this.passives),this.emit("joined","primary",e)):this.topologyType=u,N(this),!0}if(t.ismaster&&t.setName){var p=this.set[this.primary.name.toLowerCase()].electionId,S=this.set[this.primary.name.toLowerCase()].setVersion,_=this.set[this.primary.name.toLowerCase()].setName;s=e.lastIsMaster().electionId,c=e.lastIsMaster().setVersion;var O=e.lastIsMaster().setName;if(this.primary.equals(e)&&_===O)return!1;if(_&&_!==O)return this.primary.equals(e)?this.topologyType=u:this.topologyType=d,!1;if(p&&s){if(1===(a=k(p,s)))return!1;if(0===a&&S>c)return!1}else if(!p&&s&&c&&c<this.maxSetVersion)return!1;if(!this.maxElectionId&&s)this.maxElectionId=s;else if(this.maxElectionId&&s){if(1===(a=k(this.maxElectionId,s)))return!1;if(0===a&&S&&c){if(c<this.maxSetVersion)return!1}else if(c<this.maxSetVersion)return!1;this.maxElectionId=s,this.maxSetVersion=c}else this.maxSetVersion=c;return this.set[this.primary.name.toLowerCase()]={type:x,setVersion:null,electionId:null,setName:null},this.emit("left","primary",this.primary),this.primary.destroy(),this.primary=e,this.set[n]={type:f,setVersion:t.setVersion,electionId:t.electionId,setName:t.setName},this.topologyType=d,t.setName&&(this.setName=t.setName),A(e,this.unknownServers),A(e,this.secondaries),A(e,this.passives),this.emit("joined","primary",e),N(this),!0}return!this.primary&&t.primary&&(this.set[t.primary.toLowerCase()]={type:m,setVersion:null,electionId:null,setName:null}),t.secondary&&t.setName&&!E(t,e,this.secondaries)&&this.setName&&this.setName===t.setName?(C(this,g,t,e,this.secondaries),this.topologyType=this.primary?d:u,t.setName&&(this.setName=t.setName),A(e,this.unknownServers),this.primary&&this.primary.name.toLowerCase()===n&&(e.destroy(),this.primary=null,this.emit("left","primary",e)),this.emit("joined","secondary",e),N(this),!0):w(t)&&!E(t,e,this.arbiters)&&this.setName&&this.setName===t.setName?(C(this,y,t,e,this.arbiters),this.topologyType=this.primary?d:u,t.setName&&(this.setName=t.setName),A(e,this.unknownServers),this.emit("joined","arbiter",e),N(this),!0):t.passive&&t.setName&&!E(t,e,this.passives)&&this.setName&&this.setName===t.setName?(C(this,g,t,e,this.passives),this.topologyType=this.primary?d:u,t.setName&&(this.setName=t.setName),A(e,this.unknownServers),this.primary&&this.primary.name.toLowerCase()===n&&(e.destroy(),this.primary=null,this.emit("left","primary",e)),this.emit("joined","secondary",e),N(this),!0):this.set[n]&&this.set[n].type===f?(this.emit("left","primary",this.primary),this.primary.destroy(),this.primary=null,this.topologyType=u,!1):(this.topologyType=this.primary?d:u,!1)},S.prototype.updateServerMaxStaleness=function(e,t){for(var n=0,o=0;o<this.secondaries.length;o++)n=Math.max(n,this.secondaries[o].lastWriteDate);e.ismaster.maxWireVersion>=5&&e.ismaster.secondary&&this.hasPrimary()?e.staleness=e.lastUpdateTime-e.lastWriteDate-(this.primary.lastUpdateTime-this.primary.lastWriteDate)+t:e.ismaster.maxWireVersion>=5&&e.ismaster.secondary&&(e.staleness=n-e.lastWriteDate+t)},S.prototype.updateSecondariesMaxStaleness=function(e){for(var t=0;t<this.secondaries.length;t++)this.updateServerMaxStaleness(this.secondaries[t],e)},S.prototype.pickServer=function(e){if("primary"===(e=e||c.primary).preference&&null!=e.maxStalenessSeconds)return new l("primary readPreference incompatible with maxStalenessSeconds");var t=this.primary?[this.primary]:[];if(t=t.concat(this.secondaries),null!=e.maxStalenessSeconds)for(var n=0;n<t.length;n++)if(t[n].ismaster.maxWireVersion<5)return new l("maxStalenessSeconds not supported by at least one of the replicaset members");if("nearest"===e.preference&&null==e.maxStalenessSeconds)return T(this,e);if("nearest"===e.preference&&null!=e.maxStalenessSeconds)return O(this,e);var o=this.secondaries;if(e.equals(c.secondary)&&0===o.length)return new l("no secondary server available");if(e.equals(c.secondaryPreferred)&&0===o.length&&null==this.primary)return new l("no secondary or primary server available");if(e.equals(c.primary)&&null==this.primary)return new l("no primary server available");if(e.equals(c.secondaryPreferred)||e.equals(c.secondary)){if(o.length>0&&null==e.maxStalenessSeconds){var i=T(this,e);if(i)return i}else if(o.length>0&&null!=e.maxStalenessSeconds&&(i=O(this,e)))return i;return e.equals(c.secondaryPreferred)?this.primary:null}if(e.equals(c.primaryPreferred)){if(i=null,this.primary)return this.primary;if(o.length>0&&null==e.maxStalenessSeconds?i=T(this,e):o.length>0&&null!=e.maxStalenessSeconds&&(i=O(this,e)),i)return i}return this.primary};var _=function(e,t){if(null==e.tags)return t;for(var n=[],o=Array.isArray(e.tags)?e.tags:[e.tags],i=0;i<o.length;i++)for(var r=o[i],s=0;s<t.length;s++){var a=t[s].lastIsMaster().tags||{},c=!0;for(var l in r)a[l]!==r[l]&&(c=!1);c&&n.push(t[s])}return n};function O(e,t){var n=[],o=1e3*t.maxStalenessSeconds;if(o<9e4)return new l("maxStalenessSeconds must be set to at least 90 seconds");e.primary&&"secondary"!==t.preference&&"secondaryPreferred"!==t.preference&&n.push(e.primary);for(var i=0;i<e.secondaries.length;i++)n.push(e.secondaries[i]);if(e.primary&&0===n.length&&"secondaryPreferred"!==t.preference&&n.push(e.primary),(n=(n=_(t,n)).filter((function(e){return e.staleness<=o}))).sort((function(e,t){return e.lastIsMasterMS-t.lastIsMasterMS})),0===n.length)return null;e.index=e.index%n.length;var r=n[e.index];return e.index=e.index+1,r}function T(e,t){var n=[];e.primary&&"secondary"!==t.preference&&"secondaryPreferred"!==t.preference&&n.push(e.primary);for(var o=0;o<e.secondaries.length;o++)n.push(e.secondaries[o]);0===n.length&&e.primary&&"secondaryPreferred"!==t.preference&&n.push(e.primary),(n=_(t,n)).sort((function(e,t){return e.lastIsMasterMS-t.lastIsMasterMS}));var i=n.length>0?n[0].lastIsMasterMS:0;if(0===(n=n.filter((function(t){return t.lastIsMasterMS<=i+e.acceptableLatency}))).length)return null;e.index=e.index%n.length;var r=n[e.index];return e.index=e.index+1,r}function E(e,t,n){for(var o=0;o<n.length;o++)if(n[o]&&n[o].name&&n[o].name.toLowerCase()===t.name.toLowerCase())return!0;return!1}function C(e,t,n,o,i){var r=o.name.toLowerCase();e.set[r].type=t,e.set[r].electionId=n?n.electionId:n,e.set[r].setName=n?n.setName:n,e.set[r].setVersion=n?n.setVersion:n,i.push(o)}function k(e,t){var n=p.from(e.toHexString(),"hex"),o=p.from(t.toHexString(),"hex");if(n===o)return 0;if("function"==typeof p.compare)return p.compare(n,o);for(var i=n.length,r=o.length,s=Math.min(i,r),a=0;a<s&&n[a]===o[a];a++);return a!==s&&(i=n[a],r=o[a]),i<r?-1:r<i?1:0}function A(e,t){for(var n=0;n<t.length;n++){if(t[n].equals&&t[n].equals(e))return t.splice(n,1),!0;if("string"==typeof t[n]&&t[n].toLowerCase()===e.name.toLowerCase())return t.splice(n,1),!0}return!1}function N(e){if(e.listeners("topologyDescriptionChanged").length>0){var t="Unknown",n=e.setName;e.hasPrimaryAndSecondary()?t="ReplicaSetWithPrimary":!e.hasPrimary()&&e.hasSecondary()&&(t="ReplicaSetNoPrimary");var o={topologyType:t,setName:n,servers:[]};if(e.hasPrimary()){var i=e.primary.getDescription();i.type="RSPrimary",o.servers.push(i)}o.servers=o.servers.concat(e.secondaries.map((function(e){var t=e.getDescription();return t.type="RSSecondary",t}))),o.servers=o.servers.concat(e.arbiters.map((function(e){var t=e.getDescription();return t.type="RSArbiter",t}))),o.servers=o.servers.concat(e.passives.map((function(e){var t=e.getDescription();return t.type="RSSecondary",t})));var s=r(e.replicasetDescription,o),a={topologyId:e.id,previousDescription:e.replicasetDescription,newDescription:o,diff:s};e.emit("topologyDescriptionChanged",a),e.replicasetDescription=o}}e.exports=S},function(e,t,n){"use strict";const o=n(4).inherits,i=n(4).format,r=n(9).EventEmitter,s=n(13).CoreCursor,a=n(18),c=n(12).retrieveBSON,l=n(3).MongoError,p=n(71),u=n(6).clone,d=n(6).diff,h=n(6).cloneOptions,m=n(6).createClientInfo,f=n(6).SessionMixins,g=n(6).isRetryableWritesSupported,y=n(5).relayEvents,v=n(3).isRetryableError,b=c(),x=n(6).getMMAPError;var S="disconnected",w="connecting",_="connected",O="unreferenced",T="destroyed";function E(e,t){var n={disconnected:[w,T,S],connecting:[w,T,_,S],connected:[_,S,T,O],unreferenced:[O,T],destroyed:[T]}[e.state];n&&-1!==n.indexOf(t)?e.state=t:e.logger.error(i("Pool with id [%s] failed attempted illegal state transition from [%s] to [%s] only following state allowed [%s]",e.id,e.state,t,n))}var C=1,k=["connect","close","error","timeout","parseError"],A=function(e,t){t=t||{},this.id=C++,this.s={options:Object.assign({},t),bson:t.bson||new b([b.Binary,b.Code,b.DBRef,b.Decimal128,b.Double,b.Int32,b.Long,b.Map,b.MaxKey,b.MinKey,b.ObjectId,b.BSONRegExp,b.Symbol,b.Timestamp]),Cursor:t.cursorFactory||s,logger:a("Mongos",t),seedlist:e,haInterval:t.haInterval?t.haInterval:1e4,disconnectHandler:t.disconnectHandler,index:0,connectOptions:{},debug:"boolean"==typeof t.debug&&t.debug,localThresholdMS:t.localThresholdMS||15,clientInfo:m(t)},this.s.options.clientInfo=m(t),this.s.logger.isWarn()&&0!==this.s.options.socketTimeout&&this.s.options.socketTimeout<this.s.haInterval&&this.s.logger.warn(i("warning socketTimeout %s is less than haInterval %s. This might cause unnecessary server reconnections due to socket timeouts",this.s.options.socketTimeout,this.s.haInterval)),this.state=S,this.connectingProxies=[],this.connectedProxies=[],this.disconnectedProxies=[],this.index=0,this.haTimeoutId=null,this.ismaster=null,this.topologyDescription={topologyType:"Unknown",servers:[]},this.clusterTime=null,r.call(this)};function N(e,t,n){e.listeners(t).length>0&&e.emit(t,n)}o(A,r),Object.assign(A.prototype,f),Object.defineProperty(A.prototype,"type",{enumerable:!0,get:function(){return"mongos"}}),Object.defineProperty(A.prototype,"parserType",{enumerable:!0,get:function(){return b.native?"c++":"js"}}),Object.defineProperty(A.prototype,"logicalSessionTimeoutMinutes",{enumerable:!0,get:function(){return this.ismaster&&this.ismaster.logicalSessionTimeoutMinutes||null}});const I=["serverDescriptionChanged","error","close","timeout","parseError"];function M(e,t,n){t=t||{},I.forEach(t=>e.removeAllListeners(t)),e.destroy(t,n)}function B(e){return function(){e.state!==T&&(D(e.connectedProxies,e.disconnectedProxies,this),H(e),e.emit("left","mongos",this),e.emit("serverClosed",{topologyId:e.id,address:this.name}))}}function R(e,t){return function(){if(e.state===T)return H(e),D(e.connectingProxies,e.disconnectedProxies,this),this.destroy();if("connect"===t)if(e.ismaster=this.lastIsMaster(),"isdbgrid"===e.ismaster.msg){for(let t=0;t<e.connectedProxies.length;t++)if(e.connectedProxies[t].name===this.name)return D(e.connectingProxies,e.disconnectedProxies,this),H(e),this.destroy(),e.emit("failed",this);for(let e=0;e<k.length;e++)this.removeAllListeners(k[e]);this.on("error",B(e)),this.on("close",B(e)),this.on("timeout",B(e)),this.on("parseError",B(e)),D(e.connectingProxies,e.connectedProxies,this),e.emit("joined","mongos",this)}else{if(e.s.logger.isWarn()){var n="expected mongos proxy, but found replicaset member mongod for server %s";e.ismaster.hosts||(n="expected mongos proxy, but found standalone mongod for server %s"),e.s.logger.warn(i(n,this.name))}L(e.connectingProxies,this),e.emit("left","server",this),e.emit("failed",this)}else D(e.connectingProxies,e.disconnectedProxies,this),e.emit("left","mongos",this),e.emit("failed",this);if(H(e),0===e.connectingProxies.length){if(e.connectedProxies.length>0&&e.state===w)E(e,_),e.emit("connect",e),e.emit("fullsetup",e),e.emit("all",e);else if(0===e.disconnectedProxies.length)return e.s.logger.isWarn()&&e.s.logger.warn(i("no mongos proxies found in seed list, did you mean to connect to a replicaset")),e.emit("error",new l("no mongos proxies found in seed list"));!function e(t,n){n=n||{};t.haTimeoutId=setTimeout((function(){if(t.state!==T&&t.state!==O){t.isConnected()&&t.s.disconnectHandler&&t.s.disconnectHandler.execute();var o=t.connectedProxies.slice(0),i=o.length;if(0===o.length)return t.listeners("close").length>0&&t.state===w?t.emit("error",new l("no mongos proxy available")):t.emit("close",t),j(t,t.disconnectedProxies,(function(){t.state!==T&&t.state!==O&&(t.state===w&&n.firstConnect?(t.emit("connect",t),t.emit("fullsetup",t),t.emit("all",t)):t.isConnected()?t.emit("reconnect",t):!t.isConnected()&&t.listeners("close").length>0&&t.emit("close",t),e(t))}));for(var r=0;r<o.length;r++)s(0,o[r],(function(){if(0===(i-=1)){if(t.state===T||t.state===O)return;j(t,t.disconnectedProxies,(function(){t.state!==T&&t.state!==O&&e(t)}))}}))}function s(e,n,o){var i=(new Date).getTime();N(t,"serverHeartbeatStarted",{connectionId:n.name}),n.command("admin.$cmd",{ismaster:!0},{monitoring:!0,socketTimeout:t.s.options.connectionTimeout||2e3},(function(e,r){if(t.state===T||t.state===O)return D(t.connectedProxies,t.disconnectedProxies,n),n.destroy(),o(e,r);var s=(new Date).getTime()-i;e?(N(t,"serverHeartbeatFailed",{durationMS:s,failure:e,connectionId:n.name}),D(t.connectedProxies,t.disconnectedProxies,n)):(n.ismaster=r.result,n.lastIsMasterMS=s,N(t,"serverHeartbeatSucceeded",{durationMS:s,reply:r.result,connectionId:n.name})),o(e,r)}))}}),t.s.haInterval)}(e,{firstConnect:!0})}}}function P(e,t){const n=t&&t.transaction;if(n&&n.server){if(n.server.isConnected())return n.server;n.unpinServer()}for(var o=e.connectedProxies.slice(0),i=Number.MAX_VALUE,r=0;r<o.length;r++)o[r].lastIsMasterMS<i&&(i=o[r].lastIsMasterMS);let s;return 0===(o=o.filter((function(t){if(t.lastIsMasterMS<=i+e.s.localThresholdMS&&t.isConnected())return!0}))).length?s=e.connectedProxies[0]:(s=o[e.index%o.length],e.index=(e.index+1)%o.length),n&&n.isActive&&s&&s.isConnected()&&n.pinServer(s),s}function D(e,t,n){for(var o=0;o<e.length;o++)e[o].name===n.name&&e.splice(o,1);for(o=0;o<t.length;o++)t[o].name===n.name&&t.splice(o,1);t.push(n)}function L(e,t){for(var n=0;n<e.length;n++)e[n].name===t.name&&e.splice(n,1)}function j(e,t,n){var o=t.length,i=function(e,t){return function(){if(o-=1,e.state===T||e.state===O)return D(e.connectingProxies,e.disconnectedProxies,this),this.destroy();if("connect"===t){if(e.state===T||e.state===O)return D(e.connectingProxies,e.disconnectedProxies,this),this.destroy();for(var i=0;i<k.length;i++)this.removeAllListeners(k[i]);this.on("error",B(e)),this.on("close",B(e)),this.on("timeout",B(e)),this.on("parseError",B(e)),D(e.connectingProxies,e.connectedProxies,this),H(e),e.emit("joined","mongos",this)}else D(e.connectingProxies,e.disconnectedProxies,this),this.destroy();0===o&&n()}};if(0===o)return n();function r(t,n){setTimeout((function(){if(e.state!==T&&e.state!==O){var n=new p(Object.assign({},e.s.options,{host:t.name.split(":")[0],port:parseInt(t.name.split(":")[1],10),reconnect:!1,monitoring:!1,parent:e,clientInfo:u(e.s.clientInfo)}));M(t),L(e.disconnectedProxies,t),y(n,e,["serverDescriptionChanged"]),e.emit("serverOpening",{topologyId:-1!==n.s.topologyId?n.s.topologyId:e.id,address:n.name}),n.once("connect",i(e,"connect")),n.once("close",i(e,"close")),n.once("timeout",i(e,"timeout")),n.once("error",i(e,"error")),n.once("parseError",i(e,"parseError")),y(n,e,["commandStarted","commandSucceeded","commandFailed"]),e.connectingProxies.push(n),n.connect(e.s.connectOptions)}}),n)}for(var s=0;s<t.length;s++)r(t[s],s)}function z(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{};const o=e.self,i=e.op,r=e.ns,s=e.ops;let a=P(o,t.session);if(!a)return n(new l("no mongos proxy available"));const c=!e.retrying&&!!t.retryWrites&&t.session&&g(o)&&!t.session.inTransaction(),p=(i,r)=>{if(!i)return n(null,r);if(!v(i)||!c)return i=x(i),n(i);if(!(a=P(o,t.session)))return n(i);return z(Object.assign({},e,{retrying:!0}),t,n)};n.operationId&&(p.operationId=n.operationId),c&&(t.session.incrementTransactionNumber(),t.willRetryWrite=c),a[i](r,s,t,p)}A.prototype.connect=function(e){var t=this;this.s.connectOptions=e||{},E(this,w);var n=this.s.seedlist.map((function(n){const o=new p(Object.assign({},t.s.options,n,e,{reconnect:!1,monitoring:!1,parent:t,clientInfo:u(t.s.clientInfo)}));return y(o,t,["serverDescriptionChanged"]),o}));N(this,"topologyOpening",{topologyId:this.id}),function(e,t){e.connectingProxies=e.connectingProxies.concat(t);var n=0;function o(t,n){setTimeout((function(){e.emit("serverOpening",{topologyId:e.id,address:t.name}),H(e),t.once("close",R(e,"close")),t.once("timeout",R(e,"timeout")),t.once("parseError",R(e,"parseError")),t.once("error",R(e,"error")),t.once("connect",R(e,"connect")),y(t,e,["commandStarted","commandSucceeded","commandFailed"]),t.connect(e.s.connectOptions)}),n)}for(;t.length>0;)o(t.shift(),n++)}(t,n)},A.prototype.auth=function(e,t){"function"==typeof t&&t(null,null)},A.prototype.lastIsMaster=function(){return this.ismaster},A.prototype.unref=function(){E(this,O),this.connectedProxies.concat(this.connectingProxies).forEach((function(e){e.unref()})),clearTimeout(this.haTimeoutId)},A.prototype.destroy=function(e,t){this.haTimeoutId&&clearTimeout(this.haTimeoutId);const n=this.connectedProxies.concat(this.connectingProxies);let o=n.length;const i=()=>{--o>0||(H(this),N(this,"topologyClosed",{topologyId:this.id}),E(this,T),"function"==typeof t&&t(null,null))};0!==o?n.forEach(t=>{this.emit("serverClosed",{topologyId:this.id,address:t.name}),M(t,e,i),D(this.connectedProxies,this.disconnectedProxies,t)}):i()},A.prototype.isConnected=function(){return this.connectedProxies.length>0},A.prototype.isDestroyed=function(){return this.state===T},A.prototype.insert=function(e,t,n,o){return"function"==typeof n&&(o=n,n=(n={})||{}),this.state===T?o(new l(i("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void z({self:this,op:"insert",ns:e,ops:t},n,o):o(new l("no mongos proxy available")):this.s.disconnectHandler.add("insert",e,t,n,o)},A.prototype.update=function(e,t,n,o){return"function"==typeof n&&(o=n,n=(n={})||{}),this.state===T?o(new l(i("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void z({self:this,op:"update",ns:e,ops:t},n,o):o(new l("no mongos proxy available")):this.s.disconnectHandler.add("update",e,t,n,o)},A.prototype.remove=function(e,t,n,o){return"function"==typeof n&&(o=n,n=(n={})||{}),this.state===T?o(new l(i("topology was destroyed"))):this.isConnected()||null==this.s.disconnectHandler?this.isConnected()?void z({self:this,op:"remove",ns:e,ops:t},n,o):o(new l("no mongos proxy available")):this.s.disconnectHandler.add("remove",e,t,n,o)};const U=["findAndModify","insert","update","delete"];function H(e){if(e.listeners("topologyDescriptionChanged").length>0){var t="Unknown";e.connectedProxies.length>0&&(t="Sharded");var n={topologyType:t,servers:[]},o=e.disconnectedProxies.concat(e.connectingProxies);n.servers=n.servers.concat(o.map((function(e){var t=e.getDescription();return t.type="Unknown",t}))),n.servers=n.servers.concat(e.connectedProxies.map((function(e){var t=e.getDescription();return t.type="Mongos",t})));var i=d(e.topologyDescription,n),r={topologyId:e.id,previousDescription:e.topologyDescription,newDescription:n,diff:i};i.servers.length>0&&e.emit("topologyDescriptionChanged",r),e.topologyDescription=n}}A.prototype.command=function(e,t,n,o){if("function"==typeof n&&(o=n,n=(n={})||{}),this.state===T)return o(new l(i("topology was destroyed")));var r=P(this,n.session);if((null==r||!r.isConnected())&&null!=this.s.disconnectHandler)return this.s.disconnectHandler.add("command",e,t,n,o);if(null==r)return o(new l("no mongos proxy available"));var s=h(n);s.topology=this;const a=!n.retrying&&n.retryWrites&&n.session&&g(this)&&!n.session.inTransaction()&&(c=t,U.some(e=>c[e]));var c;a&&(n.session.incrementTransactionNumber(),n.willRetryWrite=a),r.command(e,t,s,(n,i)=>{if(!n)return o(null,i);if(!v(n))return o(n);if(a){const n=Object.assign({},s,{retrying:!0});return this.command(e,t,n,o)}return o(n)})},A.prototype.cursor=function(e,t,n){const o=(n=n||{}).topology||this;return new(n.cursorFactory||this.s.Cursor)(o,e,t,n)},A.prototype.selectServer=function(e,t,n){"function"==typeof e&&void 0===n&&(n=e,e=void 0,t={}),"function"==typeof t&&(n=t,t=e,e=void 0);const o=P(this,(t=t||{}).session);null!=o?(this.s.debug&&this.emit("pickedServer",null,o),n(null,o)):n(new l("server selection failed"))},A.prototype.connections=function(){for(var e=[],t=0;t<this.connectedProxies.length;t++)e=e.concat(this.connectedProxies[t].connections());return e},e.exports=A},function(e,t,n){"use strict";const o=n(9),i=n(24).ServerDescription,r=n(24).ServerType,s=n(35).TopologyDescription,a=n(35).TopologyType,c=n(94),l=n(5).calculateDurationInMs,p=n(3).MongoTimeoutError,u=n(149),d=n(5).relayEvents,h=n(11),m=n(95).readPreferenceServerSelector,f=n(95).writableServerSelector,g=n(6).isRetryableWritesSupported,y=n(13).CoreCursor,v=n(4).deprecate,b=n(12).retrieveBSON(),x=n(6).createCompressionInfo,S=n(3).isRetryableError,w=n(3).isSDAMUnrecoverableError,_=n(36).ClientSession,O=n(6).createClientInfo,T=n(3).MongoError,E=n(6).resolveClusterTime,C=n(150).SrvPoller,k=n(6).getMMAPError;let A=0;const N={localThresholdMS:15,serverSelectionTimeoutMS:3e4,heartbeatFrequencyMS:1e4,minHeartbeatFrequencyMS:500},I=["serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","commandStarted","commandSucceeded","commandFailed","monitoring"],M=I.concat(["error","connect","descriptionReceived","close","ended"]);class B extends o{constructor(e,t){super(),void 0===t&&"string"!=typeof e&&(t=e,e=[],t.host&&e.push({host:t.host,port:t.port})),"string"==typeof(e=e||[])&&(e=function(e){return e.split(",").map(e=>({host:e.split(":")[0],port:e.split(":")[1]||27017}))}(e));const n=function(e,t){const n=t.replicaSet||t.setName||t.rs_name;return 1!==e.length||n?n?a.ReplicaSetNoPrimary:a.Unknown:a.Single}(e,t=Object.assign({},N,t)),o=A++,r=e.reduce((e,t)=>{t.domain_socket&&(t.host=t.domain_socket);const n=t.port?`${t.host}:${t.port}`:`${t.host}:27017`;return e.set(n,new i(n)),e},new Map);this.s={id:o,options:t,seedlist:e,description:new s(n,r,t.replicaSet,null,null,null,t),serverSelectionTimeoutMS:t.serverSelectionTimeoutMS,heartbeatFrequencyMS:t.heartbeatFrequencyMS,minHeartbeatIntervalMS:t.minHeartbeatIntervalMS,Cursor:t.cursorFactory||y,bson:t.bson||new b,servers:new Map,sessionPool:null,sessions:new Set,promiseLibrary:t.promiseLibrary||Promise,credentials:t.credentials,clusterTime:null,monitorTimers:[],iterationTimers:[]},this.s.options.compression={compressors:x(t)},this.s.clientInfo=O(t),t.srvHost&&(this.s.srvPoller=t.srvPoller||new C({heartbeatFrequencyMS:this.s.heartbeatFrequencyMS,srvHost:t.srvHost,logger:t.logger,loggerLevel:t.loggerLevel}),this.s.detectTopologyDescriptionChange=e=>{const t=e.previousDescription.type,n=e.newDescription.type;t!==a.Sharded&&n===a.Sharded&&(this.s.handleSrvPolling=function(e){return function(t){const n=e.s.description;e.s.description=e.s.description.updateFromSrvPollingEvent(t),e.s.description!==n&&(L(e),e.emit("topologyDescriptionChanged",new c.TopologyDescriptionChangedEvent(e.s.id,n,e.s.description)))}}(this),this.s.srvPoller.on("srvRecordDiscovery",this.s.handleSrvPolling),this.s.srvPoller.start())},this.on("topologyDescriptionChanged",this.s.detectTopologyDescriptionChange))}get description(){return this.s.description}get parserType(){return b.native?"c++":"js"}connections(){return Array.from(this.s.servers.values()).reduce((e,t)=>e.concat(t.s.pool.allConnections()),[])}connect(e,t){var n,o;"function"==typeof e&&(t=e,e={}),e=e||{},this.emit("topologyOpening",new c.TopologyOpeningEvent(this.s.id)),this.emit("topologyDescriptionChanged",new c.TopologyDescriptionChangedEvent(this.s.id,new s(a.Unknown),this.s.description)),n=this,o=Array.from(this.s.description.servers.values()),n.s.servers=o.reduce((e,t)=>{const o=D(n,t);return e.set(t.address,o),e},new Map),this.s.connected=!0,U(e);const i=e.readPreference||h.primary;this.selectServer(m(i),e,(e,n)=>{if(e)return void("function"==typeof t?t(e,null):this.emit("error",e));const o=e=>{n.removeListener("connect",i),"function"==typeof t&&t(e,null)},i=(e,i)=>{n.removeListener("error",o),this.emit("open",i,this),this.emit("connect",this),"function"==typeof t&&t(i,this)};if(1===n.s.state)return n.once("error",o),void n.once("connect",i);i()})}close(e,t){"function"==typeof e&&(t=e,e={}),e=e||{},this.s.monitorTimers.map(e=>clearTimeout(e)),this.s.monitorTimers=[],this.s.iterationTimers.map(e=>clearTimeout(e)),this.s.iterationTimers=[],this.s.sessionPool&&(this.s.sessions.forEach(e=>e.endSession()),this.s.sessionPool.endAllPooledSessions()),this.s.srvPoller&&(this.s.srvPoller.stop(),this.s.handleSrvPolling&&(this.s.srvPoller.removeListener("srvRecordDiscovery",this.s.handleSrvPolling),delete this.s.handleSrvPolling)),this.s.detectTopologyDescriptionChange&&(this.removeListener("topologyDescriptionChanged",this.s.detectTopologyDescriptionChange),delete this.s.detectTopologyDescriptionChange);const n=this.s.servers;if(0===n.size)return this.s.connected=!1,void("function"==typeof t&&t(null,null));let o=0;n.forEach(e=>P(e,this,()=>{++o===n.size&&(this.emit("topologyClosed",new c.TopologyClosedEvent(this.s.id)),this.s.connected=!1,"function"==typeof t&&t(null,null))}))}selectServer(e,t,n){if("function"==typeof t)if(n=t,"function"!=typeof e){let n;t=e,e instanceof h?n=e:(U(t),n=t.readPreference||h.primary),e=m(n)}else t={};t=Object.assign({},{serverSelectionTimeoutMS:this.s.serverSelectionTimeoutMS},t);const o=this.description.type===a.Sharded,i=t.session,r=i&&i.transaction;o&&r&&r.server?n(null,r.server):(this.s.iterationTimers.map(e=>clearTimeout(e)),this.s.iterationTimers=[],function e(t,n,o,i,r){const s=l(i);if(s>=o)return r(new p(`Server selection timed out after ${o} ms`));if(!t.s.connected){t.connect();const i=setTimeout(()=>{t.removeListener("connect",a),r(new p("Server selection timed out waiting to connect"))},o-s),a=()=>{clearTimeout(i),e(t,n,o,process.hrtime(),r)};return void t.once("connect",a)}const a=Array.from(t.description.servers.values());let c;if("object"==typeof n){const e=n.readPreference?n.readPreference:h.primary;n=m(e)}try{c=n?n(t.description,a):a}catch(e){return r(e,null)}if(c.length){const e=c.map(e=>t.s.servers.get(e.address));return r(null,e)}(()=>{t.s.monitorTimers.map(e=>clearTimeout(e)),t.s.monitorTimers=[],t.s.servers.forEach(e=>{const n=setTimeout(()=>e.monitor({heartbeatFrequencyMS:t.description.heartbeatFrequencyMS}),N.minHeartbeatFrequencyMS);t.s.monitorTimers.push(n)});const a=()=>{clearTimeout(c),t.s.iterationTimers.splice(l,1),t.description.error?r(t.description.error,null):e(t,n,o,i,r)},c=setTimeout(()=>{t.removeListener("topologyDescriptionChanged",a),r(new p(`Server selection timed out after ${o} ms`))},o-s),l=t.s.iterationTimers.push(c);t.once("topologyDescriptionChanged",a)})()}(this,e,t.serverSelectionTimeoutMS,process.hrtime(),(e,t)=>{if(e)return n(e,null);const i=function(e){return e[Math.floor(Math.random()*e.length)]}(t);o&&r&&r.isActive&&r.pinServer(i),n(null,i)}))}shouldCheckForSessionSupport(){return this.description.type===a.Single&&!this.description.hasKnownServers||!this.description.hasDataBearingServers}hasSessionSupport(){return null!=this.description.logicalSessionTimeoutMinutes}startSession(e,t){const n=new _(this,this.s.sessionPool,e,t);return n.once("ended",()=>{this.s.sessions.delete(n)}),this.s.sessions.add(n),n}endSessions(e,t){Array.isArray(e)||(e=[e]),this.command("admin.$cmd",{endSessions:e},{readPreference:h.primaryPreferred,noResponse:!0},()=>{"function"==typeof t&&t()})}serverUpdateHandler(e){if(!this.s.description.hasServer(e.address))return;const t=this.s.description,n=this.s.description.servers.get(e.address);if(this.s.description=this.s.description.update(e),this.s.description.compatibilityError)return void this.emit("error",new T(this.s.description.compatibilityError));this.emit("serverDescriptionChanged",new c.ServerDescriptionChangedEvent(this.s.id,e.address,n,this.s.description.servers.get(e.address))),L(this,e);const o=e.$clusterTime;o&&E(this,o),this.emit("topologyDescriptionChanged",new c.TopologyDescriptionChangedEvent(this.s.id,t,this.s.description))}auth(e,t){"function"==typeof e&&(t=e,e=null),"function"==typeof t&&t(null,!0)}logout(e){"function"==typeof e&&e(null,!0)}insert(e,t,n,o){j({topology:this,op:"insert",ns:e,ops:t},n,o)}update(e,t,n,o){j({topology:this,op:"update",ns:e,ops:t},n,o)}remove(e,t,n,o){j({topology:this,op:"remove",ns:e,ops:t},n,o)}command(e,t,n,o){"function"==typeof n&&(o=n,n=(n={})||{}),U(n);const i=n.readPreference||h.primary;this.selectServer(m(i),n,(i,r)=>{if(i)return void o(i,null);const s=!n.retrying&&!!n.retryWrites&&n.session&&g(this)&&!n.session.inTransaction()&&function(e){return R.some(t=>e[t])}(t);s&&(n.session.incrementTransactionNumber(),n.willRetryWrite=s),r.command(e,t,n,(i,r)=>{if(!i)return o(null,r);if(!S(i))return o(i);if(s){const i=Object.assign({},n,{retrying:!0});return this.command(e,t,i,o)}return o(i)})})}cursor(e,t,n){const o=(n=n||{}).topology||this,i=n.cursorFactory||this.s.Cursor;return U(n),new i(o,e,t,n)}get clientInfo(){return this.s.clientInfo}isConnected(){return!0}isDestroyed(){return!1}unref(){console.log("not implemented: `unref`")}lastIsMaster(){const e=Array.from(this.description.servers.values());return 0===e.length?{}:e.filter(e=>e.type!==r.Unknown)[0]||{maxWireVersion:this.description.commonWireVersion}}get logicalSessionTimeoutMinutes(){return this.description.logicalSessionTimeoutMinutes}get bson(){return this.s.bson}}Object.defineProperty(B.prototype,"clusterTime",{enumerable:!0,get:function(){return this.s.clusterTime},set:function(e){this.s.clusterTime=e}}),B.prototype.destroy=v(B.prototype.close,"destroy() is deprecated, please use close() instead");const R=["findAndModify","insert","update","delete"];function P(e,t,n){M.forEach(t=>e.removeAllListeners(t)),e.destroy(()=>{t.emit("serverClosed",new c.ServerClosedEvent(t.s.id,e.description.address)),"function"==typeof n&&n(null,null)})}function D(e,t){e.emit("serverOpening",new c.ServerOpeningEvent(e.s.id,t.address));const n=new u(t,e.s.options,e);return d(n,e,I),n.once("connect",function(e,t){return function(){e.monitor({initial:!0,heartbeatFrequencyMS:t.description.heartbeatFrequencyMS})}}(n,e)),n.on("descriptionReceived",e.serverUpdateHandler.bind(e)),n.on("error",function(e,t){return function(n){t.emit("serverClosed",new c.ServerClosedEvent(t.s.id,e.description.address)),w(n,e)?z(e,n,{clearPool:!0}):z(e,n)}}(n,e)),n.on("close",()=>e.emit("close",n)),n.connect(),n}function L(e,t){if(t&&e.s.servers.has(t.address)){e.s.servers.get(t.address).s.description=t}for(const t of e.description.servers.values())if(!e.s.servers.has(t.address)){const n=D(e,t);e.s.servers.set(t.address,n)}for(const t of e.s.servers){const n=t[0];if(e.description.hasServer(n))continue;const o=e.s.servers.get(n);e.s.servers.delete(n),P(o,e)}}function j(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{};const o=e.topology,i=e.op,r=e.ns,s=e.ops,a=!e.retrying&&!!t.retryWrites&&t.session&&g(o)&&!t.session.inTransaction();o.selectServer(f(),t,(o,c)=>{if(o)return void n(o,null);const l=(o,i)=>{if(!o)return n(null,i);if(!S(o))return o=k(o),n(o);if(a){return j(Object.assign({},e,{retrying:!0}),t,n)}return n(o)};n.operationId&&(l.operationId=n.operationId),a&&(t.session.incrementTransactionNumber(),t.willRetryWrite=a),c[i](r,s,t,l)})}function z(e,t,n){function o(){e.emit("descriptionReceived",new i(e.description.address,null,{error:t})),e.monitor()}(n=Object.assign({},{clearPool:!1},n)).clearPool&&e.s.pool?e.s.pool.reset(()=>o()):o()}function U(e){if(null==e.readPreference)return;let t=e.readPreference;if("string"==typeof t)e.readPreference=new h(t);else if(!t||t instanceof h||"object"!=typeof t){if(!(t instanceof h))throw new TypeError("Invalid read preference: "+t)}else{const n=t.mode||t.preference;n&&"string"==typeof n&&(e.readPreference=new h(n,t.tags,{maxStalenessSeconds:t.maxStalenessSeconds}))}return e}e.exports=B},function(e,t,n){"use strict";const o=n(9),i=n(3).MongoError,r=n(85),s=n(5).relayEvents,a=n(92),c=n(12).retrieveBSON(),l=n(6).createClientInfo,p=n(18),u=n(24).ServerDescription,d=n(11),h=n(94).monitorServer,m=n(3).MongoParseError,f=n(3).MongoNetworkError,g=n(5).collationNotSupported,y=n(12).debugOptions,v=n(3).isSDAMUnrecoverableError,b=["reconnect","reconnectTries","reconnectInterval","emitError","cursorFactory","host","port","size","keepAlive","keepAliveInitialDelay","noDelay","connectionTimeout","checkServerIdentity","socketTimeout","ssl","ca","crl","cert","key","rejectUnauthorized","promoteLongs","promoteValues","promoteBuffers","servername"],x=0,S=1,w=2;class _ extends o{constructor(e,t,n){super(),this.s={description:e,options:t,logger:p("Server",t),bson:t.bson||new c,clientInfo:l(t),monitoring:!1,monitorFunction:t.monitorFunction||h,pool:null,state:x,credentials:t.credentials,topology:n}}get description(){return this.s.description}get name(){return this.s.description.address}get autoEncrypter(){return this.s.options&&this.s.options.autoEncrypter?this.s.options.autoEncrypter:null}connect(e){if(e=e||{},this.s.pool&&!this.s.pool.isDisconnected()&&!this.s.pool.isDestroyed())throw new i(`Server instance in invalid state ${this.s.pool.state}`);const t=this.description.address.split(":"),n=Object.assign({host:t[0],port:parseInt(t[1],10)},this.s.options,e,{bson:this.s.bson});var o;n.reconnect=!0,this.s.pool=new r(this,n),this.s.pool.on("connect",(o=this,function(e,t){const n=t.ismaster;if(o.s.lastIsMasterMS=t.lastIsMasterMS,t.agreedCompressor&&(o.s.pool.options.agreedCompressor=t.agreedCompressor),t.zlibCompressionLevel&&(o.s.pool.options.zlibCompressionLevel=t.zlibCompressionLevel),t.ismaster.$clusterTime){const e=t.ismaster.$clusterTime;o.s.sclusterTime=e}o.s.logger.isInfo()&&o.s.logger.info(`server ${o.name} connected with ismaster [${JSON.stringify(n)}]`),o.emit("descriptionReceived",new u(o.description.address,n)),o.s.state=w,o.emit("connect",o)})),this.s.pool.on("close",E(this)),this.s.pool.on("error",E(this)),this.s.pool.on("parseError",function(e){return function(t){e.s.state=x,e.emit("error",new m(t))}}(this)),s(this.s.pool,this,["commandStarted","commandSucceeded","commandFailed"]),this.s.state=S,e.auth?this.s.pool.connect.apply(this.s.pool,e.auth):this.s.pool.connect()}destroy(e,t){"function"==typeof e&&(t=e,e={}),e=Object.assign({},{force:!1},e);const n=e=>{this.emit("closed"),this.s.state=x,"function"==typeof t&&t(e,null)};if(!this.s.pool)return n();["close","error","timeout","parseError","connect"].forEach(e=>{this.s.pool.removeAllListeners(e)}),this.s.monitorId&&clearTimeout(this.s.monitorId),this.s.pool.destroy(e.force,n)}monitor(e){e=e||{},this.s.state!==w||this.s.monitoring||(this.s.monitorId&&clearTimeout(this.s.monitorId),this.s.monitorFunction(this,e))}command(e,t,n,o){"function"==typeof n&&(o=n,n=(n={})||{});const r=function(e,t){const n=O(e);if(n)return n;if(t.readPreference&&!(t.readPreference instanceof d))return new i("readPreference must be an instance of ReadPreference")}(this,n);if(r)return o(r,null);n=Object.assign({},n,{wireProtocolCommand:!1}),this.s.logger.isDebug()&&this.s.logger.debug(`executing command [${JSON.stringify({ns:e,cmd:t,options:y(b,n)})}] against ${this.name}`),g(this,t)?o(new i(`server ${this.name} does not support collation`)):a.command(this,e,t,n,(e,t)=>{e&&(n.session&&e instanceof f&&(n.session.serverSession.isDirty=!0),v(e,this)&&this.emit("error",e)),o(e,t)})}query(e,t,n,o,i){a.query(this,e,t,n,o,(e,t)=>{e&&(o.session&&e instanceof f&&(o.session.serverSession.isDirty=!0),v(e,this)&&this.emit("error",e)),i(e,t)})}getMore(e,t,n,o,i){a.getMore(this,e,t,n,o,(e,t)=>{e&&(o.session&&e instanceof f&&(o.session.serverSession.isDirty=!0),v(e,this)&&this.emit("error",e)),i(e,t)})}killCursors(e,t,n){a.killCursors(this,e,t,(e,t)=>{e&&v(e,this)&&this.emit("error",e),"function"==typeof n&&n(e,t)})}insert(e,t,n,o){T({server:this,op:"insert",ns:e,ops:t},n,o)}update(e,t,n,o){T({server:this,op:"update",ns:e,ops:t},n,o)}remove(e,t,n,o){T({server:this,op:"remove",ns:e,ops:t},n,o)}}function O(e){return e.s.pool?e.s.pool.isDestroyed()?new i("server instance pool was destroyed"):null:new i("server instance is not connected")}function T(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{};const o=e.server,r=e.op,s=e.ns,c=Array.isArray(e.ops)?e.ops:[e.ops],l=O(o);if(l)n(l,null);else{if(!g(o,t))return a[r](o,s,c,t,(e,i)=>{e&&(t.session&&e instanceof f&&(t.session.serverSession.isDirty=!0),v(e,o)&&o.emit("error",e)),n(e,i)});n(new i(`server ${o.name} does not support collation`))}}function E(e){return function(t){t&&e.emit("error",new f(t)),e.emit("close")}}Object.defineProperty(_.prototype,"clusterTime",{get:function(){return this.s.topology.clusterTime},set:function(e){this.s.topology.clusterTime=e}}),e.exports=_},function(e,t,n){"use strict";const o=n(18),i=n(9).EventEmitter,r=n(62);class s{constructor(e){this.srvRecords=e}addresses(){return new Set(this.srvRecords.map(e=>`${e.name}:${e.port}`))}}e.exports.SrvPollingEvent=s,e.exports.SrvPoller=class extends i{constructor(e){if(super(),!e||!e.srvHost)throw new TypeError("options for SrvPoller must exist and include srvHost");this.srvHost=e.srvHost,this.rescanSrvIntervalMS=6e4,this.heartbeatFrequencyMS=e.heartbeatFrequencyMS||1e4,this.logger=o("srvPoller",e),this.haMode=!1,this.generation=0,this._timeout=null}get srvAddress(){return`_mongodb._tcp.${this.srvHost}`}get intervalMS(){return this.haMode?this.heartbeatFrequencyMS:this.rescanSrvIntervalMs}start(){this._timeout||this.schedule()}stop(){this._timeout&&(clearTimeout(this._timeout),this.generation+=1,this._timeout=null)}schedule(){clearTimeout(this._timeout),this._timeout=setTimeout(()=>this._poll(),this.intervalMS)}success(e){this.haMode=!1,this.schedule(),this.emit("srvRecordDiscovery",new s(e))}failure(e,t){this.logger.warn(e,t),this.haMode=!0,this.schedule()}parentDomainMismatch(e){this.logger.warn(`parent domain mismatch on SRV record (${e.name}:${e.port})`,e)}_poll(){const e=this.generation;r.resolveSrv(this.srvAddress,(t,n)=>{if(e!==this.generation)return;if(t)return void this.failure("DNS error",t);const o=[];n.forEach(e=>{!function(e,t){const n=/^.*?\./,o=`.${e.replace(n,"")}`,i=`.${t.replace(n,"")}`;return o.endsWith(i)}(e.name,this.srvHost)?this.parentDomainMismatch(e):o.push(e)}),o.length?this.success(o):this.failure("No valid addresses found at host")})}}},function(e,t,n){"use strict";e.exports={MongoCredentials:class{constructor(e){e=e||{},this.username=e.username,this.password=e.password,this.source=e.source||e.db,this.mechanism=e.mechanism||"default",this.mechanismProperties=e.mechanismProperties}equals(e){return this.mechanism===e.mechanism&&this.username===e.username&&this.password===e.password&&this.source===e.source}resolveAuthMechanism(e){"default"===this.mechanism.toLowerCase()&&(this.mechanism=function(e){if(e){if(Array.isArray(e.saslSupportedMechs))return e.saslSupportedMechs.indexOf("SCRAM-SHA-256")>=0?"scram-sha-256":"scram-sha-1";if(e.maxWireVersion>=3)return"scram-sha-1"}return"mongocr"}(e))}}}},function(e,t,n){"use strict";const o=n(27),i=n(61),r=n(62),s=n(3).MongoParseError,a=n(11),c=/(mongodb(?:\+srv|)):\/\/(?: (?:[^:]*) (?: : ([^@]*) )? @ )?([^/?]*)(?:\/|)(.*)/;function l(e,t){const n=/^.*?\./,o=`.${e.replace(n,"")}`,i=`.${t.replace(n,"")}`;return o.endsWith(i)}function p(e,t){if(Array.isArray(t))1===(t=t.filter((e,n)=>t.indexOf(e)===n)).length&&(t=t[0]);else if(t.indexOf(":")>0)t=t.split(",").reduce((t,n)=>{const o=n.split(":");return t[o[0]]=p(e,o[1]),t},{});else if(t.indexOf(",")>0)t=t.split(",").map(t=>p(e,t));else if("true"===t.toLowerCase()||"false"===t.toLowerCase())t="true"===t.toLowerCase();else if(!Number.isNaN(t)&&!d.has(e)){const e=parseFloat(t);Number.isNaN(e)||(t=parseFloat(t))}return t}const u=new Set(["slaveok","slave_ok","sslvalidate","fsync","safe","retrywrites","j"]),d=new Set(["authsource","replicaset"]),h=new Set(["GSSAPI","MONGODB-X509","MONGODB-CR","DEFAULT","SCRAM-SHA-1","SCRAM-SHA-256","PLAIN"]),m={replicaset:"replicaSet",connecttimeoutms:"connectTimeoutMS",sockettimeoutms:"socketTimeoutMS",maxpoolsize:"maxPoolSize",minpoolsize:"minPoolSize",maxidletimems:"maxIdleTimeMS",waitqueuemultiple:"waitQueueMultiple",waitqueuetimeoutms:"waitQueueTimeoutMS",wtimeoutms:"wtimeoutMS",readconcern:"readConcern",readconcernlevel:"readConcernLevel",readpreference:"readPreference",maxstalenessseconds:"maxStalenessSeconds",readpreferencetags:"readPreferenceTags",authsource:"authSource",authmechanism:"authMechanism",authmechanismproperties:"authMechanismProperties",gssapiservicename:"gssapiServiceName",localthresholdms:"localThresholdMS",serverselectiontimeoutms:"serverSelectionTimeoutMS",serverselectiontryonce:"serverSelectionTryOnce",heartbeatfrequencyms:"heartbeatFrequencyMS",retrywrites:"retryWrites",uuidrepresentation:"uuidRepresentation",zlibcompressionlevel:"zlibCompressionLevel",tlsallowinvalidcertificates:"tlsAllowInvalidCertificates",tlsallowinvalidhostnames:"tlsAllowInvalidHostnames",tlsinsecure:"tlsInsecure",tlscafile:"tlsCAFile",tlscertificatekeyfile:"tlsCertificateKeyFile",tlscertificatekeyfilepassword:"tlsCertificateKeyFilePassword",wtimeout:"wTimeoutMS",j:"journal"};function f(e,t,n,o){if("journal"===t?t="j":"wtimeoutms"===t&&(t="wtimeout"),u.has(t)?n="true"===n||!0===n:"appname"===t?n=decodeURIComponent(n):"readconcernlevel"===t&&(e.readConcernLevel=n,t="readconcern",n={level:n}),"compressors"===t&&!(n=Array.isArray(n)?n:[n]).every(e=>"snappy"===e||"zlib"===e))throw new s("Value for `compressors` must be at least one of: `snappy`, `zlib`");if("authmechanism"===t&&!h.has(n))throw new s("Value for `authMechanism` must be one of: `DEFAULT`, `GSSAPI`, `PLAIN`, `MONGODB-X509`, `SCRAM-SHA-1`, `SCRAM-SHA-256`");if("readpreference"===t&&!a.isValid(n))throw new s("Value for `readPreference` must be one of: `primary`, `primaryPreferred`, `secondary`, `secondaryPreferred`, `nearest`");if("zlibcompressionlevel"===t&&(n<-1||n>9))throw new s("zlibCompressionLevel must be an integer between -1 and 9");"compressors"!==t&&"zlibcompressionlevel"!==t||(e.compression=e.compression||{},e=e.compression),"authmechanismproperties"===t&&("string"==typeof n.SERVICE_NAME&&(e.gssapiServiceName=n.SERVICE_NAME),"string"==typeof n.SERVICE_REALM&&(e.gssapiServiceRealm=n.SERVICE_REALM),void 0!==n.CANONICALIZE_HOST_NAME&&(e.gssapiCanonicalizeHostName=n.CANONICALIZE_HOST_NAME)),"readpreferencetags"===t&&Array.isArray(n)&&(n=function(e){const t=[];for(let n=0;n<e.length;n++)t[n]={},e[n].split(",").forEach(e=>{const o=e.split(":");t[n][o[0]]=o[1]});return t}(n)),o.caseTranslate&&m[t]?e[m[t]]=n:e[t]=n}const g=new Set(["GSSAPI","MONGODB-CR","PLAIN","SCRAM-SHA-1","SCRAM-SHA-256"]);function y(e,t){const n={};let o=i.parse(e);!function(e){const t=Object.keys(e);if(-1!==t.indexOf("tlsInsecure")&&(-1!==t.indexOf("tlsAllowInvalidCertificates")||-1!==t.indexOf("tlsAllowInvalidHostnames")))throw new s("The `tlsInsecure` option cannot be used with `tlsAllowInvalidCertificates` or `tlsAllowInvalidHostnames`.");const n=v("tls",e,t),o=v("ssl",e,t);if(null!=n&&null!=o&&n!==o)throw new s("All values of `tls` and `ssl` must be the same.")}(o);for(const e in o){const i=o[e];if(""===i||null==i)throw new s("Incomplete key value pair for option");const r=e.toLowerCase();f(n,r,p(r,i),t)}return n.wtimeout&&n.wtimeoutms&&(delete n.wtimeout,console.warn("Unsupported option `wtimeout` specified")),Object.keys(n).length?n:null}function v(e,t,n){const o=-1!==n.indexOf(e);let i;if(i=Array.isArray(t[e])?t[e][0]:t[e],o&&Array.isArray(t[e])){const n=t[e][0];t[e].forEach(e=>{if(e!==n)throw new s("All values of ${optionName} must be the same.")})}return i}const b="mongodb+srv",x=["mongodb",b];function S(e,t,n){"function"==typeof t&&(n=t,t={}),t=Object.assign({},{caseTranslate:!0},t);try{o.parse(e)}catch(e){return n(new s("URI malformed, cannot be parsed"))}const a=e.match(c);if(!a)return n(new s("Invalid connection string"));const p=a[1];if(-1===x.indexOf(p))return n(new s("Invalid protocol provided"));if(p===b)return function(e,t,n){const a=o.parse(e,!0);if(a.hostname.split(".").length<3)return n(new s("URI does not have hostname, domain name and tld"));if(a.domainLength=a.hostname.split(".").length,a.pathname&&a.pathname.match(","))return n(new s("Invalid URI, cannot contain multiple hostnames"));if(a.port)return n(new s(`Ports not accepted with '${b}' URIs`));const c=a.host;r.resolveSrv(`_mongodb._tcp.${c}`,(e,p)=>{if(e)return n(e);if(0===p.length)return n(new s("No addresses found at host"));for(let e=0;e<p.length;e++)if(!l(p[e].name,a.hostname,a.domainLength))return n(new s("Server record does not share hostname with parent URI"));a.protocol="mongodb",a.host=p.map(e=>`${e.name}:${e.port}`).join(","),"ssl"in t||a.search&&"ssl"in a.query&&null!==a.query.ssl||(a.query.ssl=!0),r.resolveTxt(c,(e,r)=>{if(e){if("ENODATA"!==e.code)return n(e);r=null}if(r){if(r.length>1)return n(new s("Multiple text records not allowed"));if(r=i.parse(r[0].join("")),Object.keys(r).some(e=>"authSource"!==e&&"replicaSet"!==e))return n(new s("Text record must only set `authSource` or `replicaSet`"));Object.assign(a.query,r)}a.search=i.stringify(a.query),S(o.format(a),t,(e,t)=>{e?n(e):n(null,Object.assign({},t,{srvHost:c}))})})})}(e,t,n);const u=a[4].split("?"),d=u.length>0?u[0]:null,h=u.length>1?u[1]:null;let m;try{m=y(h,t)}catch(e){return n(e)}m=Object.assign({},m,t);const f={username:null,password:null,db:d&&""!==d?i.unescape(d):null};if(m.auth&&(m.auth.username&&(f.username=m.auth.username),m.auth.user&&(f.username=m.auth.user),m.auth.password&&(f.password=m.auth.password)),-1!==a[4].split("?")[0].indexOf("@"))return n(new s("Unescaped slash in userinfo section"));const v=a[3].split("@");if(v.length>2)return n(new s("Unescaped at-sign in authority section"));if(v.length>1){const e=v.shift().split(":");if(e.length>2)return n(new s("Unescaped colon in authority section"));f.username=i.unescape(e[0]),f.password=e[1]?i.unescape(e[1]):null}let w=null;const _=v.shift().split(",").map(e=>{let t=o.parse(`mongodb://${e}`);if("/:"===t.path)return w=new s("Double colon in host identifier"),null;if(e.match(/\.sock/)&&(t.hostname=i.unescape(e),t.port=null),Number.isNaN(t.port))return void(w=new s("Invalid port (non-numeric string)"));const n={host:t.hostname,port:t.port?parseInt(t.port):27017};if(0!==n.port)if(n.port>65535)w=new s("Invalid port (larger than 65535) with hostname");else{if(!(n.port<0))return n;w=new s("Invalid port (negative number)")}else w=new s("Invalid port (zero) with hostname")}).filter(e=>!!e);if(w)return n(w);if(0===_.length||""===_[0].host||null===_[0].host)return n(new s("No hostname or hostnames provided in connection string"));const O={hosts:_,auth:f.db||f.username?f:null,options:Object.keys(m).length?m:null};O.auth&&O.auth.db&&(O.defaultDatabase=O.auth.db);try{!function(e){if(null==e.options)return;const t=e.options,n=t.authsource||t.authSource;null!=n&&(e.auth=Object.assign({},e.auth,{db:n}));const o=t.authmechanism||t.authMechanism;if(null!=o){if(g.has(o)&&(!e.auth||null==e.auth.username))throw new s(`Username required for mechanism \`${o}\``);if("GSSAPI"===o){if(null!=n&&"$external"!==n)throw new s(`Invalid source \`${n}\` for mechanism \`${o}\` specified.`);e.auth=Object.assign({},e.auth,{db:"$external"})}if("MONGODB-X509"===o){if(e.auth&&null!=e.auth.password)throw new s(`Password not allowed for mechanism \`${o}\``);if(null!=n&&"$external"!==n)throw new s(`Invalid source \`${n}\` for mechanism \`${o}\` specified.`);e.auth=Object.assign({},e.auth,{db:"$external"})}"PLAIN"===o&&e.auth&&null==e.auth.db&&(e.auth=Object.assign({},e.auth,{db:"$external"}))}e.auth&&null==e.auth.db&&(e.auth=Object.assign({},e.auth,{db:"admin"}))}(O)}catch(e){return n(e)}n(null,O)}e.exports=S},function(e,t,n){"use strict";const o=n(9).EventEmitter;e.exports=class extends o{constructor(){super()}instrument(e,t){this.$MongoClient=e;const n=this.$prototypeConnect=e.prototype.connect,o=this;e.prototype.connect=function(e){return this.s.options.monitorCommands=!0,this.on("commandStarted",e=>o.emit("started",e)),this.on("commandSucceeded",e=>o.emit("succeeded",e)),this.on("commandFailed",e=>o.emit("failed",e)),n.call(this,e)},"function"==typeof t&&t(null,this)}uninstrument(){this.$MongoClient.prototype.connect=this.$prototypeConnect}}},function(e,t,n){"use strict";const o=n(19).buildCountCommand,i=n(0).formattedOrderClause,r=n(0).handleCallback,s=n(2).MongoError,a=Array.prototype.push,c=n(13).CursorState;function l(e,t){if(0!==e.bufferedCount())return e._next(t),l}function p(e,t){if(e.s.state===c.CLOSED||e.isDead&&e.isDead())return r(t,s.create({message:"Cursor is closed",driver:!0}));if(e.s.state===c.INIT&&e.cmd.sort)try{e.cmd.sort=i(e.cmd.sort)}catch(e){return r(t,e)}e._next((n,o)=>{if(e.s.state=c.OPEN,n)return r(t,n);r(t,null,o)})}e.exports={count:function(e,t,n,i){t&&("number"==typeof e.cursorSkip()&&(n.skip=e.cursorSkip()),"number"==typeof e.cursorLimit()&&(n.limit=e.cursorLimit())),n.readPreference&&e.setReadPreference(n.readPreference),"number"!=typeof n.maxTimeMS&&e.cmd&&"number"==typeof e.cmd.maxTimeMS&&(n.maxTimeMS=e.cmd.maxTimeMS);let r,s={};s.skip=n.skip,s.limit=n.limit,s.hint=n.hint,s.maxTimeMS=n.maxTimeMS,s.collectionName=e.namespace.collection;try{r=o(e,e.cmd.query,s)}catch(e){return i(e)}e.server=e.topology.s.coreTopology,e.topology.command(e.namespace.withCollection("$cmd"),r,e.options,(e,t)=>{i(e,t?t.result.n:null)})},each:function e(t,n){if(!n)throw s.create({message:"callback is mandatory",driver:!0});if(t.isNotified())return;if(t.s.state===c.CLOSED||t.isDead())return r(n,s.create({message:"Cursor is closed",driver:!0}));t.s.state===c.INIT&&(t.s.state=c.OPEN);let o=null;if(t.bufferedCount()>0){for(;o=l(t,n);)o(t,n);e(t,n)}else t.next((o,i)=>o?r(n,o):null==i?t.close({skipKillCursors:!0},()=>r(n,null,null)):void(!1!==r(n,null,i)&&e(t,n)))},hasNext:function(e,t){return e.s.currentDoc?t(null,!0):e.isNotified()?t(null,!1):void p(e,(n,o)=>n?t(n,null):e.s.state===c.CLOSED||e.isDead()?t(null,!1):o?(e.s.currentDoc=o,void t(null,!0)):t(null,!1))},next:function(e,t){if(e.s.currentDoc){const n=e.s.currentDoc;return e.s.currentDoc=null,t(null,n)}p(e,t)},toArray:function(e,t){const n=[];e.rewind(),e.s.state=c.INIT;const o=()=>{e._next((i,s)=>{if(i)return e._endSession?e._endSession(()=>r(t,i)):r(t,i);if(null==s)return e.close({skipKillCursors:!0},()=>r(t,null,n));if(n.push(s),e.bufferedCount()>0){let t=e.readBufferedDocuments(e.bufferedCount());e.s.transforms&&"function"==typeof e.s.transforms.doc&&(t=t.map(e.s.transforms.doc)),a.apply(n,t)}o()})};o()}}},function(e,t,n){"use strict";const o=n(97),i=o.BulkOperationBase,r=o.Batch,s=o.bson,a=n(0).toError;function c(e,t,n){const i=s.calculateObjectSize(n,{checkKeys:!1,ignoreUndefined:!1});if(i>=e.s.maxBatchSizeBytes)throw a("document is larger than the maximum size "+e.s.maxBatchSizeBytes);e.s.currentBatch=null,t===o.INSERT?e.s.currentBatch=e.s.currentInsertBatch:t===o.UPDATE?e.s.currentBatch=e.s.currentUpdateBatch:t===o.REMOVE&&(e.s.currentBatch=e.s.currentRemoveBatch);const c=e.s.maxKeySize;if(null==e.s.currentBatch&&(e.s.currentBatch=new r(t,e.s.currentIndex)),(e.s.currentBatch.size+1>=e.s.maxWriteBatchSize||e.s.currentBatch.sizeBytes+c+i>=e.s.maxBatchSizeBytes||e.s.currentBatch.batchType!==t)&&(e.s.batches.push(e.s.currentBatch),e.s.currentBatch=new r(t,e.s.currentIndex)),Array.isArray(n))throw a("operation passed in cannot be an Array");return e.s.currentBatch.operations.push(n),e.s.currentBatch.originalIndexes.push(e.s.currentIndex),e.s.currentIndex=e.s.currentIndex+1,t===o.INSERT?(e.s.currentInsertBatch=e.s.currentBatch,e.s.bulkResult.insertedIds.push({index:e.s.bulkResult.insertedIds.length,_id:n._id})):t===o.UPDATE?e.s.currentUpdateBatch=e.s.currentBatch:t===o.REMOVE&&(e.s.currentRemoveBatch=e.s.currentBatch),e.s.currentBatch.size+=1,e.s.currentBatch.sizeBytes+=c+i,e}class l extends i{constructor(e,t,n){n=n||{},super(e,t,n=Object.assign(n,{addToOperationsList:c}),!1)}}function p(e,t,n){return new l(e,t,n)}p.UnorderedBulkOperation=l,e.exports=p,e.exports.Bulk=l},function(e,t,n){"use strict";const o=n(97),i=o.BulkOperationBase,r=o.Batch,s=o.bson,a=n(0).toError;function c(e,t,n){const i=s.calculateObjectSize(n,{checkKeys:!1,ignoreUndefined:!1});if(i>=e.s.maxBatchSizeBytes)throw a("document is larger than the maximum size "+e.s.maxBatchSizeBytes);null==e.s.currentBatch&&(e.s.currentBatch=new r(t,e.s.currentIndex));const c=e.s.maxKeySize;if((e.s.currentBatchSize+1>=e.s.maxWriteBatchSize||e.s.currentBatchSizeBytes+c+i>=e.s.maxBatchSizeBytes||e.s.currentBatch.batchType!==t)&&(e.s.batches.push(e.s.currentBatch),e.s.currentBatch=new r(t,e.s.currentIndex),e.s.currentBatchSize=0,e.s.currentBatchSizeBytes=0),t===o.INSERT&&e.s.bulkResult.insertedIds.push({index:e.s.currentIndex,_id:n._id}),Array.isArray(n))throw a("operation passed in cannot be an Array");return e.s.currentBatch.originalIndexes.push(e.s.currentIndex),e.s.currentBatch.operations.push(n),e.s.currentBatchSize+=1,e.s.currentBatchSizeBytes+=c+i,e.s.currentIndex+=1,e}class l extends i{constructor(e,t,n){n=n||{},super(e,t,n=Object.assign(n,{addToOperationsList:c}),!0)}}function p(e,t,n){return new l(e,t,n)}p.OrderedBulkOperation=l,e.exports=p,e.exports.Bulk=l},function(e,t,n){"use strict";const o=n(55);e.exports=class extends o{constructor(e,t,n){const o=[{$match:t}];"number"==typeof n.skip&&o.push({$skip:n.skip}),"number"==typeof n.limit&&o.push({$limit:n.limit}),o.push({$group:{_id:1,n:{$sum:1}}}),super(e,o,n)}execute(e,t){super.execute(e,(e,n)=>{if(e)return void t(e,null);const o=n.result;if(null==o.cursor||null==o.cursor.firstBatch)return void t(null,0);const i=o.cursor.firstBatch;t(null,i.length?i[0].n:0)})}}},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(1).defineAspects,r=n(1).OperationBase,s=n(10).executeCommand,a=n(2).MongoError,c=n(2).ReadPreference;class l extends r{constructor(e,t,n){super(n),this.collection=e,this.indexSpecs=t}execute(e){const t=this.collection,n=this.indexSpecs;let o=this.options;const i=t.s.topology.capabilities();for(let t=0;t<n.length;t++)if(null==n[t].name){const o=[];if(n[t].collation&&i&&!i.commandsTakeCollation)return e(new a("server/primary/mongos does not support collation"));for(let e in n[t].key)o.push(`${e}_${n[t].key[e]}`);n[t].name=o.join("_")}o=Object.assign({},o,{readPreference:c.PRIMARY}),s(t.s.db,{createIndexes:t.collectionName,indexes:n},o,e)}}i(l,o.WRITE_OPERATION),e.exports=l},function(e,t,n){"use strict";const o=n(1).OperationBase,i=n(8).deleteCallback,r=n(8).removeDocuments;e.exports=class extends o{constructor(e,t,n){super(n),this.collection=e,this.filter=t}execute(e){const t=this.collection,n=this.filter,o=this.options;o.single=!1,r(t,n,o,(t,n)=>i(t,n,e))}}},function(e,t,n){"use strict";const o=n(1).OperationBase,i=n(8).deleteCallback,r=n(8).removeDocuments;e.exports=class extends o{constructor(e,t,n){super(n),this.collection=e,this.filter=t}execute(e){const t=this.collection,n=this.filter,o=this.options;o.single=!0,r(t,n,o,(t,n)=>i(t,n,e))}}},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(1).defineAspects,r=n(33),s=n(0).decorateWithCollation,a=n(0).decorateWithReadConcern;class c extends r{constructor(e,t,n,o){super(e,o),this.collection=e,this.key=t,this.query=n}execute(e,t){const n=this.collection,o=this.key,i=this.query,r=this.options,c={distinct:n.collectionName,key:o,query:i};"number"==typeof r.maxTimeMS&&(c.maxTimeMS=r.maxTimeMS),a(c,n,r);try{s(c,n,r)}catch(e){return t(e,null)}super.executeCommand(e,c,(e,n)=>{e?t(e):t(null,this.options.full?n:n.values)})}}i(c,[o.READ_OPERATION,o.RETRYABLE,o.EXECUTE_WITH_SELECTION]),e.exports=c},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(1).defineAspects,r=n(100),s=n(0).handleCallback;class a extends r{constructor(e,t){super(e,"*",t)}execute(e){super.execute(t=>{if(t)return s(e,t,!1);s(e,null,!0)})}}i(a,o.WRITE_OPERATION),e.exports=a},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(1).defineAspects,r=n(33);class s extends r{constructor(e,t,n){void 0===n&&(n=t,t=void 0),super(e,n),this.collectionName=e.s.namespace.collection,t&&(this.query=t)}execute(e,t){const n=this.options,o={count:this.collectionName};this.query&&(o.query=this.query),"number"==typeof n.skip&&(o.skip=n.skip),"number"==typeof n.limit&&(o.limit=n.limit),n.hint&&(o.hint=n.hint),super.executeCommand(e,o,(e,n)=>{e?t(e):t(null,n.n)})}}i(s,[o.READ_OPERATION,o.RETRYABLE,o.EXECUTE_WITH_SELECTION]),e.exports=s},function(e,t,n){"use strict";const o=n(1).OperationBase,i=n(1).Aspect,r=n(1).defineAspects,s=n(0).resolveReadPreference;class a extends o{constructor(e,t,n,o){super(o),this.ns=t,this.cmd=n,this.readPreference=s(e,this.options)}execute(e,t){this.server=e;const n=this.cursorState||{};e.query(this.ns.toString(),this.cmd,n,this.options,t)}}r(a,[i.READ_OPERATION,i.RETRYABLE,i.EXECUTE_WITH_SELECTION,i.SKIP_SESSION]),e.exports=a},function(e,t,n){"use strict";const o=n(0).handleCallback,i=n(1).OperationBase,r=n(0).toError;e.exports=class extends i{constructor(e,t,n){super(n),this.collection=e,this.query=t}execute(e){const t=this.collection,n=this.query,i=this.options;t.find(n,i).limit(-1).batchSize(1).next((t,n)=>{if(null!=t)return o(e,r(t),null);o(e,null,n)})}}},function(e,t,n){"use strict";const o=n(56);e.exports=class extends o{constructor(e,t,n){const o=Object.assign({},n);o.fields=n.projection,o.remove=!0,super(e,t,o.sort,null,o)}}},function(e,t,n){"use strict";const o=n(56);e.exports=class extends o{constructor(e,t,n,o){const i=Object.assign({},o);i.fields=o.projection,i.update=!0,i.new=void 0!==o.returnOriginal&&!o.returnOriginal,i.upsert=void 0!==o.upsert&&!!o.upsert,super(e,t,i.sort,n,i)}}},function(e,t,n){"use strict";const o=n(56);e.exports=class extends o{constructor(e,t,n,o){const i=Object.assign({},o);i.fields=o.projection,i.update=!0,i.new="boolean"==typeof o.returnOriginal&&!o.returnOriginal,i.upsert="boolean"==typeof o.upsert&&o.upsert,super(e,t,i.sort,n,i)}}},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(1).defineAspects,r=n(1).OperationBase,s=n(0).decorateCommand,a=n(0).decorateWithReadConcern,c=n(10).executeCommand,l=n(0).handleCallback,p=n(0).resolveReadPreference,u=n(0).toError;class d extends r{constructor(e,t,n,o){super(o),this.collection=e,this.x=t,this.y=n}execute(e){const t=this.collection,n=this.x,o=this.y;let i=this.options,r={geoSearch:t.collectionName,near:[n,o]};r=s(r,i,["readPreference","session"]),(i=Object.assign({},i)).readPreference=p(t,i),a(r,t,i),c(t.s.db,r,i,(t,n)=>{if(t)return l(e,t);(n.err||n.errmsg)&&l(e,u(n)),l(e,null,n)})}}i(d,o.READ_OPERATION),e.exports=d},function(e,t,n){"use strict";const o=n(1).OperationBase,i=n(8).indexInformation;e.exports=class extends o{constructor(e,t){super(t),this.collection=e}execute(e){const t=this.collection;let n=this.options;n=Object.assign({},{full:!0},n),i(t.s.db,t.collectionName,n,e)}}},function(e,t,n){"use strict";const o=n(1).OperationBase,i=n(0).handleCallback,r=n(10).indexInformation;e.exports=class extends o{constructor(e,t,n){super(n),this.collection=e,this.indexes=t}execute(e){const t=this.collection,n=this.indexes,o=this.options;r(t.s.db,t.collectionName,o,(t,o)=>{if(null!=t)return i(e,t,null);if(!Array.isArray(n))return i(e,null,null!=o[n]);for(let t=0;t<n.length;t++)if(null==o[n[t]])return i(e,null,!1);return i(e,null,!0)})}}},function(e,t,n){"use strict";const o=n(1).OperationBase,i=n(98),r=n(2).MongoError,s=n(8).prepareDocs;e.exports=class extends o{constructor(e,t,n){super(n),this.collection=e,this.docs=t}execute(e){const t=this.collection;let n=this.docs;const o=this.options;if(!Array.isArray(n))return e(r.create({message:"docs parameter must be an array of documents",driver:!0}));o.serializeFunctions=o.serializeFunctions||t.s.serializeFunctions,n=s(t,n,o),new i(t,[{insertMany:n}],o).execute((t,o)=>{if(t)return e(t,null);e(null,function(e,t){const n={result:{ok:1,n:t.insertedCount},ops:e,insertedCount:t.insertedCount,insertedIds:t.insertedIds};t.getLastOp()&&(n.result.opTime=t.getLastOp());return n}(n,o))})}}},function(e,t,n){"use strict";const o=n(2).MongoError,i=n(1).OperationBase,r=n(8).insertDocuments;e.exports=class extends i{constructor(e,t,n){super(n),this.collection=e,this.doc=t}execute(e){const t=this.collection,n=this.doc,i=this.options;if(Array.isArray(n))return e(o.create({message:"doc parameter must be an object",driver:!0}));r(t,[n],i,(t,o)=>{if(null!=e){if(t&&e)return e(t);if(null==o)return e(null,{result:{ok:1}});o.insertedCount=o.result.n,o.insertedId=n._id,e&&e(null,o)}})}}},function(e,t,n){"use strict";const o=n(102),i=n(0).handleCallback;e.exports=class extends o{constructor(e,t){super(e,t)}execute(e){super.execute((t,n)=>{if(t)return i(e,t);i(e,null,!(!n||!n.capped))})}}},function(e,t,n){"use strict";const o=n(33),i=n(1).Aspect,r=n(1).defineAspects,s=n(5).maxWireVersion,a=3;class c extends o{constructor(e,t){super(e,t,{fullResponse:!0}),this.collectionNamespace=e.s.namespace}execute(e,t){if(s(e)<a){const n=this.collectionNamespace.withCollection("system.indexes").toString(),o=this.collectionNamespace.toString();return void e.query(n,{query:{ns:o}},{},this.options,t)}const n=this.options.batchSize?{batchSize:this.options.batchSize}:{};super.executeCommand(e,{listIndexes:this.collectionNamespace.collection,cursor:n},t)}}r(c,[i.READ_OPERATION,i.RETRYABLE,i.EXECUTE_WITH_SELECTION]),e.exports=c},function(e,t,n){"use strict";const o=n(0).applyWriteConcern,i=n(2).BSON.Code,r=n(0).decorateWithCollation,s=n(0).decorateWithReadConcern,a=n(10).executeCommand,c=n(0).handleCallback,l=n(0).isObject,p=n(57).loadDb,u=n(1).OperationBase,d=n(0).resolveReadPreference,h=n(0).toError,m=["readPreference","session","bypassDocumentValidation","w","wtimeout","j","writeConcern"];function f(e){if(!l(e)||"ObjectID"===e._bsontype)return e;const t=Object.keys(e);let n;const o={};for(let r=t.length-1;r>=0;r--)"function"==typeof e[n=t[r]]?o[n]=new i(String(e[n])):o[n]=f(e[n]);return o}e.exports=class extends u{constructor(e,t,n,o){super(o),this.collection=e,this.map=t,this.reduce=n}execute(e){const t=this.collection,n=this.map,i=this.reduce;let l=this.options;const u={mapreduce:t.collectionName,map:n,reduce:i};for(let e in l)"scope"===e?u[e]=f(l[e]):-1===m.indexOf(e)&&(u[e]=l[e]);(l=Object.assign({},l)).readPreference=d(t,l),!1!==l.readPreference&&"primary"!==l.readPreference&&l.out&&1!==l.out.inline&&"inline"!==l.out?(l.readPreference="primary",o(u,{db:t.s.db,collection:t},l)):s(u,t,l),!0===l.bypassDocumentValidation&&(u.bypassDocumentValidation=l.bypassDocumentValidation);try{r(u,t,l)}catch(t){return e(t,null)}a(t.s.db,u,l,(n,o)=>{if(n)return c(e,n);if(1!==o.ok||o.err||o.errmsg)return c(e,h(o));const i={};if(o.timeMillis&&(i.processtime=o.timeMillis),o.counts&&(i.counts=o.counts),o.timing&&(i.timing=o.timing),o.results)return null!=l.verbose&&l.verbose?c(e,null,{results:o.results,stats:i}):c(e,null,o.results);let r=null;if(null!=o.result&&"object"==typeof o.result){const e=o.result;r=new(p())(e.db,t.s.db.s.topology,t.s.db.s.options).collection(e.collection)}else r=t.s.db.collection(o.result);if(null==l.verbose||!l.verbose)return c(e,n,r);c(e,n,{collection:r,stats:i})})}}},function(e,t,n){"use strict";const o=n(1).OperationBase,i=n(0).handleCallback;let r;e.exports=class extends o{constructor(e,t){super(t),this.db=e}execute(e){const t=this.db;let o=this.options,s=(r||(r=n(32)),r);o=Object.assign({},o,{nameOnly:!0}),t.listCollections({},o).toArray((n,o)=>{if(null!=n)return i(e,n,null);o=o.filter(e=>-1===e.name.indexOf("$")),i(e,null,o.map(e=>new s(t,t.s.topology,t.databaseName,e.name,t.s.pkFactory,t.s.options)))})}}},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(1).defineAspects,r=n(15),s=n(0).applyWriteConcern,a=n(0).handleCallback,c=n(57).loadCollection,l=n(2).MongoError,p=n(2).ReadPreference,u=["w","wtimeout","j","fsync","autoIndexId","strict","serializeFunctions","pkFactory","raw","readPreference","session","readConcern","writeConcern"];class d extends r{constructor(e,t,n){super(e,n),this.name=t}_buildCommand(){const e=this.name,t=this.options,n={create:e};for(let e in t)null!=t[e]&&"function"!=typeof t[e]&&-1===u.indexOf(e)&&(n[e]=t[e]);return n}execute(e){const t=this.db,n=this.name,o=this.options;let i=c();if(t.serverConfig&&t.serverConfig.isDestroyed())return e(new l("topology was destroyed"));let r=Object.assign({},o,{nameOnly:!0});r=s(r,{db:t},r),t.listCollections({name:n},r).setReadPreference(p.PRIMARY).toArray((s,c)=>{if(null!=s)return a(e,s,null);if(c.length>0&&r.strict)return a(e,l.create({message:`Collection ${n} already exists. Currently in strict mode.`,driver:!0}),null);if(c.length>0)try{return a(e,null,new i(t,t.s.topology,t.databaseName,n,t.s.pkFactory,o))}catch(s){return a(e,s)}super.execute(r=>{if(r)return a(e,r);try{return a(e,null,new i(t,t.s.topology,t.databaseName,n,t.s.pkFactory,o))}catch(r){return a(e,r)}})})}}i(d,o.WRITE_OPERATION),e.exports=d},function(e,t,n){"use strict";const o=n(33),i=n(1).Aspect,r=n(1).defineAspects,s=n(5).maxWireVersion,a=n(73),c=3;class l extends o{constructor(e,t,n){super(e,n,{fullResponse:!0}),this.db=e,this.filter=t,this.nameOnly=!!this.options.nameOnly,"number"==typeof this.options.batchSize&&(this.batchSize=this.options.batchSize)}execute(e,t){if(s(e)<c){let n=this.filter;const o=this.db.s.namespace.db;"string"!=typeof n.name||new RegExp("^"+o+"\\.").test(n.name)||((n=Object.assign({},n)).name=this.db.s.namespace.withCollection(n.name).toString()),null==n&&(n.name=`/${o}/`),n=n.name?{$and:[{name:n.name},{name:/^((?!\$).)*$/}]}:{name:/^((?!\$).)*$/};const i=function(e){const t=`${e}.`;return{doc:e=>{const n=e.name.indexOf(t);return e.name&&0===n&&(e.name=e.name.substr(n+t.length)),e}}}(o);return void e.query(`${o}.${a.SYSTEM_NAMESPACE_COLLECTION}`,{query:n},{batchSize:this.batchSize||1e3},{},(e,n)=>{n&&n.message&&n.message.documents&&Array.isArray(n.message.documents)&&(n.message.documents=n.message.documents.map(i.doc)),t(e,n)})}const n={listCollections:1,filter:this.filter,cursor:this.batchSize?{batchSize:this.batchSize}:{},nameOnly:this.nameOnly};return super.executeCommand(e,n,t)}}r(l,[i.READ_OPERATION,i.RETRYABLE,i.EXECUTE_WITH_SELECTION]),e.exports=l},function(e,t,n){"use strict";const o=n(15);e.exports=class extends o{constructor(e,t,n){super(e,n)}_buildCommand(){return{profile:-1}}execute(e){super.execute((t,n)=>{if(null==t&&1===n.ok){const t=n.was;return 0===t?e(null,"off"):1===t?e(null,"slow_only"):2===t?e(null,"all"):e(new Error("Error: illegal profiling level value "+t),null)}e(null!=t?t:new Error("Error with profile command"),null)})}}},function(e,t,n){"use strict";const o=n(15),i=new Set(["off","slow_only","all"]);e.exports=class extends o{constructor(e,t,n){let o=0;"off"===t?o=0:"slow_only"===t?o=1:"all"===t&&(o=2),super(e,n),this.level=t,this.profile=o}_buildCommand(){return{profile:this.profile}}execute(e){const t=this.level;if(!i.has(t))return e(new Error("Error: illegal profiling level value "+t));super.execute((n,o)=>null==n&&1===o.ok?e(null,t):e(null!=n?n:new Error("Error with profile command"),null))}}},function(e,t,n){"use strict";const o=n(15);e.exports=class extends o{constructor(e,t,n){let o={validate:t};const i=Object.keys(n);for(let e=0;e<i.length;e++)n.hasOwnProperty(i[e])&&"session"!==i[e]&&(o[i[e]]=n[i[e]]);super(e.s.db,n,null,o),this.collectionName}execute(e){const t=this.collectionName;super.execute((n,o)=>null!=n?e(n,null):0===o.ok?e(new Error("Error with validate command"),null):null!=o.result&&o.result.constructor!==String?e(new Error("Error with validation data"),null):null!=o.result&&null!=o.result.match(/exception|corrupt/)?e(new Error("Error: invalid collection "+t),null):null==o.valid||o.valid?e(null,o):e(new Error("Error: invalid collection "+t),null))}}},function(e,t,n){"use strict";const o=n(33),i=n(1).Aspect,r=n(1).defineAspects,s=n(0).MongoDBNamespace;class a extends o{constructor(e,t){super(e,t),this.ns=new s("admin","$cmd")}execute(e,t){const n={listDatabases:1};this.options.nameOnly&&(n.nameOnly=Number(n.nameOnly)),this.options.filter&&(n.filter=this.options.filter),"boolean"==typeof this.options.authorizedDatabases&&(n.authorizedDatabases=this.options.authorizedDatabases),super.executeCommand(e,n,t)}}r(a,[i.READ_OPERATION,i.RETRYABLE,i.EXECUTE_WITH_SELECTION]),e.exports=a},function(e,t,n){"use strict";const o=n(15),i=n(0).handleCallback;e.exports=class extends o{constructor(e,t){super(e.s.db,t,e)}_buildCommand(){return{reIndex:this.collection.collectionName}}execute(e){super.execute((t,n)=>{if(null!=e)return t?i(e,t,null):void i(e,null,!!n.ok)})}}},function(e,t,n){"use strict";const o=n(1).OperationBase,i=n(8).updateDocuments;e.exports=class extends o{constructor(e,t,n,o){super(o),this.collection=e,this.filter=t,this.doc=n}execute(e){const t=this.collection,n=this.filter,o=this.doc,r=this.options;r.multi=!1,i(t,n,o,r,(t,n)=>(function(e,t,n,o){if(null==o)return;if(e&&o)return o(e);if(null==t)return o(null,{result:{ok:1}});t.modifiedCount=null!=t.result.nModified?t.result.nModified:t.result.n,t.upsertedId=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?t.result.upserted[0]:null,t.upsertedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length?t.result.upserted.length:0,t.matchedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?0:t.result.n,t.ops=[n],o&&o(null,t)})(t,n,o,e))}}},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(15);class r extends i{constructor(e,t){super(e.s.db,t,e)}_buildCommand(){const e=this.collection,t=this.options,n={collStats:e.collectionName};return null!=t.scale&&(n.scale=t.scale),n}}(0,n(1).defineAspects)(r,o.READ_OPERATION),e.exports=r},function(e,t,n){"use strict";const o=n(1).OperationBase,i=n(8).updateCallback,r=n(8).updateDocuments;e.exports=class extends o{constructor(e,t,n,o){super(o),this.collection=e,this.filter=t,this.update=n}execute(e){const t=this.collection,n=this.filter,o=this.update,s=this.options;s.multi=!0,r(t,n,o,s,(t,n)=>i(t,n,e))}}},function(e,t,n){"use strict";const o=n(1).OperationBase,i=n(8).updateDocuments;e.exports=class extends o{constructor(e,t,n,o){super(o),this.collection=e,this.filter=t,this.update=n}execute(e){const t=this.collection,n=this.filter,o=this.update,r=this.options;r.multi=!1,i(t,n,o,r,(t,n)=>(function(e,t,n){if(null==n)return;if(e)return n(e);if(null==t)return n(null,{result:{ok:1}});t.modifiedCount=null!=t.result.nModified?t.result.nModified:t.result.n,t.upsertedId=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?t.result.upserted[0]:null,t.upsertedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length?t.result.upserted.length:0,t.matchedCount=Array.isArray(t.result.upserted)&&t.result.upserted.length>0?0:t.result.n,n(null,t)})(t,n,e))}}},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(8).buildCountCommand,r=n(1).defineAspects,s=n(1).OperationBase;class a extends s{constructor(e,t,n){super(n),this.cursor=e,this.applySkipLimit=t}execute(e){const t=this.cursor,n=this.applySkipLimit,o=this.options;n&&("number"==typeof t.cursorSkip()&&(o.skip=t.cursorSkip()),"number"==typeof t.cursorLimit()&&(o.limit=t.cursorLimit())),o.readPreference&&t.setReadPreference(o.readPreference),"number"!=typeof o.maxTimeMS&&t.cmd&&"number"==typeof t.cmd.maxTimeMS&&(o.maxTimeMS=t.cmd.maxTimeMS);let r,s={};s.skip=o.skip,s.limit=o.limit,s.hint=o.hint,s.maxTimeMS=o.maxTimeMS,s.collectionName=t.namespace.collection;try{r=i(t,t.cmd.query,s)}catch(t){return e(t)}t.server=t.topology.s.coreTopology,t.topology.command(t.namespace.withCollection("$cmd"),r,t.options,(t,n)=>{e(t,n?n.result.n:null)})}}r(a,o.SKIP_SESSION),e.exports=a},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(13).CoreCursor,r=n(1).defineAspects,s=n(1).OperationBase;class a extends s{constructor(e){super(),this.cursor=e}execute(){const e=this.cursor;return i.prototype._next.apply(e,arguments)}}r(a,o.SKIP_SESSION),e.exports=a},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(1).defineAspects,r=n(57).loadCursor,s=n(1).OperationBase,a=n(8).nextObject;class c extends s{constructor(e){super(),this.cursor=e}execute(e){const t=this.cursor;let n=r();return t.s.currentDoc?e(null,!0):t.isNotified()?e(null,!1):void a(t,(o,i)=>o?e(o,null):t.s.state===n.CLOSED||t.isDead()?e(null,!1):i?(t.s.currentDoc=i,void e(null,!0)):e(null,!1))}}i(c,o.SKIP_SESSION),e.exports=c},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(1).defineAspects,r=n(1).OperationBase,s=n(8).nextObject;class a extends r{constructor(e){super(),this.cursor=e}execute(e){const t=this.cursor;if(t.s.currentDoc){const n=t.s.currentDoc;return t.s.currentDoc=null,e(null,n)}s(t,e)}}i(a,o.SKIP_SESSION),e.exports=a},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(1).defineAspects,r=n(0).handleCallback,s=n(13).CursorState,a=n(1).OperationBase,c=Array.prototype.push;class l extends a{constructor(e){super(),this.cursor=e}execute(e){const t=this.cursor,n=[];t.rewind(),t.s.state=s.INIT;const o=()=>{t._next((i,s)=>{if(i)return t._endSession?t._endSession(()=>r(e,i)):r(e,i);if(null==s)return t.close({skipKillCursors:!0},()=>r(e,null,n));if(n.push(s),t.bufferedCount()>0){let e=t.readBufferedDocuments(t.bufferedCount());t.s.transforms&&"function"==typeof t.s.transforms.doc&&(e=e.map(t.s.transforms.doc)),c.apply(n,e)}o()})};o()}}i(l,o.SKIP_SESSION),e.exports=l},function(e,t,n){"use strict";const o=n(1).OperationBase,i=n(1).defineAspects,r=n(1).Aspect,s=n(4).deprecate,a=n(2).Logger,c=n(2).MongoCredentials,l=n(2).MongoError,p=n(108),u=n(195),d=n(2).parseConnectionString,h=n(38),m=n(2).ReadPreference,f=n(109),g=n(58),y=n(2).Sessions.ServerSessionPool;let v;const b=s(n(196),"current URL string parser is deprecated, and will be removed in a future version. To use the new parser, pass option { useNewUrlParser: true } to MongoClient.connect."),x={DEFAULT:"default","MONGODB-CR":"mongocr",PLAIN:"plain","MONGODB-X509":"x509","SCRAM-SHA-1":"scram-sha-1","SCRAM-SHA-256":"scram-sha-256"},S=["timeout","close","serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha","all","fullsetup","open"],w=new Set(["DEFAULT","MONGODB-CR","PLAIN","MONGODB-X509","SCRAM-SHA-1","SCRAM-SHA-256","GSSAPI"]),_=["poolSize","ssl","sslValidate","sslCA","sslCert","sslKey","sslPass","sslCRL","autoReconnect","noDelay","keepAlive","keepAliveInitialDelay","connectTimeoutMS","family","socketTimeoutMS","reconnectTries","reconnectInterval","ha","haInterval","replicaSet","secondaryAcceptableLatencyMS","acceptableLatencyMS","connectWithNoPrimary","authSource","w","wtimeout","j","forceServerObjectId","serializeFunctions","ignoreUndefined","raw","bufferMaxEntries","readPreference","pkFactory","promiseLibrary","readConcern","maxStalenessSeconds","loggerLevel","logger","promoteValues","promoteBuffers","promoteLongs","domainsEnabled","checkServerIdentity","validateOptions","appname","auth","user","password","authMechanism","compression","fsync","readPreferenceTags","numberOfRetries","auto_reconnect","minSize","monitorCommands","retryWrites","retryReads","useNewUrlParser","useUnifiedTopology","serverSelectionTimeoutMS","useRecoveryToken","autoEncryption"],O=["native_parser"],T=["server","replset","replSet","mongos","db"];const E=_.reduce((e,t)=>(e[t.toLowerCase()]=t,e),{});class C extends o{constructor(e){super(),this.mongoClient=e}execute(e){const t=this.mongoClient,o=function(e){const t=_.concat(T);for(const n in e)if(-1===O.indexOf(n)){if(-1===t.indexOf(n)){if(e.validateOptions)return new l(`option ${n} is not supported`);console.warn(`the options [${n}] is not supported`)}-1!==T.indexOf(n)&&console.warn("the server/replset/mongos/db options are deprecated, "+`all their options are supported at the top level of the options object [${_}]`)}}(t.s.options);if(o)return e(o);!function(e,t,o,i){if(o=Object.assign({},o),null==i)throw new Error("no callback function provided");let r=!1;const s=a("MongoClient",o);if(t instanceof g||t instanceof f||t instanceof p)return function(e,t,n,o){A(e,t),k(e,t),L(e,t);let i=Object.assign({},n);"string"!=typeof n.readPreference&&"string"!=typeof n.read_preference||(i.readPreference=new m(n.readPreference||n.read_preference));if((i.user||i.password||i.authMechanism)&&!i.credentials)try{i.credentials=R(e,i.user,i.password,i)}catch(e){return o(e,t)}return t.connect(i,o)}(e,t,o,h);const c=o.useNewUrlParser?d:b,u=o.useNewUrlParser?j:P;function h(t,n){const o="seed list contains no mongos proxies, replicaset connections requires the parameter replicaSet to be supplied in the URI or options object, mongodb://server:port/db?replicaSet=name";if(t&&"no mongos proxies found in seed list"===t.message)return s.isWarn()&&s.warn(o),i(new l(o));r&&e.emit("authenticated",null,!0),i(t,n)}c(t,o,(t,s)=>{if(t)return i(t);const a=u(s),c=B(a,o);if(null==c.socketTimeoutMS&&(c.socketTimeoutMS=36e4),null==c.connectTimeoutMS&&(c.connectTimeoutMS=3e4),null==c.retryWrites&&(c.retryWrites=!0),null==c.useRecoveryToken&&(c.useRecoveryToken=!0),c.db_options&&c.db_options.auth&&delete c.db_options.auth,e.s.options=c,0===a.servers.length)return i(new Error("connection string must contain at least one seed host"));if(c.auth&&!c.credentials)try{r=!0,c.credentials=R(e,c.auth.user,c.auth.password,c)}catch(t){return i(t)}return c.useUnifiedTopology?M(e,"unified",c,h):(N(),c.replicaSet||c.rs_name?M(e,"replicaset",c,h):a.servers.length>1?M(e,"mongos",c,h):function(e,t,o){t.promiseLibrary=e.s.promiseLibrary;const i=z(t)[0],r=function(e,t){let o=(v||(v=n(54)),v);const i=[];e instanceof o&&S.forEach(n=>{t.on(n,(t,o)=>{"open"===n?i.push({event:n,object1:e}):i.push({event:n,object1:t,object2:o})})});return i}(e,i);i.connect(t,(n,s)=>{if(n)return i.close(!0),o(n);!function(e){S.forEach(t=>e.removeAllListeners(t))}(i),L(e,i),k(e,i);const a=s.lastIsMaster();if(A(e,s),a&&"isdbgrid"===a.msg)return s.close(),M(e,"mongos",t,o);!function(e,t){for(let n=0;n<t.length;n++)e.emit(t[n].event,t[n].object1,t[n].object2)}(e,r),o(n,s)})}(e,c,h))})}(t,t.s.url,t.s.options,n=>{if(n)return e(n);e(null,t)})}}function k(e,t){t.on("authenticated",I(e,"authenticated")),t.on("error",I(e,"error")),t.on("timeout",I(e,"timeout")),t.on("close",I(e,"close")),t.on("parseError",I(e,"parseError")),t.once("open",I(e,"open")),t.once("fullsetup",I(e,"fullsetup")),t.once("all",I(e,"all")),t.on("reconnect",I(e,"reconnect"))}function A(e,t){e.topology=t,t.s.sessionPool=new y(t instanceof u?t:t.s.coreTopology)}i(C,[r.SKIP_SESSION]);const N=s(()=>{},"current Server Discovery and Monitoring engine is deprecated, and will be removed in a future version. To use the new Server Discover and Monitoring engine, pass option { useUnifiedTopology: true } to the MongoClient constructor.");function I(e,t){const n=new Set(["all","fullsetup","open","reconnect"]);return(o,i)=>{if(n.has(t))return e.emit(t,e);e.emit(t,o,i)}}function M(e,t,o,i){o.promiseLibrary=e.s.promiseLibrary;const r={};"unified"===t&&(r.createServers=!1);const s=z(o,r);let a;"mongos"===t?a=new p(s,o):"replicaset"===t?a=new f(s,o):"unified"===t&&(a=new u(o.servers,o)),k(e,a),L(e,a),a.connect(o,(t,r)=>{if(t)return a.close(!0),i(t);if(A(e,r),null==o.autoEncryption)return void i(null,r);let s;try{s=n(110)(n(81)).AutoEncrypter}catch(t){return void i(t)}const c=Object.assign({},o.autoEncryption);a.s.options.autoEncrypter=new s(e,c),a.s.options.autoEncrypter.init(e=>{if(e)return i(e,null);i(null,r)})})}function B(e,t){const n=["mongos","server","db","replset","db_options","server_options","rs_options","mongos_options"],o=["readconcern","compression"];for(const i in t)-1!==o.indexOf(i.toLowerCase())?e[i]=t[i]:-1!==n.indexOf(i.toLowerCase())?e=D(e,t[i],!1):!t[i]||"object"!=typeof t[i]||Buffer.isBuffer(t[i])||Array.isArray(t[i])?e[i]=t[i]:e=D(e,t[i],!0);return e}function R(e,t,n,o){const i=(o=Object.assign({},o)).authSource||o.authdb||o.dbName,r=o.authMechanism||"DEFAULT",s=r.toUpperCase();if(!w.has(s))throw l.create({message:`authentication mechanism ${r} not supported', options.authMechanism`,driver:!0});return new c("GSSAPI"===s?{mechanism:"win32"===process.platform?"sspi":"gssapi",mechanismProperties:o,source:i,username:t,password:n}:{mechanism:x[s],source:i,username:t,password:n})}function P(e){return D(B({},e),e,!1)}function D(e,t,n){for(const o in t)t[o]&&"object"==typeof t[o]&&n?e=D(e,t[o],n):e[o]=t[o];return e}function L(e,t){["serverOpening","serverDescriptionChanged","serverHeartbeatStarted","serverHeartbeatSucceeded","serverHeartbeatFailed","serverClosed","topologyOpening","topologyClosed","topologyDescriptionChanged","commandStarted","commandSucceeded","commandFailed","joined","left","ping","ha"].forEach(n=>{t.on(n,(t,o)=>{e.emit(n,t,o)})})}function j(e){let t=Object.assign({servers:e.hosts},e.options);for(let e in t){const n=E[e];n&&(t[n]=t[e])}const n=e.auth&&e.auth.username,o=e.options&&e.options.authMechanism;return(n||o)&&(t.auth=Object.assign({},e.auth),t.auth.db&&(t.authSource=t.authSource||t.auth.db),t.auth.username&&(t.auth.user=t.auth.username)),e.defaultDatabase&&(t.dbName=e.defaultDatabase),t.maxpoolsize&&(t.poolSize=t.maxpoolsize),t.readconcernlevel&&(t.readConcern=new h(t.readconcernlevel)),t.wtimeoutms&&(t.wtimeout=t.wtimeoutms),e.srvHost&&(t.srvHost=e.srvHost),t}function z(e,t){if(t=Object.assign({},{createServers:!0},t),"string"!=typeof e.readPreference&&"string"!=typeof e.read_preference||(e.readPreference=new m(e.readPreference||e.read_preference)),e.readPreference&&(e.readPreferenceTags||e.read_preference_tags)&&(e.readPreference.tags=e.readPreferenceTags||e.read_preference_tags),e.maxStalenessSeconds&&(e.readPreference.maxStalenessSeconds=e.maxStalenessSeconds),null==e.socketTimeoutMS&&(e.socketTimeoutMS=36e4),null==e.connectTimeoutMS&&(e.connectTimeoutMS=3e4),t.createServers)return e.servers.map(t=>t.domain_socket?new g(t.domain_socket,27017,e):new g(t.host,t.port,e))}e.exports=C},function(e,t,n){"use strict";const o=n(2).Topology,i=n(26).ServerCapabilities,r=n(22),s=n(0).translateOptions;e.exports=class extends o{constructor(e,t){t=t||{};let n=Object.assign({},{cursorFactory:r,reconnect:!1,emitError:"boolean"!=typeof t.emitError||t.emitError,size:"number"==typeof t.poolSize?t.poolSize:5,monitorCommands:"boolean"==typeof t.monitorCommands&&t.monitorCommands});n=s(n,t);var o=t.socketOptions&&Object.keys(t.socketOptions).length>0?t.socketOptions:t;super(e,n=s(n,o)),t.appname&&(this.s.clientInfo.application={name:t.appname})}capabilities(){return this.s.sCapabilities?this.s.sCapabilities:null==this.lastIsMaster()?null:(this.s.sCapabilities=new i(this.lastIsMaster()),this.s.sCapabilities)}command(e,t,n,o){super.command(e.toString(),t,n,o)}insert(e,t,n,o){super.insert(e.toString(),t,n,o)}update(e,t,n,o){super.update(e.toString(),t,n,o)}remove(e,t,n,o){super.remove(e.toString(),t,n,o)}}},function(e,t,n){"use strict";const o=n(2).ReadPreference,i=n(27),r=n(4).format,s=n(2).Logger,a=n(62),c=n(38);function l(e,t){let n=/^.*?\./,o=`.${e.replace(n,"")}`,i=`.${t.replace(n,"")}`;return!!o.endsWith(i)}function p(e,t,n){let a,l;try{a=function(e,t){let n="",a="",l="",p="admin",u=i.parse(e,!0);if((null==u.hostname||""===u.hostname)&&-1===e.indexOf(".sock"))throw new Error("No hostname or hostnames provided in connection string");if("0"===u.port)throw new Error("Invalid port (zero) with hostname");if(!isNaN(parseInt(u.port,10))&&parseInt(u.port,10)>65535)throw new Error("Invalid port (larger than 65535) with hostname");if(u.path&&u.path.length>0&&"/"!==u.path[0]&&-1===e.indexOf(".sock"))throw new Error("Missing delimiting slash between hosts and options");if(u.query)for(let e in u.query){if(-1!==e.indexOf("::"))throw new Error("Double colon in host identifier");if(""===u.query[e])throw new Error("Query parameter "+e+" is an incomplete value pair")}if(u.auth){let t=u.auth.split(":");if(-1!==e.indexOf(u.auth)&&t.length>2)throw new Error("Username with password containing an unescaped colon");if(-1!==e.indexOf(u.auth)&&-1!==u.auth.indexOf("@"))throw new Error("Username containing an unescaped at-sign")}let d=e.split("?").shift().split(","),h=[];for(let e=0;e<d.length;e++){let t=d[e];-1!==t.indexOf("mongodb")?-1!==t.indexOf("@")?h.push(t.split("@").pop()):h.push(t.substr("mongodb://".length)):-1!==t.indexOf("/")?h.push(t.split("/").shift()):-1===t.indexOf("/")&&h.push(t.trim())}for(let e=0;e<h.length;e++){let t=i.parse(r("mongodb://%s",h[e].trim()));if((!t.path||-1===t.path.indexOf(".sock"))&&(t.path&&-1!==t.path.indexOf(":")))throw t.path.split("/").length>1&&-1===t.path.indexOf("::")?new Error("Slash in host identifier"):new Error("Double colon in host identifier")}-1!==e.indexOf("?")?(l=e.substr(e.indexOf("?")+1),n=e.substring("mongodb://".length,e.indexOf("?"))):n=e.substring("mongodb://".length);-1!==n.indexOf("@")&&(a=n.split("@")[0],n=n.split("@")[1]);if(n.split("/").length>2)throw new Error("Unsupported host '"+n.split("?")[0]+"', hosts must be URL encoded and contain at most one unencoded slash");if(-1!==n.indexOf(".sock")){if(-1!==n.indexOf(".sock/")){if(-1!==(p=n.split(".sock/")[1]).indexOf("/")){if(2===p.split("/").length&&0===p.split("/")[1].length)throw new Error("Illegal trailing backslash after database name");throw new Error("More than 1 database name in URL")}n=n.split("/",n.indexOf(".sock")+".sock".length)}}else if(-1!==n.indexOf("/")){if(n.split("/").length>2){if(0===n.split("/")[2].length)throw new Error("Illegal trailing backslash after database name");throw new Error("More than 1 database name in URL")}p=n.split("/")[1],n=n.split("/")[0]}n=decodeURIComponent(n);let m,f,g,y,v={},b=a||"",x=b.split(":",2),S=decodeURIComponent(x[0]);if(x[0]!==encodeURIComponent(S))throw new Error("Username contains an illegal unescaped character");if(x[0]=S,x[1]){let e=decodeURIComponent(x[1]);if(x[1]!==encodeURIComponent(e))throw new Error("Password contains an illegal unescaped character");x[1]=e}2===x.length&&(v.auth={user:x[0],password:x[1]});t&&null!=t.auth&&(v.auth=t.auth);let w={socketOptions:{}},_={read_preference_tags:[]},O={socketOptions:{}},T={socketOptions:{}};if(v.server_options=w,v.db_options=_,v.rs_options=O,v.mongos_options=T,e.match(/\.sock/)){let t=e.substring(e.indexOf("mongodb://")+"mongodb://".length,e.lastIndexOf(".sock")+".sock".length);-1!==t.indexOf("@")&&(t=t.split("@")[1]),t=decodeURIComponent(t),g=[{domain_socket:t}]}else{let e={};g=(m=n).split(",").map((function(t){let n,o,i;if(i=/\[([^\]]+)\](?::(.+))?/.exec(t))n=i[1],o=parseInt(i[2],10)||27017;else{let e=t.split(":",2);n=e[0]||"localhost",o=null!=e[1]?parseInt(e[1],10):27017,-1!==n.indexOf("?")&&(n=n.split(/\?/)[0])}return e[n+"_"+o]?null:(e[n+"_"+o]=1,{host:n,port:o})})).filter((function(e){return null!=e}))}v.dbName=p||"admin",(f=(l||"").split(/[&;]/)).forEach((function(e){if(e){var t=e.split("="),n=t[0],i=t[1];switch(n){case"slaveOk":case"slave_ok":w.slave_ok="true"===i,_.slaveOk="true"===i;break;case"maxPoolSize":case"poolSize":w.poolSize=parseInt(i,10),O.poolSize=parseInt(i,10);break;case"appname":v.appname=decodeURIComponent(i);break;case"autoReconnect":case"auto_reconnect":w.auto_reconnect="true"===i;break;case"ssl":if("prefer"===i){w.ssl=i,O.ssl=i,T.ssl=i;break}w.ssl="true"===i,O.ssl="true"===i,T.ssl="true"===i;break;case"sslValidate":w.sslValidate="true"===i,O.sslValidate="true"===i,T.sslValidate="true"===i;break;case"replicaSet":case"rs_name":O.rs_name=i;break;case"reconnectWait":O.reconnectWait=parseInt(i,10);break;case"retries":O.retries=parseInt(i,10);break;case"readSecondary":case"read_secondary":O.read_secondary="true"===i;break;case"fsync":_.fsync="true"===i;break;case"journal":_.j="true"===i;break;case"safe":_.safe="true"===i;break;case"nativeParser":case"native_parser":_.native_parser="true"===i;break;case"readConcernLevel":_.readConcern=new c(i);break;case"connectTimeoutMS":w.socketOptions.connectTimeoutMS=parseInt(i,10),O.socketOptions.connectTimeoutMS=parseInt(i,10),T.socketOptions.connectTimeoutMS=parseInt(i,10);break;case"socketTimeoutMS":w.socketOptions.socketTimeoutMS=parseInt(i,10),O.socketOptions.socketTimeoutMS=parseInt(i,10),T.socketOptions.socketTimeoutMS=parseInt(i,10);break;case"w":_.w=parseInt(i,10),isNaN(_.w)&&(_.w=i);break;case"authSource":_.authSource=i;break;case"gssapiServiceName":_.gssapiServiceName=i;break;case"authMechanism":if("GSSAPI"===i)if(null==v.auth){let e=decodeURIComponent(b);if(-1===e.indexOf("@"))throw new Error("GSSAPI requires a provided principal");v.auth={user:e,password:null}}else v.auth.user=decodeURIComponent(v.auth.user);else"MONGODB-X509"===i&&(v.auth={user:decodeURIComponent(b)});if("GSSAPI"!==i&&"MONGODB-X509"!==i&&"MONGODB-CR"!==i&&"DEFAULT"!==i&&"SCRAM-SHA-1"!==i&&"SCRAM-SHA-256"!==i&&"PLAIN"!==i)throw new Error("Only DEFAULT, GSSAPI, PLAIN, MONGODB-X509, or SCRAM-SHA-1 is supported by authMechanism");_.authMechanism=i;break;case"authMechanismProperties":{let e=i.split(","),t={};e.forEach((function(e){let n=e.split(":");t[n[0]]=n[1]})),_.authMechanismProperties=t,"string"==typeof t.SERVICE_NAME&&(_.gssapiServiceName=t.SERVICE_NAME),"string"==typeof t.SERVICE_REALM&&(_.gssapiServiceRealm=t.SERVICE_REALM),"string"==typeof t.CANONICALIZE_HOST_NAME&&(_.gssapiCanonicalizeHostName="true"===t.CANONICALIZE_HOST_NAME)}break;case"wtimeoutMS":_.wtimeout=parseInt(i,10);break;case"readPreference":if(!o.isValid(i))throw new Error("readPreference must be either primary/primaryPreferred/secondary/secondaryPreferred/nearest");_.readPreference=i;break;case"maxStalenessSeconds":_.maxStalenessSeconds=parseInt(i,10);break;case"readPreferenceTags":{let e={};if(null==(i=decodeURIComponent(i))||""===i){_.read_preference_tags.push(e);break}let t=i.split(/,/);for(let n=0;n<t.length;n++){let o=t[n].trim().split(/:/);e[o[0]]=o[1]}_.read_preference_tags.push(e)}break;case"compressors":{y=w.compression||{};let e=i.split(",");if(!e.every((function(e){return"snappy"===e||"zlib"===e})))throw new Error("Compressors must be at least one of snappy or zlib");y.compressors=e,w.compression=y}break;case"zlibCompressionLevel":{y=w.compression||{};let e=parseInt(i,10);if(e<-1||e>9)throw new Error("zlibCompressionLevel must be an integer between -1 and 9");y.zlibCompressionLevel=e,w.compression=y}break;case"retryWrites":_.retryWrites="true"===i;break;case"minSize":_.minSize=parseInt(i,10);break;default:s("URL Parser").warn(`${n} is not supported as a connection string option`)}}})),0===_.read_preference_tags.length&&(_.read_preference_tags=null);if(!(-1!==_.w&&0!==_.w||!0!==_.journal&&!0!==_.fsync&&!0!==_.safe))throw new Error("w set to -1 or 0 cannot be combined with safe/w/journal/fsync");_.readPreference||(_.readPreference="primary");return _=Object.assign(_,t),v.servers=g,v}(e,t)}catch(e){l=e}return l?n(l,null):n(null,a)}e.exports=function(e,t,n){let o;"function"==typeof t&&(n=t,t={}),t=t||{};try{o=i.parse(e,!0)}catch(e){return n(new Error("URL malformed, cannot be parsed"))}if("mongodb:"!==o.protocol&&"mongodb+srv:"!==o.protocol)return n(new Error("Invalid schema, expected `mongodb` or `mongodb+srv`"));if("mongodb:"===o.protocol)return p(e,t,n);if(o.hostname.split(".").length<3)return n(new Error("URI does not have hostname, domain name and tld"));if(o.domainLength=o.hostname.split(".").length,o.pathname&&o.pathname.match(","))return n(new Error("Invalid URI, cannot contain multiple hostnames"));if(o.port)return n(new Error("Ports not accepted with `mongodb+srv` URIs"));let r=`_mongodb._tcp.${o.host}`;a.resolveSrv(r,(function(e,i){if(e)return n(e);if(0===i.length)return n(new Error("No addresses found at host"));for(let e=0;e<i.length;e++)if(!l(i[e].name,o.hostname,o.domainLength))return n(new Error("Server record does not share hostname with parent URI"));let r=o.auth?`mongodb://${o.auth}@`:"mongodb://",s=i.map((function(e,t){return 0===t?`${r}${e.name}:${e.port}`:`${e.name}:${e.port}`})).join(",")+"/",c=[];if(o.path){let e=o.path.slice(1);-1!==e.indexOf("?")&&(e=e.slice(0,e.indexOf("?"))),s+=e}(t.ssl||o.search)&&(t.ssl||!o.search||o.search.match("ssl"))||c.push("ssl=true"),o.search&&c.push(o.search.replace("?","")),a.resolveTxt(o.host,(function(e,o){if(e&&"ENODATA"!==e.code)return n(e);if(e&&"ENODATA"===e.code&&(o=null),o){if(o.length>1)return n(new Error("Multiple text records not allowed"));if(!(o=(o=o[0]).length>1?o.join(""):o[0]).includes("authSource")&&!o.includes("replicaSet"))return n(new Error("Text record must only set `authSource` or `replicaSet`"));c.push(o)}c.length&&(s+=`?${c.join("&")}`),p(s,t,n)}))}))}},function(e,t,n){"use strict";e.exports=function(e){const t=n(77),o=e.mongodb.MongoTimeoutError,i=n(59),r=i.debug,s=i.databaseNamespace,a=i.collectionNamespace,c=i.MongoCryptError,l=0,p=1,u=2,d=3,h=4,m=5,f=6,g=443,y=new Map([[l,"MONGOCRYPT_CTX_ERROR"],[p,"MONGOCRYPT_CTX_NEED_MONGO_COLLINFO"],[u,"MONGOCRYPT_CTX_NEED_MONGO_MARKINGS"],[d,"MONGOCRYPT_CTX_NEED_MONGO_KEYS"],[h,"MONGOCRYPT_CTX_NEED_KMS"],[m,"MONGOCRYPT_CTX_READY"],[f,"MONGOCRYPT_CTX_DONE"]]);return{StateMachine:class{execute(e,t,n){const i=e._bson,s=e._client,a=e._keyVaultNamespace,g=e._mongocryptdClient,v=e._mongocryptdManager;switch(r(`[context#${t.id}] ${y.get(t.state)||t.state}`),t.state){case p:{const o=i.deserialize(t.nextMongoOperation());return void this.fetchCollectionInfo(s,t.ns,o,(o,i)=>{if(o)return n(o,null);i&&t.addMongoOperationResponse(i),t.finishMongoOperation(),this.execute(e,t,n)})}case u:{const i=t.nextMongoOperation();return void this.markCommand(g,t.ns,i,(r,s)=>{if(r)return r instanceof o&&v&&!v.bypassSpawn?void v.spawn(()=>{this.markCommand(g,t.ns,i,(o,i)=>{if(o)return n(o,null);t.addMongoOperationResponse(i),t.finishMongoOperation(),this.execute(e,t,n)})}):n(r,null);t.addMongoOperationResponse(s),t.finishMongoOperation(),this.execute(e,t,n)})}case d:{const o=t.nextMongoOperation();return void this.fetchKeys(s,a,o,(o,r)=>{if(o)return n(o,null);r.forEach(e=>{t.addMongoOperationResponse(i.serialize(e))}),t.finishMongoOperation(),this.execute(e,t,n)})}case h:{const o=[];let i;for(;i=t.nextKMSRequest();)o.push(this.kmsRequest(i));return void Promise.all(o).then(()=>{t.finishKMSRequests(),this.execute(e,t,n)}).catch(e=>{n(e,null)})}case m:{const e=t.finalize();if(t.state===l){const e=t.status.message||"Finalization error";return void n(new c(e))}return void n(null,i.deserialize(e))}case l:{const e=t.status.message;return void n(new c(e))}case f:return;default:return void n(new c(`Unknown state: ${t.state}`))}}kmsRequest(e){const n={host:e.endpoint,port:g},o=e.message;return new Promise((i,r)=>{const s=t.connect(n,()=>{s.write(o)});s.once("timeout",()=>{s.removeAllListeners(),s.destroy(),r(new c("KMS request timed out"))}),s.once("error",e=>{s.removeAllListeners(),s.destroy(),r(e)}),s.on("data",t=>{e.addResponse(t),e.bytesNeeded<=0&&s.end(i)})})}fetchCollectionInfo(e,t,n,o){const i=e.topology.bson,r=s(t);e.db(r).listCollections(n).toArray((e,t)=>{if(e)return void o(e,null);const n=t.length>0?i.serialize(t[0]):null;o(null,n)})}markCommand(e,t,n,o){const i=e.topology.bson,r=s(t),a=i.deserialize(n);e.db(r).command(a,(e,t)=>{o(e,e?null:i.serialize(t))})}fetchKeys(e,t,n,o){const i=e.topology.bson,r=s(t),c=a(t);n=i.deserialize(n),e.db(r).collection(c).find(n).toArray((e,t)=>{e?o(e,null):o(null,t)})}}}}},function(e,t,n){"use strict";e.exports=function(e){const t=n(111)("mongocrypt"),o=n(59).databaseNamespace,i=e.stateMachine.StateMachine,r=n(200).MongocryptdManager,s=e.mongodb.MongoClient,a=n(112);return{AutoEncrypter:class{constructor(e,n){this._client=e,this._bson=e.topology.bson,this._mongocryptdManager=new r(n.extraOptions),this._mongocryptdClient=new s(this._mongocryptdManager.uri,{useNewUrlParser:!0,useUnifiedTopology:!0}),this._keyVaultNamespace=n.keyVaultNamespace||"admin.datakeys";const o={};n.schemaMap&&(o.schemaMap=Buffer.isBuffer(n.schemaMap)?n.schemaMap:this._bson.serialize(n.schemaMap)),n.kmsProviders&&(o.kmsProviders=n.kmsProviders),n.logger&&(o.logger=n.logger),Object.assign(o,{cryptoCallbacks:a}),this._mongocrypt=new t.MongoCrypt(o),this._contextCounter=0}init(e){if(this._mongocryptdManager.bypassSpawn)return this._mongocryptdClient.connect(e);this._mongocryptdManager.spawn(()=>{this._mongocryptdClient.connect(e)})}teardown(e,t){this._mongocryptdClient.close(e,t)}encrypt(e,t,n){if("string"!=typeof e)throw new TypeError("Parameter `ns` must be a string");if("object"!=typeof t)throw new TypeError("Parameter `cmd` must be an object");const r=this._bson,s=Buffer.isBuffer(t)?t:r.serialize(t);let a;try{a=this._mongocrypt.makeEncryptionContext(o(e),s)}catch(e){return void n(e,null)}a.id=this._contextCounter++,a.ns=e,a.document=t,(new i).execute(this,a,n)}decrypt(e,t){const n=this._bson,o=Buffer.isBuffer(e)?e:n.serialize(e);let r;try{r=this._mongocrypt.makeDecryptionContext(o)}catch(e){return void t(e,null)}r.id=this._contextCounter++,(new i).execute(this,r,t)}}}}},function(e,t,n){var o=n(23).sep||"/";e.exports=function(e){if("string"!=typeof e||e.length<=7||"file://"!=e.substring(0,7))throw new TypeError("must pass in a file:// URI to convert to a file path");var t=decodeURI(e.substring(7)),n=t.indexOf("/"),i=t.substring(0,n),r=t.substring(n+1);"localhost"==i&&(i="");i&&(i=o+o+i);r=r.replace(/^(.+)\|/,"$1:"),"\\"==o&&(r=r.replace(/\//g,"\\"));/^.+\:/.test(r)||(r=o+r);return i+r}},function(e,t,n){"use strict";const o=n(118).spawn,i=n(20).readFile,r="mongocryptd.pid",s=50;function a(e){i(r,"utf8",(t,n)=>{if(t)return e(void 0,!1);if(!n||!n.length)return e(void 0,!1);try{JSON.parse(n)}catch(t){return e(t,!1)}e(void 0,!0)})}e.exports={MongocryptdManager:class{constructor(e){(e=e||{}).mongocryptdURI?this.uri=e.mongocryptdURI:this.uri="mongodb://localhost:27020/?serverSelectionTimeoutMS=1000",this.bypassSpawn=!!e.mongocryptdBypassSpawn,this.spawPath=e.mongocryptdSpawnPath||"",this.spawnArgs=[],Array.isArray(e.mongocryptdSpawnArgs)&&this.spawnArgs.concat(e.mongocryptdSpawnArgs),this.spawnArgs.indexOf("idleShutdownTimeoutSecs")<0&&this.spawnArgs.concat(["--idleShutdownTimeoutSecs","60"])}spawn(e){a((t,n)=>{if(!t&&n)return void process.nextTick(e);const i=this.spawnPath||"mongocryptd";this._child=o(i,this.spawnArgs,{stdio:"ignore",detached:!0}),this._child.on("error",()=>{}),this._child.unref(),function e(t,n){if(t<=0)return n();a((o,i)=>{if(i)return n();t-=1,setTimeout(()=>e(t,n),s)})}(20,e)})}}}},function(e,t,n){"use strict";e.exports=function(e){const t=n(111)("mongocrypt"),o=n(59),i=o.databaseNamespace,r=o.collectionNamespace,s=o.promiseOrCallback,a=e.stateMachine.StateMachine,c=n(112);return{ClientEncryption:class{constructor(e,n){if(this._client=e,this._bson=e.topology.bson,null==n.keyVaultNamespace)throw new TypeError("Missing required option `keyVaultNamespace`");Object.assign(n,{cryptoCallbacks:c}),this._keyVaultNamespace=n.keyVaultNamespace,this._mongoCrypt=new t.MongoCrypt(n)}createDataKey(e,t,n){"function"==typeof t&&(n=t,t={}),t=function(e,t){if((t=Object.assign({},t)).keyAltNames){if(!Array.isArray(t.keyAltNames))throw new TypeError(`Option "keyAltNames" must be an array of string, but was of type ${typeof t.keyAltNames}.`);const n=[];for(let o=0;o<t.keyAltNames.length;o+=1){const i=t.keyAltNames[o],r=typeof i;if("string"!==r)throw new TypeError(`Option "keyAltNames" must be an array of string, but item at index ${o} was of type ${r} `);n.push(e.serialize({keyAltName:i}))}t.keyAltNames=n}else null==t.keyAltNames&&delete t.keyAltNames;return t}(this._bson,t);const o=this._mongoCrypt.makeDataKeyContext(e,t),c=new a;return s(n,e=>{c.execute(this,o,(t,n)=>{if(t)return void e(t,null);const o=i(this._keyVaultNamespace),s=r(this._keyVaultNamespace);this._client.db(o).collection(s).insertOne(n,(t,n)=>{t?e(t,null):e(null,n.insertedId)})})})}encrypt(e,t,n){const o=this._bson,i=o.serialize({v:e}),r=Object.assign({},t);if(t.keyId&&(r.keyId=t.keyId.buffer),t.keyAltName){const e=t.keyAltName;if(t.keyId)throw new TypeError('"options" cannot contain both "keyId" and "keyAltName"');const n=typeof e;if("string"!==n)throw new TypeError(`"options.keyAltName" must be of type string, but was of type ${n}`);r.keyAltName=o.serialize({keyAltName:e})}const c=new a,l=this._mongoCrypt.makeExplicitEncryptionContext(i,r);return s(n,e=>{c.execute(this,l,(t,n)=>{t?e(t,null):e(null,n.v)})})}decrypt(e,t){const n=this._bson.serialize({v:e}),o=this._mongoCrypt.makeExplicitDecryptionContext(n),i=new a;return s(t,e=>{i.execute(this,o,(t,n)=>{t?e(t,null):e(null,n.v)})})}}}}},function(e,t,n){"use strict";const o=n(1).Aspect,i=n(1).defineAspects,r=n(1).OperationBase;class s extends r{constructor(e,t){super(),this.client=e,this.force=t}execute(e){const t=this.client,n=this.force,o=n=>{t.emit("close",t);for(const e of t.s.dbCache)e[1].emit("close",t);t.removeAllListeners("close"),e(n,null)};null!=t.topology?t.topology.close(n,e=>{const i=t.topology.s.options.autoEncrypter;i?i.teardown(n,t=>o(e||t)):o(e)}):o()}}i(s,[o.SKIP_SESSION]),e.exports=s},function(e,t,n){"use strict";const o=n(113),i=n(2).BSON.ObjectID,r=n(2).ReadPreference,s=n(17).Buffer,a=n(20),c=n(4).format,l=n(4),p=n(2).MongoError,u=l.inherits,d=n(14).Duplex,h=n(0).shallowClone,m=n(0).executeLegacyOperation,f=n(4).deprecate;const g=f(()=>{},"GridStore is deprecated, and will be removed in a future version. Please use GridFSBucket instead");var y=function e(t,n,s,a,c){if(g(),!(this instanceof e))return new e(t,n,s,a,c);this.db=t,void 0===c&&(c={}),void 0===a?(a=s,s=void 0):"object"==typeof a&&(c=a,a=s,s=void 0),n&&"ObjectID"===n._bsontype?(this.referenceBy=1,this.fileId=n,this.filename=s):void 0===s?(this.referenceBy=0,this.filename=n,null!=a.indexOf("w")&&(this.fileId=new i)):(this.referenceBy=1,this.fileId=n,this.filename=s),this.mode=null==a?"r":a,this.options=c||{},this.isOpen=!1,this.root=null==this.options.root?e.DEFAULT_ROOT_COLLECTION:this.options.root,this.position=0,this.readPreference=this.options.readPreference||t.options.readPreference||r.primary,this.writeConcern=U(t,this.options),this.internalChunkSize=null==this.options.chunkSize?o.DEFAULT_CHUNK_SIZE:this.options.chunkSize;var l=this.options.promiseLibrary||Promise;this.promiseLibrary=l,Object.defineProperty(this,"chunkSize",{enumerable:!0,get:function(){return this.internalChunkSize},set:function(e){"w"!==this.mode[0]||0!==this.position||null!=this.uploadDate?this.internalChunkSize=this.internalChunkSize:this.internalChunkSize=e}}),Object.defineProperty(this,"md5",{enumerable:!0,get:function(){return this.internalMd5}}),Object.defineProperty(this,"chunkNumber",{enumerable:!0,get:function(){return this.currentChunk&&this.currentChunk.chunkNumber?this.currentChunk.chunkNumber:null}})};y.prototype.open=function(e,t){if("function"==typeof e&&(t=e,e={}),e=e||{},"w"!==this.mode&&"w+"!==this.mode&&"r"!==this.mode)throw p.create({message:"Illegal mode "+this.mode,driver:!0});return m(this.db.s.topology,v,[this,e,t],{skipSessions:!0})};var v=function(e,t,n){var o=U(e.db,e.options);"w"===e.mode||"w+"===e.mode?e.collection().ensureIndex([["filename",1]],o,(function(){var t=e.chunkCollection(),i=h(o);i.unique=!0,t.ensureIndex([["files_id",1],["n",1]],i,(function(){C(e,o,(function(t,o){if(t)return n(t);e.isOpen=!0,n(t,o)}))}))})):C(e,o,(function(t,o){if(t)return n(t);e.isOpen=!0,n(t,o)}))};y.prototype.eof=function(){return this.position===this.length},y.prototype.getc=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},m(this.db.s.topology,b,[this,e,t],{skipSessions:!0})};var b=function(e,t,n){e.eof()?n(null,null):e.currentChunk.eof()?N(e,e.currentChunk.chunkNumber+1,(function(t,o){e.currentChunk=o,e.position=e.position+1,n(t,e.currentChunk.getc())})):(e.position=e.position+1,n(null,e.currentChunk.getc()))};y.prototype.puts=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||{};var o=null==e.match(/\n$/)?e+"\n":e;return m(this.db.s.topology,this.write.bind(this),[o,t,n],{skipSessions:!0})},y.prototype.stream=function(){return new H(this)},y.prototype.write=function(e,t,n,o){return"function"==typeof n&&(o=n,n={}),n=n||{},m(this.db.s.topology,j,[this,e,t,n,o],{skipSessions:!0})},y.prototype.destroy=function(){this.writable&&(this.readable=!1,this.writable&&(this.writable=!1,this._q.length=0,this.emit("close")))},y.prototype.writeFile=function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=t||{},m(this.db.s.topology,x,[this,e,t,n],{skipSessions:!0})};var x=function(e,t,n,i){"string"!=typeof t?e.open((function(e,n){if(e)return i(e,n);a.fstat(t,(function(e,r){if(e)return i(e,n);var c=0,l=0,p=function(){var e=s.alloc(n.chunkSize);a.read(t,e,0,e.length,c,(function(e,s,u){if(e)return i(e,n);c+=s,new o(n,{n:l++},n.writeConcern).write(u.slice(0,s),(function(e,o){if(e)return i(e,n);o.save({},(function(e){return e?i(e,n):(n.position=n.position+s,n.currentChunk=o,c>=r.size?void a.close(t,(function(e){if(e)return i(e);n.close((function(e){return i(e||null,n)}))})):process.nextTick(p))}))}))}))};process.nextTick(p)}))})):a.open(t,"r",(function(t,n){if(t)return i(t);e.writeFile(n,i)}))};y.prototype.close=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},m(this.db.s.topology,S,[this,e,t],{skipSessions:!0})};var S=function(e,t,n){"w"===e.mode[0]?(t=Object.assign({},e.writeConcern,t),null!=e.currentChunk&&e.currentChunk.position>0?e.currentChunk.save({},(function(o){if(o&&"function"==typeof n)return n(o);e.collection((function(o,i){if(o&&"function"==typeof n)return n(o);null!=e.uploadDate?A(e,(function(e,o){if(e){if("function"==typeof n)return n(e);throw e}i.save(o,t,(function(e){"function"==typeof n&&n(e,o)}))})):(e.uploadDate=new Date,A(e,(function(e,o){if(e){if("function"==typeof n)return n(e);throw e}i.save(o,t,(function(e){"function"==typeof n&&n(e,o)}))})))}))})):e.collection((function(o,i){if(o&&"function"==typeof n)return n(o);e.uploadDate=new Date,A(e,(function(e,o){if(e){if("function"==typeof n)return n(e);throw e}i.save(o,t,(function(e){"function"==typeof n&&n(e,o)}))}))}))):"r"===e.mode[0]?"function"==typeof n&&n(null,null):"function"==typeof n&&n(p.create({message:c("Illegal mode %s",e.mode),driver:!0}))};y.prototype.chunkCollection=function(e){return"function"==typeof e?this.db.collection(this.root+".chunks",e):this.db.collection(this.root+".chunks")},y.prototype.unlink=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},m(this.db.s.topology,w,[this,e,t],{skipSessions:!0})};var w=function(e,t,n){M(e,(function(t){if(null!==t)return t.message="at deleteChunks: "+t.message,n(t);e.collection((function(t,o){if(null!==t)return t.message="at collection: "+t.message,n(t);o.remove({_id:e.fileId},e.writeConcern,(function(t){n(t,e)}))}))}))};y.prototype.collection=function(e){return"function"==typeof e&&this.db.collection(this.root+".files",e),this.db.collection(this.root+".files")},y.prototype.readlines=function(e,t,n){var o=Array.prototype.slice.call(arguments,0);return n="function"==typeof o[o.length-1]?o.pop():void 0,e=(e=o.length?o.shift():"\n")||"\n",t=o.length?o.shift():{},m(this.db.s.topology,_,[this,e,t,n],{skipSessions:!0})};var _=function(e,t,n,o){e.read((function(e,n){if(e)return o(e);var i=n.toString().split(t);i=i.length>0?i.splice(0,i.length-1):[];for(var r=0;r<i.length;r++)i[r]=i[r]+t;o(null,i)}))};y.prototype.rewind=function(e,t){return"function"==typeof e&&(t=e,e={}),e=e||{},m(this.db.s.topology,O,[this,e,t],{skipSessions:!0})};var O=function(e,t,n){0!==e.currentChunk.chunkNumber?"w"===e.mode[0]?M(e,(function(t){if(t)return n(t);e.currentChunk=new o(e,{n:0},e.writeConcern),e.position=0,n(null,e)})):e.currentChunk(0,(function(t,o){if(t)return n(t);e.currentChunk=o,e.currentChunk.rewind(),e.position=0,n(null,e)})):(e.currentChunk.rewind(),e.position=0,n(null,e))};y.prototype.read=function(e,t,n,o){var i=Array.prototype.slice.call(arguments,0);return o="function"==typeof i[i.length-1]?i.pop():void 0,e=i.length?i.shift():null,t=i.length?i.shift():null,n=i.length?i.shift():{},m(this.db.s.topology,T,[this,e,t,n,o],{skipSessions:!0})};var T=function(e,t,n,o,i){var r=null==t?e.length-e.position:t,a=null==n?s.alloc(r):n;if(a._index=null!=n&&null!=n._index?n._index:0,e.currentChunk.length()-e.currentChunk.position+a._index>=r){var c=e.currentChunk.readSlice(r-a._index);return c.copy(a,a._index),e.position=e.position+a.length,0===r&&0===a.length?i(p.create({message:"File does not exist",driver:!0}),null):i(null,a)}(c=e.currentChunk.readSlice(e.currentChunk.length()-e.currentChunk.position)).copy(a,a._index),a._index+=c.length,N(e,e.currentChunk.chunkNumber+1,(function(n,o){if(n)return i(n);o.length()>0?(e.currentChunk=o,e.read(t,a,i)):a._index>0?i(null,a):i(p.create({message:"no chunks found for file, possibly corrupt",driver:!0}),null)}))};y.prototype.tell=function(e){var t=this;return"function"==typeof e?e(null,this.position):new t.promiseLibrary((function(e){e(t.position)}))},y.prototype.seek=function(e,t,n,o){var i=Array.prototype.slice.call(arguments,1);return o="function"==typeof i[i.length-1]?i.pop():void 0,t=i.length?i.shift():null,n=i.length?i.shift():{},m(this.db.s.topology,E,[this,e,t,n,o],{skipSessions:!0})};var E=function(e,t,n,o,i){if("r"!==e.mode)return i(p.create({message:"seek is only supported for mode r",driver:!0}));var r=null==n?y.IO_SEEK_SET:n,s=t,a=0;a=r===y.IO_SEEK_CUR?e.position+s:r===y.IO_SEEK_END?e.length+s:s;var c=Math.floor(a/e.chunkSize);N(e,c,(function(t,n){return t?i(t,null):null==n?i(new Error("no chunk found")):(e.currentChunk=n,e.position=a,e.currentChunk.position=e.position%e.chunkSize,void i(t,e))}))},C=function(e,t,n){var r=e.collection(),s=1===e.referenceBy?{_id:e.fileId}:{filename:e.filename};function a(e){a.err||n(a.err=e)}s=null==e.fileId&&null==e.filename?null:s,t.readPreference=e.readPreference,null!=s?r.findOne(s,t,(function(r,s){if(r)return a(r);if(null!=s)e.fileId=s._id,e.filename="r"===e.mode||void 0===e.filename?s.filename:e.filename,e.contentType=s.contentType,e.internalChunkSize=s.chunkSize,e.uploadDate=s.uploadDate,e.aliases=s.aliases,e.length=s.length,e.metadata=s.metadata,e.internalMd5=s.md5;else{if("r"===e.mode){e.length=0;var l="ObjectID"===e.fileId._bsontype?e.fileId.toHexString():e.fileId;return a(p.create({message:c("file with id %s not opened for writing",1===e.referenceBy?l:e.filename),driver:!0}))}e.fileId=null==e.fileId?new i:e.fileId,e.contentType=y.DEFAULT_CONTENT_TYPE,e.internalChunkSize=null==e.internalChunkSize?o.DEFAULT_CHUNK_SIZE:e.internalChunkSize,e.length=0}"r"===e.mode?N(e,0,t,(function(t,o){if(t)return a(t);e.currentChunk=o,e.position=0,n(null,e)})):"w"===e.mode&&s?M(e,t,(function(t){if(t)return a(t);e.currentChunk=new o(e,{n:0},e.writeConcern),e.contentType=null==e.options.content_type?e.contentType:e.options.content_type,e.internalChunkSize=null==e.options.chunk_size?e.internalChunkSize:e.options.chunk_size,e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=0,n(null,e)})):"w"===e.mode?(e.currentChunk=new o(e,{n:0},e.writeConcern),e.contentType=null==e.options.content_type?e.contentType:e.options.content_type,e.internalChunkSize=null==e.options.chunk_size?e.internalChunkSize:e.options.chunk_size,e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=0,n(null,e)):"w+"===e.mode&&N(e,I(e),t,(function(t,i){if(t)return a(t);e.currentChunk=null==i?new o(e,{n:0},e.writeConcern):i,e.currentChunk.position=e.currentChunk.data.length(),e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=e.length,n(null,e)}))})):(e.fileId=null==e.fileId?new i:e.fileId,e.contentType=y.DEFAULT_CONTENT_TYPE,e.internalChunkSize=null==e.internalChunkSize?o.DEFAULT_CHUNK_SIZE:e.internalChunkSize,e.length=0,"w"===e.mode?M(e,t,(function(t){if(t)return a(t);e.currentChunk=new o(e,{n:0},e.writeConcern),e.contentType=null==e.options.content_type?e.contentType:e.options.content_type,e.internalChunkSize=null==e.options.chunk_size?e.internalChunkSize:e.options.chunk_size,e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=0,n(null,e)})):"w+"===e.mode&&N(e,I(e),t,(function(t,i){if(t)return a(t);e.currentChunk=null==i?new o(e,{n:0},e.writeConcern):i,e.currentChunk.position=e.currentChunk.data.length(),e.metadata=null==e.options.metadata?e.metadata:e.options.metadata,e.aliases=null==e.options.aliases?e.aliases:e.options.aliases,e.position=e.length,n(null,e)})))},k=function(e,t,n,i){"function"==typeof n&&(i=n,n=null);var r="boolean"==typeof n&&n;if("w"!==e.mode)i(p.create({message:c("file with id %s not opened for writing",1===e.referenceBy?e.referenceBy:e.filename),driver:!0}),null);else{if(!(e.currentChunk.position+t.length>=e.chunkSize))return e.position=e.position+t.length,e.currentChunk.write(t),r?e.close((function(t){i(t,e)})):i(null,e);for(var s=e.currentChunk.chunkNumber,a=e.chunkSize-e.currentChunk.position,l=t.slice(0,a),u=t.slice(a),d=[e.currentChunk.write(l)];u.length>=e.chunkSize;){var h=new o(e,{n:s+1},e.writeConcern);l=u.slice(0,e.chunkSize),u=u.slice(e.chunkSize),s+=1,h.write(l),d.push(h)}e.currentChunk=new o(e,{n:s+1},e.writeConcern),u.length>0&&e.currentChunk.write(u),e.position=e.position+t.length;for(var m=d.length,f=0;f<d.length;f++)d[f].save({},(function(t){return t?i(t):(m-=1)<=0?r?e.close((function(t){i(t,e)})):i(null,e):void 0}))}},A=function(e,t){var n={_id:e.fileId,filename:e.filename,contentType:e.contentType,length:e.position?e.position:0,chunkSize:e.chunkSize,uploadDate:e.uploadDate,aliases:e.aliases,metadata:e.metadata},o={filemd5:e.fileId,root:e.root};e.db.command(o,(function(e,o){if(e)return t(e);n.md5=o.md5,t(null,n)}))},N=function(e,t,n,i){"function"==typeof n&&(i=n,n={}),(n=n||e.writeConcern).readPreference=e.readPreference,e.chunkCollection().findOne({files_id:e.fileId,n:t},n,(function(t,n){if(t)return i(t);i(null,new o(e,null==n?{}:n,e.writeConcern))}))},I=function(e){return Math.floor((e.length?e.length-1:0)/e.chunkSize)},M=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=t||e.writeConcern,null!=e.fileId?e.chunkCollection().remove({files_id:e.fileId},t,(function(e){if(e)return n(e,!1);n(null,!0)})):n(null,!0)};y.DEFAULT_ROOT_COLLECTION="fs",y.DEFAULT_CONTENT_TYPE="binary/octet-stream",y.IO_SEEK_SET=0,y.IO_SEEK_CUR=1,y.IO_SEEK_END=2,y.exist=function(e,t,n,o,i){var r=Array.prototype.slice.call(arguments,2);return i="function"==typeof r[r.length-1]?r.pop():void 0,n=r.length?r.shift():null,o=(o=r.length?r.shift():{})||{},m(e.s.topology,B,[e,t,n,o,i],{skipSessions:!0})};var B=function(e,t,n,o,i){var s=o.readPreference||r.PRIMARY,a=null!=n?n:y.DEFAULT_ROOT_COLLECTION;e.collection(a+".files",(function(e,n){if(e)return i(e);var o="string"==typeof t||"[object RegExp]"===Object.prototype.toString.call(t)?{filename:t}:{_id:t};null!=t&&"object"==typeof t&&"[object RegExp]"!==Object.prototype.toString.call(t)&&(o=t),n.findOne(o,{readPreference:s},(function(e,t){if(e)return i(e);i(null,null!=t)}))}))};y.list=function(e,t,n,o){var i=Array.prototype.slice.call(arguments,1);return o="function"==typeof i[i.length-1]?i.pop():void 0,t=i.length?i.shift():null,n=(n=i.length?i.shift():{})||{},m(e.s.topology,R,[e,t,n,o],{skipSessions:!0})};var R=function(e,t,n,o){null!=t&&"object"==typeof t&&(n=t,t=null);var i=n.readPreference||r.primary,s=null!=n.id&&n.id,a=null!=t?t:y.DEFAULT_ROOT_COLLECTION,c=[];e.collection(a+".files",(function(e,t){if(e)return o(e);t.find({},{readPreference:i},(function(e,t){if(e)return o(e);t.each((function(e,t){null!=t?c.push(s?t._id:t.filename):o(e,c)}))}))}))};y.read=function(e,t,n,o,i,r){var s=Array.prototype.slice.call(arguments,2);return r="function"==typeof s[s.length-1]?s.pop():void 0,n=s.length?s.shift():null,o=s.length?s.shift():null,i=(i=s.length?s.shift():null)||{},m(e.s.topology,P,[e,t,n,o,i,r],{skipSessions:!0})};var P=function(e,t,n,o,i,r){new y(e,t,"r",i).open((function(e,t){return e?r(e):o&&o>=t.length?r("offset larger than size of file",null):n&&n>t.length?r("length is larger than the size of the file",null):o&&n&&o+n>t.length?r("offset and length is larger than the size of the file",null):void(null!=o?t.seek(o,(function(e,t){if(e)return r(e);t.read(n,r)})):t.read(n,r))}))};y.readlines=function(e,t,n,o,i){var r=Array.prototype.slice.call(arguments,2);return i="function"==typeof r[r.length-1]?r.pop():void 0,n=r.length?r.shift():null,o=(o=r.length?r.shift():null)||{},m(e.s.topology,D,[e,t,n,o,i],{skipSessions:!0})};var D=function(e,t,n,o,i){var r=null==n?"\n":n;new y(e,t,"r",o).open((function(e,t){if(e)return i(e);t.readlines(r,i)}))};y.unlink=function(e,t,n,o){var i=Array.prototype.slice.call(arguments,2);return o="function"==typeof i[i.length-1]?i.pop():void 0,n=(n=i.length?i.shift():{})||{},m(e.s.topology,L,[this,e,t,n,o],{skipSessions:!0})};var L=function(e,t,n,o,i){var r=U(t,o);if(n.constructor===Array)for(var s=0,a=0;a<n.length;a++)++s,y.unlink(t,n[a],o,(function(){0==--s&&i(null,e)}));else new y(t,n,"w",o).open((function(t,n){if(t)return i(t);M(n,(function(t){if(t)return i(t);n.collection((function(t,o){if(t)return i(t);o.remove({_id:n.fileId},r,(function(t){i(t,e)}))}))}))}))},j=function(e,t,n,o,i){return s.isBuffer(t)?k(e,t,n,i):k(e,s.from(t,"binary"),n,i)},z=function(e){var t={};return null!=e.w&&(t.w=e.w),!0===e.journal&&(t.j=e.journal),!0===e.j&&(t.j=e.j),!0===e.fsync&&(t.fsync=e.fsync),null!=e.wtimeout&&(t.wtimeout=e.wtimeout),t},U=function(e,t){var n={w:1};if(null!=(t=t||{}).w||"boolean"==typeof t.j||"boolean"==typeof t.journal||"boolean"==typeof t.fsync?n=z(t):null!=t.safe&&"object"==typeof t.safe?n=z(t.safe):"boolean"==typeof t.safe?n={w:t.safe?1:0}:null!=e.options.w||"boolean"==typeof e.options.j||"boolean"==typeof e.options.journal||"boolean"==typeof e.options.fsync?n=z(e.options):!e.safe||null==e.safe.w&&"boolean"!=typeof e.safe.j&&"boolean"!=typeof e.safe.journal&&"boolean"!=typeof e.safe.fsync?"boolean"==typeof e.safe&&(n={w:e.safe?1:0}):n=z(e.safe),n.w<1&&(!0===n.journal||!0===n.j||!0===n.fsync))throw p.create({message:"No acknowledgement using w < 1 cannot be combined with journal:true or fsync:true",driver:!0});return n},H=function(e){d.call(this),this.gs=e,this.endCalled=!1,this.totalBytesToRead=this.gs.length-this.gs.position,this.seekPosition=this.gs.position};u(H,d),H.prototype._pipe=H.prototype.pipe,H.prototype.pipe=function(e){var t=this;return t.gs.isOpen?(t.totalBytesToRead=t.gs.length-t.gs.position,t._pipe.apply(t,[e])):t.gs.open((function(n){if(n)return t.emit("error",n);t.totalBytesToRead=t.gs.length-t.gs.position,t._pipe.apply(t,[e])})),e},H.prototype._read=function(){var e=this,t=function(){e.gs.read(n,(function(t,n){return t&&!e.endCalled?e.emit("error",t):e.endCalled||null==n?e.push(null):(n.length<=e.totalBytesToRead?(e.totalBytesToRead=e.totalBytesToRead-n.length,e.push(n)):n.length>e.totalBytesToRead&&(e.totalBytesToRead=e.totalBytesToRead-n._index,e.push(n.slice(0,n._index))),void(e.totalBytesToRead<=0&&(e.endCalled=!0)))}))},n=e.gs.length<e.gs.chunkSize?e.gs.length-e.seekPosition:e.gs.chunkSize;e.gs.isOpen?t():e.gs.open((function(n){if(e.totalBytesToRead=e.gs.length-e.gs.position,n)return e.emit("error",n);t()}))},H.prototype.destroy=function(){this.pause(),this.endCalled=!0,this.gs.close(),this.emit("end")},H.prototype.write=function(e){var t=this;return t.endCalled?t.emit("error",p.create({message:"attempting to write to stream after end called",driver:!0})):t.gs.isOpen?(t.gs.write(e,(function(){t.emit("drain")})),!0):(t.gs.open((function(){t.gs.isOpen=!0,t.gs.write(e,(function(){process.nextTick((function(){t.emit("drain")}))}))})),!1)},H.prototype.end=function(e,t,n){var o=this,i=Array.prototype.slice.call(arguments,0);n="function"==typeof i[i.length-1]?i.pop():void 0,e=i.length?i.shift():null,t=i.length?i.shift():null,o.endCalled=!0,e&&o.gs.write(e,(function(){o.gs.close((function(){"function"==typeof n&&n(),o.emit("end")}))})),o.gs.close((function(){"function"==typeof n&&n(),o.emit("end")}))},e.exports=y},function(e,t,n){"use strict";var o=n(9).EventEmitter,i=n(205),r=n(206),s=n(0).shallowClone,a=n(0).toError,c=n(4),l=n(0).executeLegacyOperation,p={bucketName:"fs",chunkSizeBytes:261120};function u(e,t){if(o.apply(this),this.setMaxListeners(0),t&&"object"==typeof t){t=s(t);for(var n=Object.keys(p),i=0;i<n.length;++i)t[n[i]]||(t[n[i]]=p[n[i]])}else t=p;this.s={db:e,options:t,_chunksCollection:e.collection(t.bucketName+".chunks"),_filesCollection:e.collection(t.bucketName+".files"),checkedIndexes:!1,calledOpenUploadStream:!1,promiseLibrary:e.s.promiseLibrary||Promise}}function d(e,t,n){e.s._filesCollection.deleteOne({_id:t},(function(o,i){if(o)return n(o);e.s._chunksCollection.deleteMany({files_id:t},(function(e){return e?n(e):i.result.n?void n():n(new Error("FileNotFound: no file with id "+t+" found"))}))}))}function h(e,t,n,o){var i={_id:t},r={$set:{filename:n}};e.s._filesCollection.updateOne(i,r,(function(e,n){return e?o(e):n.result.n?void o():o(a("File with id "+t+" not found"))}))}function m(e,t){e.s._filesCollection.drop((function(n){if(n)return t(n);e.s._chunksCollection.drop((function(e){return e?t(e):t()}))}))}e.exports=u,c.inherits(u,o),u.prototype.openUploadStream=function(e,t){return(t=t?s(t):{}).chunkSizeBytes||(t.chunkSizeBytes=this.s.options.chunkSizeBytes),new r(this,e,t)},u.prototype.openUploadStreamWithId=function(e,t,n){return(n=n?s(n):{}).chunkSizeBytes||(n.chunkSizeBytes=this.s.options.chunkSizeBytes),n.id=e,new r(this,t,n)},u.prototype.openDownloadStream=function(e,t){var n={_id:e};return t={start:t&&t.start,end:t&&t.end},new i(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,n,t)},u.prototype.delete=function(e,t){return l(this.s.db.s.topology,d,[this,e,t],{skipSessions:!0})},u.prototype.find=function(e,t){e=e||{},t=t||{};var n=this.s._filesCollection.find(e);return null!=t.batchSize&&n.batchSize(t.batchSize),null!=t.limit&&n.limit(t.limit),null!=t.maxTimeMS&&n.maxTimeMS(t.maxTimeMS),null!=t.noCursorTimeout&&n.addCursorFlag("noCursorTimeout",t.noCursorTimeout),null!=t.skip&&n.skip(t.skip),null!=t.sort&&n.sort(t.sort),n},u.prototype.openDownloadStreamByName=function(e,t){var n={uploadDate:-1},o=null;t&&null!=t.revision&&(t.revision>=0?(n={uploadDate:1},o=t.revision):o=-t.revision-1);var r={filename:e};return t={sort:n,skip:o,start:t&&t.start,end:t&&t.end},new i(this.s._chunksCollection,this.s._filesCollection,this.s.options.readPreference,r,t)},u.prototype.rename=function(e,t,n){return l(this.s.db.s.topology,h,[this,e,t,n],{skipSessions:!0})},u.prototype.drop=function(e){return l(this.s.db.s.topology,m,[this,e],{skipSessions:!0})},u.prototype.getLogger=function(){return this.s.db.s.logger}},function(e,t,n){"use strict";var o=n(14),i=n(4);function r(e,t,n,i,r){this.s={bytesRead:0,chunks:e,cursor:null,expected:0,files:t,filter:i,init:!1,expectedEnd:0,file:null,options:r,readPreference:n},o.Readable.call(this)}function s(e){if(e.s.init)throw new Error("You cannot change options after the stream has enteredflowing mode!")}function a(e,t){e.emit("error",t)}e.exports=r,i.inherits(r,o.Readable),r.prototype._read=function(){var e=this;this.destroyed||function(e,t){if(e.s.file)return t();e.s.init||(!function(e){var t={};e.s.readPreference&&(t.readPreference=e.s.readPreference);e.s.options&&e.s.options.sort&&(t.sort=e.s.options.sort);e.s.options&&e.s.options.skip&&(t.skip=e.s.options.skip);e.s.files.findOne(e.s.filter,t,(function(t,n){if(t)return a(e,t);if(!n){var o=e.s.filter._id?e.s.filter._id.toString():e.s.filter.filename,i=new Error("FileNotFound: file "+o+" was not found");return i.code="ENOENT",a(e,i)}if(n.length<=0)e.push(null);else if(e.destroyed)e.emit("close");else{e.s.bytesToSkip=function(e,t,n){if(n&&null!=n.start){if(n.start>t.length)throw new Error("Stream start ("+n.start+") must not be more than the length of the file ("+t.length+")");if(n.start<0)throw new Error("Stream start ("+n.start+") must not be negative");if(null!=n.end&&n.end<n.start)throw new Error("Stream start ("+n.start+") must not be greater than stream end ("+n.end+")");return e.s.bytesRead=Math.floor(n.start/t.chunkSize)*t.chunkSize,e.s.expected=Math.floor(n.start/t.chunkSize),n.start-e.s.bytesRead}}(e,n,e.s.options);var r={files_id:n._id};if(e.s.options&&null!=e.s.options.start){var s=Math.floor(e.s.options.start/n.chunkSize);s>0&&(r.n={$gte:s})}e.s.cursor=e.s.chunks.find(r).sort({n:1}),e.s.readPreference&&e.s.cursor.setReadPreference(e.s.readPreference),e.s.expectedEnd=Math.ceil(n.length/n.chunkSize),e.s.file=n,e.s.bytesToTrim=function(e,t,n,o){if(o&&null!=o.end){if(o.end>t.length)throw new Error("Stream end ("+o.end+") must not be more than the length of the file ("+t.length+")");if(o.start<0)throw new Error("Stream end ("+o.end+") must not be negative");var i=null!=o.start?Math.floor(o.start/t.chunkSize):0;return n.limit(Math.ceil(o.end/t.chunkSize)-i),e.s.expectedEnd=Math.ceil(o.end/t.chunkSize),Math.ceil(o.end/t.chunkSize)*t.chunkSize-o.end}}(e,n,e.s.cursor,e.s.options),e.emit("file",n)}}))}(e),e.s.init=!0);e.once("file",(function(){t()}))}(e,(function(){!function(e){if(e.destroyed)return;e.s.cursor.next((function(t,n){if(e.destroyed)return;if(t)return a(e,t);if(!n)return e.push(null),void process.nextTick(()=>{e.s.cursor.close((function(t){t?a(e,t):e.emit("close")}))});var o=e.s.file.length-e.s.bytesRead,i=e.s.expected++,r=Math.min(e.s.file.chunkSize,o);if(n.n>i){var s="ChunkIsMissing: Got unexpected n: "+n.n+", expected: "+i;return a(e,new Error(s))}if(n.n<i)return s="ExtraChunk: Got unexpected n: "+n.n+", expected: "+i,a(e,new Error(s));var c=Buffer.isBuffer(n.data)?n.data:n.data.buffer;if(c.length!==r)return o<=0?(s="ExtraChunk: Got unexpected n: "+n.n,a(e,new Error(s))):(s="ChunkIsWrongSize: Got unexpected length: "+c.length+", expected: "+r,a(e,new Error(s)));if(e.s.bytesRead+=c.length,0===c.length)return e.push(null);var l=null,p=null;null!=e.s.bytesToSkip&&(l=e.s.bytesToSkip,e.s.bytesToSkip=0);const u=i===e.s.expectedEnd-1,d=e.s.options.end-e.s.bytesToSkip;u&&null!=e.s.bytesToTrim?p=e.s.file.chunkSize-e.s.bytesToTrim:e.s.options.end&&d<n.data.length()&&(p=d),null==l&&null==p||(c=c.slice(l||0,p||c.length)),e.push(c)}))}(e)}))},r.prototype.start=function(e){return s(this),this.s.options.start=e,this},r.prototype.end=function(e){return s(this),this.s.options.end=e,this},r.prototype.abort=function(e){var t=this;this.push(null),this.destroyed=!0,this.s.cursor?this.s.cursor.close((function(n){t.emit("close"),e&&e(n)})):(this.s.init||t.emit("close"),e&&e())}},function(e,t,n){"use strict";var o=n(2),i=n(16),r=n(14),s=n(4),a=n(17).Buffer,c=26;function l(e,t,n){if(n=n||{},this.bucket=e,this.chunks=e.s._chunksCollection,this.filename=t,this.files=e.s._filesCollection,this.options=n,this.done=!1,this.id=n.id?n.id:o.BSON.ObjectId(),this.chunkSizeBytes=this.options.chunkSizeBytes,this.bufToStore=a.alloc(this.chunkSizeBytes),this.length=0,this.md5=!n.disableMD5&&i.createHash("md5"),this.n=0,this.pos=0,this.state={streamEnd:!1,outstandingRequests:0,errored:!1,aborted:!1,promiseLibrary:this.bucket.s.promiseLibrary},!this.bucket.s.calledOpenUploadStream){this.bucket.s.calledOpenUploadStream=!0;var r=this;!function(e,t){e.files.findOne({},{_id:1},(function(n,o){return n?t(n):o?t():void e.files.listIndexes().toArray((function(n,o){if(n){if(n.code===c){var i={filename:1,uploadDate:1};return void e.files.createIndex(i,{background:!1},(function(n){if(n)return t(n);d(e,t)}))}return t(n)}var r=!1;if(o.forEach((function(e){2===Object.keys(e.key).length&&1===e.key.filename&&1===e.key.uploadDate&&(r=!0)})),r)d(e,t);else{i={filename:1,uploadDate:1};var s=m(e);s.background=!1,e.files.createIndex(i,s,(function(n){if(n)return t(n);d(e,t)}))}}))}))}(this,(function(){r.bucket.s.checkedIndexes=!0,r.bucket.emit("index")}))}}function p(e,t,n){if(!e.state.errored){if(e.state.errored=!0,n)return n(t);e.emit("error",t)}}function u(e,t,n){return{_id:o.BSON.ObjectId(),files_id:e,n:t,data:n}}function d(e,t){e.chunks.listIndexes().toArray((function(n,o){if(n){if(n.code===c){var i={files_id:1,n:1};return void e.chunks.createIndex(i,{background:!1,unique:!0},(function(e){if(e)return t(e);t()}))}return t(n)}var r=!1;if(o.forEach((function(e){e.key&&(2===Object.keys(e.key).length&&1===e.key.files_id&&1===e.key.n&&(r=!0))})),r)t();else{i={files_id:1,n:1};var s=m(e);s.background=!1,s.unique=!0,e.chunks.createIndex(i,s,(function(e){if(e)return t(e);t()}))}}))}function h(e,t){if(e.done)return!0;if(e.state.streamEnd&&0===e.state.outstandingRequests&&!e.state.errored){e.done=!0;var n=function(e,t,n,o,i,r,s,a){var c={_id:e,length:t,chunkSize:n,uploadDate:new Date,filename:i};o&&(c.md5=o);r&&(c.contentType=r);s&&(c.aliases=s);a&&(c.metadata=a);return c}(e.id,e.length,e.chunkSizeBytes,e.md5&&e.md5.digest("hex"),e.filename,e.options.contentType,e.options.aliases,e.options.metadata);return!y(e,t)&&(e.files.insertOne(n,m(e),(function(o){if(o)return p(e,o,t);e.emit("finish",n)})),!0)}return!1}function m(e){var t={};return e.options.writeConcern&&(t.w=e.options.writeConcern.w,t.wtimeout=e.options.writeConcern.wtimeout,t.j=e.options.writeConcern.j),t}function f(e,t){return e.bucket.s.checkedIndexes?t(!1):(e.bucket.once("index",(function(){t(!0)})),!0)}function g(e,t){if(0===e.pos)return h(e,t);++e.state.outstandingRequests;var n=a.alloc(e.pos);e.bufToStore.copy(n,0,0,e.pos),e.md5&&e.md5.update(n);var o=u(e.id,e.n,n);if(y(e,t))return!1;e.chunks.insertOne(o,m(e),(function(t){if(t)return p(e,t);--e.state.outstandingRequests,h(e)}))}function y(e,t){return!!e.state.aborted&&("function"==typeof t&&t(new Error("this stream has been aborted")),!0)}e.exports=l,s.inherits(l,r.Writable),l.prototype.write=function(e,t,n){var o=this;return f(this,(function(){return function(e,t,n,o){if(y(e,o))return!1;var i=a.isBuffer(t)?t:a.from(t,n);if(e.length+=i.length,e.pos+i.length<e.chunkSizeBytes)return i.copy(e.bufToStore,e.pos),e.pos+=i.length,o&&o(),!0;var r=i.length,s=e.chunkSizeBytes-e.pos,c=Math.min(s,i.length),l=0;for(;r>0;){var d=i.length-r;if(i.copy(e.bufToStore,e.pos,d,d+c),e.pos+=c,0===(s-=c)){e.md5&&e.md5.update(e.bufToStore);var f=u(e.id,e.n,e.bufToStore);if(++e.state.outstandingRequests,++l,y(e,o))return!1;e.chunks.insertOne(f,m(e),(function(t){if(t)return p(e,t);--e.state.outstandingRequests,--l||(e.emit("drain",f),o&&o(),h(e))})),s=e.chunkSizeBytes,e.pos=0,++e.n}r-=c,c=Math.min(s,r)}return!1}(o,e,t,n)}))},l.prototype.abort=function(e){if(this.state.streamEnd){var t=new Error("Cannot abort a stream that has already completed");return"function"==typeof e?e(t):this.state.promiseLibrary.reject(t)}if(this.state.aborted)return t=new Error("Cannot call abort() on a stream twice"),"function"==typeof e?e(t):this.state.promiseLibrary.reject(t);this.state.aborted=!0,this.chunks.deleteMany({files_id:this.id},(function(t){"function"==typeof e&&e(t)}))},l.prototype.end=function(e,t,n){var o=this;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),y(this,n)||(this.state.streamEnd=!0,n&&this.once("finish",(function(e){n(null,e)})),e?this.write(e,t,(function(){g(o)})):f(this,(function(){g(o)})))}},,,,,,,,,,function(e,t,n){"use strict";const o=n(64),i=n(335),r=n(27),s=n(114),a=n(14).PassThrough,c=n(336),l=n(79),p=5;e.exports=function(e,t){return function e(t,n){n=n||{};n.fetchRes=n.fetchRes||new a;n.cookies=n.cookies||new c;n.redirects=n.redirects||0;n.maxRedirects=isNaN(n.maxRedirects)?p:n.maxRedirects;n.cookie&&([].concat(n.cookie||[]).forEach(e=>{n.cookies.set(e,t)}),n.cookie=!1);let u=n.fetchRes;let d=r.parse(t);let h=(n.method||"").toString().trim().toUpperCase()||"GET";let m=!1;let f;let g;let y="https:"===d.protocol?i:o;let v={"accept-encoding":"gzip,deflate","user-agent":"nodemailer/"+l.version};Object.keys(n.headers||{}).forEach(e=>{v[e.toLowerCase().trim()]=n.headers[e]});n.userAgent&&(v["user-agent"]=n.userAgent);d.auth&&(v.Authorization="Basic "+Buffer.from(d.auth).toString("base64"));(f=n.cookies.get(t))&&(v.cookie=f);if(n.body){if(!1!==n.contentType&&(v["Content-Type"]=n.contentType||"application/x-www-form-urlencoded"),"function"==typeof n.body.pipe)v["Transfer-Encoding"]="chunked",(g=n.body).on("error",e=>{m||(m=!0,e.type="FETCH",e.sourceUrl=t,u.emit("error",e))});else{if(n.body instanceof Buffer)g=n.body;else if("object"==typeof n.body)try{g=Buffer.from(Object.keys(n.body).map(e=>{let t=n.body[e].toString().trim();return encodeURIComponent(e)+"="+encodeURIComponent(t)}).join("&"))}catch(e){if(m)return;return m=!0,e.type="FETCH",e.sourceUrl=t,void u.emit("error",e)}else g=Buffer.from(n.body.toString().trim());v["Content-Type"]=n.contentType||"application/x-www-form-urlencoded",v["Content-Length"]=g.length}h=(n.method||"").toString().trim().toUpperCase()||"POST"}let b;let x={method:h,host:d.hostname,path:d.path,port:d.port?d.port:"https:"===d.protocol?443:80,headers:v,rejectUnauthorized:!1,agent:!1};n.tls&&Object.keys(n.tls).forEach(e=>{x[e]=n.tls[e]});try{b=y.request(x)}catch(e){return m=!0,setImmediate(()=>{e.type="FETCH",e.sourceUrl=t,u.emit("error",e)}),u}n.timeout&&b.setTimeout(n.timeout,()=>{if(m)return;m=!0,b.abort();let e=new Error("Request Timeout");e.type="FETCH",e.sourceUrl=t,u.emit("error",e)});b.on("error",e=>{m||(m=!0,e.type="FETCH",e.sourceUrl=t,u.emit("error",e))});b.on("response",o=>{let i;if(!m){switch(o.headers["content-encoding"]){case"gzip":case"deflate":i=s.createUnzip()}if(o.headers["set-cookie"]&&[].concat(o.headers["set-cookie"]||[]).forEach(e=>{n.cookies.set(e,t)}),[301,302,303,307,308].includes(o.statusCode)&&o.headers.location){if(n.redirects++,n.redirects>n.maxRedirects){m=!0;let e=new Error("Maximum redirect count exceeded");return e.type="FETCH",e.sourceUrl=t,u.emit("error",e),void b.abort()}return n.method="GET",n.body=!1,e(r.resolve(t,o.headers.location),n)}if(u.statusCode=o.statusCode,u.headers=o.headers,o.statusCode>=300&&!n.allowErrorResponse){m=!0;let e=new Error("Invalid status code "+o.statusCode);return e.type="FETCH",e.sourceUrl=t,u.emit("error",e),void b.abort()}o.on("error",e=>{m||(m=!0,e.type="FETCH",e.sourceUrl=t,u.emit("error",e),b.abort())}),i?(o.pipe(i).pipe(u),i.on("error",e=>{m||(m=!0,e.type="FETCH",e.sourceUrl=t,u.emit("error",e),b.abort())})):o.pipe(u)}});setImmediate(()=>{if(g)try{if("function"==typeof g.pipe)return g.pipe(b);b.write(g)}catch(e){return m=!0,e.type="FETCH",e.sourceUrl=t,void u.emit("error",e)}b.end()});return u}(e,t)},e.exports.Cookies=c},function(e,t,n){"use strict";const o=n(246),i=n(247),r=n(243);e.exports={isPlainText:e=>"string"==typeof e&&!/[\x00-\x08\x0b\x0c\x0e-\x1f\u0080-\uFFFF]/.test(e),hasLongerLines:(e,t)=>e.length>131072||new RegExp("^.{"+(t+1)+",}","m").test(e),encodeWord(e,t,n){let r;t=(t||"Q").toString().toUpperCase().trim().charAt(0);if((n=n||0)&&n>7+"UTF-8".length&&(n-=7+"UTF-8".length),"Q"===t?r=i.encode(e).replace(/[^a-z0-9!*+\-/=]/gi,e=>{let t=e.charCodeAt(0).toString(16).toUpperCase();return" "===e?"_":"="+(1===t.length?"0"+t:t)}):"B"===t&&(r="string"==typeof e?e:o.encode(e),n=n?Math.max(3,(n-n%4)/4*3):0),n&&("B"!==t?r:o.encode(e)).length>n)if("Q"===t)r=this.splitMimeEncodedString(r,n).join("?= =?UTF-8?"+t+"?");else{let e=[],i="";for(let t=0,s=r.length;t<s;t++){let s=r.charAt(t);Buffer.byteLength(i+s)<=n||0===t?i+=s:(e.push(o.encode(i)),i=s)}i&&e.push(o.encode(i)),r=e.length>1?e.join("?= =?UTF-8?"+t+"?"):e.join("")}else"B"===t&&(r=o.encode(e));return"=?UTF-8?"+t+"?"+r+("?="===r.substr(-2)?"":"?=")},encodeWords(e,t,n,o){let i;n=n||0;let r=e.match(/(?:^|\s)([^\s]*[\u0080-\uFFFF])/);if(!r)return e;if(o)return this.encodeWord(e,t,n);let s=e.match(/([\u0080-\uFFFF][^\s]*)[^\u0080-\uFFFF]*$/);if(!s)return e;let a=r.index+(r[0].match(/[^\s]/)||{index:0}).index,c=s.index+(s[1]||"").length;return i=(a?e.substr(0,a):"")+this.encodeWord(e.substring(a,c),t||"Q",n)+(c<e.length?e.substr(c):"")},buildHeaderValue(e){let t=[];return Object.keys(e.params||{}).forEach(n=>{let o=e.params[n];!this.isPlainText(o)||o.length>=75?this.buildHeaderParam(n,o,50).forEach(e=>{/[\s"\\;:/=(),<>@[\]?]|^[-']|'$/.test(e.value)&&"*"!==e.key.substr(-1)?t.push(e.key+"="+JSON.stringify(e.value)):t.push(e.key+"="+e.value)}):/[\s'"\\;:/=(),<>@[\]?]|^-/.test(o)?t.push(n+"="+JSON.stringify(o)):t.push(n+"="+o)}),e.value+(t.length?"; "+t.join("; "):"")},buildHeaderParam(e,t,n){let o,i,r,s,a,c,l=[],p="string"==typeof t?t:(t||"").toString(),u=0;if(n=n||50,this.isPlainText(t)){if(p.length<=n)return[{key:e,value:p}];(p=p.replace(new RegExp(".{"+n+"}","g"),e=>(l.push({line:e}),"")))&&l.push({line:p})}else{if(/[\uD800-\uDBFF]/.test(p)){for(o=[],a=0,c=p.length;a<c;a++)(r=(i=p.charAt(a)).charCodeAt(0))>=55296&&r<=56319&&a<c-1?(i+=p.charAt(a+1),o.push(i),a++):o.push(i);p=o}s="utf-8''";let e=!0;for(u=0,a=0,c=p.length;a<c;a++){if(i=p[a],e)i=this.safeEncodeURIComponent(i);else if((i=" "===i?i:this.safeEncodeURIComponent(i))!==p[a]){if(!((this.safeEncodeURIComponent(s)+i).length>=n)){e=!0,a=u,s="";continue}l.push({line:s,encoded:e}),s="",u=a-1}(s+i).length>=n?(l.push({line:s,encoded:e}),s=i=" "===p[a]?" ":this.safeEncodeURIComponent(p[a]),i===p[a]?(e=!1,u=a-1):e=!0):s+=i}s&&l.push({line:s,encoded:e})}return l.map((t,n)=>({key:e+"*"+n+(t.encoded?"*":""),value:t.line}))},parseHeaderValue(e){let t,n={value:!1,params:{}},o=!1,i="",r="value",s=!1,a=!1;for(let c=0,l=e.length;c<l;c++)if(t=e.charAt(c),"key"===r){if("="===t){o=i.trim().toLowerCase(),r="value",i="";continue}i+=t}else{if(a)i+=t;else{if("\\"===t){a=!0;continue}s&&t===s?s=!1:s||'"'!==t?s||";"!==t?i+=t:(!1===o?n.value=i.trim():n.params[o]=i.trim(),r="key",i=""):s=t}a=!1}return"value"===r?!1===o?n.value=i.trim():n.params[o]=i.trim():i.trim()&&(n.params[i.trim().toLowerCase()]=""),Object.keys(n.params).forEach(e=>{let t,o,i,r;(i=e.match(/(\*(\d+)|\*(\d+)\*|\*)$/))&&(t=e.substr(0,i.index),o=Number(i[2]||i[3])||0,n.params[t]&&"object"==typeof n.params[t]||(n.params[t]={charset:!1,values:[]}),r=n.params[e],0===o&&"*"===i[0].substr(-1)&&(i=r.match(/^([^']*)'[^']*'(.*)$/))&&(n.params[t].charset=i[1]||"iso-8859-1",r=i[2]),n.params[t].values[o]=r,delete n.params[e])}),Object.keys(n.params).forEach(e=>{let t;n.params[e]&&Array.isArray(n.params[e].values)&&(t=n.params[e].values.map(e=>e||"").join(""),n.params[e].charset?n.params[e]="=?"+n.params[e].charset+"?Q?"+t.replace(/[=?_\s]/g,e=>{let t=e.charCodeAt(0).toString(16);return" "===e?"_":"%"+(t.length<2?"0":"")+t}).replace(/%/g,"=")+"?=":n.params[e]=t)}),n},detectExtension:e=>r.detectExtension(e),detectMimeType:e=>r.detectMimeType(e),foldLines(e,t,n){t=t||76;let o,i,r=0,s=(e=(e||"").toString()).length,a="";for(;r<s;){if((o=e.substr(r,t)).length<t){a+=o;break}(i=o.match(/^[^\n\r]*(\r?\n|\r)/))?(a+=o=i[0],r+=o.length):((i=o.match(/(\s+)[^\s]*$/))&&i[0].length-(n?(i[1]||"").length:0)<o.length?o=o.substr(0,o.length-(i[0].length-(n?(i[1]||"").length:0))):(i=e.substr(r+o.length).match(/^[^\s]+(\s*)/))&&(o+=i[0].substr(0,i[0].length-(n?0:(i[1]||"").length))),a+=o,(r+=o.length)<s&&(a+="\r\n"))}return a},splitMimeEncodedString:(e,t)=>{let n,o,i,r,s=[];for(t=Math.max(t||0,12);e.length;){for((o=(n=e.substr(0,t)).match(/[=][0-9A-F]?$/i))&&(n=n.substr(0,o.index)),r=!1;!r;)r=!0,(o=e.substr(n.length).match(/^[=]([0-9A-F]{2})/i))&&(i=parseInt(o[1],16))<194&&i>127&&(n=n.substr(0,n.length-3),r=!1);n.length&&s.push(n),e=e.substr(n.length)}return s},encodeURICharComponent:e=>{let t="",n=e.charCodeAt(0).toString(16).toUpperCase();if(n.length%2&&(n="0"+n),n.length>2)for(let e=0,o=n.length/2;e<o;e++)t+="%"+n.substr(e,2);else t+="%"+n;return t},safeEncodeURIComponent(e){e=(e||"").toString();try{e=encodeURIComponent(e)}catch(t){return e.replace(/[^\x00-\x1F *'()<>@,;:\\"[\]?=\u007F-\uFFFF]+/g,"")}return e.replace(/[\x00-\x1F *'()<>@,;:\\"[\]?=\u007F-\uFFFF]/g,e=>this.encodeURICharComponent(e))}}},,,,,function(e,t,n){"use strict";const o=n(79),i=n(9).EventEmitter,r=n(66),s=n(77),a=n(78),c=n(16),l=n(348),p=n(14).PassThrough,u=n(63),d=12e4,h=6e5,m=3e4;e.exports=class extends i{constructor(e){super(e),this.id=c.randomBytes(8).toString("base64").replace(/\W/g,""),this.stage="init",this.options=e||{},this.secureConnection=!!this.options.secure,this.alreadySecured=!!this.options.secured,this.port=Number(this.options.port)||(this.secureConnection?465:587),this.host=this.options.host||"localhost",void 0===this.options.secure&&465===this.port&&(this.secureConnection=!0),this.name=this.options.name||this._getHostname(),this.logger=u.getLogger(this.options,{component:this.options.component||"smtp-connection",sid:this.id}),this.customAuth=new Map,Object.keys(this.options.customAuth||{}).forEach(e=>{let t=(e||"").toString().trim().toUpperCase();t&&this.customAuth.set(t,this.options.customAuth[e])}),this.version=o.version,this.authenticated=!1,this.destroyed=!1,this.secure=!!this.secureConnection,this._remainder="",this._responseQueue=[],this.lastServerResponse=!1,this._socket=!1,this._supportedAuth=[],this._envelope=!1,this._supportedExtensions=[],this._maxAllowedSize=0,this._responseActions=[],this._recipientQueue=[],this._greetingTimeout=!1,this._connectionTimeout=!1,this._destroyed=!1,this._closing=!1,this._onSocketData=e=>this._onData(e),this._onSocketError=e=>this._onError(e,"ESOCKET",!1,"CONN"),this._onSocketClose=()=>this._onClose(),this._onSocketEnd=()=>this._onEnd(),this._onSocketTimeout=()=>this._onTimeout()}connect(e){if("function"==typeof e){this.once("connect",()=>{this.logger.debug({tnx:"smtp"},"SMTP handshake finished"),e()});const t=this._isDestroyedMessage("connect");if(t)return e(this._formatError(t,"ECONNECTION",!1,"CONN"))}let t={port:this.port,host:this.host};this.options.localAddress&&(t.localAddress=this.options.localAddress);let n=()=>{this._connectionTimeout=setTimeout(()=>{this._onError("Connection timeout","ETIMEDOUT",!1,"CONN")},this.options.connectionTimeout||d),this._socket.on("error",this._onSocketError)};return this.options.connection?(this._socket=this.options.connection,void(this.secureConnection&&!this.alreadySecured?setImmediate(()=>this._upgradeConnection(e=>{e?this._onError(new Error("Error initiating TLS - "+(e.message||e)),"ETLS",!1,"CONN"):this._onConnect()})):setImmediate(()=>this._onConnect()))):this.options.socket?(this._socket=this.options.socket,u.resolveHostname(t,(e,o)=>{if(e)return setImmediate(()=>this._onError(e,"EDNS",!1,"CONN"));this.logger.debug({tnx:"dns",source:t.host,resolved:o.host,cached:!!o._cached},"Resolved %s as %s [cache %s]",t.host,o.host,o._cached?"hit":"miss"),Object.keys(o).forEach(e=>{"_"!==e.charAt(0)&&o[e]&&(t[e]=o[e])});try{this._socket.connect(this.port,this.host,()=>{this._socket.setKeepAlive(!0),this._onConnect()}),n()}catch(e){return setImmediate(()=>this._onError(e,"ECONNECTION",!1,"CONN"))}})):this.secureConnection?(this.options.tls&&Object.keys(this.options.tls).forEach(e=>{t[e]=this.options.tls[e]}),u.resolveHostname(t,(e,o)=>{if(e)return setImmediate(()=>this._onError(e,"EDNS",!1,"CONN"));this.logger.debug({tnx:"dns",source:t.host,resolved:o.host,cached:!!o._cached},"Resolved %s as %s [cache %s]",t.host,o.host,o._cached?"hit":"miss"),Object.keys(o).forEach(e=>{"_"!==e.charAt(0)&&o[e]&&(t[e]=o[e])});try{this._socket=s.connect(t,()=>{this._socket.setKeepAlive(!0),this._onConnect()}),n()}catch(e){return setImmediate(()=>this._onError(e,"ECONNECTION",!1,"CONN"))}})):u.resolveHostname(t,(e,o)=>{if(e)return setImmediate(()=>this._onError(e,"EDNS",!1,"CONN"));this.logger.debug({tnx:"dns",source:t.host,resolved:o.host,cached:!!o._cached},"Resolved %s as %s [cache %s]",t.host,o.host,o._cached?"hit":"miss"),Object.keys(o).forEach(e=>{"_"!==e.charAt(0)&&o[e]&&(t[e]=o[e])});try{this._socket=r.connect(t,()=>{this._socket.setKeepAlive(!0),this._onConnect()}),n()}catch(e){return setImmediate(()=>this._onError(e,"ECONNECTION",!1,"CONN"))}})}quit(){this._sendCommand("QUIT"),this._responseActions.push(this.close)}close(){if(clearTimeout(this._connectionTimeout),clearTimeout(this._greetingTimeout),this._responseActions=[],this._closing)return;this._closing=!0;let e="end";"init"===this.stage&&(e="destroy"),this.logger.debug({tnx:"smtp"},'Closing connection to the server using "%s"',e);let t=this._socket&&this._socket.socket||this._socket;if(t&&!t.destroyed)try{this._socket[e]()}catch(e){}this._destroy()}login(e,t){const n=this._isDestroyedMessage("login");if(n)return t(this._formatError(n,"ECONNECTION",!1,"API"));if(this._auth=e||{},this._authMethod=(this._auth.method||"").toString().trim().toUpperCase()||!1,this._authMethod||!this._auth.oauth2||this._auth.credentials?this._authMethod&&("XOAUTH2"!==this._authMethod||this._auth.oauth2)||(this._authMethod=(this._supportedAuth[0]||"PLAIN").toUpperCase().trim()):this._authMethod="XOAUTH2",!("XOAUTH2"===this._authMethod||this._auth.credentials&&this._auth.credentials.user&&this._auth.credentials.pass)){if(!this._auth.user||!this._auth.pass)return t(this._formatError('Missing credentials for "'+this._authMethod+'"',"EAUTH",!1,"API"));this._auth.credentials={user:this._auth.user,pass:this._auth.pass,options:this._auth.options}}if(!this.customAuth.has(this._authMethod)){switch(this._authMethod){case"XOAUTH2":return void this._handleXOauth2Token(!1,t);case"LOGIN":return this._responseActions.push(e=>{this._actionAUTH_LOGIN_USER(e,t)}),void this._sendCommand("AUTH LOGIN");case"PLAIN":return this._responseActions.push(e=>{this._actionAUTHComplete(e,t)}),void this._sendCommand("AUTH PLAIN "+Buffer.from("\0"+this._auth.credentials.user+"\0"+this._auth.credentials.pass,"utf-8").toString("base64"));case"CRAM-MD5":return this._responseActions.push(e=>{this._actionAUTH_CRAM_MD5(e,t)}),void this._sendCommand("AUTH CRAM-MD5")}return t(this._formatError('Unknown authentication method "'+this._authMethod+'"',"EAUTH",!1,"API"))}{let e,n=this.customAuth.get(this._authMethod),o=!1,i=()=>{o||(o=!0,this.logger.info({tnx:"smtp",username:this._auth.user,action:"authenticated",method:this._authMethod},"User %s authenticated",JSON.stringify(this._auth.user)),this.authenticated=!0,t(null,!0))},r=n=>{o||(o=!0,t(this._formatError(n,"EAUTH",e,"AUTH "+this._authMethod)))},s=n({auth:this._auth,method:this._authMethod,extensions:[].concat(this._supportedExtensions),authMethods:[].concat(this._supportedAuth),maxAllowedSize:this._maxAllowedSize||!1,sendCommand:(t,n)=>{let o;return n||(o=new Promise((e,t)=>{n=u.callbackPromise(e,t)})),this._responseActions.push(o=>{e=o;let i=o.match(/^(\d+)(?:\s(\d+\.\d+\.\d+))?\s/),r={command:t,response:o};i?(r.status=Number(i[1])||0,i[2]&&(r.code=i[2]),r.text=o.substr(i[0].length)):(r.text=o,r.status=0),n(null,r)}),setImmediate(()=>this._sendCommand(t)),o},resolve:i,reject:r});s&&"function"==typeof s.catch&&s.then(i).catch(r)}}send(e,t,n){if(!t)return n(this._formatError("Empty message","EMESSAGE",!1,"API"));const o=this._isDestroyedMessage("send message");if(o)return n(this._formatError(o,"ECONNECTION",!1,"API"));if(this._maxAllowedSize&&e.size>this._maxAllowedSize)return setImmediate(()=>{n(this._formatError("Message size larger than allowed "+this._maxAllowedSize,"EMESSAGE",!1,"MAIL FROM"))});let i=!1,r=function(){i||(i=!0,n(...arguments))};"function"==typeof t.on&&t.on("error",e=>r(this._formatError(e,"ESTREAM",!1,"API")));let s=Date.now();this._setEnvelope(e,(e,n)=>{if(e)return r(e);let o=Date.now(),i=this._createSendStream((e,t)=>e?r(e):(n.envelopeTime=o-s,n.messageTime=Date.now()-o,n.messageSize=i.outByteCount,n.response=t,r(null,n)));"function"==typeof t.pipe?t.pipe(i):(i.write(t),i.end())})}reset(e){this._sendCommand("RSET"),this._responseActions.push(t=>"2"!==t.charAt(0)?e(this._formatError("Could not reset session state. response="+t,"EPROTOCOL",t,"RSET")):(this._envelope=!1,e(null,!0)))}_onConnect(){clearTimeout(this._connectionTimeout),this.logger.info({tnx:"network",localAddress:this._socket.localAddress,localPort:this._socket.localPort,remoteAddress:this._socket.remoteAddress,remotePort:this._socket.remotePort},"%s established to %s:%s",this.secure?"Secure connection":"Connection",this._socket.remoteAddress,this._socket.remotePort),this._destroyed?this.close():(this.stage="connected",this._socket.removeListener("data",this._onSocketData),this._socket.removeListener("timeout",this._onSocketTimeout),this._socket.removeListener("close",this._onSocketClose),this._socket.removeListener("end",this._onSocketEnd),this._socket.on("data",this._onSocketData),this._socket.once("close",this._onSocketClose),this._socket.once("end",this._onSocketEnd),this._socket.setTimeout(this.options.socketTimeout||h),this._socket.on("timeout",this._onSocketTimeout),this._greetingTimeout=setTimeout(()=>{this._socket&&!this._destroyed&&this._responseActions[0]===this._actionGreeting&&this._onError("Greeting never received","ETIMEDOUT",!1,"CONN")},this.options.greetingTimeout||m),this._responseActions.push(this._actionGreeting),this._socket.resume())}_onData(e){if(this._destroyed||!e||!e.length)return;let t,n=(e||"").toString("binary"),o=(this._remainder+n).split(/\r?\n/);this._remainder=o.pop();for(let e=0,n=o.length;e<n;e++)this._responseQueue.length&&(t=this._responseQueue[this._responseQueue.length-1],/^\d+-/.test(t.split("\n").pop()))?this._responseQueue[this._responseQueue.length-1]+="\n"+o[e]:this._responseQueue.push(o[e]);this._processResponse()}_onError(e,t,n,o){clearTimeout(this._connectionTimeout),clearTimeout(this._greetingTimeout),this._destroyed||(e=this._formatError(e,t,n,o),this.logger.error(n,e.message),this.emit("error",e),this.close())}_formatError(e,t,n,o){let i;i=/Error\]$/i.test(Object.prototype.toString.call(e))?e:new Error(e),t&&"Error"!==t&&(i.code=t),n&&(i.response=n,i.message+=": "+n);let r="string"==typeof n&&Number((n.match(/^\d+/)||[])[0])||!1;return r&&(i.responseCode=r),o&&(i.command=o),i}_onClose(){return this.logger.info({tnx:"network"},"Connection closed"),this.upgrading&&!this._destroyed?this._onError(new Error("Connection closed unexpectedly"),"ETLS",!1,"CONN"):[this._actionGreeting,this.close].includes(this._responseActions[0])||this._destroyed?void this._destroy():this._onError(new Error("Connection closed unexpectedly"),"ECONNECTION",!1,"CONN")}_onEnd(){this._destroy()}_onTimeout(){return this._onError(new Error("Timeout"),"ETIMEDOUT",!1,"CONN")}_destroy(){this._destroyed||(this._destroyed=!0,this.emit("end"))}_upgradeConnection(e){this._socket.removeListener("data",this._onSocketData),this._socket.removeListener("timeout",this._onSocketTimeout);let t=this._socket,n={socket:this._socket,host:this.host};Object.keys(this.options.tls||{}).forEach(e=>{n[e]=this.options.tls[e]}),this.upgrading=!0,this._socket=s.connect(n,()=>(this.secure=!0,this.upgrading=!1,this._socket.on("data",this._onSocketData),t.removeListener("close",this._onSocketClose),t.removeListener("end",this._onSocketEnd),e(null,!0))),this._socket.on("error",this._onSocketError),this._socket.once("close",this._onSocketClose),this._socket.once("end",this._onSocketEnd),this._socket.setTimeout(this.options.socketTimeout||h),this._socket.on("timeout",this._onSocketTimeout),t.resume()}_processResponse(){if(!this._responseQueue.length)return!1;let e=this.lastServerResponse=(this._responseQueue.shift()||"").toString();if(/^\d+-/.test(e.split("\n").pop()))return;(this.options.debug||this.options.transactionLog)&&this.logger.debug({tnx:"server"},e.replace(/\r?\n$/,"")),e.trim()||setImmediate(()=>this._processResponse(!0));let t=this._responseActions.shift();if("function"!=typeof t)return this._onError(new Error("Unexpected Response"),"EPROTOCOL",e,"CONN");t.call(this,e),setImmediate(()=>this._processResponse(!0))}_sendCommand(e){if(!this._destroyed){if(this._socket.destroyed)return this.close();(this.options.debug||this.options.transactionLog)&&this.logger.debug({tnx:"client"},(e||"").toString().replace(/\r?\n$/,"")),this._socket.write(Buffer.from(e+"\r\n","utf-8"))}}_setEnvelope(e,t){let n=[],o=!1;if(this._envelope=e||{},this._envelope.from=(this._envelope.from&&this._envelope.from.address||this._envelope.from||"").toString().trim(),this._envelope.to=[].concat(this._envelope.to||[]).map(e=>(e&&e.address||e||"").toString().trim()),!this._envelope.to.length)return t(this._formatError("No recipients defined","EENVELOPE",!1,"API"));if(this._envelope.from&&/[\r\n<>]/.test(this._envelope.from))return t(this._formatError("Invalid sender "+JSON.stringify(this._envelope.from),"EENVELOPE",!1,"API"));/[\x80-\uFFFF]/.test(this._envelope.from)&&(o=!0);for(let e=0,n=this._envelope.to.length;e<n;e++){if(!this._envelope.to[e]||/[\r\n<>]/.test(this._envelope.to[e]))return t(this._formatError("Invalid recipient "+JSON.stringify(this._envelope.to[e]),"EENVELOPE",!1,"API"));/[\x80-\uFFFF]/.test(this._envelope.to[e])&&(o=!0)}if(this._envelope.rcptQueue=JSON.parse(JSON.stringify(this._envelope.to||[])),this._envelope.rejected=[],this._envelope.rejectedErrors=[],this._envelope.accepted=[],this._envelope.dsn)try{this._envelope.dsn=this._setDsnEnvelope(this._envelope.dsn)}catch(e){return t(this._formatError("Invalid DSN "+e.message,"EENVELOPE",!1,"API"))}this._responseActions.push(e=>{this._actionMAIL(e,t)}),o&&this._supportedExtensions.includes("SMTPUTF8")&&(n.push("SMTPUTF8"),this._usingSmtpUtf8=!0),this._envelope.use8BitMime&&this._supportedExtensions.includes("8BITMIME")&&(n.push("BODY=8BITMIME"),this._using8BitMime=!0),this._envelope.size&&this._supportedExtensions.includes("SIZE")&&n.push("SIZE="+this._envelope.size),this._envelope.dsn&&this._supportedExtensions.includes("DSN")&&(this._envelope.dsn.ret&&n.push("RET="+u.encodeXText(this._envelope.dsn.ret)),this._envelope.dsn.envid&&n.push("ENVID="+u.encodeXText(this._envelope.dsn.envid))),this._sendCommand("MAIL FROM:<"+this._envelope.from+">"+(n.length?" "+n.join(" "):""))}_setDsnEnvelope(e){let t=(e.ret||e.return||"").toString().toUpperCase()||null;if(t)switch(t){case"HDRS":case"HEADERS":t="HDRS";break;case"FULL":case"BODY":t="FULL"}if(t&&!["FULL","HDRS"].includes(t))throw new Error("ret: "+JSON.stringify(t));let n=(e.envid||e.id||"").toString()||null,o=e.notify||null;if(o){"string"==typeof o&&(o=o.split(",")),o=o.map(e=>e.trim().toUpperCase());let e=["NEVER","SUCCESS","FAILURE","DELAY"];if(o.filter(t=>!e.includes(t)).length||o.length>1&&o.includes("NEVER"))throw new Error("notify: "+JSON.stringify(o.join(",")));o=o.join(",")}let i=(e.orcpt||e.recipient||"").toString()||null;return i&&i.indexOf(";")<0&&(i="rfc822;"+i),{ret:t,envid:n,notify:o,orcpt:i}}_getDsnRcptToArgs(){let e=[];return this._envelope.dsn&&this._supportedExtensions.includes("DSN")&&(this._envelope.dsn.notify&&e.push("NOTIFY="+u.encodeXText(this._envelope.dsn.notify)),this._envelope.dsn.orcpt&&e.push("ORCPT="+u.encodeXText(this._envelope.dsn.orcpt))),e.length?" "+e.join(" "):""}_createSendStream(e){let t,n=new l;return this.options.lmtp?this._envelope.accepted.forEach((t,n)=>{let o=n===this._envelope.accepted.length-1;this._responseActions.push(n=>{this._actionLMTPStream(t,o,n,e)})}):this._responseActions.push(t=>{this._actionSMTPStream(t,e)}),n.pipe(this._socket,{end:!1}),this.options.debug&&((t=new p).on("readable",()=>{let e;for(;e=t.read();)this.logger.debug({tnx:"message"},e.toString("binary").replace(/\r?\n$/,""))}),n.pipe(t)),n.once("end",()=>{this.logger.info({tnx:"message",inByteCount:n.inByteCount,outByteCount:n.outByteCount},"<%s bytes encoded mime message (source size %s bytes)>",n.outByteCount,n.inByteCount)}),n}_actionGreeting(e){clearTimeout(this._greetingTimeout),"220"===e.substr(0,3)?this.options.lmtp?(this._responseActions.push(this._actionLHLO),this._sendCommand("LHLO "+this.name)):(this._responseActions.push(this._actionEHLO),this._sendCommand("EHLO "+this.name)):this._onError(new Error("Invalid greeting. response="+e),"EPROTOCOL",e,"CONN")}_actionLHLO(e){"2"===e.charAt(0)?this._actionEHLO(e):this._onError(new Error("Invalid LHLO. response="+e),"EPROTOCOL",e,"LHLO")}_actionEHLO(e){let t;if("421"!==e.substr(0,3)){if("2"!==e.charAt(0))return this.options.requireTLS?void this._onError(new Error("EHLO failed but HELO does not support required STARTTLS. response="+e),"ECONNECTION",e,"EHLO"):(this._responseActions.push(this._actionHELO),void this._sendCommand("HELO "+this.name));if(!this.secure&&!this.options.ignoreTLS&&(/[ -]STARTTLS\b/im.test(e)||this.options.requireTLS))return this._sendCommand("STARTTLS"),void this._responseActions.push(this._actionSTARTTLS);/[ -]SMTPUTF8\b/im.test(e)&&this._supportedExtensions.push("SMTPUTF8"),/[ -]DSN\b/im.test(e)&&this._supportedExtensions.push("DSN"),/[ -]8BITMIME\b/im.test(e)&&this._supportedExtensions.push("8BITMIME"),/[ -]PIPELINING\b/im.test(e)&&this._supportedExtensions.push("PIPELINING"),/AUTH(?:(\s+|=)[^\n]*\s+|\s+|=)PLAIN/i.test(e)&&this._supportedAuth.push("PLAIN"),/AUTH(?:(\s+|=)[^\n]*\s+|\s+|=)LOGIN/i.test(e)&&this._supportedAuth.push("LOGIN"),/AUTH(?:(\s+|=)[^\n]*\s+|\s+|=)CRAM-MD5/i.test(e)&&this._supportedAuth.push("CRAM-MD5"),/AUTH(?:(\s+|=)[^\n]*\s+|\s+|=)XOAUTH2/i.test(e)&&this._supportedAuth.push("XOAUTH2"),(t=e.match(/[ -]SIZE(?:[ \t]+(\d+))?/im))&&(this._supportedExtensions.push("SIZE"),this._maxAllowedSize=Number(t[1])||0),this.emit("connect")}else this._onError(new Error("Server terminates connection. response="+e),"ECONNECTION",e,"EHLO")}_actionHELO(e){"2"===e.charAt(0)?this.emit("connect"):this._onError(new Error("Invalid HELO. response="+e),"EPROTOCOL",e,"HELO")}_actionSTARTTLS(e){if("2"!==e.charAt(0))return this.options.opportunisticTLS?(this.logger.info({tnx:"smtp"},"Failed STARTTLS upgrade, continuing unencrypted"),this.emit("connect")):void this._onError(new Error("Error upgrading connection with STARTTLS"),"ETLS",e,"STARTTLS");this._upgradeConnection((e,t)=>{e?this._onError(new Error("Error initiating TLS - "+(e.message||e)),"ETLS",!1,"STARTTLS"):(this.logger.info({tnx:"smtp"},"Connection upgraded with STARTTLS"),t?this.options.lmtp?(this._responseActions.push(this._actionLHLO),this._sendCommand("LHLO "+this.name)):(this._responseActions.push(this._actionEHLO),this._sendCommand("EHLO "+this.name)):this.emit("connect"))})}_actionAUTH_LOGIN_USER(e,t){/^334[ -]/.test(e)?(this._responseActions.push(e=>{this._actionAUTH_LOGIN_PASS(e,t)}),this._sendCommand(Buffer.from(this._auth.credentials.user+"","utf-8").toString("base64"))):t(this._formatError('Invalid login sequence while waiting for "334 VXNlcm5hbWU6"',"EAUTH",e,"AUTH LOGIN"))}_actionAUTH_CRAM_MD5(e,t){let n=e.match(/^334\s+(.+)$/),o="";if(!n)return t(this._formatError("Invalid login sequence while waiting for server challenge string","EAUTH",e,"AUTH CRAM-MD5"));o=n[1];let i=Buffer.from(o,"base64").toString("ascii"),r=c.createHmac("md5",this._auth.credentials.pass);r.update(i);let s=r.digest("hex"),a=this._auth.credentials.user+" "+s;this._responseActions.push(e=>{this._actionAUTH_CRAM_MD5_PASS(e,t)}),this._sendCommand(Buffer.from(a).toString("base64"))}_actionAUTH_CRAM_MD5_PASS(e,t){if(!e.match(/^235\s+/))return t(this._formatError('Invalid login sequence while waiting for "235"',"EAUTH",e,"AUTH CRAM-MD5"));this.logger.info({tnx:"smtp",username:this._auth.user,action:"authenticated",method:this._authMethod},"User %s authenticated",JSON.stringify(this._auth.user)),this.authenticated=!0,t(null,!0)}_actionAUTH_LOGIN_PASS(e,t){if(!/^334[ -]/.test(e))return t(this._formatError('Invalid login sequence while waiting for "334 UGFzc3dvcmQ6"',"EAUTH",e,"AUTH LOGIN"));this._responseActions.push(e=>{this._actionAUTHComplete(e,t)}),this._sendCommand(Buffer.from(this._auth.credentials.pass+"","utf-8").toString("base64"))}_actionAUTHComplete(e,t,n){return n||"function"!=typeof t||(n=t,t=!1),"334"===e.substr(0,3)?(this._responseActions.push(e=>{t||"XOAUTH2"!==this._authMethod?this._actionAUTHComplete(e,!0,n):setImmediate(()=>this._handleXOauth2Token(!0,n))}),void this._sendCommand("")):"2"!==e.charAt(0)?(this.logger.info({tnx:"smtp",username:this._auth.user,action:"authfail",method:this._authMethod},"User %s failed to authenticate",JSON.stringify(this._auth.user)),n(this._formatError("Invalid login","EAUTH",e,"AUTH "+this._authMethod))):(this.logger.info({tnx:"smtp",username:this._auth.user,action:"authenticated",method:this._authMethod},"User %s authenticated",JSON.stringify(this._auth.user)),this.authenticated=!0,void n(null,!0))}_actionMAIL(e,t){let n,o;if(2!==Number(e.charAt(0)))return n=this._usingSmtpUtf8&&/^550 /.test(e)&&/[\x80-\uFFFF]/.test(this._envelope.from)?"Internationalized mailbox name not allowed":"Mail command failed",t(this._formatError(n,"EENVELOPE",e,"MAIL FROM"));if(!this._envelope.rcptQueue.length)return t(this._formatError("Can't send mail - no recipients defined","EENVELOPE",!1,"API"));if(this._recipientQueue=[],this._supportedExtensions.includes("PIPELINING"))for(;this._envelope.rcptQueue.length;)o=this._envelope.rcptQueue.shift(),this._recipientQueue.push(o),this._responseActions.push(e=>{this._actionRCPT(e,t)}),this._sendCommand("RCPT TO:<"+o+">"+this._getDsnRcptToArgs());else o=this._envelope.rcptQueue.shift(),this._recipientQueue.push(o),this._responseActions.push(e=>{this._actionRCPT(e,t)}),this._sendCommand("RCPT TO:<"+o+">"+this._getDsnRcptToArgs())}_actionRCPT(e,t){let n,o,i=this._recipientQueue.shift();if(2!==Number(e.charAt(0))?(n=this._usingSmtpUtf8&&/^553 /.test(e)&&/[\x80-\uFFFF]/.test(i)?"Internationalized mailbox name not allowed":"Recipient command failed",this._envelope.rejected.push(i),(o=this._formatError(n,"EENVELOPE",e,"RCPT TO")).recipient=i,this._envelope.rejectedErrors.push(o)):this._envelope.accepted.push(i),this._envelope.rcptQueue.length||this._recipientQueue.length)this._envelope.rcptQueue.length&&(i=this._envelope.rcptQueue.shift(),this._recipientQueue.push(i),this._responseActions.push(e=>{this._actionRCPT(e,t)}),this._sendCommand("RCPT TO:<"+i+">"+this._getDsnRcptToArgs()));else{if(!(this._envelope.rejected.length<this._envelope.to.length))return(o=this._formatError("Can't send mail - all recipients were rejected","EENVELOPE",e,"RCPT TO")).rejected=this._envelope.rejected,o.rejectedErrors=this._envelope.rejectedErrors,t(o);this._responseActions.push(e=>{this._actionDATA(e,t)}),this._sendCommand("DATA")}}_actionDATA(e,t){if(!/^[23]/.test(e))return t(this._formatError("Data command failed","EENVELOPE",e,"DATA"));let n={accepted:this._envelope.accepted,rejected:this._envelope.rejected};this._envelope.rejectedErrors.length&&(n.rejectedErrors=this._envelope.rejectedErrors),t(null,n)}_actionSMTPStream(e,t){return 2!==Number(e.charAt(0))?t(this._formatError("Message failed","EMESSAGE",e,"DATA")):t(null,e)}_actionLMTPStream(e,t,n,o){let i;if(2!==Number(n.charAt(0))){(i=this._formatError("Message failed for recipient "+e,"EMESSAGE",n,"DATA")).recipient=e,this._envelope.rejected.push(e),this._envelope.rejectedErrors.push(i);for(let t=0,n=this._envelope.accepted.length;t<n;t++)this._envelope.accepted[t]===e&&this._envelope.accepted.splice(t,1)}if(t)return o(null,n)}_handleXOauth2Token(e,t){this._auth.oauth2.getToken(e,(n,o)=>{if(n)return this.logger.info({tnx:"smtp",username:this._auth.user,action:"authfail",method:this._authMethod},"User %s failed to authenticate",JSON.stringify(this._auth.user)),t(this._formatError(n,"EAUTH",!1,"AUTH XOAUTH2"));this._responseActions.push(n=>{this._actionAUTHComplete(n,e,t)}),this._sendCommand("AUTH XOAUTH2 "+this._auth.oauth2.buildXOAuth2Token(o))})}_isDestroyedMessage(e){if(this._destroyed)return"Cannot "+e+" - smtp connection is already destroyed.";if(this._socket){if(this._socket.destroyed)return"Cannot "+e+" - smtp connection socket is already destroyed.";if(!this._socket.writable)return"Cannot "+e+" - smtp connection socket is already half-closed."}}_getHostname(){let e=a.hostname()||"";return e.indexOf(".")<0&&(e="[127.0.0.1]"),e.match(/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/)&&(e="["+e+"]"),e}}},function(e,t,n){"use strict";const o=n(14).Transform;e.exports=class extends o{constructor(e){super(e),this.options=e||{},this.lastByte=!1}_transform(e,t,n){let o,i=0;for(let t=0,n=e.length;t<n;t++)10===e[t]&&(t&&13!==e[t-1]||!t&&13!==this.lastByte)&&(t>i&&(o=e.slice(i,t),this.push(o)),this.push(Buffer.from("\r\n")),i=t+1);i&&i<e.length?(o=e.slice(i),this.push(o)):i||this.push(e),this.lastByte=e[e.length-1],n()}}},,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";const o=n(23),i=new Map([["application/acad","dwg"],["application/applixware","aw"],["application/arj","arj"],["application/atom+xml","xml"],["application/atomcat+xml","atomcat"],["application/atomsvc+xml","atomsvc"],["application/base64",["mm","mme"]],["application/binhex","hqx"],["application/binhex4","hqx"],["application/book",["book","boo"]],["application/ccxml+xml,","ccxml"],["application/cdf","cdf"],["application/cdmi-capability","cdmia"],["application/cdmi-container","cdmic"],["application/cdmi-domain","cdmid"],["application/cdmi-object","cdmio"],["application/cdmi-queue","cdmiq"],["application/clariscad","ccad"],["application/commonground","dp"],["application/cu-seeme","cu"],["application/davmount+xml","davmount"],["application/drafting","drw"],["application/dsptype","tsp"],["application/dssc+der","dssc"],["application/dssc+xml","xdssc"],["application/dxf","dxf"],["application/ecmascript",["js","es"]],["application/emma+xml","emma"],["application/envoy","evy"],["application/epub+zip","epub"],["application/excel",["xls","xl","xla","xlb","xlc","xld","xlk","xll","xlm","xlt","xlv","xlw"]],["application/exi","exi"],["application/font-tdpfr","pfr"],["application/fractals","fif"],["application/freeloader","frl"],["application/futuresplash","spl"],["application/gnutar","tgz"],["application/groupwise","vew"],["application/hlp","hlp"],["application/hta","hta"],["application/hyperstudio","stk"],["application/i-deas","unv"],["application/iges",["iges","igs"]],["application/inf","inf"],["application/internet-property-stream","acx"],["application/ipfix","ipfix"],["application/java","class"],["application/java-archive","jar"],["application/java-byte-code","class"],["application/java-serialized-object","ser"],["application/java-vm","class"],["application/javascript","js"],["application/json","json"],["application/lha","lha"],["application/lzx","lzx"],["application/mac-binary","bin"],["application/mac-binhex","hqx"],["application/mac-binhex40","hqx"],["application/mac-compactpro","cpt"],["application/macbinary","bin"],["application/mads+xml","mads"],["application/marc","mrc"],["application/marcxml+xml","mrcx"],["application/mathematica","ma"],["application/mathml+xml","mathml"],["application/mbedlet","mbd"],["application/mbox","mbox"],["application/mcad","mcd"],["application/mediaservercontrol+xml","mscml"],["application/metalink4+xml","meta4"],["application/mets+xml","mets"],["application/mime","aps"],["application/mods+xml","mods"],["application/mp21","m21"],["application/mp4","mp4"],["application/mspowerpoint",["ppt","pot","pps","ppz"]],["application/msword",["doc","dot","w6w","wiz","word"]],["application/mswrite","wri"],["application/mxf","mxf"],["application/netmc","mcp"],["application/octet-stream",["*"]],["application/oda","oda"],["application/oebps-package+xml","opf"],["application/ogg","ogx"],["application/olescript","axs"],["application/onenote","onetoc"],["application/patch-ops-error+xml","xer"],["application/pdf","pdf"],["application/pgp-encrypted","asc"],["application/pgp-signature","pgp"],["application/pics-rules","prf"],["application/pkcs-12","p12"],["application/pkcs-crl","crl"],["application/pkcs10","p10"],["application/pkcs7-mime",["p7c","p7m"]],["application/pkcs7-signature","p7s"],["application/pkcs8","p8"],["application/pkix-attr-cert","ac"],["application/pkix-cert",["cer","crt"]],["application/pkix-crl","crl"],["application/pkix-pkipath","pkipath"],["application/pkixcmp","pki"],["application/plain","text"],["application/pls+xml","pls"],["application/postscript",["ps","ai","eps"]],["application/powerpoint","ppt"],["application/pro_eng",["part","prt"]],["application/prs.cww","cww"],["application/pskc+xml","pskcxml"],["application/rdf+xml","rdf"],["application/reginfo+xml","rif"],["application/relax-ng-compact-syntax","rnc"],["application/resource-lists+xml","rl"],["application/resource-lists-diff+xml","rld"],["application/ringing-tones","rng"],["application/rls-services+xml","rs"],["application/rsd+xml","rsd"],["application/rss+xml","xml"],["application/rtf",["rtf","rtx"]],["application/sbml+xml","sbml"],["application/scvp-cv-request","scq"],["application/scvp-cv-response","scs"],["application/scvp-vp-request","spq"],["application/scvp-vp-response","spp"],["application/sdp","sdp"],["application/sea","sea"],["application/set","set"],["application/set-payment-initiation","setpay"],["application/set-registration-initiation","setreg"],["application/shf+xml","shf"],["application/sla","stl"],["application/smil",["smi","smil"]],["application/smil+xml","smi"],["application/solids","sol"],["application/sounder","sdr"],["application/sparql-query","rq"],["application/sparql-results+xml","srx"],["application/srgs","gram"],["application/srgs+xml","grxml"],["application/sru+xml","sru"],["application/ssml+xml","ssml"],["application/step",["step","stp"]],["application/streamingmedia","ssm"],["application/tei+xml","tei"],["application/thraud+xml","tfi"],["application/timestamped-data","tsd"],["application/toolbook","tbk"],["application/vda","vda"],["application/vnd.3gpp.pic-bw-large","plb"],["application/vnd.3gpp.pic-bw-small","psb"],["application/vnd.3gpp.pic-bw-var","pvb"],["application/vnd.3gpp2.tcap","tcap"],["application/vnd.3m.post-it-notes","pwn"],["application/vnd.accpac.simply.aso","aso"],["application/vnd.accpac.simply.imp","imp"],["application/vnd.acucobol","acu"],["application/vnd.acucorp","atc"],["application/vnd.adobe.air-application-installer-package+zip","air"],["application/vnd.adobe.fxp","fxp"],["application/vnd.adobe.xdp+xml","xdp"],["application/vnd.adobe.xfdf","xfdf"],["application/vnd.ahead.space","ahead"],["application/vnd.airzip.filesecure.azf","azf"],["application/vnd.airzip.filesecure.azs","azs"],["application/vnd.amazon.ebook","azw"],["application/vnd.americandynamics.acc","acc"],["application/vnd.amiga.ami","ami"],["application/vnd.android.package-archive","apk"],["application/vnd.anser-web-certificate-issue-initiation","cii"],["application/vnd.anser-web-funds-transfer-initiation","fti"],["application/vnd.antix.game-component","atx"],["application/vnd.apple.installer+xml","mpkg"],["application/vnd.apple.mpegurl","m3u8"],["application/vnd.aristanetworks.swi","swi"],["application/vnd.audiograph","aep"],["application/vnd.blueice.multipass","mpm"],["application/vnd.bmi","bmi"],["application/vnd.businessobjects","rep"],["application/vnd.chemdraw+xml","cdxml"],["application/vnd.chipnuts.karaoke-mmd","mmd"],["application/vnd.cinderella","cdy"],["application/vnd.claymore","cla"],["application/vnd.cloanto.rp9","rp9"],["application/vnd.clonk.c4group","c4g"],["application/vnd.cluetrust.cartomobile-config","c11amc"],["application/vnd.cluetrust.cartomobile-config-pkg","c11amz"],["application/vnd.commonspace","csp"],["application/vnd.contact.cmsg","cdbcmsg"],["application/vnd.cosmocaller","cmc"],["application/vnd.crick.clicker","clkx"],["application/vnd.crick.clicker.keyboard","clkk"],["application/vnd.crick.clicker.palette","clkp"],["application/vnd.crick.clicker.template","clkt"],["application/vnd.crick.clicker.wordbank","clkw"],["application/vnd.criticaltools.wbs+xml","wbs"],["application/vnd.ctc-posml","pml"],["application/vnd.cups-ppd","ppd"],["application/vnd.curl.car","car"],["application/vnd.curl.pcurl","pcurl"],["application/vnd.data-vision.rdz","rdz"],["application/vnd.denovo.fcselayout-link","fe_launch"],["application/vnd.dna","dna"],["application/vnd.dolby.mlp","mlp"],["application/vnd.dpgraph","dpg"],["application/vnd.dreamfactory","dfac"],["application/vnd.dvb.ait","ait"],["application/vnd.dvb.service","svc"],["application/vnd.dynageo","geo"],["application/vnd.ecowin.chart","mag"],["application/vnd.enliven","nml"],["application/vnd.epson.esf","esf"],["application/vnd.epson.msf","msf"],["application/vnd.epson.quickanime","qam"],["application/vnd.epson.salt","slt"],["application/vnd.epson.ssf","ssf"],["application/vnd.eszigno3+xml","es3"],["application/vnd.ezpix-album","ez2"],["application/vnd.ezpix-package","ez3"],["application/vnd.fdf","fdf"],["application/vnd.fdsn.seed","seed"],["application/vnd.flographit","gph"],["application/vnd.fluxtime.clip","ftc"],["application/vnd.framemaker","fm"],["application/vnd.frogans.fnc","fnc"],["application/vnd.frogans.ltf","ltf"],["application/vnd.fsc.weblaunch","fsc"],["application/vnd.fujitsu.oasys","oas"],["application/vnd.fujitsu.oasys2","oa2"],["application/vnd.fujitsu.oasys3","oa3"],["application/vnd.fujitsu.oasysgp","fg5"],["application/vnd.fujitsu.oasysprs","bh2"],["application/vnd.fujixerox.ddd","ddd"],["application/vnd.fujixerox.docuworks","xdw"],["application/vnd.fujixerox.docuworks.binder","xbd"],["application/vnd.fuzzysheet","fzs"],["application/vnd.genomatix.tuxedo","txd"],["application/vnd.geogebra.file","ggb"],["application/vnd.geogebra.tool","ggt"],["application/vnd.geometry-explorer","gex"],["application/vnd.geonext","gxt"],["application/vnd.geoplan","g2w"],["application/vnd.geospace","g3w"],["application/vnd.gmx","gmx"],["application/vnd.google-earth.kml+xml","kml"],["application/vnd.google-earth.kmz","kmz"],["application/vnd.grafeq","gqf"],["application/vnd.groove-account","gac"],["application/vnd.groove-help","ghf"],["application/vnd.groove-identity-message","gim"],["application/vnd.groove-injector","grv"],["application/vnd.groove-tool-message","gtm"],["application/vnd.groove-tool-template","tpl"],["application/vnd.groove-vcard","vcg"],["application/vnd.hal+xml","hal"],["application/vnd.handheld-entertainment+xml","zmm"],["application/vnd.hbci","hbci"],["application/vnd.hhe.lesson-player","les"],["application/vnd.hp-hpgl",["hgl","hpg","hpgl"]],["application/vnd.hp-hpid","hpid"],["application/vnd.hp-hps","hps"],["application/vnd.hp-jlyt","jlt"],["application/vnd.hp-pcl","pcl"],["application/vnd.hp-pclxl","pclxl"],["application/vnd.hydrostatix.sof-data","sfd-hdstx"],["application/vnd.hzn-3d-crossword","x3d"],["application/vnd.ibm.minipay","mpy"],["application/vnd.ibm.modcap","afp"],["application/vnd.ibm.rights-management","irm"],["application/vnd.ibm.secure-container","sc"],["application/vnd.iccprofile","icc"],["application/vnd.igloader","igl"],["application/vnd.immervision-ivp","ivp"],["application/vnd.immervision-ivu","ivu"],["application/vnd.insors.igm","igm"],["application/vnd.intercon.formnet","xpw"],["application/vnd.intergeo","i2g"],["application/vnd.intu.qbo","qbo"],["application/vnd.intu.qfx","qfx"],["application/vnd.ipunplugged.rcprofile","rcprofile"],["application/vnd.irepository.package+xml","irp"],["application/vnd.is-xpr","xpr"],["application/vnd.isac.fcs","fcs"],["application/vnd.jam","jam"],["application/vnd.jcp.javame.midlet-rms","rms"],["application/vnd.jisp","jisp"],["application/vnd.joost.joda-archive","joda"],["application/vnd.kahootz","ktz"],["application/vnd.kde.karbon","karbon"],["application/vnd.kde.kchart","chrt"],["application/vnd.kde.kformula","kfo"],["application/vnd.kde.kivio","flw"],["application/vnd.kde.kontour","kon"],["application/vnd.kde.kpresenter","kpr"],["application/vnd.kde.kspread","ksp"],["application/vnd.kde.kword","kwd"],["application/vnd.kenameaapp","htke"],["application/vnd.kidspiration","kia"],["application/vnd.kinar","kne"],["application/vnd.koan","skp"],["application/vnd.kodak-descriptor","sse"],["application/vnd.las.las+xml","lasxml"],["application/vnd.llamagraphics.life-balance.desktop","lbd"],["application/vnd.llamagraphics.life-balance.exchange+xml","lbe"],["application/vnd.lotus-1-2-3","123"],["application/vnd.lotus-approach","apr"],["application/vnd.lotus-freelance","pre"],["application/vnd.lotus-notes","nsf"],["application/vnd.lotus-organizer","org"],["application/vnd.lotus-screencam","scm"],["application/vnd.lotus-wordpro","lwp"],["application/vnd.macports.portpkg","portpkg"],["application/vnd.mcd","mcd"],["application/vnd.medcalcdata","mc1"],["application/vnd.mediastation.cdkey","cdkey"],["application/vnd.mfer","mwf"],["application/vnd.mfmp","mfm"],["application/vnd.micrografx.flo","flo"],["application/vnd.micrografx.igx","igx"],["application/vnd.mif","mif"],["application/vnd.mobius.daf","daf"],["application/vnd.mobius.dis","dis"],["application/vnd.mobius.mbk","mbk"],["application/vnd.mobius.mqy","mqy"],["application/vnd.mobius.msl","msl"],["application/vnd.mobius.plc","plc"],["application/vnd.mobius.txf","txf"],["application/vnd.mophun.application","mpn"],["application/vnd.mophun.certificate","mpc"],["application/vnd.mozilla.xul+xml","xul"],["application/vnd.ms-artgalry","cil"],["application/vnd.ms-cab-compressed","cab"],["application/vnd.ms-excel",["xls","xla","xlc","xlm","xlt","xlw","xlb","xll"]],["application/vnd.ms-excel.addin.macroenabled.12","xlam"],["application/vnd.ms-excel.sheet.binary.macroenabled.12","xlsb"],["application/vnd.ms-excel.sheet.macroenabled.12","xlsm"],["application/vnd.ms-excel.template.macroenabled.12","xltm"],["application/vnd.ms-fontobject","eot"],["application/vnd.ms-htmlhelp","chm"],["application/vnd.ms-ims","ims"],["application/vnd.ms-lrm","lrm"],["application/vnd.ms-officetheme","thmx"],["application/vnd.ms-outlook","msg"],["application/vnd.ms-pki.certstore","sst"],["application/vnd.ms-pki.pko","pko"],["application/vnd.ms-pki.seccat","cat"],["application/vnd.ms-pki.stl","stl"],["application/vnd.ms-pkicertstore","sst"],["application/vnd.ms-pkiseccat","cat"],["application/vnd.ms-pkistl","stl"],["application/vnd.ms-powerpoint",["ppt","pot","pps","ppa","pwz"]],["application/vnd.ms-powerpoint.addin.macroenabled.12","ppam"],["application/vnd.ms-powerpoint.presentation.macroenabled.12","pptm"],["application/vnd.ms-powerpoint.slide.macroenabled.12","sldm"],["application/vnd.ms-powerpoint.slideshow.macroenabled.12","ppsm"],["application/vnd.ms-powerpoint.template.macroenabled.12","potm"],["application/vnd.ms-project","mpp"],["application/vnd.ms-word.document.macroenabled.12","docm"],["application/vnd.ms-word.template.macroenabled.12","dotm"],["application/vnd.ms-works",["wks","wcm","wdb","wps"]],["application/vnd.ms-wpl","wpl"],["application/vnd.ms-xpsdocument","xps"],["application/vnd.mseq","mseq"],["application/vnd.musician","mus"],["application/vnd.muvee.style","msty"],["application/vnd.neurolanguage.nlu","nlu"],["application/vnd.noblenet-directory","nnd"],["application/vnd.noblenet-sealer","nns"],["application/vnd.noblenet-web","nnw"],["application/vnd.nokia.configuration-message","ncm"],["application/vnd.nokia.n-gage.data","ngdat"],["application/vnd.nokia.n-gage.symbian.install","n-gage"],["application/vnd.nokia.radio-preset","rpst"],["application/vnd.nokia.radio-presets","rpss"],["application/vnd.nokia.ringing-tone","rng"],["application/vnd.novadigm.edm","edm"],["application/vnd.novadigm.edx","edx"],["application/vnd.novadigm.ext","ext"],["application/vnd.oasis.opendocument.chart","odc"],["application/vnd.oasis.opendocument.chart-template","otc"],["application/vnd.oasis.opendocument.database","odb"],["application/vnd.oasis.opendocument.formula","odf"],["application/vnd.oasis.opendocument.formula-template","odft"],["application/vnd.oasis.opendocument.graphics","odg"],["application/vnd.oasis.opendocument.graphics-template","otg"],["application/vnd.oasis.opendocument.image","odi"],["application/vnd.oasis.opendocument.image-template","oti"],["application/vnd.oasis.opendocument.presentation","odp"],["application/vnd.oasis.opendocument.presentation-template","otp"],["application/vnd.oasis.opendocument.spreadsheet","ods"],["application/vnd.oasis.opendocument.spreadsheet-template","ots"],["application/vnd.oasis.opendocument.text","odt"],["application/vnd.oasis.opendocument.text-master","odm"],["application/vnd.oasis.opendocument.text-template","ott"],["application/vnd.oasis.opendocument.text-web","oth"],["application/vnd.olpc-sugar","xo"],["application/vnd.oma.dd2+xml","dd2"],["application/vnd.openofficeorg.extension","oxt"],["application/vnd.openxmlformats-officedocument.presentationml.presentation","pptx"],["application/vnd.openxmlformats-officedocument.presentationml.slide","sldx"],["application/vnd.openxmlformats-officedocument.presentationml.slideshow","ppsx"],["application/vnd.openxmlformats-officedocument.presentationml.template","potx"],["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","xlsx"],["application/vnd.openxmlformats-officedocument.spreadsheetml.template","xltx"],["application/vnd.openxmlformats-officedocument.wordprocessingml.document","docx"],["application/vnd.openxmlformats-officedocument.wordprocessingml.template","dotx"],["application/vnd.osgeo.mapguide.package","mgp"],["application/vnd.osgi.dp","dp"],["application/vnd.palm","pdb"],["application/vnd.pawaafile","paw"],["application/vnd.pg.format","str"],["application/vnd.pg.osasli","ei6"],["application/vnd.picsel","efif"],["application/vnd.pmi.widget","wg"],["application/vnd.pocketlearn","plf"],["application/vnd.powerbuilder6","pbd"],["application/vnd.previewsystems.box","box"],["application/vnd.proteus.magazine","mgz"],["application/vnd.publishare-delta-tree","qps"],["application/vnd.pvi.ptid1","ptid"],["application/vnd.quark.quarkxpress","qxd"],["application/vnd.realvnc.bed","bed"],["application/vnd.recordare.musicxml","mxl"],["application/vnd.recordare.musicxml+xml","musicxml"],["application/vnd.rig.cryptonote","cryptonote"],["application/vnd.rim.cod","cod"],["application/vnd.rn-realmedia","rm"],["application/vnd.rn-realplayer","rnx"],["application/vnd.route66.link66+xml","link66"],["application/vnd.sailingtracker.track","st"],["application/vnd.seemail","see"],["application/vnd.sema","sema"],["application/vnd.semd","semd"],["application/vnd.semf","semf"],["application/vnd.shana.informed.formdata","ifm"],["application/vnd.shana.informed.formtemplate","itp"],["application/vnd.shana.informed.interchange","iif"],["application/vnd.shana.informed.package","ipk"],["application/vnd.simtech-mindmapper","twd"],["application/vnd.smaf","mmf"],["application/vnd.smart.teacher","teacher"],["application/vnd.solent.sdkm+xml","sdkm"],["application/vnd.spotfire.dxp","dxp"],["application/vnd.spotfire.sfs","sfs"],["application/vnd.stardivision.calc","sdc"],["application/vnd.stardivision.draw","sda"],["application/vnd.stardivision.impress","sdd"],["application/vnd.stardivision.math","smf"],["application/vnd.stardivision.writer","sdw"],["application/vnd.stardivision.writer-global","sgl"],["application/vnd.stepmania.stepchart","sm"],["application/vnd.sun.xml.calc","sxc"],["application/vnd.sun.xml.calc.template","stc"],["application/vnd.sun.xml.draw","sxd"],["application/vnd.sun.xml.draw.template","std"],["application/vnd.sun.xml.impress","sxi"],["application/vnd.sun.xml.impress.template","sti"],["application/vnd.sun.xml.math","sxm"],["application/vnd.sun.xml.writer","sxw"],["application/vnd.sun.xml.writer.global","sxg"],["application/vnd.sun.xml.writer.template","stw"],["application/vnd.sus-calendar","sus"],["application/vnd.svd","svd"],["application/vnd.symbian.install","sis"],["application/vnd.syncml+xml","xsm"],["application/vnd.syncml.dm+wbxml","bdm"],["application/vnd.syncml.dm+xml","xdm"],["application/vnd.tao.intent-module-archive","tao"],["application/vnd.tmobile-livetv","tmo"],["application/vnd.trid.tpt","tpt"],["application/vnd.triscape.mxs","mxs"],["application/vnd.trueapp","tra"],["application/vnd.ufdl","ufd"],["application/vnd.uiq.theme","utz"],["application/vnd.umajin","umj"],["application/vnd.unity","unityweb"],["application/vnd.uoml+xml","uoml"],["application/vnd.vcx","vcx"],["application/vnd.visio","vsd"],["application/vnd.visionary","vis"],["application/vnd.vsf","vsf"],["application/vnd.wap.wbxml","wbxml"],["application/vnd.wap.wmlc","wmlc"],["application/vnd.wap.wmlscriptc","wmlsc"],["application/vnd.webturbo","wtb"],["application/vnd.wolfram.player","nbp"],["application/vnd.wordperfect","wpd"],["application/vnd.wqd","wqd"],["application/vnd.wt.stf","stf"],["application/vnd.xara",["web","xar"]],["application/vnd.xfdl","xfdl"],["application/vnd.yamaha.hv-dic","hvd"],["application/vnd.yamaha.hv-script","hvs"],["application/vnd.yamaha.hv-voice","hvp"],["application/vnd.yamaha.openscoreformat","osf"],["application/vnd.yamaha.openscoreformat.osfpvg+xml","osfpvg"],["application/vnd.yamaha.smaf-audio","saf"],["application/vnd.yamaha.smaf-phrase","spf"],["application/vnd.yellowriver-custom-menu","cmp"],["application/vnd.zul","zir"],["application/vnd.zzazz.deck+xml","zaz"],["application/vocaltec-media-desc","vmd"],["application/vocaltec-media-file","vmf"],["application/voicexml+xml","vxml"],["application/widget","wgt"],["application/winhlp","hlp"],["application/wordperfect",["wp","wp5","wp6","wpd"]],["application/wordperfect6.0",["w60","wp5"]],["application/wordperfect6.1","w61"],["application/wsdl+xml","wsdl"],["application/wspolicy+xml","wspolicy"],["application/x-123","wk1"],["application/x-7z-compressed","7z"],["application/x-abiword","abw"],["application/x-ace-compressed","ace"],["application/x-aim","aim"],["application/x-authorware-bin","aab"],["application/x-authorware-map","aam"],["application/x-authorware-seg","aas"],["application/x-bcpio","bcpio"],["application/x-binary","bin"],["application/x-binhex40","hqx"],["application/x-bittorrent","torrent"],["application/x-bsh",["bsh","sh","shar"]],["application/x-bytecode.elisp","elc"],["applicaiton/x-bytecode.python","pyc"],["application/x-bzip","bz"],["application/x-bzip2",["boz","bz2"]],["application/x-cdf","cdf"],["application/x-cdlink","vcd"],["application/x-chat",["cha","chat"]],["application/x-chess-pgn","pgn"],["application/x-cmu-raster","ras"],["application/x-cocoa","cco"],["application/x-compactpro","cpt"],["application/x-compress","z"],["application/x-compressed",["tgz","gz","z","zip"]],["application/x-conference","nsc"],["application/x-cpio","cpio"],["application/x-cpt","cpt"],["application/x-csh","csh"],["application/x-debian-package","deb"],["application/x-deepv","deepv"],["application/x-director",["dir","dcr","dxr"]],["application/x-doom","wad"],["application/x-dtbncx+xml","ncx"],["application/x-dtbook+xml","dtb"],["application/x-dtbresource+xml","res"],["application/x-dvi","dvi"],["application/x-elc","elc"],["application/x-envoy",["env","evy"]],["application/x-esrehber","es"],["application/x-excel",["xls","xla","xlb","xlc","xld","xlk","xll","xlm","xlt","xlv","xlw"]],["application/x-font-bdf","bdf"],["application/x-font-ghostscript","gsf"],["application/x-font-linux-psf","psf"],["application/x-font-otf","otf"],["application/x-font-pcf","pcf"],["application/x-font-snf","snf"],["application/x-font-ttf","ttf"],["application/x-font-type1","pfa"],["application/x-font-woff","woff"],["application/x-frame","mif"],["application/x-freelance","pre"],["application/x-futuresplash","spl"],["application/x-gnumeric","gnumeric"],["application/x-gsp","gsp"],["application/x-gss","gss"],["application/x-gtar","gtar"],["application/x-gzip",["gz","gzip"]],["application/x-hdf","hdf"],["application/x-helpfile",["help","hlp"]],["application/x-httpd-imap","imap"],["application/x-ima","ima"],["application/x-internet-signup",["ins","isp"]],["application/x-internett-signup","ins"],["application/x-inventor","iv"],["application/x-ip2","ip"],["application/x-iphone","iii"],["application/x-java-class","class"],["application/x-java-commerce","jcm"],["application/x-java-jnlp-file","jnlp"],["application/x-javascript","js"],["application/x-koan",["skd","skm","skp","skt"]],["application/x-ksh","ksh"],["application/x-latex",["latex","ltx"]],["application/x-lha","lha"],["application/x-lisp","lsp"],["application/x-livescreen","ivy"],["application/x-lotus","wq1"],["application/x-lotusscreencam","scm"],["application/x-lzh","lzh"],["application/x-lzx","lzx"],["application/x-mac-binhex40","hqx"],["application/x-macbinary","bin"],["application/x-magic-cap-package-1.0","mc$"],["application/x-mathcad","mcd"],["application/x-meme","mm"],["application/x-midi",["mid","midi"]],["application/x-mif","mif"],["application/x-mix-transfer","nix"],["application/x-mobipocket-ebook","prc"],["application/x-mplayer2","asx"],["application/x-ms-application","application"],["application/x-ms-wmd","wmd"],["application/x-ms-wmz","wmz"],["application/x-ms-xbap","xbap"],["application/x-msaccess","mdb"],["application/x-msbinder","obd"],["application/x-mscardfile","crd"],["application/x-msclip","clp"],["application/x-msdownload",["exe","dll"]],["application/x-msexcel",["xls","xla","xlw"]],["application/x-msmediaview",["mvb","m13","m14"]],["application/x-msmetafile","wmf"],["application/x-msmoney","mny"],["application/x-mspowerpoint","ppt"],["application/x-mspublisher","pub"],["application/x-msschedule","scd"],["application/x-msterminal","trm"],["application/x-mswrite","wri"],["application/x-navi-animation","ani"],["application/x-navidoc","nvd"],["application/x-navimap","map"],["application/x-navistyle","stl"],["application/x-netcdf",["cdf","nc"]],["application/x-newton-compatible-pkg","pkg"],["application/x-nokia-9000-communicator-add-on-software","aos"],["application/x-omc","omc"],["application/x-omcdatamaker","omcd"],["application/x-omcregerator","omcr"],["application/x-pagemaker",["pm4","pm5"]],["application/x-pcl","pcl"],["application/x-perfmon",["pma","pmc","pml","pmr","pmw"]],["application/x-pixclscript","plx"],["application/x-pkcs10","p10"],["application/x-pkcs12",["p12","pfx"]],["application/x-pkcs7-certificates",["p7b","spc"]],["application/x-pkcs7-certreqresp","p7r"],["application/x-pkcs7-mime",["p7m","p7c"]],["application/x-pkcs7-signature",["p7s","p7a"]],["application/x-pointplus","css"],["application/x-portable-anymap","pnm"],["application/x-project",["mpc","mpt","mpv","mpx"]],["application/x-qpro","wb1"],["application/x-rar-compressed","rar"],["application/x-rtf","rtf"],["application/x-sdp","sdp"],["application/x-sea","sea"],["application/x-seelogo","sl"],["application/x-sh","sh"],["application/x-shar",["shar","sh"]],["application/x-shockwave-flash","swf"],["application/x-silverlight-app","xap"],["application/x-sit","sit"],["application/x-sprite",["spr","sprite"]],["application/x-stuffit","sit"],["application/x-stuffitx","sitx"],["application/x-sv4cpio","sv4cpio"],["application/x-sv4crc","sv4crc"],["application/x-tar","tar"],["application/x-tbook",["sbk","tbk"]],["application/x-tcl","tcl"],["application/x-tex","tex"],["application/x-tex-tfm","tfm"],["application/x-texinfo",["texi","texinfo"]],["application/x-troff",["roff","t","tr"]],["application/x-troff-man","man"],["application/x-troff-me","me"],["application/x-troff-ms","ms"],["application/x-troff-msvideo","avi"],["application/x-ustar","ustar"],["application/x-visio",["vsd","vst","vsw"]],["application/x-vnd.audioexplosion.mzz","mzz"],["application/x-vnd.ls-xpix","xpix"],["application/x-vrml","vrml"],["application/x-wais-source",["src","wsrc"]],["application/x-winhelp","hlp"],["application/x-wintalk","wtk"],["application/x-world",["wrl","svr"]],["application/x-wpwin","wpd"],["application/x-wri","wri"],["application/x-x509-ca-cert",["cer","crt","der"]],["application/x-x509-user-cert","crt"],["application/x-xfig","fig"],["application/x-xpinstall","xpi"],["application/x-zip-compressed","zip"],["application/xcap-diff+xml","xdf"],["application/xenc+xml","xenc"],["application/xhtml+xml","xhtml"],["application/xml","xml"],["application/xml-dtd","dtd"],["application/xop+xml","xop"],["application/xslt+xml","xslt"],["application/xspf+xml","xspf"],["application/xv+xml","mxml"],["application/yang","yang"],["application/yin+xml","yin"],["application/ynd.ms-pkipko","pko"],["application/zip","zip"],["audio/adpcm","adp"],["audio/aiff",["aiff","aif","aifc"]],["audio/basic",["snd","au"]],["audio/it","it"],["audio/make",["funk","my","pfunk"]],["audio/make.my.funk","pfunk"],["audio/mid",["mid","rmi"]],["audio/midi",["midi","kar","mid"]],["audio/mod","mod"],["audio/mp4","mp4a"],["audio/mpeg",["mpga","mp3","m2a","mp2","mpa","mpg"]],["audio/mpeg3","mp3"],["audio/nspaudio",["la","lma"]],["audio/ogg","oga"],["audio/s3m","s3m"],["audio/tsp-audio","tsi"],["audio/tsplayer","tsp"],["audio/vnd.dece.audio","uva"],["audio/vnd.digital-winds","eol"],["audio/vnd.dra","dra"],["audio/vnd.dts","dts"],["audio/vnd.dts.hd","dtshd"],["audio/vnd.lucent.voice","lvp"],["audio/vnd.ms-playready.media.pya","pya"],["audio/vnd.nuera.ecelp4800","ecelp4800"],["audio/vnd.nuera.ecelp7470","ecelp7470"],["audio/vnd.nuera.ecelp9600","ecelp9600"],["audio/vnd.qcelp","qcp"],["audio/vnd.rip","rip"],["audio/voc","voc"],["audio/voxware","vox"],["audio/wav","wav"],["audio/webm","weba"],["audio/x-aac","aac"],["audio/x-adpcm","snd"],["audio/x-aiff",["aiff","aif","aifc"]],["audio/x-au","au"],["audio/x-gsm",["gsd","gsm"]],["audio/x-jam","jam"],["audio/x-liveaudio","lam"],["audio/x-mid",["mid","midi"]],["audio/x-midi",["midi","mid"]],["audio/x-mod","mod"],["audio/x-mpeg","mp2"],["audio/x-mpeg-3","mp3"],["audio/x-mpegurl","m3u"],["audio/x-mpequrl","m3u"],["audio/x-ms-wax","wax"],["audio/x-ms-wma","wma"],["audio/x-nspaudio",["la","lma"]],["audio/x-pn-realaudio",["ra","ram","rm","rmm","rmp"]],["audio/x-pn-realaudio-plugin",["ra","rmp","rpm"]],["audio/x-psid","sid"],["audio/x-realaudio","ra"],["audio/x-twinvq","vqf"],["audio/x-twinvq-plugin",["vqe","vql"]],["audio/x-vnd.audioexplosion.mjuicemediafile","mjf"],["audio/x-voc","voc"],["audio/x-wav","wav"],["audio/xm","xm"],["chemical/x-cdx","cdx"],["chemical/x-cif","cif"],["chemical/x-cmdf","cmdf"],["chemical/x-cml","cml"],["chemical/x-csml","csml"],["chemical/x-pdb",["pdb","xyz"]],["chemical/x-xyz","xyz"],["drawing/x-dwf","dwf"],["i-world/i-vrml","ivr"],["image/bmp",["bmp","bm"]],["image/cgm","cgm"],["image/cis-cod","cod"],["image/cmu-raster",["ras","rast"]],["image/fif","fif"],["image/florian",["flo","turbot"]],["image/g3fax","g3"],["image/gif","gif"],["image/ief",["ief","iefs"]],["image/jpeg",["jpeg","jpe","jpg","jfif","jfif-tbnl"]],["image/jutvision","jut"],["image/ktx","ktx"],["image/naplps",["nap","naplps"]],["image/pict",["pic","pict"]],["image/pipeg","jfif"],["image/pjpeg",["jfif","jpe","jpeg","jpg"]],["image/png",["png","x-png"]],["image/prs.btif","btif"],["image/svg+xml","svg"],["image/tiff",["tif","tiff"]],["image/vasa","mcf"],["image/vnd.adobe.photoshop","psd"],["image/vnd.dece.graphic","uvi"],["image/vnd.djvu","djvu"],["image/vnd.dvb.subtitle","sub"],["image/vnd.dwg",["dwg","dxf","svf"]],["image/vnd.dxf","dxf"],["image/vnd.fastbidsheet","fbs"],["image/vnd.fpx","fpx"],["image/vnd.fst","fst"],["image/vnd.fujixerox.edmics-mmr","mmr"],["image/vnd.fujixerox.edmics-rlc","rlc"],["image/vnd.ms-modi","mdi"],["image/vnd.net-fpx",["fpx","npx"]],["image/vnd.rn-realflash","rf"],["image/vnd.rn-realpix","rp"],["image/vnd.wap.wbmp","wbmp"],["image/vnd.xiff","xif"],["image/webp","webp"],["image/x-cmu-raster","ras"],["image/x-cmx","cmx"],["image/x-dwg",["dwg","dxf","svf"]],["image/x-freehand","fh"],["image/x-icon","ico"],["image/x-jg","art"],["image/x-jps","jps"],["image/x-niff",["niff","nif"]],["image/x-pcx","pcx"],["image/x-pict",["pct","pic"]],["image/x-portable-anymap","pnm"],["image/x-portable-bitmap","pbm"],["image/x-portable-graymap","pgm"],["image/x-portable-greymap","pgm"],["image/x-portable-pixmap","ppm"],["image/x-quicktime",["qif","qti","qtif"]],["image/x-rgb","rgb"],["image/x-tiff",["tif","tiff"]],["image/x-windows-bmp","bmp"],["image/x-xbitmap","xbm"],["image/x-xbm","xbm"],["image/x-xpixmap",["xpm","pm"]],["image/x-xwd","xwd"],["image/x-xwindowdump","xwd"],["image/xbm","xbm"],["image/xpm","xpm"],["message/rfc822",["eml","mht","mhtml","nws","mime"]],["model/iges",["iges","igs"]],["model/mesh","msh"],["model/vnd.collada+xml","dae"],["model/vnd.dwf","dwf"],["model/vnd.gdl","gdl"],["model/vnd.gtw","gtw"],["model/vnd.mts","mts"],["model/vnd.vtu","vtu"],["model/vrml",["vrml","wrl","wrz"]],["model/x-pov","pov"],["multipart/x-gzip","gzip"],["multipart/x-ustar","ustar"],["multipart/x-zip","zip"],["music/crescendo",["mid","midi"]],["music/x-karaoke","kar"],["paleovu/x-pv","pvu"],["text/asp","asp"],["text/calendar","ics"],["text/css","css"],["text/csv","csv"],["text/ecmascript","js"],["text/h323","323"],["text/html",["html","htm","stm","acgi","htmls","htx","shtml"]],["text/iuls","uls"],["text/javascript","js"],["text/mcf","mcf"],["text/n3","n3"],["text/pascal","pas"],["text/plain",["txt","bas","c","h","c++","cc","com","conf","cxx","def","f","f90","for","g","hh","idc","jav","java","list","log","lst","m","mar","pl","sdml","text"]],["text/plain-bas","par"],["text/prs.lines.tag","dsc"],["text/richtext",["rtx","rt","rtf"]],["text/scriplet","wsc"],["text/scriptlet","sct"],["text/sgml",["sgm","sgml"]],["text/tab-separated-values","tsv"],["text/troff","t"],["text/turtle","ttl"],["text/uri-list",["uni","unis","uri","uris"]],["text/vnd.abc","abc"],["text/vnd.curl","curl"],["text/vnd.curl.dcurl","dcurl"],["text/vnd.curl.mcurl","mcurl"],["text/vnd.curl.scurl","scurl"],["text/vnd.fly","fly"],["text/vnd.fmi.flexstor","flx"],["text/vnd.graphviz","gv"],["text/vnd.in3d.3dml","3dml"],["text/vnd.in3d.spot","spot"],["text/vnd.rn-realtext","rt"],["text/vnd.sun.j2me.app-descriptor","jad"],["text/vnd.wap.wml","wml"],["text/vnd.wap.wmlscript","wmls"],["text/webviewhtml","htt"],["text/x-asm",["asm","s"]],["text/x-audiosoft-intra","aip"],["text/x-c",["c","cc","cpp"]],["text/x-component","htc"],["text/x-fortran",["for","f","f77","f90"]],["text/x-h",["h","hh"]],["text/x-java-source",["java","jav"]],["text/x-java-source,java","java"],["text/x-la-asf","lsx"],["text/x-m","m"],["text/x-pascal","p"],["text/x-script","hlb"],["text/x-script.csh","csh"],["text/x-script.elisp","el"],["text/x-script.guile","scm"],["text/x-script.ksh","ksh"],["text/x-script.lisp","lsp"],["text/x-script.perl","pl"],["text/x-script.perl-module","pm"],["text/x-script.phyton","py"],["text/x-script.rexx","rexx"],["text/x-script.scheme","scm"],["text/x-script.sh","sh"],["text/x-script.tcl","tcl"],["text/x-script.tcsh","tcsh"],["text/x-script.zsh","zsh"],["text/x-server-parsed-html",["shtml","ssi"]],["text/x-setext","etx"],["text/x-sgml",["sgm","sgml"]],["text/x-speech",["spc","talk"]],["text/x-uil","uil"],["text/x-uuencode",["uu","uue"]],["text/x-vcalendar","vcs"],["text/x-vcard","vcf"],["text/xml","xml"],["video/3gpp","3gp"],["video/3gpp2","3g2"],["video/animaflex","afl"],["video/avi","avi"],["video/avs-video","avs"],["video/dl","dl"],["video/fli","fli"],["video/gl","gl"],["video/h261","h261"],["video/h263","h263"],["video/h264","h264"],["video/jpeg","jpgv"],["video/jpm","jpm"],["video/mj2","mj2"],["video/mp4","mp4"],["video/mpeg",["mpeg","mp2","mpa","mpe","mpg","mpv2","m1v","m2v","mp3"]],["video/msvideo","avi"],["video/ogg","ogv"],["video/quicktime",["mov","qt","moov"]],["video/vdo","vdo"],["video/vivo",["viv","vivo"]],["video/vnd.dece.hd","uvh"],["video/vnd.dece.mobile","uvm"],["video/vnd.dece.pd","uvp"],["video/vnd.dece.sd","uvs"],["video/vnd.dece.video","uvv"],["video/vnd.fvt","fvt"],["video/vnd.mpegurl","mxu"],["video/vnd.ms-playready.media.pyv","pyv"],["video/vnd.rn-realvideo","rv"],["video/vnd.uvvu.mp4","uvu"],["video/vnd.vivo",["viv","vivo"]],["video/vosaic","vos"],["video/webm","webm"],["video/x-amt-demorun","xdr"],["video/x-amt-showrun","xsr"],["video/x-atomic3d-feature","fmf"],["video/x-dl","dl"],["video/x-dv",["dif","dv"]],["video/x-f4v","f4v"],["video/x-fli","fli"],["video/x-flv","flv"],["video/x-gl","gl"],["video/x-isvideo","isu"],["video/x-la-asf",["lsf","lsx"]],["video/x-m4v","m4v"],["video/x-motion-jpeg","mjpg"],["video/x-mpeg",["mp3","mp2"]],["video/x-mpeq2a","mp2"],["video/x-ms-asf",["asf","asr","asx"]],["video/x-ms-asf-plugin","asx"],["video/x-ms-wm","wm"],["video/x-ms-wmv","wmv"],["video/x-ms-wmx","wmx"],["video/x-ms-wvx","wvx"],["video/x-msvideo","avi"],["video/x-qtc","qtc"],["video/x-scm","scm"],["video/x-sgi-movie",["movie","mv"]],["windows/metafile","wmf"],["www/mime","mime"],["x-conference/x-cooltalk","ice"],["x-music/x-midi",["mid","midi"]],["x-world/x-3dmf",["3dm","3dmf","qd3","qd3d"]],["x-world/x-svr","svr"],["x-world/x-vrml",["flr","vrml","wrl","wrz","xaf","xof"]],["x-world/x-vrt","vrt"],["xgl/drawing","xgz"],["xgl/movie","xmz"]]),r=new Map([["123","application/vnd.lotus-1-2-3"],["323","text/h323"],["*","application/octet-stream"],["3dm","x-world/x-3dmf"],["3dmf","x-world/x-3dmf"],["3dml","text/vnd.in3d.3dml"],["3g2","video/3gpp2"],["3gp","video/3gpp"],["7z","application/x-7z-compressed"],["a","application/octet-stream"],["aab","application/x-authorware-bin"],["aac","audio/x-aac"],["aam","application/x-authorware-map"],["aas","application/x-authorware-seg"],["abc","text/vnd.abc"],["abw","application/x-abiword"],["ac","application/pkix-attr-cert"],["acc","application/vnd.americandynamics.acc"],["ace","application/x-ace-compressed"],["acgi","text/html"],["acu","application/vnd.acucobol"],["acx","application/internet-property-stream"],["adp","audio/adpcm"],["aep","application/vnd.audiograph"],["afl","video/animaflex"],["afp","application/vnd.ibm.modcap"],["ahead","application/vnd.ahead.space"],["ai","application/postscript"],["aif",["audio/aiff","audio/x-aiff"]],["aifc",["audio/aiff","audio/x-aiff"]],["aiff",["audio/aiff","audio/x-aiff"]],["aim","application/x-aim"],["aip","text/x-audiosoft-intra"],["air","application/vnd.adobe.air-application-installer-package+zip"],["ait","application/vnd.dvb.ait"],["ami","application/vnd.amiga.ami"],["ani","application/x-navi-animation"],["aos","application/x-nokia-9000-communicator-add-on-software"],["apk","application/vnd.android.package-archive"],["application","application/x-ms-application"],["apr","application/vnd.lotus-approach"],["aps","application/mime"],["arc","application/octet-stream"],["arj",["application/arj","application/octet-stream"]],["art","image/x-jg"],["asf","video/x-ms-asf"],["asm","text/x-asm"],["aso","application/vnd.accpac.simply.aso"],["asp","text/asp"],["asr","video/x-ms-asf"],["asx",["video/x-ms-asf","application/x-mplayer2","video/x-ms-asf-plugin"]],["atc","application/vnd.acucorp"],["atomcat","application/atomcat+xml"],["atomsvc","application/atomsvc+xml"],["atx","application/vnd.antix.game-component"],["au",["audio/basic","audio/x-au"]],["avi",["video/avi","video/msvideo","application/x-troff-msvideo","video/x-msvideo"]],["avs","video/avs-video"],["aw","application/applixware"],["axs","application/olescript"],["azf","application/vnd.airzip.filesecure.azf"],["azs","application/vnd.airzip.filesecure.azs"],["azw","application/vnd.amazon.ebook"],["bas","text/plain"],["bcpio","application/x-bcpio"],["bdf","application/x-font-bdf"],["bdm","application/vnd.syncml.dm+wbxml"],["bed","application/vnd.realvnc.bed"],["bh2","application/vnd.fujitsu.oasysprs"],["bin",["application/octet-stream","application/mac-binary","application/macbinary","application/x-macbinary","application/x-binary"]],["bm","image/bmp"],["bmi","application/vnd.bmi"],["bmp",["image/bmp","image/x-windows-bmp"]],["boo","application/book"],["book","application/book"],["box","application/vnd.previewsystems.box"],["boz","application/x-bzip2"],["bsh","application/x-bsh"],["btif","image/prs.btif"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["c",["text/plain","text/x-c"]],["c++","text/plain"],["c11amc","application/vnd.cluetrust.cartomobile-config"],["c11amz","application/vnd.cluetrust.cartomobile-config-pkg"],["c4g","application/vnd.clonk.c4group"],["cab","application/vnd.ms-cab-compressed"],["car","application/vnd.curl.car"],["cat",["application/vnd.ms-pkiseccat","application/vnd.ms-pki.seccat"]],["cc",["text/plain","text/x-c"]],["ccad","application/clariscad"],["cco","application/x-cocoa"],["ccxml","application/ccxml+xml,"],["cdbcmsg","application/vnd.contact.cmsg"],["cdf",["application/cdf","application/x-cdf","application/x-netcdf"]],["cdkey","application/vnd.mediastation.cdkey"],["cdmia","application/cdmi-capability"],["cdmic","application/cdmi-container"],["cdmid","application/cdmi-domain"],["cdmio","application/cdmi-object"],["cdmiq","application/cdmi-queue"],["cdx","chemical/x-cdx"],["cdxml","application/vnd.chemdraw+xml"],["cdy","application/vnd.cinderella"],["cer",["application/pkix-cert","application/x-x509-ca-cert"]],["cgm","image/cgm"],["cha","application/x-chat"],["chat","application/x-chat"],["chm","application/vnd.ms-htmlhelp"],["chrt","application/vnd.kde.kchart"],["cif","chemical/x-cif"],["cii","application/vnd.anser-web-certificate-issue-initiation"],["cil","application/vnd.ms-artgalry"],["cla","application/vnd.claymore"],["class",["application/octet-stream","application/java","application/java-byte-code","application/java-vm","application/x-java-class"]],["clkk","application/vnd.crick.clicker.keyboard"],["clkp","application/vnd.crick.clicker.palette"],["clkt","application/vnd.crick.clicker.template"],["clkw","application/vnd.crick.clicker.wordbank"],["clkx","application/vnd.crick.clicker"],["clp","application/x-msclip"],["cmc","application/vnd.cosmocaller"],["cmdf","chemical/x-cmdf"],["cml","chemical/x-cml"],["cmp","application/vnd.yellowriver-custom-menu"],["cmx","image/x-cmx"],["cod",["image/cis-cod","application/vnd.rim.cod"]],["com",["application/octet-stream","text/plain"]],["conf","text/plain"],["cpio","application/x-cpio"],["cpp","text/x-c"],["cpt",["application/mac-compactpro","application/x-compactpro","application/x-cpt"]],["crd","application/x-mscardfile"],["crl",["application/pkix-crl","application/pkcs-crl"]],["crt",["application/pkix-cert","application/x-x509-user-cert","application/x-x509-ca-cert"]],["cryptonote","application/vnd.rig.cryptonote"],["csh",["text/x-script.csh","application/x-csh"]],["csml","chemical/x-csml"],["csp","application/vnd.commonspace"],["css",["text/css","application/x-pointplus"]],["csv","text/csv"],["cu","application/cu-seeme"],["curl","text/vnd.curl"],["cww","application/prs.cww"],["cxx","text/plain"],["dae","model/vnd.collada+xml"],["daf","application/vnd.mobius.daf"],["davmount","application/davmount+xml"],["dcr","application/x-director"],["dcurl","text/vnd.curl.dcurl"],["dd2","application/vnd.oma.dd2+xml"],["ddd","application/vnd.fujixerox.ddd"],["deb","application/x-debian-package"],["deepv","application/x-deepv"],["def","text/plain"],["der","application/x-x509-ca-cert"],["dfac","application/vnd.dreamfactory"],["dif","video/x-dv"],["dir","application/x-director"],["dis","application/vnd.mobius.dis"],["djvu","image/vnd.djvu"],["dl",["video/dl","video/x-dl"]],["dll","application/x-msdownload"],["dms","application/octet-stream"],["dna","application/vnd.dna"],["doc","application/msword"],["docm","application/vnd.ms-word.document.macroenabled.12"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["dot","application/msword"],["dotm","application/vnd.ms-word.template.macroenabled.12"],["dotx","application/vnd.openxmlformats-officedocument.wordprocessingml.template"],["dp",["application/commonground","application/vnd.osgi.dp"]],["dpg","application/vnd.dpgraph"],["dra","audio/vnd.dra"],["drw","application/drafting"],["dsc","text/prs.lines.tag"],["dssc","application/dssc+der"],["dtb","application/x-dtbook+xml"],["dtd","application/xml-dtd"],["dts","audio/vnd.dts"],["dtshd","audio/vnd.dts.hd"],["dump","application/octet-stream"],["dv","video/x-dv"],["dvi","application/x-dvi"],["dwf",["model/vnd.dwf","drawing/x-dwf"]],["dwg",["application/acad","image/vnd.dwg","image/x-dwg"]],["dxf",["application/dxf","image/vnd.dwg","image/vnd.dxf","image/x-dwg"]],["dxp","application/vnd.spotfire.dxp"],["dxr","application/x-director"],["ecelp4800","audio/vnd.nuera.ecelp4800"],["ecelp7470","audio/vnd.nuera.ecelp7470"],["ecelp9600","audio/vnd.nuera.ecelp9600"],["edm","application/vnd.novadigm.edm"],["edx","application/vnd.novadigm.edx"],["efif","application/vnd.picsel"],["ei6","application/vnd.pg.osasli"],["el","text/x-script.elisp"],["elc",["application/x-elc","application/x-bytecode.elisp"]],["eml","message/rfc822"],["emma","application/emma+xml"],["env","application/x-envoy"],["eol","audio/vnd.digital-winds"],["eot","application/vnd.ms-fontobject"],["eps","application/postscript"],["epub","application/epub+zip"],["es",["application/ecmascript","application/x-esrehber"]],["es3","application/vnd.eszigno3+xml"],["esf","application/vnd.epson.esf"],["etx","text/x-setext"],["evy",["application/envoy","application/x-envoy"]],["exe",["application/octet-stream","application/x-msdownload"]],["exi","application/exi"],["ext","application/vnd.novadigm.ext"],["ez2","application/vnd.ezpix-album"],["ez3","application/vnd.ezpix-package"],["f",["text/plain","text/x-fortran"]],["f4v","video/x-f4v"],["f77","text/x-fortran"],["f90",["text/plain","text/x-fortran"]],["fbs","image/vnd.fastbidsheet"],["fcs","application/vnd.isac.fcs"],["fdf","application/vnd.fdf"],["fe_launch","application/vnd.denovo.fcselayout-link"],["fg5","application/vnd.fujitsu.oasysgp"],["fh","image/x-freehand"],["fif",["application/fractals","image/fif"]],["fig","application/x-xfig"],["fli",["video/fli","video/x-fli"]],["flo",["image/florian","application/vnd.micrografx.flo"]],["flr","x-world/x-vrml"],["flv","video/x-flv"],["flw","application/vnd.kde.kivio"],["flx","text/vnd.fmi.flexstor"],["fly","text/vnd.fly"],["fm","application/vnd.framemaker"],["fmf","video/x-atomic3d-feature"],["fnc","application/vnd.frogans.fnc"],["for",["text/plain","text/x-fortran"]],["fpx",["image/vnd.fpx","image/vnd.net-fpx"]],["frl","application/freeloader"],["fsc","application/vnd.fsc.weblaunch"],["fst","image/vnd.fst"],["ftc","application/vnd.fluxtime.clip"],["fti","application/vnd.anser-web-funds-transfer-initiation"],["funk","audio/make"],["fvt","video/vnd.fvt"],["fxp","application/vnd.adobe.fxp"],["fzs","application/vnd.fuzzysheet"],["g","text/plain"],["g2w","application/vnd.geoplan"],["g3","image/g3fax"],["g3w","application/vnd.geospace"],["gac","application/vnd.groove-account"],["gdl","model/vnd.gdl"],["geo","application/vnd.dynageo"],["gex","application/vnd.geometry-explorer"],["ggb","application/vnd.geogebra.file"],["ggt","application/vnd.geogebra.tool"],["ghf","application/vnd.groove-help"],["gif","image/gif"],["gim","application/vnd.groove-identity-message"],["gl",["video/gl","video/x-gl"]],["gmx","application/vnd.gmx"],["gnumeric","application/x-gnumeric"],["gph","application/vnd.flographit"],["gqf","application/vnd.grafeq"],["gram","application/srgs"],["grv","application/vnd.groove-injector"],["grxml","application/srgs+xml"],["gsd","audio/x-gsm"],["gsf","application/x-font-ghostscript"],["gsm","audio/x-gsm"],["gsp","application/x-gsp"],["gss","application/x-gss"],["gtar","application/x-gtar"],["gtm","application/vnd.groove-tool-message"],["gtw","model/vnd.gtw"],["gv","text/vnd.graphviz"],["gxt","application/vnd.geonext"],["gz",["application/x-gzip","application/x-compressed"]],["gzip",["multipart/x-gzip","application/x-gzip"]],["h",["text/plain","text/x-h"]],["h261","video/h261"],["h263","video/h263"],["h264","video/h264"],["hal","application/vnd.hal+xml"],["hbci","application/vnd.hbci"],["hdf","application/x-hdf"],["help","application/x-helpfile"],["hgl","application/vnd.hp-hpgl"],["hh",["text/plain","text/x-h"]],["hlb","text/x-script"],["hlp",["application/winhlp","application/hlp","application/x-helpfile","application/x-winhelp"]],["hpg","application/vnd.hp-hpgl"],["hpgl","application/vnd.hp-hpgl"],["hpid","application/vnd.hp-hpid"],["hps","application/vnd.hp-hps"],["hqx",["application/mac-binhex40","application/binhex","application/binhex4","application/mac-binhex","application/x-binhex40","application/x-mac-binhex40"]],["hta","application/hta"],["htc","text/x-component"],["htke","application/vnd.kenameaapp"],["htm","text/html"],["html","text/html"],["htmls","text/html"],["htt","text/webviewhtml"],["htx","text/html"],["hvd","application/vnd.yamaha.hv-dic"],["hvp","application/vnd.yamaha.hv-voice"],["hvs","application/vnd.yamaha.hv-script"],["i2g","application/vnd.intergeo"],["icc","application/vnd.iccprofile"],["ice","x-conference/x-cooltalk"],["ico","image/x-icon"],["ics","text/calendar"],["idc","text/plain"],["ief","image/ief"],["iefs","image/ief"],["ifm","application/vnd.shana.informed.formdata"],["iges",["application/iges","model/iges"]],["igl","application/vnd.igloader"],["igm","application/vnd.insors.igm"],["igs",["application/iges","model/iges"]],["igx","application/vnd.micrografx.igx"],["iif","application/vnd.shana.informed.interchange"],["iii","application/x-iphone"],["ima","application/x-ima"],["imap","application/x-httpd-imap"],["imp","application/vnd.accpac.simply.imp"],["ims","application/vnd.ms-ims"],["inf","application/inf"],["ins",["application/x-internet-signup","application/x-internett-signup"]],["ip","application/x-ip2"],["ipfix","application/ipfix"],["ipk","application/vnd.shana.informed.package"],["irm","application/vnd.ibm.rights-management"],["irp","application/vnd.irepository.package+xml"],["isp","application/x-internet-signup"],["isu","video/x-isvideo"],["it","audio/it"],["itp","application/vnd.shana.informed.formtemplate"],["iv","application/x-inventor"],["ivp","application/vnd.immervision-ivp"],["ivr","i-world/i-vrml"],["ivu","application/vnd.immervision-ivu"],["ivy","application/x-livescreen"],["jad","text/vnd.sun.j2me.app-descriptor"],["jam",["application/vnd.jam","audio/x-jam"]],["jar","application/java-archive"],["jav",["text/plain","text/x-java-source"]],["java",["text/plain","text/x-java-source,java","text/x-java-source"]],["jcm","application/x-java-commerce"],["jfif",["image/pipeg","image/jpeg","image/pjpeg"]],["jfif-tbnl","image/jpeg"],["jisp","application/vnd.jisp"],["jlt","application/vnd.hp-jlyt"],["jnlp","application/x-java-jnlp-file"],["joda","application/vnd.joost.joda-archive"],["jpe",["image/jpeg","image/pjpeg"]],["jpeg",["image/jpeg","image/pjpeg"]],["jpg",["image/jpeg","image/pjpeg"]],["jpgv","video/jpeg"],["jpm","video/jpm"],["jps","image/x-jps"],["js",["application/javascript","application/ecmascript","text/javascript","text/ecmascript","application/x-javascript"]],["json","application/json"],["jut","image/jutvision"],["kar",["audio/midi","music/x-karaoke"]],["karbon","application/vnd.kde.karbon"],["kfo","application/vnd.kde.kformula"],["kia","application/vnd.kidspiration"],["kml","application/vnd.google-earth.kml+xml"],["kmz","application/vnd.google-earth.kmz"],["kne","application/vnd.kinar"],["kon","application/vnd.kde.kontour"],["kpr","application/vnd.kde.kpresenter"],["ksh",["application/x-ksh","text/x-script.ksh"]],["ksp","application/vnd.kde.kspread"],["ktx","image/ktx"],["ktz","application/vnd.kahootz"],["kwd","application/vnd.kde.kword"],["la",["audio/nspaudio","audio/x-nspaudio"]],["lam","audio/x-liveaudio"],["lasxml","application/vnd.las.las+xml"],["latex","application/x-latex"],["lbd","application/vnd.llamagraphics.life-balance.desktop"],["lbe","application/vnd.llamagraphics.life-balance.exchange+xml"],["les","application/vnd.hhe.lesson-player"],["lha",["application/octet-stream","application/lha","application/x-lha"]],["lhx","application/octet-stream"],["link66","application/vnd.route66.link66+xml"],["list","text/plain"],["lma",["audio/nspaudio","audio/x-nspaudio"]],["log","text/plain"],["lrm","application/vnd.ms-lrm"],["lsf","video/x-la-asf"],["lsp",["application/x-lisp","text/x-script.lisp"]],["lst","text/plain"],["lsx",["video/x-la-asf","text/x-la-asf"]],["ltf","application/vnd.frogans.ltf"],["ltx","application/x-latex"],["lvp","audio/vnd.lucent.voice"],["lwp","application/vnd.lotus-wordpro"],["lzh",["application/octet-stream","application/x-lzh"]],["lzx",["application/lzx","application/octet-stream","application/x-lzx"]],["m",["text/plain","text/x-m"]],["m13","application/x-msmediaview"],["m14","application/x-msmediaview"],["m1v","video/mpeg"],["m21","application/mp21"],["m2a","audio/mpeg"],["m2v","video/mpeg"],["m3u",["audio/x-mpegurl","audio/x-mpequrl"]],["m3u8","application/vnd.apple.mpegurl"],["m4v","video/x-m4v"],["ma","application/mathematica"],["mads","application/mads+xml"],["mag","application/vnd.ecowin.chart"],["man","application/x-troff-man"],["map","application/x-navimap"],["mar","text/plain"],["mathml","application/mathml+xml"],["mbd","application/mbedlet"],["mbk","application/vnd.mobius.mbk"],["mbox","application/mbox"],["mc$","application/x-magic-cap-package-1.0"],["mc1","application/vnd.medcalcdata"],["mcd",["application/mcad","application/vnd.mcd","application/x-mathcad"]],["mcf",["image/vasa","text/mcf"]],["mcp","application/netmc"],["mcurl","text/vnd.curl.mcurl"],["mdb","application/x-msaccess"],["mdi","image/vnd.ms-modi"],["me","application/x-troff-me"],["meta4","application/metalink4+xml"],["mets","application/mets+xml"],["mfm","application/vnd.mfmp"],["mgp","application/vnd.osgeo.mapguide.package"],["mgz","application/vnd.proteus.magazine"],["mht","message/rfc822"],["mhtml","message/rfc822"],["mid",["audio/mid","audio/midi","music/crescendo","x-music/x-midi","audio/x-midi","application/x-midi","audio/x-mid"]],["midi",["audio/midi","music/crescendo","x-music/x-midi","audio/x-midi","application/x-midi","audio/x-mid"]],["mif",["application/vnd.mif","application/x-mif","application/x-frame"]],["mime",["message/rfc822","www/mime"]],["mj2","video/mj2"],["mjf","audio/x-vnd.audioexplosion.mjuicemediafile"],["mjpg","video/x-motion-jpeg"],["mlp","application/vnd.dolby.mlp"],["mm",["application/base64","application/x-meme"]],["mmd","application/vnd.chipnuts.karaoke-mmd"],["mme","application/base64"],["mmf","application/vnd.smaf"],["mmr","image/vnd.fujixerox.edmics-mmr"],["mny","application/x-msmoney"],["mod",["audio/mod","audio/x-mod"]],["mods","application/mods+xml"],["moov","video/quicktime"],["mov","video/quicktime"],["movie","video/x-sgi-movie"],["mp2",["video/mpeg","audio/mpeg","video/x-mpeg","audio/x-mpeg","video/x-mpeq2a"]],["mp3",["audio/mpeg","audio/mpeg3","video/mpeg","audio/x-mpeg-3","video/x-mpeg"]],["mp4",["video/mp4","application/mp4"]],["mp4a","audio/mp4"],["mpa",["video/mpeg","audio/mpeg"]],["mpc",["application/vnd.mophun.certificate","application/x-project"]],["mpe","video/mpeg"],["mpeg","video/mpeg"],["mpg",["video/mpeg","audio/mpeg"]],["mpga","audio/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["mpm","application/vnd.blueice.multipass"],["mpn","application/vnd.mophun.application"],["mpp","application/vnd.ms-project"],["mpt","application/x-project"],["mpv","application/x-project"],["mpv2","video/mpeg"],["mpx","application/x-project"],["mpy","application/vnd.ibm.minipay"],["mqy","application/vnd.mobius.mqy"],["mrc","application/marc"],["mrcx","application/marcxml+xml"],["ms","application/x-troff-ms"],["mscml","application/mediaservercontrol+xml"],["mseq","application/vnd.mseq"],["msf","application/vnd.epson.msf"],["msg","application/vnd.ms-outlook"],["msh","model/mesh"],["msl","application/vnd.mobius.msl"],["msty","application/vnd.muvee.style"],["mts","model/vnd.mts"],["mus","application/vnd.musician"],["musicxml","application/vnd.recordare.musicxml+xml"],["mv","video/x-sgi-movie"],["mvb","application/x-msmediaview"],["mwf","application/vnd.mfer"],["mxf","application/mxf"],["mxl","application/vnd.recordare.musicxml"],["mxml","application/xv+xml"],["mxs","application/vnd.triscape.mxs"],["mxu","video/vnd.mpegurl"],["my","audio/make"],["mzz","application/x-vnd.audioexplosion.mzz"],["n-gage","application/vnd.nokia.n-gage.symbian.install"],["n3","text/n3"],["nap","image/naplps"],["naplps","image/naplps"],["nbp","application/vnd.wolfram.player"],["nc","application/x-netcdf"],["ncm","application/vnd.nokia.configuration-message"],["ncx","application/x-dtbncx+xml"],["ngdat","application/vnd.nokia.n-gage.data"],["nif","image/x-niff"],["niff","image/x-niff"],["nix","application/x-mix-transfer"],["nlu","application/vnd.neurolanguage.nlu"],["nml","application/vnd.enliven"],["nnd","application/vnd.noblenet-directory"],["nns","application/vnd.noblenet-sealer"],["nnw","application/vnd.noblenet-web"],["npx","image/vnd.net-fpx"],["nsc","application/x-conference"],["nsf","application/vnd.lotus-notes"],["nvd","application/x-navidoc"],["nws","message/rfc822"],["o","application/octet-stream"],["oa2","application/vnd.fujitsu.oasys2"],["oa3","application/vnd.fujitsu.oasys3"],["oas","application/vnd.fujitsu.oasys"],["obd","application/x-msbinder"],["oda","application/oda"],["odb","application/vnd.oasis.opendocument.database"],["odc","application/vnd.oasis.opendocument.chart"],["odf","application/vnd.oasis.opendocument.formula"],["odft","application/vnd.oasis.opendocument.formula-template"],["odg","application/vnd.oasis.opendocument.graphics"],["odi","application/vnd.oasis.opendocument.image"],["odm","application/vnd.oasis.opendocument.text-master"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["omc","application/x-omc"],["omcd","application/x-omcdatamaker"],["omcr","application/x-omcregerator"],["onetoc","application/onenote"],["opf","application/oebps-package+xml"],["org","application/vnd.lotus-organizer"],["osf","application/vnd.yamaha.openscoreformat"],["osfpvg","application/vnd.yamaha.openscoreformat.osfpvg+xml"],["otc","application/vnd.oasis.opendocument.chart-template"],["otf","application/x-font-otf"],["otg","application/vnd.oasis.opendocument.graphics-template"],["oth","application/vnd.oasis.opendocument.text-web"],["oti","application/vnd.oasis.opendocument.image-template"],["otp","application/vnd.oasis.opendocument.presentation-template"],["ots","application/vnd.oasis.opendocument.spreadsheet-template"],["ott","application/vnd.oasis.opendocument.text-template"],["oxt","application/vnd.openofficeorg.extension"],["p","text/x-pascal"],["p10",["application/pkcs10","application/x-pkcs10"]],["p12",["application/pkcs-12","application/x-pkcs12"]],["p7a","application/x-pkcs7-signature"],["p7b","application/x-pkcs7-certificates"],["p7c",["application/pkcs7-mime","application/x-pkcs7-mime"]],["p7m",["application/pkcs7-mime","application/x-pkcs7-mime"]],["p7r","application/x-pkcs7-certreqresp"],["p7s",["application/pkcs7-signature","application/x-pkcs7-signature"]],["p8","application/pkcs8"],["par","text/plain-bas"],["part","application/pro_eng"],["pas","text/pascal"],["paw","application/vnd.pawaafile"],["pbd","application/vnd.powerbuilder6"],["pbm","image/x-portable-bitmap"],["pcf","application/x-font-pcf"],["pcl",["application/vnd.hp-pcl","application/x-pcl"]],["pclxl","application/vnd.hp-pclxl"],["pct","image/x-pict"],["pcurl","application/vnd.curl.pcurl"],["pcx","image/x-pcx"],["pdb",["application/vnd.palm","chemical/x-pdb"]],["pdf","application/pdf"],["pfa","application/x-font-type1"],["pfr","application/font-tdpfr"],["pfunk",["audio/make","audio/make.my.funk"]],["pfx","application/x-pkcs12"],["pgm",["image/x-portable-graymap","image/x-portable-greymap"]],["pgn","application/x-chess-pgn"],["pgp","application/pgp-signature"],["pic",["image/pict","image/x-pict"]],["pict","image/pict"],["pkg","application/x-newton-compatible-pkg"],["pki","application/pkixcmp"],["pkipath","application/pkix-pkipath"],["pko",["application/ynd.ms-pkipko","application/vnd.ms-pki.pko"]],["pl",["text/plain","text/x-script.perl"]],["plb","application/vnd.3gpp.pic-bw-large"],["plc","application/vnd.mobius.plc"],["plf","application/vnd.pocketlearn"],["pls","application/pls+xml"],["plx","application/x-pixclscript"],["pm",["text/x-script.perl-module","image/x-xpixmap"]],["pm4","application/x-pagemaker"],["pm5","application/x-pagemaker"],["pma","application/x-perfmon"],["pmc","application/x-perfmon"],["pml",["application/vnd.ctc-posml","application/x-perfmon"]],["pmr","application/x-perfmon"],["pmw","application/x-perfmon"],["png","image/png"],["pnm",["application/x-portable-anymap","image/x-portable-anymap"]],["portpkg","application/vnd.macports.portpkg"],["pot",["application/vnd.ms-powerpoint","application/mspowerpoint"]],["potm","application/vnd.ms-powerpoint.template.macroenabled.12"],["potx","application/vnd.openxmlformats-officedocument.presentationml.template"],["pov","model/x-pov"],["ppa","application/vnd.ms-powerpoint"],["ppam","application/vnd.ms-powerpoint.addin.macroenabled.12"],["ppd","application/vnd.cups-ppd"],["ppm","image/x-portable-pixmap"],["pps",["application/vnd.ms-powerpoint","application/mspowerpoint"]],["ppsm","application/vnd.ms-powerpoint.slideshow.macroenabled.12"],["ppsx","application/vnd.openxmlformats-officedocument.presentationml.slideshow"],["ppt",["application/vnd.ms-powerpoint","application/mspowerpoint","application/powerpoint","application/x-mspowerpoint"]],["pptm","application/vnd.ms-powerpoint.presentation.macroenabled.12"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["ppz","application/mspowerpoint"],["prc","application/x-mobipocket-ebook"],["pre",["application/vnd.lotus-freelance","application/x-freelance"]],["prf","application/pics-rules"],["prt","application/pro_eng"],["ps","application/postscript"],["psb","application/vnd.3gpp.pic-bw-small"],["psd",["application/octet-stream","image/vnd.adobe.photoshop"]],["psf","application/x-font-linux-psf"],["pskcxml","application/pskc+xml"],["ptid","application/vnd.pvi.ptid1"],["pub","application/x-mspublisher"],["pvb","application/vnd.3gpp.pic-bw-var"],["pvu","paleovu/x-pv"],["pwn","application/vnd.3m.post-it-notes"],["pwz","application/vnd.ms-powerpoint"],["py","text/x-script.phyton"],["pya","audio/vnd.ms-playready.media.pya"],["pyc","applicaiton/x-bytecode.python"],["pyv","video/vnd.ms-playready.media.pyv"],["qam","application/vnd.epson.quickanime"],["qbo","application/vnd.intu.qbo"],["qcp","audio/vnd.qcelp"],["qd3","x-world/x-3dmf"],["qd3d","x-world/x-3dmf"],["qfx","application/vnd.intu.qfx"],["qif","image/x-quicktime"],["qps","application/vnd.publishare-delta-tree"],["qt","video/quicktime"],["qtc","video/x-qtc"],["qti","image/x-quicktime"],["qtif","image/x-quicktime"],["qxd","application/vnd.quark.quarkxpress"],["ra",["audio/x-realaudio","audio/x-pn-realaudio","audio/x-pn-realaudio-plugin"]],["ram","audio/x-pn-realaudio"],["rar","application/x-rar-compressed"],["ras",["image/cmu-raster","application/x-cmu-raster","image/x-cmu-raster"]],["rast","image/cmu-raster"],["rcprofile","application/vnd.ipunplugged.rcprofile"],["rdf","application/rdf+xml"],["rdz","application/vnd.data-vision.rdz"],["rep","application/vnd.businessobjects"],["res","application/x-dtbresource+xml"],["rexx","text/x-script.rexx"],["rf","image/vnd.rn-realflash"],["rgb","image/x-rgb"],["rif","application/reginfo+xml"],["rip","audio/vnd.rip"],["rl","application/resource-lists+xml"],["rlc","image/vnd.fujixerox.edmics-rlc"],["rld","application/resource-lists-diff+xml"],["rm",["application/vnd.rn-realmedia","audio/x-pn-realaudio"]],["rmi","audio/mid"],["rmm","audio/x-pn-realaudio"],["rmp",["audio/x-pn-realaudio-plugin","audio/x-pn-realaudio"]],["rms","application/vnd.jcp.javame.midlet-rms"],["rnc","application/relax-ng-compact-syntax"],["rng",["application/ringing-tones","application/vnd.nokia.ringing-tone"]],["rnx","application/vnd.rn-realplayer"],["roff","application/x-troff"],["rp","image/vnd.rn-realpix"],["rp9","application/vnd.cloanto.rp9"],["rpm","audio/x-pn-realaudio-plugin"],["rpss","application/vnd.nokia.radio-presets"],["rpst","application/vnd.nokia.radio-preset"],["rq","application/sparql-query"],["rs","application/rls-services+xml"],["rsd","application/rsd+xml"],["rt",["text/richtext","text/vnd.rn-realtext"]],["rtf",["application/rtf","text/richtext","application/x-rtf"]],["rtx",["text/richtext","application/rtf"]],["rv","video/vnd.rn-realvideo"],["s","text/x-asm"],["s3m","audio/s3m"],["saf","application/vnd.yamaha.smaf-audio"],["saveme","application/octet-stream"],["sbk","application/x-tbook"],["sbml","application/sbml+xml"],["sc","application/vnd.ibm.secure-container"],["scd","application/x-msschedule"],["scm",["application/vnd.lotus-screencam","video/x-scm","text/x-script.guile","application/x-lotusscreencam","text/x-script.scheme"]],["scq","application/scvp-cv-request"],["scs","application/scvp-cv-response"],["sct","text/scriptlet"],["scurl","text/vnd.curl.scurl"],["sda","application/vnd.stardivision.draw"],["sdc","application/vnd.stardivision.calc"],["sdd","application/vnd.stardivision.impress"],["sdkm","application/vnd.solent.sdkm+xml"],["sdml","text/plain"],["sdp",["application/sdp","application/x-sdp"]],["sdr","application/sounder"],["sdw","application/vnd.stardivision.writer"],["sea",["application/sea","application/x-sea"]],["see","application/vnd.seemail"],["seed","application/vnd.fdsn.seed"],["sema","application/vnd.sema"],["semd","application/vnd.semd"],["semf","application/vnd.semf"],["ser","application/java-serialized-object"],["set","application/set"],["setpay","application/set-payment-initiation"],["setreg","application/set-registration-initiation"],["sfd-hdstx","application/vnd.hydrostatix.sof-data"],["sfs","application/vnd.spotfire.sfs"],["sgl","application/vnd.stardivision.writer-global"],["sgm",["text/sgml","text/x-sgml"]],["sgml",["text/sgml","text/x-sgml"]],["sh",["application/x-shar","application/x-bsh","application/x-sh","text/x-script.sh"]],["shar",["application/x-bsh","application/x-shar"]],["shf","application/shf+xml"],["shtml",["text/html","text/x-server-parsed-html"]],["sid","audio/x-psid"],["sis","application/vnd.symbian.install"],["sit",["application/x-stuffit","application/x-sit"]],["sitx","application/x-stuffitx"],["skd","application/x-koan"],["skm","application/x-koan"],["skp",["application/vnd.koan","application/x-koan"]],["skt","application/x-koan"],["sl","application/x-seelogo"],["sldm","application/vnd.ms-powerpoint.slide.macroenabled.12"],["sldx","application/vnd.openxmlformats-officedocument.presentationml.slide"],["slt","application/vnd.epson.salt"],["sm","application/vnd.stepmania.stepchart"],["smf","application/vnd.stardivision.math"],["smi",["application/smil","application/smil+xml"]],["smil","application/smil"],["snd",["audio/basic","audio/x-adpcm"]],["snf","application/x-font-snf"],["sol","application/solids"],["spc",["text/x-speech","application/x-pkcs7-certificates"]],["spf","application/vnd.yamaha.smaf-phrase"],["spl",["application/futuresplash","application/x-futuresplash"]],["spot","text/vnd.in3d.spot"],["spp","application/scvp-vp-response"],["spq","application/scvp-vp-request"],["spr","application/x-sprite"],["sprite","application/x-sprite"],["src","application/x-wais-source"],["sru","application/sru+xml"],["srx","application/sparql-results+xml"],["sse","application/vnd.kodak-descriptor"],["ssf","application/vnd.epson.ssf"],["ssi","text/x-server-parsed-html"],["ssm","application/streamingmedia"],["ssml","application/ssml+xml"],["sst",["application/vnd.ms-pkicertstore","application/vnd.ms-pki.certstore"]],["st","application/vnd.sailingtracker.track"],["stc","application/vnd.sun.xml.calc.template"],["std","application/vnd.sun.xml.draw.template"],["step","application/step"],["stf","application/vnd.wt.stf"],["sti","application/vnd.sun.xml.impress.template"],["stk","application/hyperstudio"],["stl",["application/vnd.ms-pkistl","application/sla","application/vnd.ms-pki.stl","application/x-navistyle"]],["stm","text/html"],["stp","application/step"],["str","application/vnd.pg.format"],["stw","application/vnd.sun.xml.writer.template"],["sub","image/vnd.dvb.subtitle"],["sus","application/vnd.sus-calendar"],["sv4cpio","application/x-sv4cpio"],["sv4crc","application/x-sv4crc"],["svc","application/vnd.dvb.service"],["svd","application/vnd.svd"],["svf",["image/vnd.dwg","image/x-dwg"]],["svg","image/svg+xml"],["svr",["x-world/x-svr","application/x-world"]],["swf","application/x-shockwave-flash"],["swi","application/vnd.aristanetworks.swi"],["sxc","application/vnd.sun.xml.calc"],["sxd","application/vnd.sun.xml.draw"],["sxg","application/vnd.sun.xml.writer.global"],["sxi","application/vnd.sun.xml.impress"],["sxm","application/vnd.sun.xml.math"],["sxw","application/vnd.sun.xml.writer"],["t",["text/troff","application/x-troff"]],["talk","text/x-speech"],["tao","application/vnd.tao.intent-module-archive"],["tar","application/x-tar"],["tbk",["application/toolbook","application/x-tbook"]],["tcap","application/vnd.3gpp2.tcap"],["tcl",["text/x-script.tcl","application/x-tcl"]],["tcsh","text/x-script.tcsh"],["teacher","application/vnd.smart.teacher"],["tei","application/tei+xml"],["tex","application/x-tex"],["texi","application/x-texinfo"],["texinfo","application/x-texinfo"],["text",["application/plain","text/plain"]],["tfi","application/thraud+xml"],["tfm","application/x-tex-tfm"],["tgz",["application/gnutar","application/x-compressed"]],["thmx","application/vnd.ms-officetheme"],["tif",["image/tiff","image/x-tiff"]],["tiff",["image/tiff","image/x-tiff"]],["tmo","application/vnd.tmobile-livetv"],["torrent","application/x-bittorrent"],["tpl","application/vnd.groove-tool-template"],["tpt","application/vnd.trid.tpt"],["tr","application/x-troff"],["tra","application/vnd.trueapp"],["trm","application/x-msterminal"],["tsd","application/timestamped-data"],["tsi","audio/tsp-audio"],["tsp",["application/dsptype","audio/tsplayer"]],["tsv","text/tab-separated-values"],["ttf","application/x-font-ttf"],["ttl","text/turtle"],["turbot","image/florian"],["twd","application/vnd.simtech-mindmapper"],["txd","application/vnd.genomatix.tuxedo"],["txf","application/vnd.mobius.txf"],["txt","text/plain"],["ufd","application/vnd.ufdl"],["uil","text/x-uil"],["uls","text/iuls"],["umj","application/vnd.umajin"],["uni","text/uri-list"],["unis","text/uri-list"],["unityweb","application/vnd.unity"],["unv","application/i-deas"],["uoml","application/vnd.uoml+xml"],["uri","text/uri-list"],["uris","text/uri-list"],["ustar",["application/x-ustar","multipart/x-ustar"]],["utz","application/vnd.uiq.theme"],["uu",["application/octet-stream","text/x-uuencode"]],["uue","text/x-uuencode"],["uva","audio/vnd.dece.audio"],["uvh","video/vnd.dece.hd"],["uvi","image/vnd.dece.graphic"],["uvm","video/vnd.dece.mobile"],["uvp","video/vnd.dece.pd"],["uvs","video/vnd.dece.sd"],["uvu","video/vnd.uvvu.mp4"],["uvv","video/vnd.dece.video"],["vcd","application/x-cdlink"],["vcf","text/x-vcard"],["vcg","application/vnd.groove-vcard"],["vcs","text/x-vcalendar"],["vcx","application/vnd.vcx"],["vda","application/vda"],["vdo","video/vdo"],["vew","application/groupwise"],["vis","application/vnd.visionary"],["viv",["video/vivo","video/vnd.vivo"]],["vivo",["video/vivo","video/vnd.vivo"]],["vmd","application/vocaltec-media-desc"],["vmf","application/vocaltec-media-file"],["voc",["audio/voc","audio/x-voc"]],["vos","video/vosaic"],["vox","audio/voxware"],["vqe","audio/x-twinvq-plugin"],["vqf","audio/x-twinvq"],["vql","audio/x-twinvq-plugin"],["vrml",["model/vrml","x-world/x-vrml","application/x-vrml"]],["vrt","x-world/x-vrt"],["vsd",["application/vnd.visio","application/x-visio"]],["vsf","application/vnd.vsf"],["vst","application/x-visio"],["vsw","application/x-visio"],["vtu","model/vnd.vtu"],["vxml","application/voicexml+xml"],["w60","application/wordperfect6.0"],["w61","application/wordperfect6.1"],["w6w","application/msword"],["wad","application/x-doom"],["wav",["audio/wav","audio/x-wav"]],["wax","audio/x-ms-wax"],["wb1","application/x-qpro"],["wbmp","image/vnd.wap.wbmp"],["wbs","application/vnd.criticaltools.wbs+xml"],["wbxml","application/vnd.wap.wbxml"],["wcm","application/vnd.ms-works"],["wdb","application/vnd.ms-works"],["web","application/vnd.xara"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["wg","application/vnd.pmi.widget"],["wgt","application/widget"],["wiz","application/msword"],["wk1","application/x-123"],["wks","application/vnd.ms-works"],["wm","video/x-ms-wm"],["wma","audio/x-ms-wma"],["wmd","application/x-ms-wmd"],["wmf",["windows/metafile","application/x-msmetafile"]],["wml","text/vnd.wap.wml"],["wmlc","application/vnd.wap.wmlc"],["wmls","text/vnd.wap.wmlscript"],["wmlsc","application/vnd.wap.wmlscriptc"],["wmv","video/x-ms-wmv"],["wmx","video/x-ms-wmx"],["wmz","application/x-ms-wmz"],["woff","application/x-font-woff"],["word","application/msword"],["wp","application/wordperfect"],["wp5",["application/wordperfect","application/wordperfect6.0"]],["wp6","application/wordperfect"],["wpd",["application/wordperfect","application/vnd.wordperfect","application/x-wpwin"]],["wpl","application/vnd.ms-wpl"],["wps","application/vnd.ms-works"],["wq1","application/x-lotus"],["wqd","application/vnd.wqd"],["wri",["application/mswrite","application/x-wri","application/x-mswrite"]],["wrl",["model/vrml","x-world/x-vrml","application/x-world"]],["wrz",["model/vrml","x-world/x-vrml"]],["wsc","text/scriplet"],["wsdl","application/wsdl+xml"],["wspolicy","application/wspolicy+xml"],["wsrc","application/x-wais-source"],["wtb","application/vnd.webturbo"],["wtk","application/x-wintalk"],["wvx","video/x-ms-wvx"],["x-png","image/png"],["x3d","application/vnd.hzn-3d-crossword"],["xaf","x-world/x-vrml"],["xap","application/x-silverlight-app"],["xar","application/vnd.xara"],["xbap","application/x-ms-xbap"],["xbd","application/vnd.fujixerox.docuworks.binder"],["xbm",["image/xbm","image/x-xbm","image/x-xbitmap"]],["xdf","application/xcap-diff+xml"],["xdm","application/vnd.syncml.dm+xml"],["xdp","application/vnd.adobe.xdp+xml"],["xdr","video/x-amt-demorun"],["xdssc","application/dssc+xml"],["xdw","application/vnd.fujixerox.docuworks"],["xenc","application/xenc+xml"],["xer","application/patch-ops-error+xml"],["xfdf","application/vnd.adobe.xfdf"],["xfdl","application/vnd.xfdl"],["xgz","xgl/drawing"],["xhtml","application/xhtml+xml"],["xif","image/vnd.xiff"],["xl","application/excel"],["xla",["application/vnd.ms-excel","application/excel","application/x-msexcel","application/x-excel"]],["xlam","application/vnd.ms-excel.addin.macroenabled.12"],["xlb",["application/excel","application/vnd.ms-excel","application/x-excel"]],["xlc",["application/vnd.ms-excel","application/excel","application/x-excel"]],["xld",["application/excel","application/x-excel"]],["xlk",["application/excel","application/x-excel"]],["xll",["application/excel","application/vnd.ms-excel","application/x-excel"]],["xlm",["application/vnd.ms-excel","application/excel","application/x-excel"]],["xls",["application/vnd.ms-excel","application/excel","application/x-msexcel","application/x-excel"]],["xlsb","application/vnd.ms-excel.sheet.binary.macroenabled.12"],["xlsm","application/vnd.ms-excel.sheet.macroenabled.12"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xlt",["application/vnd.ms-excel","application/excel","application/x-excel"]],["xltm","application/vnd.ms-excel.template.macroenabled.12"],["xltx","application/vnd.openxmlformats-officedocument.spreadsheetml.template"],["xlv",["application/excel","application/x-excel"]],["xlw",["application/vnd.ms-excel","application/excel","application/x-msexcel","application/x-excel"]],["xm","audio/xm"],["xml",["application/xml","text/xml","application/atom+xml","application/rss+xml"]],["xmz","xgl/movie"],["xo","application/vnd.olpc-sugar"],["xof","x-world/x-vrml"],["xop","application/xop+xml"],["xpi","application/x-xpinstall"],["xpix","application/x-vnd.ls-xpix"],["xpm",["image/xpm","image/x-xpixmap"]],["xpr","application/vnd.is-xpr"],["xps","application/vnd.ms-xpsdocument"],["xpw","application/vnd.intercon.formnet"],["xslt","application/xslt+xml"],["xsm","application/vnd.syncml+xml"],["xspf","application/xspf+xml"],["xsr","video/x-amt-showrun"],["xul","application/vnd.mozilla.xul+xml"],["xwd",["image/x-xwd","image/x-xwindowdump"]],["xyz",["chemical/x-xyz","chemical/x-pdb"]],["yang","application/yang"],["yin","application/yin+xml"],["z",["application/x-compressed","application/x-compress"]],["zaz","application/vnd.zzazz.deck+xml"],["zip",["application/zip","multipart/x-zip","application/x-zip-compressed","application/x-compressed"]],["zir","application/vnd.zul"],["zmm","application/vnd.handheld-entertainment+xml"],["zoo","application/octet-stream"],["zsh","text/x-script.zsh"]]);e.exports={detectMimeType(e){if(!e)return"application/octet-stream";let t=o.parse(e),n=(t.ext.substr(1)||t.name||"").split("?").shift().trim().toLowerCase(),i="application/octet-stream";return r.has(n)&&(i=r.get(n)),Array.isArray(i)?i[0]:i},detectExtension(e){if(!e)return"bin";let t=(e||"").toLowerCase().trim().split("/"),n=t.shift().trim(),o=t.join("/").trim();if(i.has(n+"/"+o)){let e=i.get(n+"/"+o);return Array.isArray(e)?e[0]:e}switch(n){case"text":return"txt";default:return"bin"}}}},function(e,t,n){"use strict";const o=n(16),i=n(78),r=n(20),s=n(245),a=n(14).PassThrough,c=n(63),l=n(217),p=n(247),u=n(246),d=n(338),h=n(216),m=n(339);class f{constructor(e,t){this.nodeCounter=0,t=t||{},this.baseBoundary=t.baseBoundary||o.randomBytes(8).toString("hex"),this.boundaryPrefix=t.boundaryPrefix||"--_NmP",this.disableFileAccess=!!t.disableFileAccess,this.disableUrlAccess=!!t.disableUrlAccess,this.normalizeHeaderKey=t.normalizeHeaderKey,this.date=new Date,this.rootNode=t.rootNode||this,this.keepBcc=!!t.keepBcc,t.filename&&(this.filename=t.filename,e||(e=l.detectMimeType(this.filename.split(".").pop()))),this.textEncoding=(t.textEncoding||"").toString().trim().charAt(0).toUpperCase(),this.parentNode=t.parentNode,this.hostname=t.hostname,this.childNodes=[],this._nodeId=++this.rootNode.nodeCounter,this._headers=[],this._isPlainText=!1,this._hasLongLines=!1,this._envelope=!1,this._raw=!1,this._transforms=[],this._processFuncs=[],e&&this.setHeader("Content-Type",e)}createChild(e,t){t||"object"!=typeof e||(t=e,e=void 0);let n=new f(e,t);return this.appendChild(n),n}appendChild(e){return e.rootNode!==this.rootNode&&(e.rootNode=this.rootNode,e._nodeId=++this.rootNode.nodeCounter),e.parentNode=this,this.childNodes.push(e),e}replace(e){return e===this?this:(this.parentNode.childNodes.forEach((t,n)=>{t===this&&(e.rootNode=this.rootNode,e.parentNode=this.parentNode,e._nodeId=this._nodeId,this.rootNode=this,this.parentNode=void 0,e.parentNode.childNodes[n]=e)}),e)}remove(){if(!this.parentNode)return this;for(let e=this.parentNode.childNodes.length-1;e>=0;e--)if(this.parentNode.childNodes[e]===this)return this.parentNode.childNodes.splice(e,1),this.parentNode=void 0,this.rootNode=this,this}setHeader(e,t){let n,o=!1;if(!t&&e&&"object"==typeof e)return e.key&&"value"in e?this.setHeader(e.key,e.value):Array.isArray(e)?e.forEach(e=>{this.setHeader(e.key,e.value)}):Object.keys(e).forEach(t=>{this.setHeader(t,e[t])}),this;n={key:e=this._normalizeHeaderKey(e),value:t};for(let t=0,i=this._headers.length;t<i;t++)this._headers[t].key===e&&(o?(this._headers.splice(t,1),t--,i--):(this._headers[t]=n,o=!0));return o||this._headers.push(n),this}addHeader(e,t){return!t&&e&&"object"==typeof e?(e.key&&e.value?this.addHeader(e.key,e.value):Array.isArray(e)?e.forEach(e=>{this.addHeader(e.key,e.value)}):Object.keys(e).forEach(t=>{this.addHeader(t,e[t])}),this):Array.isArray(t)?(t.forEach(t=>{this.addHeader(e,t)}),this):(this._headers.push({key:this._normalizeHeaderKey(e),value:t}),this)}getHeader(e){e=this._normalizeHeaderKey(e);for(let t=0,n=this._headers.length;t<n;t++)if(this._headers[t].key===e)return this._headers[t].value}setContent(e){return this.content=e,"function"==typeof this.content.pipe?(this._contentErrorHandler=e=>{this.content.removeListener("error",this._contentErrorHandler),this.content=e},this.content.once("error",this._contentErrorHandler)):"string"==typeof this.content&&(this._isPlainText=l.isPlainText(this.content),this._isPlainText&&l.hasLongerLines(this.content,76)&&(this._hasLongLines=!0)),this}build(e){let t;e||(t=new Promise((t,n)=>{e=c.callbackPromise(t,n)}));let n=this.createReadStream(),o=[],i=0,r=!1;return n.on("readable",()=>{let e;for(;null!==(e=n.read());)o.push(e),i+=e.length}),n.once("error",t=>{if(!r)return r=!0,e(t)}),n.once("end",t=>{if(!r)return r=!0,t&&t.length&&(o.push(t),i+=t.length),e(null,Buffer.concat(o,i))}),t}getTransferEncoding(){let e=!1,t=(this.getHeader("Content-Type")||"").toString().toLowerCase().trim();return this.content&&((e=(this.getHeader("Content-Transfer-Encoding")||"").toString().toLowerCase().trim())&&["base64","quoted-printable"].includes(e)||(/^text\//i.test(t)?e=this._isPlainText&&!this._hasLongLines?"7bit":"string"==typeof this.content||this.content instanceof Buffer?"Q"===this._getTextEncoding(this.content)?"quoted-printable":"base64":"B"===this.transferEncoding?"base64":"quoted-printable":/^(multipart|message)\//i.test(t)||(e=e||"base64"))),e}buildHeaders(){let e=this.getTransferEncoding(),t=[];return e&&this.setHeader("Content-Transfer-Encoding",e),this.filename&&!this.getHeader("Content-Disposition")&&this.setHeader("Content-Disposition","attachment"),this.rootNode===this&&(this.getHeader("Date")||this.setHeader("Date",this.date.toUTCString().replace(/GMT/,"+0000")),this.messageId(),this.getHeader("MIME-Version")||this.setHeader("MIME-Version","1.0")),this._headers.forEach(e=>{let n,o,i=e.key,r=e.value,s={};if(!r||"object"!=typeof r||["From","Sender","To","Cc","Bcc","Reply-To","Date","References"].includes(i)||(Object.keys(r).forEach(e=>{"value"!==e&&(s[e]=r[e])}),(r=(r.value||"").toString()).trim()))if(s.prepared)s.foldLines?t.push(l.foldLines(i+": "+r)):t.push(i+": "+r);else{switch(e.key){case"Content-Disposition":n=l.parseHeaderValue(r),this.filename&&(n.params.filename=this.filename),r=l.buildHeaderValue(n);break;case"Content-Type":n=l.parseHeaderValue(r),this._handleContentType(n),n.value.match(/^text\/plain\b/)&&"string"==typeof this.content&&/[\u0080-\uFFFF]/.test(this.content)&&(n.params.charset="utf-8"),r=l.buildHeaderValue(n),this.filename&&(((o=this._encodeWords(this.filename))!==this.filename||/[\s'"\\;:/=(),<>@[\]?]|^-/.test(o))&&(o='"'+o+'"'),r+="; name="+o);break;case"Bcc":if(!this.keepBcc)return}if(((r=this._encodeHeaderValue(i,r))||"").toString().trim()){if("function"==typeof this.normalizeHeaderKey){let e=this.normalizeHeaderKey(i,r);e&&"string"==typeof e&&e.length&&(i=e)}t.push(l.foldLines(i+": "+r,76))}}}),t.join("\r\n")}createReadStream(e){let t,n=new a(e=e||{}),o=n;this.stream(n,e,e=>{e?o.emit("error",e):n.end()});for(let e=0,n=this._transforms.length;e<n;e++)t="function"==typeof this._transforms[e]?this._transforms[e]():this._transforms[e],o.once("error",e=>{t.emit("error",e)}),o=o.pipe(t);t=new m,o.once("error",e=>{t.emit("error",e)}),o=o.pipe(t);for(let e=0,n=this._processFuncs.length;e<n;e++)t=this._processFuncs[e],o=t(o);return o}transform(e){this._transforms.push(e)}processFunc(e){this._processFuncs.push(e)}stream(e,t,n){let o,i,r=this.getTransferEncoding(),s=!1,a=e=>{s||(s=!0,n(e))},c=()=>{let n=0,o=()=>{if(n>=this.childNodes.length)return e.write("\r\n--"+this.boundary+"--\r\n"),a();let i=this.childNodes[n++];e.write((n>1?"\r\n":"")+"--"+this.boundary+"\r\n"),i.stream(e,t,e=>{if(e)return a(e);setImmediate(o)})};if(!this.multipart)return a();setImmediate(o)},l=()=>{if(!this.content)return setImmediate(c);{if("[object Error]"===Object.prototype.toString.call(this.content))return a(this.content);"function"==typeof this.content.pipe&&(this.content.removeListener("error",this._contentErrorHandler),this._contentErrorHandler=e=>a(e),this.content.once("error",this._contentErrorHandler));let n=()=>{["quoted-printable","base64"].includes(r)?((o=new("base64"===r?u:p).Encoder(t)).pipe(e,{end:!1}),o.once("end",c),o.once("error",e=>a(e)),(i=this._getStream(this.content)).pipe(o)):((i=this._getStream(this.content)).pipe(e,{end:!1}),i.once("end",c)),i.once("error",e=>a(e))};if(this.content._resolve){let e=[],t=0,o=!1,i=this._getStream(this.content);i.on("error",e=>{o||(o=!0,a(e))}),i.on("readable",()=>{let n;for(;null!==(n=i.read());)e.push(n),t+=n.length}),i.on("end",()=>{o||(o=!0,this.content._resolve=!1,this.content._resolvedValue=Buffer.concat(e,t),setImmediate(n))})}else setImmediate(n)}};this._raw?setImmediate(()=>{if("[object Error]"===Object.prototype.toString.call(this._raw))return a(this._raw);"function"==typeof this._raw.pipe&&this._raw.removeListener("error",this._contentErrorHandler);let t=this._getStream(this._raw);t.pipe(e,{end:!1}),t.on("error",t=>e.emit("error",t)),t.on("end",c)}):(e.write(this.buildHeaders()+"\r\n\r\n"),setImmediate(l))}setEnvelope(e){let t;this._envelope={from:!1,to:[]},e.from&&(t=[],this._convertAddresses(this._parseAddresses(e.from),t),(t=t.filter(e=>e&&e.address)).length&&t[0]&&(this._envelope.from=t[0].address)),["to","cc","bcc"].forEach(t=>{e[t]&&this._convertAddresses(this._parseAddresses(e[t]),this._envelope.to)}),this._envelope.to=this._envelope.to.map(e=>e.address).filter(e=>e);let n=["to","cc","bcc","from"];return Object.keys(e).forEach(t=>{n.includes(t)||(this._envelope[t]=e[t])}),this}getAddresses(){let e={};return this._headers.forEach(t=>{let n=t.key.toLowerCase();["from","sender","reply-to","to","cc","bcc"].includes(n)&&(Array.isArray(e[n])||(e[n]=[]),this._convertAddresses(this._parseAddresses(t.value),e[n]))}),e}getEnvelope(){if(this._envelope)return this._envelope;let e={from:!1,to:[]};return this._headers.forEach(t=>{let n=[];"From"===t.key||!e.from&&["Reply-To","Sender"].includes(t.key)?(this._convertAddresses(this._parseAddresses(t.value),n),n.length&&n[0]&&(e.from=n[0].address)):["To","Cc","Bcc"].includes(t.key)&&this._convertAddresses(this._parseAddresses(t.value),e.to)}),e.to=e.to.map(e=>e.address),e}messageId(){let e=this.getHeader("Message-ID");return e||(e=this._generateMessageId(),this.setHeader("Message-ID",e)),e}setRaw(e){return this._raw=e,this._raw&&"function"==typeof this._raw.pipe&&(this._contentErrorHandler=e=>{this._raw.removeListener("error",this._contentErrorHandler),this._raw=e},this._raw.once("error",this._contentErrorHandler)),this}_getStream(e){let t;return e._resolvedValue?(t=new a,setImmediate(()=>t.end(e._resolvedValue)),t):"function"==typeof e.pipe?e:e&&"string"==typeof e.path&&!e.href?this.disableFileAccess?(t=new a,setImmediate(()=>t.emit("error",new Error("File access rejected for "+e.path))),t):r.createReadStream(e.path):e&&"string"==typeof e.href?this.disableUrlAccess?(t=new a,setImmediate(()=>t.emit("error",new Error("Url access rejected for "+e.href))),t):h(e.href,{headers:e.httpHeaders}):(t=new a,setImmediate(()=>t.end(e||"")),t)}_parseAddresses(e){return[].concat.apply([],[].concat(e).map(e=>e&&e.address?(e.address=this._normalizeAddress(e.address),e.name=e.name||"",[e]):d(e)))}_normalizeHeaderKey(e){return e=(e||"").toString().replace(/\r?\n|\r/g," ").trim().toLowerCase().replace(/^X-SMTPAPI$|^(MIME|DKIM)\b|^[a-z]|-(SPF|FBL|ID|MD5)$|-[a-z]/gi,e=>e.toUpperCase()).replace(/^Content-Features$/i,"Content-features")}_handleContentType(e){this.contentType=e.value.trim().toLowerCase(),this.multipart=this.contentType.split("/").reduce((e,t)=>"multipart"===e&&t),this.multipart?this.boundary=e.params.boundary=e.params.boundary||this.boundary||this._generateBoundary():this.boundary=!1}_generateBoundary(){return this.rootNode.boundaryPrefix+"-"+this.rootNode.baseBoundary+"-Part_"+this._nodeId}_encodeHeaderValue(e,t){switch(e=this._normalizeHeaderKey(e)){case"From":case"Sender":case"To":case"Cc":case"Bcc":case"Reply-To":return this._convertAddresses(this._parseAddresses(t));case"Message-ID":case"In-Reply-To":case"Content-Id":return"<"!==(t=(t||"").toString().replace(/\r?\n|\r/g," ")).charAt(0)&&(t="<"+t),">"!==t.charAt(t.length-1)&&(t+=">"),t;case"References":return(t=[].concat.apply([],[].concat(t||"").map(e=>(e=(e||"").toString().replace(/\r?\n|\r/g," ").trim()).replace(/<[^>]*>/g,e=>e.replace(/\s/g,"")).split(/\s+/))).map(e=>("<"!==e.charAt(0)&&(e="<"+e),">"!==e.charAt(e.length-1)&&(e+=">"),e))).join(" ").trim();case"Date":return"[object Date]"===Object.prototype.toString.call(t)?t.toUTCString().replace(/GMT/,"+0000"):(t=(t||"").toString().replace(/\r?\n|\r/g," "),this._encodeWords(t));default:return t=(t||"").toString().replace(/\r?\n|\r/g," "),this._encodeWords(t)}}_convertAddresses(e,t){let n=[];return t=t||[],[].concat(e||[]).forEach(e=>{e.address?(e.address=this._normalizeAddress(e.address),e.name?e.name&&n.push(this._encodeAddressName(e.name)+" <"+e.address+">"):n.push(e.address),e.address&&(t.filter(t=>t.address===e.address).length||t.push(e))):e.group&&n.push(this._encodeAddressName(e.name)+":"+(e.group.length?this._convertAddresses(e.group,t):"").trim()+";")}),n.join(", ")}_normalizeAddress(e){let t=(e=(e||"").toString().trim()).lastIndexOf("@");if(t<0)return e;let n=e.substr(0,t),o=e.substr(t+1);return n+"@"+s.toASCII(o.toLowerCase())}_encodeAddressName(e){return/^[\w ']*$/.test(e)?e:/^[\x20-\x7e]*$/.test(e)?'"'+e.replace(/([\\"])/g,"\\$1")+'"':l.encodeWord(e,this._getTextEncoding(e),52)}_encodeWords(e){return l.encodeWords(e,this._getTextEncoding(e),52,!0)}_getTextEncoding(e){e=(e||"").toString();let t,n,o=this.textEncoding;return o||(o=(n=(e.match(/[\x00-\x08\x0B\x0C\x0E-\x1F\u0080-\uFFFF]/g)||[]).length)<(t=(e.match(/[a-z]/gi)||[]).length)?"Q":"B"),o}_generateMessageId(){return"<"+[2,2,2,6].reduce((e,t)=>e+"-"+o.randomBytes(t).toString("hex"),o.randomBytes(4).toString("hex"))+"@"+(this.getEnvelope().from||this.hostname||i.hostname()||"localhost").split("@").pop()+">"}}e.exports=f},function(e,t){e.exports=require("punycode")},function(e,t,n){"use strict";const o=n(14).Transform;function i(e){return"string"==typeof e&&(e=Buffer.from(e,"utf-8")),e.toString("base64")}function r(e,t){if(t=t||76,(e=(e||"").toString()).length<=t)return e;let n=[],o=0,i=1024*t;for(;o<e.length;){let r=e.substr(o,i).replace(new RegExp(".{"+t+"}","g"),"$&\r\n").trim();n.push(r),o+=i}return n.join("\r\n").trim()}e.exports={encode:i,wrap:r,Encoder:class extends o{constructor(e){super(),this.options=e||{},!1!==this.options.lineLength&&(this.options.lineLength=this.options.lineLength||76),this._curLine="",this._remainingBytes=!1,this.inputBytes=0,this.outputBytes=0}_transform(e,t,n){if("buffer"!==t&&(e=Buffer.from(e,t)),!e||!e.length)return setImmediate(n);this.inputBytes+=e.length,this._remainingBytes&&this._remainingBytes.length&&(e=Buffer.concat([this._remainingBytes,e],this._remainingBytes.length+e.length),this._remainingBytes=!1),e.length%3?(this._remainingBytes=e.slice(e.length-e.length%3),e=e.slice(0,e.length-e.length%3)):this._remainingBytes=!1;let o=this._curLine+i(e);if(this.options.lineLength){let e=(o=r(o,this.options.lineLength)).lastIndexOf("\n");e<0?(this._curLine=o,o=""):e===o.length-1?this._curLine="":(this._curLine=o.substr(e+1),o=o.substr(0,e+1))}o&&(this.outputBytes+=o.length,this.push(Buffer.from(o,"ascii"))),setImmediate(n)}_flush(e){this._remainingBytes&&this._remainingBytes.length&&(this._curLine+=i(this._remainingBytes)),this._curLine&&(this._curLine=r(this._curLine,this.options.lineLength),this.outputBytes+=this._curLine.length,this.push(this._curLine,"ascii"),this._curLine=""),e()}}}},function(e,t,n){"use strict";const o=n(14).Transform;function i(e){"string"==typeof e&&(e=Buffer.from(e,"utf-8"));let t,n=[[9],[10],[13],[32,60],[62,126]],o="";for(let i=0,r=e.length;i<r;i++)s(t=e[i],n)&&(32!==t&&9!==t||i!==r-1&&10!==e[i+1]&&13!==e[i+1])?o+=String.fromCharCode(t):o+="="+(t<16?"0":"")+t.toString(16).toUpperCase();return o}function r(e,t){if(t=t||76,(e=(e||"").toString()).length<=t)return e;let n,o,i,r=0,s=e.length,a=Math.floor(t/3),c="";for(;r<s;)if(n=(i=e.substr(r,t)).match(/\r\n/))c+=i=i.substr(0,n.index+n[0].length),r+=i.length;else if("\n"!==i.substr(-1))if(n=i.substr(-a).match(/\n.*?$/))c+=i=i.substr(0,i.length-(n[0].length-1)),r+=i.length;else{if(i.length>t-a&&(n=i.substr(-a).match(/[ \t.,!?][^ \t.,!?]*$/)))i=i.substr(0,i.length-(n[0].length-1));else if(i.match(/[=][\da-f]{0,2}$/i))for((n=i.match(/[=][\da-f]{0,1}$/i))&&(i=i.substr(0,i.length-n[0].length));i.length>3&&i.length<s-r&&!i.match(/^(?:=[\da-f]{2}){1,4}$/i)&&(n=i.match(/[=][\da-f]{2}$/gi))&&!((o=parseInt(n[0].substr(1,2),16))<128)&&(i=i.substr(0,i.length-3),!(o>=192)););r+i.length<s&&"\n"!==i.substr(-1)?(i.length===t&&i.match(/[=][\da-f]{2}$/i)?i=i.substr(0,i.length-3):i.length===t&&(i=i.substr(0,i.length-1)),r+=i.length,i+="=\r\n"):r+=i.length,c+=i}else c+=i,r+=i.length;return c}function s(e,t){for(let n=t.length-1;n>=0;n--)if(t[n].length){if(1===t[n].length&&e===t[n][0])return!0;if(2===t[n].length&&e>=t[n][0]&&e<=t[n][1])return!0}return!1}e.exports={encode:i,wrap:r,Encoder:class extends o{constructor(e){super(),this.options=e||{},!1!==this.options.lineLength&&(this.options.lineLength=this.options.lineLength||76),this._curLine="",this.inputBytes=0,this.outputBytes=0}_transform(e,t,n){let o;if("buffer"!==t&&(e=Buffer.from(e,t)),!e||!e.length)return n();this.inputBytes+=e.length,this.options.lineLength?(o=(o=r(o=this._curLine+i(e),this.options.lineLength)).replace(/(^|\n)([^\n]*)$/,(e,t,n)=>(this._curLine=n,t)))&&(this.outputBytes+=o.length,this.push(o)):(o=i(e),this.outputBytes+=o.length,this.push(o,"ascii")),n()}_flush(e){this._curLine&&(this.outputBytes+=this._curLine.length,this.push(this._curLine,"ascii")),e()}}}},function(e,t,n){"use strict";const o=n(14).Stream,i=n(216),r=n(16),s=n(63);e.exports=class extends o{constructor(e,t){if(super(),this.options=e||{},e&&e.serviceClient){if(!e.privateKey||!e.user)return void setImmediate(()=>this.emit("error",new Error('Options "privateKey" and "user" are required for service account!')));let t=Math.min(Math.max(Number(this.options.serviceRequestTimeout)||0,0),3600);this.options.serviceRequestTimeout=t||300}if(this.logger=s.getLogger({logger:t},{component:this.options.component||"OAuth2"}),this.provisionCallback="function"==typeof this.options.provisionCallback&&this.options.provisionCallback,this.options.accessUrl=this.options.accessUrl||"https://accounts.google.com/o/oauth2/token",this.options.customHeaders=this.options.customHeaders||{},this.options.customParams=this.options.customParams||{},this.accessToken=this.options.accessToken||!1,this.options.expires&&Number(this.options.expires))this.expires=this.options.expires;else{let e=Math.max(Number(this.options.timeout)||0,0);this.expires=e&&Date.now()+1e3*e||0}}getToken(e,t){if(!e&&this.accessToken&&(!this.expires||this.expires>Date.now()))return t(null,this.accessToken);let n=(...e)=>{e[0]?this.logger.error({err:e[0],tnx:"OAUTH2",user:this.options.user,action:"renew"},"Failed generating new Access Token for %s",this.options.user):this.logger.info({tnx:"OAUTH2",user:this.options.user,action:"renew"},"Generated new Access Token for %s",this.options.user),t(...e)};this.provisionCallback?this.provisionCallback(this.options.user,!!e,(e,t,o)=>{!e&&t&&(this.accessToken=t,this.expires=o||0),n(e,t)}):this.generateToken(n)}updateToken(e,t){this.accessToken=e,t=Math.max(Number(t)||0,0),this.expires=t&&Date.now()+1e3*t||0,this.emit("token",{user:this.options.user,accessToken:e||"",expires:this.expires})}generateToken(e){let t,n;if(this.options.serviceClient){let e=Math.floor(Date.now()/1e3),o={iss:this.options.serviceClient,scope:this.options.scope||"https://mail.google.com/",sub:this.options.user,aud:this.options.accessUrl,iat:e,exp:e+this.options.serviceRequestTimeout},i=this.jwtSignRS256(o);t={grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:i},n={grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:o}}else{if(!this.options.refreshToken)return e(new Error("Can't create new access token for user"));t={client_id:this.options.clientId||"",client_secret:this.options.clientSecret||"",refresh_token:this.options.refreshToken,grant_type:"refresh_token"},n={client_id:this.options.clientId||"",client_secret:(this.options.clientSecret||"").substr(0,6)+"...",refresh_token:(this.options.refreshToken||"").substr(0,6)+"...",grant_type:"refresh_token"}}Object.keys(this.options.customParams).forEach(e=>{t[e]=this.options.customParams[e],n[e]=this.options.customParams[e]}),this.logger.debug({tnx:"OAUTH2",user:this.options.user,action:"generate"},"Requesting token using: %s",JSON.stringify(n)),this.postRequest(this.options.accessUrl,t,this.options,(t,n)=>{let o;if(t)return e(t);try{o=JSON.parse(n.toString())}catch(t){return e(t)}if(!o||"object"!=typeof o)return this.logger.debug({tnx:"OAUTH2",user:this.options.user,action:"post"},"Response: %s",(n||"").toString()),e(new Error("Invalid authentication response"));let i={};return Object.keys(o).forEach(e=>{i[e]="access_token"!==e?o[e]:(o[e]||"").toString().substr(0,6)+"..."}),this.logger.debug({tnx:"OAUTH2",user:this.options.user,action:"post"},"Response: %s",JSON.stringify(i)),o.error?e(new Error(o.error)):o.access_token?(this.updateToken(o.access_token,o.expires_in),e(null,this.accessToken)):e(new Error("No access token"))})}buildXOAuth2Token(e){let t=["user="+(this.options.user||""),"auth=Bearer "+(e||this.accessToken),"",""];return Buffer.from(t.join(""),"utf-8").toString("base64")}postRequest(e,t,n,o){let r=!1,s=[],a=0,c=i(e,{method:"post",headers:n.customHeaders,body:t,allowErrorResponse:!0});c.on("readable",()=>{let e;for(;null!==(e=c.read());)s.push(e),a+=e.length}),c.once("error",e=>{if(!r)return r=!0,o(e)}),c.once("end",()=>{if(!r)return r=!0,o(null,Buffer.concat(s,a))})}toBase64URL(e){return"string"==typeof e&&(e=Buffer.from(e)),e.toString("base64").replace(/[=]+/g,"").replace(/\+/g,"-").replace(/\//g,"_")}jwtSignRS256(e){e=['{"alg":"RS256","typ":"JWT"}',JSON.stringify(e)].map(e=>this.toBase64URL(e)).join(".");let t=r.createSign("RSA-SHA256").update(e).sign(this.options.privateKey);return e+"."+this.toBase64URL(t)}}},function(e,t,n){"use strict";const o=n(349),i={};function r(e){return e.replace(/[^a-zA-Z0-9.-]/g,"").toLowerCase()}function s(e){let t=["domains","aliases"],n={};return Object.keys(e).forEach(o=>{t.indexOf(o)<0&&(n[o]=e[o])}),n}Object.keys(o).forEach(e=>{let t=o[e];i[r(e)]=s(t),[].concat(t.aliases||[]).forEach(e=>{i[r(e)]=s(t)}),[].concat(t.domains||[]).forEach(e=>{i[r(e)]=s(t)})}),e.exports=function(e){return e=r(e.split("@").pop()),i[e]||!1}},function(e,t,n){"use strict";const o=n(14).Transform;e.exports=class extends o{constructor(e){super(e),this.options=e||{}}_transform(e,t,n){let o,i=0;for(let t=0,n=e.length;t<n;t++)13===e[t]&&(o=e.slice(i,t),i=t+1,this.push(o));i&&i<e.length?(o=e.slice(i),this.push(o)):i||this.push(e),n()}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){const{end:o}=n(124),i=n(333);e.exports={sendEmail:function({req:e,res:t,email:n,content:r,subject:s="Do not reply"}){const a={from:"red.hand.devs@gmail.com",to:n,subject:s,html:r};i.createTransport({service:"Gmail",auth:{user:"red.hand.devs@gmail.com",pass:"123456t7890y"}}).sendMail(a,(function(n,i){n?o(t,"error",n.message):o(t,"success",JSON.stringify(e.body))}))}}},function(e,t,n){"use strict";const o=n(334),i=n(63),r=n(346),s=n(350),a=n(351),c=n(352),l=n(353),p=n(354),u=n(216),d=n(79),h=(process.env.ETHEREAL_API||"https://api.nodemailer.com").replace(/\/+$/,""),m=(process.env.ETHEREAL_WEB||"https://ethereal.email").replace(/\/+$/,""),f=["true","yes","y","1"].includes((process.env.ETHEREAL_CACHE||"yes").toString().trim().toLowerCase());let g=!1;e.exports.createTransport=function(e,t){let n,u,d;return("object"==typeof e&&"function"!=typeof e.send||"string"==typeof e&&/^(smtps?|direct):/i.test(e))&&(e=(u=(n="string"==typeof e?e:e.url)?i.parseConnectionUrl(n):e).pool?new r(u):u.sendmail?new a(u):u.streamTransport?new c(u):u.jsonTransport?new l(u):u.SES?new p(u):new s(u)),d=new o(e,u,t)},e.exports.createTestAccount=function(e,t){let n;if(t||"function"!=typeof e||(t=e,e=!1),t||(n=new Promise((e,n)=>{t=i.callbackPromise(e,n)})),f&&g)return setImmediate(()=>t(null,g)),n;let o=[],r=0,s=u((e=e||h)+"/user",{contentType:"application/json",method:"POST",body:Buffer.from(JSON.stringify({requestor:d.name,version:d.version}))});return s.on("readable",()=>{let e;for(;null!==(e=s.read());)o.push(e),r+=e.length}),s.once("error",e=>t(e)),s.once("end",()=>{let e,n,i=Buffer.concat(o,r);try{e=JSON.parse(i.toString())}catch(e){n=e}return n?t(n):"success"!==e.status||e.error?t(new Error(e.error||"Request failed")):(delete e.status,void t(null,g=e))}),n},e.exports.getTestMessageUrl=function(e){if(!e||!e.response)return!1;let t=new Map;return e.response.replace(/\[([^\]]+)\]$/,(e,n)=>{n.replace(/\b([A-Z0-9]+)=([^\s]+)/g,(e,n,o)=>{t.set(n,o)})}),!(!t.has("STATUS")||!t.has("MSGID"))&&(g.web||m)+"/message/"+t.get("MSGID")}},function(e,t,n){"use strict";const o=n(9),i=n(63),r=n(243),s=n(337),a=n(340),c=n(344),l=n(4),p=n(27),u=n(79),d=n(345),h=n(66),m=n(62),f=n(16);e.exports=class extends o{constructor(e,t,n){super(),this.options=t||{},this._defaults=n||{},this._defaultPlugins={compile:[(...e)=>this._convertDataImages(...e)],stream:[]},this._userPlugins={compile:[],stream:[]},this.meta=new Map,this.dkim=!!this.options.dkim&&new a(this.options.dkim),this.transporter=e,this.transporter.mailer=this,this.logger=i.getLogger(this.options,{component:this.options.component||"mail"}),this.logger.debug({tnx:"create"},"Creating transport: %s",this.getVersionString()),"function"==typeof this.transporter.on&&(this.transporter.on("log",e=>{this.logger.debug({tnx:"transport"},"%s: %s",e.type,e.message)}),this.transporter.on("error",e=>{this.logger.error({err:e,tnx:"transport"},"Transport Error: %s",e.message),this.emit("error",e)}),this.transporter.on("idle",(...e)=>{this.emit("idle",...e)})),["close","isIdle","verify"].forEach(e=>{this[e]=(...t)=>"function"==typeof this.transporter[e]?this.transporter[e](...t):(this.logger.warn({tnx:"transport",methodName:e},"Non existing method %s called for transport",e),!1)}),this.options.proxy&&"string"==typeof this.options.proxy&&this.setupProxy(this.options.proxy)}use(e,t){return e=(e||"").toString(),this._userPlugins.hasOwnProperty(e)?this._userPlugins[e].push(t):this._userPlugins[e]=[t],this}sendMail(e,t){let n;t||(n=new Promise((e,n)=>{t=i.callbackPromise(e,n)})),"function"==typeof this.getSocket&&(this.transporter.getSocket=this.getSocket,this.getSocket=!1);let o=new d(this,e);return this.logger.debug({tnx:"transport",name:this.transporter.name,version:this.transporter.version,action:"send"},"Sending mail using %s/%s",this.transporter.name,this.transporter.version),this._processPlugins("compile",o,e=>{if(e)return this.logger.error({err:e,tnx:"plugin",action:"compile"},"PluginCompile Error: %s",e.message),t(e);o.message=new s(o.data).compile(),o.setMailerHeader(),o.setPriorityHeaders(),o.setListHeaders(),this._processPlugins("stream",o,e=>{if(e)return this.logger.error({err:e,tnx:"plugin",action:"stream"},"PluginStream Error: %s",e.message),t(e);(o.data.dkim||this.dkim)&&o.message.processFunc(e=>{let t=o.data.dkim?new a(o.data.dkim):this.dkim;return this.logger.debug({tnx:"DKIM",messageId:o.message.messageId(),dkimDomains:t.keys.map(e=>e.keySelector+"."+e.domainName).join(", ")},"Signing outgoing message with %s keys",t.keys.length),t.sign(e,o.data._dkim)}),this.transporter.send(o,(...e)=>{e[0]&&this.logger.error({err:e[0],tnx:"transport",action:"send"},"Send Error: %s",e[0].message),t(...e)})})}),n}getVersionString(){return l.format("%s (%s; +%s; %s/%s)",u.name,u.version,u.homepage,this.transporter.name,this.transporter.version)}_processPlugins(e,t,n){if(e=(e||"").toString(),!this._userPlugins.hasOwnProperty(e))return n();let o=this._userPlugins[e]||[],i=this._defaultPlugins[e]||[];if(o.length&&this.logger.debug({tnx:"transaction",pluginCount:o.length,step:e},"Using %s plugins for %s",o.length,e),o.length+i.length===0)return n();let r=0,s="default",a=()=>{let e="default"===s?i:o;if(r>=e.length){if("default"!==s||!o.length)return n();s="user",r=0,e=o}(0,e[r++])(t,e=>{if(e)return n(e);a()})};a()}setupProxy(e){let t=p.parse(e);this.getSocket=(e,n)=>{let o=t.protocol.replace(/:$/,"").toLowerCase();if(this.meta.has("proxy_handler_"+o))return this.meta.get("proxy_handler_"+o)(t,e,n);switch(o){case"http":case"https":return void c(t.href,e.port,e.host,(e,t)=>e?n(e):n(null,{connection:t}));case"socks":case"socks5":case"socks4":case"socks4a":{if(!this.meta.has("proxy_socks_module"))return n(new Error("Socks module not loaded"));let o=o=>{let i=!!this.meta.get("proxy_socks_module").SocksClient,r=i?this.meta.get("proxy_socks_module").SocksClient:this.meta.get("proxy_socks_module"),s=Number(t.protocol.replace(/\D/g,""))||5,a={proxy:{ipaddress:o,port:Number(t.port),type:s},[i?"destination":"target"]:{host:e.host,port:e.port},command:"connect"};if(t.auth){let e=decodeURIComponent(t.auth.split(":").shift()),n=decodeURIComponent(t.auth.split(":").pop());i?(a.userId=e,a.password=n):4===s?a.userid=e:a.authentication={username:e,password:n}}r.createConnection(a,(e,t)=>e?n(e):n(null,{connection:t.socket||t}))};return h.isIP(t.hostname)?o(t.hostname):m.resolve(t.hostname,(e,t)=>{if(e)return n(e);o(Array.isArray(t)?t[0]:t)})}}n(new Error("Unknown proxy configuration"))}}_convertDataImages(e,t){if(!this.options.attachDataUrls&&!e.data.attachDataUrls||!e.data.html)return t();e.resolveContent(e.data,"html",(n,o)=>{if(n)return t(n);let i=0;o=(o||"").toString().replace(/(<img\b[^>]* src\s*=[\s"']*)(data:([^;]+);[^"'>\s]+)/gi,(t,n,o,s)=>{let a=f.randomBytes(10).toString("hex")+"@localhost";return e.data.attachments||(e.data.attachments=[]),Array.isArray(e.data.attachments)||(e.data.attachments=[].concat(e.data.attachments||[])),e.data.attachments.push({path:o,cid:a,filename:"image-"+ ++i+"."+r.detectExtension(s)}),n+"cid:"+a}),e.data.html=o,t()})}set(e,t){return this.meta.set(e,t)}get(e){return this.meta.get(e)}}},function(e,t){e.exports=require("https")},function(e,t,n){"use strict";const o=n(27),i=1800;e.exports=class{constructor(e){this.options=e||{},this.cookies=[]}set(e,t){let n,r=o.parse(t||""),s=this.parse(e);return s.domain?(n=s.domain.replace(/^\./,""),(r.hostname.length<n.length||("."+r.hostname).substr(1-n.length)!=="."+n)&&(s.domain=r.hostname)):s.domain=r.hostname,s.path||(s.path=this.getPath(r.pathname)),s.expires||(s.expires=new Date(Date.now()+1e3*(Number(this.options.sessionTimeout||i)||i))),this.add(s)}get(e){return this.list(e).map(e=>e.name+"="+e.value).join("; ")}list(e){let t,n,o=[];for(t=this.cookies.length-1;t>=0;t--)n=this.cookies[t],this.isExpired(n)?this.cookies.splice(t,t):this.match(n,e)&&o.unshift(n);return o}parse(e){let t={};return(e||"").toString().split(";").forEach(e=>{let n,o=e.split("="),i=o.shift().trim().toLowerCase(),r=o.join("=").trim();if(i)switch(i){case"expires":"Invalid Date"!==(r=new Date(r)).toString()&&(t.expires=r);break;case"path":t.path=r;break;case"domain":(n=r.toLowerCase()).length&&"."!==n.charAt(0)&&(n="."+n),t.domain=n;break;case"max-age":t.expires=new Date(Date.now()+1e3*(Number(r)||0));break;case"secure":t.secure=!0;break;case"httponly":t.httponly=!0;break;default:t.name||(t.name=i,t.value=r)}}),t}match(e,t){let n=o.parse(t||"");return(n.hostname===e.domain||"."===e.domain.charAt(0)&&("."+n.hostname).substr(-e.domain.length)===e.domain)&&(this.getPath(n.pathname).substr(0,e.path.length)===e.path&&(!e.secure||"https:"===n.protocol))}add(e){let t,n;if(!e||!e.name)return!1;for(t=0,n=this.cookies.length;t<n;t++)if(this.compare(this.cookies[t],e))return this.isExpired(e)?(this.cookies.splice(t,1),!1):(this.cookies[t]=e,!0);return this.isExpired(e)||this.cookies.push(e),!0}compare(e,t){return e.name===t.name&&e.path===t.path&&e.domain===t.domain&&e.secure===t.secure&&e.httponly==e.httponly}isExpired(e){return e.expires&&e.expires<new Date||!e.value}getPath(e){let t=(e||"/").split("/");return t.pop(),"/"!==(t=t.join("/").trim()).charAt(0)&&(t="/"+t),"/"!==t.substr(-1)&&(t+="/"),t}}},function(e,t,n){"use strict";const o=n(244),i=n(217);e.exports=class{constructor(e){this.mail=e||{},this.message=!1}compile(){return this._alternatives=this.getAlternatives(),this._htmlNode=this._alternatives.filter(e=>/^text\/html\b/i.test(e.contentType)).pop(),this._attachments=this.getAttachments(!!this._htmlNode),this._useRelated=!(!this._htmlNode||!this._attachments.related.length),this._useAlternative=this._alternatives.length>1,this._useMixed=this._attachments.attached.length>1||this._alternatives.length&&1===this._attachments.attached.length,this.mail.raw?this.message=(new o).setRaw(this.mail.raw):this._useMixed?this.message=this._createMixed():this._useAlternative?this.message=this._createAlternative():this._useRelated?this.message=this._createRelated():this.message=this._createContentNode(!1,[].concat(this._alternatives||[]).concat(this._attachments.attached||[]).shift()||{contentType:"text/plain",content:""}),this.mail.headers&&this.message.addHeader(this.mail.headers),["from","sender","to","cc","bcc","reply-to","in-reply-to","references","subject","message-id","date"].forEach(e=>{let t=e.replace(/-(\w)/g,(e,t)=>t.toUpperCase());this.mail[t]&&this.message.setHeader(e,this.mail[t])}),this.mail.envelope&&this.message.setEnvelope(this.mail.envelope),this.message.messageId(),this.message}getAttachments(e){let t,n,o=[].concat(this.mail.attachments||[]).map((e,t)=>{let n,o=/^message\//i.test(e.contentType);return/^data:/i.test(e.path||e.href)&&(e=this._processDataUrl(e)),n={contentType:e.contentType||i.detectMimeType(e.filename||e.path||e.href||"bin"),contentDisposition:e.contentDisposition||(o?"inline":"attachment"),contentTransferEncoding:"contentTransferEncoding"in e?e.contentTransferEncoding:"base64"},e.filename?n.filename=e.filename:o||!1===e.filename||(n.filename=(e.path||e.href||"").split("/").pop().split("?").shift()||"attachment-"+(t+1),n.filename.indexOf(".")<0&&(n.filename+="."+i.detectExtension(n.contentType))),/^https?:\/\//i.test(e.path)&&(e.href=e.path,e.path=void 0),e.cid&&(n.cid=e.cid),e.raw?n.raw=e.raw:e.path?n.content={path:e.path}:e.href?n.content={href:e.href,httpHeaders:e.httpHeaders}:n.content=e.content||"",e.encoding&&(n.encoding=e.encoding),e.headers&&(n.headers=e.headers),n});return this.mail.icalEvent&&(t="object"==typeof this.mail.icalEvent&&(this.mail.icalEvent.content||this.mail.icalEvent.path||this.mail.icalEvent.href||this.mail.icalEvent.raw)?this.mail.icalEvent:{content:this.mail.icalEvent},n={},Object.keys(t).forEach(e=>{n[e]=t[e]}),n.contentType="application/ics",n.headers||(n.headers={}),n.filename=n.filename||"invite.ics",n.headers["Content-Disposition"]="attachment",n.headers["Content-Transfer-Encoding"]="base64"),e?{attached:o.filter(e=>!e.cid).concat(n||[]),related:o.filter(e=>!!e.cid)}:{attached:o.concat(n||[]),related:[]}}getAlternatives(){let e,t,n,o,r,s,a=[];return this.mail.text&&((e="object"==typeof this.mail.text&&(this.mail.text.content||this.mail.text.path||this.mail.text.href||this.mail.text.raw)?this.mail.text:{content:this.mail.text}).contentType="text/plain"+(!e.encoding&&i.isPlainText(e.content)?"":"; charset=utf-8")),this.mail.watchHtml&&((n="object"==typeof this.mail.watchHtml&&(this.mail.watchHtml.content||this.mail.watchHtml.path||this.mail.watchHtml.href||this.mail.watchHtml.raw)?this.mail.watchHtml:{content:this.mail.watchHtml}).contentType="text/watch-html"+(!n.encoding&&i.isPlainText(n.content)?"":"; charset=utf-8")),this.mail.amp&&((o="object"==typeof this.mail.amp&&(this.mail.amp.content||this.mail.amp.path||this.mail.amp.href||this.mail.amp.raw)?this.mail.amp:{content:this.mail.amp}).contentType="text/x-amp-html"+(!o.encoding&&i.isPlainText(o.content)?"":"; charset=utf-8")),!this.mail.icalEvent||this.mail.attachments&&this.mail.attachments.length||(r="object"==typeof this.mail.icalEvent&&(this.mail.icalEvent.content||this.mail.icalEvent.path||this.mail.icalEvent.href||this.mail.icalEvent.raw)?this.mail.icalEvent:{content:this.mail.icalEvent},s={},Object.keys(r).forEach(e=>{s[e]=r[e]}),s.content&&"object"==typeof s.content&&(s.content._resolve=!0),s.filename=!1,s.contentType='text/calendar; charset="utf-8"; method='+(s.method||"PUBLISH").toString().trim().toUpperCase(),s.headers||(s.headers={})),this.mail.html&&((t="object"==typeof this.mail.html&&(this.mail.html.content||this.mail.html.path||this.mail.html.href||this.mail.html.raw)?this.mail.html:{content:this.mail.html}).contentType="text/html"+(!t.encoding&&i.isPlainText(t.content)?"":"; charset=utf-8")),[].concat(e||[]).concat(n||[]).concat(o||[]).concat(t||[]).concat(s||[]).concat(this.mail.alternatives||[]).forEach(e=>{let t;/^data:/i.test(e.path||e.href)&&(e=this._processDataUrl(e)),t={contentType:e.contentType||i.detectMimeType(e.filename||e.path||e.href||"txt"),contentTransferEncoding:e.contentTransferEncoding},e.filename&&(t.filename=e.filename),/^https?:\/\//i.test(e.path)&&(e.href=e.path,e.path=void 0),e.raw?t.raw=e.raw:e.path?t.content={path:e.path}:e.href?t.content={href:e.href}:t.content=e.content||"",e.encoding&&(t.encoding=e.encoding),e.headers&&(t.headers=e.headers),a.push(t)}),a}_createMixed(e){let t;return t=e?e.createChild("multipart/mixed",{disableUrlAccess:this.mail.disableUrlAccess,disableFileAccess:this.mail.disableFileAccess,normalizeHeaderKey:this.mail.normalizeHeaderKey}):new o("multipart/mixed",{baseBoundary:this.mail.baseBoundary,textEncoding:this.mail.textEncoding,boundaryPrefix:this.mail.boundaryPrefix,disableUrlAccess:this.mail.disableUrlAccess,disableFileAccess:this.mail.disableFileAccess,normalizeHeaderKey:this.mail.normalizeHeaderKey}),this._useAlternative?this._createAlternative(t):this._useRelated&&this._createRelated(t),[].concat(!this._useAlternative&&this._alternatives||[]).concat(this._attachments.attached||[]).forEach(e=>{this._useRelated&&e===this._htmlNode||this._createContentNode(t,e)}),t}_createAlternative(e){let t;return t=e?e.createChild("multipart/alternative",{disableUrlAccess:this.mail.disableUrlAccess,disableFileAccess:this.mail.disableFileAccess,normalizeHeaderKey:this.mail.normalizeHeaderKey}):new o("multipart/alternative",{baseBoundary:this.mail.baseBoundary,textEncoding:this.mail.textEncoding,boundaryPrefix:this.mail.boundaryPrefix,disableUrlAccess:this.mail.disableUrlAccess,disableFileAccess:this.mail.disableFileAccess,normalizeHeaderKey:this.mail.normalizeHeaderKey}),this._alternatives.forEach(e=>{this._useRelated&&this._htmlNode===e?this._createRelated(t):this._createContentNode(t,e)}),t}_createRelated(e){let t;return t=e?e.createChild('multipart/related; type="text/html"',{disableUrlAccess:this.mail.disableUrlAccess,disableFileAccess:this.mail.disableFileAccess,normalizeHeaderKey:this.mail.normalizeHeaderKey}):new o('multipart/related; type="text/html"',{baseBoundary:this.mail.baseBoundary,textEncoding:this.mail.textEncoding,boundaryPrefix:this.mail.boundaryPrefix,disableUrlAccess:this.mail.disableUrlAccess,disableFileAccess:this.mail.disableFileAccess,normalizeHeaderKey:this.mail.normalizeHeaderKey}),this._createContentNode(t,this._htmlNode),this._attachments.related.forEach(e=>this._createContentNode(t,e)),t}_createContentNode(e,t){let n;(t=t||{}).content=t.content||"";let i=(t.encoding||"utf8").toString().toLowerCase().replace(/[-_\s]/g,"");return n=e?e.createChild(t.contentType,{filename:t.filename,disableUrlAccess:this.mail.disableUrlAccess,disableFileAccess:this.mail.disableFileAccess,normalizeHeaderKey:this.mail.normalizeHeaderKey}):new o(t.contentType,{filename:t.filename,baseBoundary:this.mail.baseBoundary,textEncoding:this.mail.textEncoding,boundaryPrefix:this.mail.boundaryPrefix,disableUrlAccess:this.mail.disableUrlAccess,disableFileAccess:this.mail.disableFileAccess}),t.headers&&n.addHeader(t.headers),t.cid&&n.setHeader("Content-Id","<"+t.cid.replace(/[<>]/g,"")+">"),t.contentTransferEncoding?n.setHeader("Content-Transfer-Encoding",t.contentTransferEncoding):this.mail.encoding&&/^text\//i.test(t.contentType)&&n.setHeader("Content-Transfer-Encoding",this.mail.encoding),/^text\//i.test(t.contentType)&&!t.contentDisposition||n.setHeader("Content-Disposition",t.contentDisposition||(t.cid?"inline":"attachment")),"string"!=typeof t.content||["utf8","usascii","ascii"].includes(i)||(t.content=Buffer.from(t.content,i)),t.raw?n.setRaw(t.raw):n.setContent(t.content),n}_processDataUrl(e){let t=(e.path||e.href).match(/^data:((?:[^;]*;)*(?:[^,]*)),(.*)$/i);return t?(e.content=/\bbase64$/i.test(t[1])?Buffer.from(t[2],"base64"):Buffer.from(decodeURIComponent(t[2])),"path"in e&&(e.path=!1),"href"in e&&(e.href=!1),t[1].split(";").forEach(t=>{/^\w+\/[^/]+$/i.test(t)&&(e.contentType=e.contentType||t.toLowerCase())}),e):e}}},function(e,t,n){"use strict";class o{constructor(e){this.str=(e||"").toString(),this.operatorCurrent="",this.operatorExpecting="",this.node=null,this.escaped=!1,this.list=[],this.operators={'"':'"',"(":")","<":">",",":"",":":";",";":""}}tokenize(){let e,t=[];for(let t=0,n=this.str.length;t<n;t++)e=this.str.charAt(t),this.checkChar(e);return this.list.forEach(e=>{e.value=(e.value||"").toString().trim(),e.value&&t.push(e)}),t}checkChar(e){if((e in this.operators||"\\"===e)&&this.escaped)this.escaped=!1;else{if(this.operatorExpecting&&e===this.operatorExpecting)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting="",void(this.escaped=!1);if(!this.operatorExpecting&&e in this.operators)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting=this.operators[e],void(this.escaped=!1)}this.escaped||"\\"!==e?(this.node||(this.node={type:"text",value:""},this.list.push(this.node)),this.escaped&&"\\"!==e&&(this.node.value+="\\"),this.node.value+=e,this.escaped=!1):this.escaped=!0}}function i(e,t){t=t||{};let n=new o(e).tokenize(),r=[],s=[],a=[];if(n.forEach(e=>{"operator"!==e.type||","!==e.value&&";"!==e.value?s.push(e):(s.length&&r.push(s),s=[])}),s.length&&r.push(s),r.forEach(e=>{(e=function(e){let t,n,o,r,s=!1,a="text",c=[],l={address:[],comment:[],group:[],text:[]};for(o=0,r=e.length;o<r;o++)if("operator"===(t=e[o]).type)switch(t.value){case"<":a="address";break;case"(":a="comment";break;case":":a="group",s=!0;break;default:a="text"}else t.value&&("address"===a&&(t.value=t.value.replace(/^[^<]*<\s*/,"")),l[a].push(t.value));if(!l.text.length&&l.comment.length&&(l.text=l.comment,l.comment=[]),s)l.text=l.text.join(" "),c.push({name:l.text||n&&n.name,group:l.group.length?i(l.group.join(",")):[]});else{if(!l.address.length&&l.text.length){for(o=l.text.length-1;o>=0;o--)if(l.text[o].match(/^[^@\s]+@[^@\s]+$/)){l.address=l.text.splice(o,1);break}let e=function(e){return l.address.length?e:(l.address=[e.trim()]," ")};if(!l.address.length)for(o=l.text.length-1;o>=0&&(l.text[o]=l.text[o].replace(/\s*\b[^@\s]+@[^\s]+\b\s*/,e).trim(),!l.address.length);o--);}if(!l.text.length&&l.comment.length&&(l.text=l.comment,l.comment=[]),l.address.length>1&&(l.text=l.text.concat(l.address.splice(1))),l.text=l.text.join(" "),l.address=l.address.join(" "),!l.address&&s)return[];(n={address:l.address||l.text||"",name:l.text||l.address||""}).address===n.name&&((n.address||"").match(/@/)?n.name="":n.address=""),c.push(n)}return c}(e)).length&&(a=a.concat(e))}),t.flatten){let e=[],t=n=>{n.forEach(n=>{if(n.group)return t(n.group);e.push(n)})};return t(a),e}return a}e.exports=i},function(e,t,n){"use strict";const o=n(14).Transform;e.exports=class extends o{constructor(){super(),this.lastByte=!1}_transform(e,t,n){e.length&&(this.lastByte=e[e.length-1]),this.push(e),n()}_flush(e){return 10===this.lastByte?e():13===this.lastByte?(this.push(Buffer.from("\n")),e()):(this.push(Buffer.from("\r\n")),e())}}},function(e,t,n){"use strict";const o=n(341),i=n(342),r=n(343),s=n(14).PassThrough,a=n(20),c=n(23),l=n(16),p="sha256",u=131072;class d{constructor(e,t,n,o){this.options=e||{},this.keys=t,this.cacheTreshold=Number(this.options.cacheTreshold)||u,this.hashAlgo=this.options.hashAlgo||p,this.cacheDir=this.options.cacheDir||!1,this.chunks=[],this.chunklen=0,this.readPos=0,this.cachePath=!!this.cacheDir&&c.join(this.cacheDir,"message."+Date.now()+"-"+l.randomBytes(14).toString("hex")),this.cache=!1,this.headers=!1,this.bodyHash=!1,this.parser=!1,this.relaxedBody=!1,this.input=n,this.output=o,this.output.usingCache=!1,this.errored=!1,this.input.on("error",e=>{this.errored=!0,this.cleanup(),o.emit("error",e)})}cleanup(){this.cache&&this.cachePath&&a.unlink(this.cachePath,()=>!1)}createReadCache(){this.cache=a.createReadStream(this.cachePath),this.cache.once("error",e=>{this.cleanup(),this.output.emit("error",e)}),this.cache.once("close",()=>{this.cleanup()}),this.cache.pipe(this.output)}sendNextChunk(){if(this.errored)return;if(this.readPos>=this.chunks.length)return this.cache?this.createReadCache():this.output.end();let e=this.chunks[this.readPos++];if(!1===this.output.write(e))return this.output.once("drain",()=>{this.sendNextChunk()});setImmediate(()=>this.sendNextChunk())}sendSignedOutput(){let e=0,t=()=>{if(e>=this.keys.length)return this.output.write(this.parser.rawHeaders),setImmediate(()=>this.sendNextChunk());let n=this.keys[e++],o=r(this.headers,this.hashAlgo,this.bodyHash,{domainName:n.domainName,keySelector:n.keySelector,privateKey:n.privateKey,headerFieldNames:this.options.headerFieldNames,skipFields:this.options.skipFields});return o&&this.output.write(Buffer.from(o+"\r\n")),setImmediate(t)};if(this.bodyHash&&this.headers)return t();this.output.write(this.parser.rawHeaders),this.sendNextChunk()}createWriteCache(){this.output.usingCache=!0,this.cache=a.createWriteStream(this.cachePath),this.cache.once("error",e=>{this.cleanup(),this.relaxedBody.unpipe(this.cache),this.relaxedBody.on("readable",()=>{for(;null!==this.relaxedBody.read(););}),this.errored=!0,this.output.emit("error",e)}),this.cache.once("close",()=>{this.sendSignedOutput()}),this.relaxedBody.removeAllListeners("readable"),this.relaxedBody.pipe(this.cache)}signStream(){this.parser=new o,this.relaxedBody=new i({hashAlgo:this.hashAlgo}),this.parser.on("headers",e=>{this.headers=e}),this.relaxedBody.on("hash",e=>{this.bodyHash=e}),this.relaxedBody.on("readable",()=>{let e;if(!this.cache)for(;null!==(e=this.relaxedBody.read());)if(this.chunks.push(e),this.chunklen+=e.length,this.chunklen>=this.cacheTreshold&&this.cachePath)return this.createWriteCache()}),this.relaxedBody.on("end",()=>{this.cache||this.sendSignedOutput()}),this.parser.pipe(this.relaxedBody),setImmediate(()=>this.input.pipe(this.parser))}}e.exports=class{constructor(e){this.options=e||{},this.keys=[].concat(this.options.keys||{domainName:e.domainName,keySelector:e.keySelector,privateKey:e.privateKey})}sign(e,t){let n=new s,o=e,i=!1;Buffer.isBuffer(e)?(i=e,o=new s):"string"==typeof e&&(i=Buffer.from(e),o=new s);let r=this.options;t&&Object.keys(t).length&&(r={},Object.keys(this.options||{}).forEach(e=>{r[e]=this.options[e]}),Object.keys(t||{}).forEach(e=>{e in r||(r[e]=t[e])}));let a=new d(r,this.keys,o,n);return setImmediate(()=>{a.signStream(),i&&setImmediate(()=>{o.end(i)})}),n}}},function(e,t,n){"use strict";const o=n(14).Transform;e.exports=class extends o{constructor(e){super(e),this.lastBytes=Buffer.alloc(4),this.headersParsed=!1,this.headerBytes=0,this.headerChunks=[],this.rawHeaders=!1,this.bodySize=0}updateLastBytes(e){let t=this.lastBytes.length,n=Math.min(e.length,t);for(let e=0,o=t-n;e<o;e++)this.lastBytes[e]=this.lastBytes[e+n];for(let o=1;o<=n;o++)this.lastBytes[t-o]=e[e.length-o]}checkHeaders(e){if(this.headersParsed)return!0;let t=this.lastBytes.length,n=0;this.curLinePos=0;for(let o=0,i=this.lastBytes.length+e.length;o<i;o++){let i;if(10===(i=o<t?this.lastBytes[o]:e[o-t])&&o){let i=o-1<t?this.lastBytes[o-1]:e[o-1-t],r=o>1&&(o-2<t?this.lastBytes[o-2]:e[o-2-t]);if(10===i){this.headersParsed=!0,n=o-t+1,this.headerBytes+=n;break}if(13===i&&10===r){this.headersParsed=!0,n=o-t+1,this.headerBytes+=n;break}}}if(this.headersParsed){if(this.headerChunks.push(e.slice(0,n)),this.rawHeaders=Buffer.concat(this.headerChunks,this.headerBytes),this.headerChunks=null,this.emit("headers",this.parseHeaders()),e.length-1>n){let t=e.slice(n);this.bodySize+=t.length,setImmediate(()=>this.push(t))}return!1}return this.headerBytes+=e.length,this.headerChunks.push(e),this.updateLastBytes(e),!1}_transform(e,t,n){if(!e||!e.length)return n();let o;"string"==typeof e&&(e=Buffer.from(e,t));try{o=this.checkHeaders(e)}catch(e){return n(e)}o&&(this.bodySize+=e.length,this.push(e)),setImmediate(n)}_flush(e){if(this.headerChunks){let e=Buffer.concat(this.headerChunks,this.headerBytes);this.bodySize+=e.length,this.push(e),this.headerChunks=null}e()}parseHeaders(){let e=(this.rawHeaders||"").toString().split(/\r?\n/);for(let t=e.length-1;t>0;t--)/^\s/.test(e[t])&&(e[t-1]+="\n"+e[t],e.splice(t,1));return e.filter(e=>e.trim()).map(e=>({key:e.substr(0,e.indexOf(":")).trim().toLowerCase(),line:e}))}}},function(e,t,n){"use strict";const o=n(14).Transform,i=n(16);e.exports=class extends o{constructor(e){super(),e=e||{},this.chunkBuffer=[],this.chunkBufferLen=0,this.bodyHash=i.createHash(e.hashAlgo||"sha1"),this.remainder="",this.byteLength=0,this.debug=e.debug,this._debugBody=!!e.debug&&[]}updateHash(e){let t,n="",o="file";for(let t=e.length-1;t>=0;t--){let i=e[t];if("file"!==o||10!==i&&13!==i)if("file"!==o||9!==i&&32!==i)if("line"!==o||9!==i&&32!==i){if(("file"===o||"line"===o)&&(o="body",t===e.length-1))break}else;else o="line";else;if(0===t){if("file"===o&&(!this.remainder||/[\r\n]$/.test(this.remainder))||"line"===o&&(!this.remainder||/[ \t]$/.test(this.remainder)))return void(this.remainder+=e.toString("binary"));if("line"===o||"file"===o){n=e.toString("binary"),e=!1;break}}if("body"===o){n=e.slice(t+1).toString("binary"),e=e.slice(0,t+1);break}}let i=!!this.remainder;if(e&&!i)for(let t=0,n=e.length;t<n;t++){if(t&&10===e[t]&&13!==e[t-1]){i=!0;break}if(t&&13===e[t]&&32===e[t-1]){i=!0;break}if(t&&32===e[t]&&32===e[t-1]){i=!0;break}if(9===e[t]){i=!0;break}}i?(t=this.remainder+(e?e.toString("binary"):""),this.remainder=n,t=t.replace(/\r?\n/g,"\n").replace(/[ \t]*$/gm,"").replace(/[ \t]+/gm," ").replace(/\n/g,"\r\n"),e=Buffer.from(t,"binary")):n&&(this.remainder=n),this.debug&&this._debugBody.push(e),this.bodyHash.update(e)}_transform(e,t,n){if(!e||!e.length)return n();"string"==typeof e&&(e=Buffer.from(e,t)),this.updateHash(e),this.byteLength+=e.length,this.push(e),n()}_flush(e){/[\r\n]$/.test(this.remainder)&&this.byteLength>2&&this.bodyHash.update(Buffer.from("\r\n")),this.byteLength||this.push(Buffer.from("\r\n")),this.emit("hash",this.bodyHash.digest("base64"),!!this.debug&&Buffer.concat(this._debugBody)),e()}}},function(e,t,n){"use strict";const o=n(245),i=n(217),r=n(16);function s(e,t,n){let o=new Set,i=new Set,r=new Map;(n||"").toLowerCase().split(":").forEach(e=>{i.add(e.trim())}),(t||"").toLowerCase().split(":").filter(e=>!i.has(e.trim())).forEach(e=>{o.add(e.trim())});for(let t=e.length-1;t>=0;t--){let n=e[t];o.has(n.key)&&!r.has(n.key)&&r.set(n.key,a(n.line))}let s=[],c=[];return o.forEach(e=>{r.has(e)&&(c.push(e),s.push(e+":"+r.get(e)))}),{headers:s.join("\r\n")+"\r\n",fieldNames:c.join(":")}}function a(e){return e.substr(e.indexOf(":")+1).replace(/\r?\n/g,"").replace(/\s+/g," ").trim()}e.exports=(e,t,n,c)=>{let l,p,u=s(e,(c=c||{}).headerFieldNames||"From:Sender:Reply-To:Subject:Date:Message-ID:To:Cc:MIME-Version:Content-Type:Content-Transfer-Encoding:Content-ID:Content-Description:Resent-Date:Resent-From:Resent-Sender:Resent-To:Resent-Cc:Resent-Message-ID:In-Reply-To:References:List-Id:List-Help:List-Unsubscribe:List-Subscribe:List-Post:List-Owner:List-Archive",c.skipFields),d=function(e,t,n,r,s){let a=["v=1","a=rsa-"+r,"c=relaxed/relaxed","d="+o.toASCII(e),"q=dns/txt","s="+t,"bh="+s,"h="+n].join("; ");return i.foldLines("DKIM-Signature: "+a,76)+";\r\n b="}(c.domainName,c.keySelector,u.fieldNames,t,n);u.headers+="dkim-signature:"+a(d),(l=r.createSign(("rsa-"+t).toUpperCase())).update(u.headers);try{p=l.sign(c.privateKey,"base64")}catch(e){return!1}return d+p.replace(/(^.{73}|.{75}(?!\r?\n|\r))/g,"$&\r\n ").trim()},e.exports.relaxedHeaders=s},function(e,t,n){"use strict";const o=n(66),i=n(77),r=n(27);e.exports=function(e,t,n,s){let a,c,l,p=r.parse(e);a={host:p.hostname,port:Number(p.port)?Number(p.port):"https:"===p.protocol?443:80},"https:"===p.protocol?(a.rejectUnauthorized=!1,c=i.connect.bind(i)):c=o.connect.bind(o);let u=!1,d=function(e){if(!u){u=!0;try{l.destroy()}catch(e){}s(e)}};(l=c(a,()=>{if(u)return;let e={Host:n+":"+t,Connection:"close"};p.auth&&(e["Proxy-Authorization"]="Basic "+Buffer.from(p.auth).toString("base64")),l.write("CONNECT "+n+":"+t+" HTTP/1.1\r\n"+Object.keys(e).map(t=>t+": "+e[t]).join("\r\n")+"\r\n\r\n");let o="",i=e=>{let t,n;if(!u&&(t=(o+=e.toString("binary")).match(/\r\n\r\n/))){if(l.removeListener("data",i),n=o.substr(t.index+t[0].length),o=o.substr(0,t.index),n&&l.unshift(Buffer.from(n,"binary")),u=!0,!(t=o.match(/^HTTP\/\d+\.\d+ (\d+)/i))||"2"!==(t[1]||"").charAt(0)){try{l.destroy()}catch(e){}return s(new Error("Invalid response from proxy"+(t&&": "+t[1]||"")))}return l.removeListener("error",d),s(null,l)}};l.on("data",i)})).once("error",d)}},function(e,t,n){"use strict";const o=n(63),i=n(244),r=n(217);e.exports=class{constructor(e,t){this.mailer=e,this.data={},this.message=null,t=t||{};let n=e.options||{},o=e._defaults||{};Object.keys(t).forEach(e=>{this.data[e]=t[e]}),this.data.headers=this.data.headers||{},Object.keys(o).forEach(e=>{e in this.data?"headers"===e&&Object.keys(o.headers).forEach(e=>{e in this.data.headers||(this.data.headers[e]=o.headers[e])}):this.data[e]=o[e]}),["disableFileAccess","disableUrlAccess","normalizeHeaderKey"].forEach(e=>{e in n&&(this.data[e]=n[e])})}resolveContent(...e){return o.resolveContent(...e)}resolveAll(e){let t=[[this.data,"html"],[this.data,"text"],[this.data,"watchHtml"],[this.data,"amp"],[this.data,"icalEvent"]];this.data.alternatives&&this.data.alternatives.length&&this.data.alternatives.forEach((e,n)=>{t.push([this.data.alternatives,n])}),this.data.attachments&&this.data.attachments.length&&this.data.attachments.forEach((e,n)=>{e.filename||(e.filename=(e.path||e.href||"").split("/").pop().split("?").shift()||"attachment-"+(n+1),e.filename.indexOf(".")<0&&(e.filename+="."+r.detectExtension(e.contentType))),e.contentType||(e.contentType=r.detectMimeType(e.filename||e.path||e.href||"bin")),t.push([this.data.attachments,n])});let n=new i;["from","to","cc","bcc","sender","replyTo"].forEach(e=>{let t;this.message?t=[].concat(n._parseAddresses(this.message.getHeader("replyTo"===e?"reply-to":e))||[]):this.data[e]&&(t=[].concat(n._parseAddresses(this.data[e])||[])),t&&t.length?this.data[e]=t:e in this.data&&(this.data[e]=null)});["from","sender","replyTo"].forEach(e=>{this.data[e]&&(this.data[e]=this.data[e].shift())});let s=0,a=()=>{if(s>=t.length)return e(null,this.data);let n=t[s++];if(!n[0]||!n[0][n[1]])return a();o.resolveContent(...n,(t,o)=>{if(t)return e(t);let i={content:o};n[0][n[1]]&&"object"==typeof n[0][n[1]]&&!Buffer.isBuffer(n[0][n[1]])&&Object.keys(n[0][n[1]]).forEach(e=>{e in i||["content","path","href","raw"].includes(e)||(i[e]=n[0][n[1]][e])}),n[0][n[1]]=i,a()})};setImmediate(()=>a())}normalize(e){let t=this.data.envelope||this.message.getEnvelope(),n=this.message.messageId();this.resolveAll((o,i)=>{if(o)return e(o);if(i.envelope=t,i.messageId=n,["html","text","watchHtml","amp"].forEach(e=>{i[e]&&i[e].content&&("string"==typeof i[e].content?i[e]=i[e].content:Buffer.isBuffer(i[e].content)&&(i[e]=i[e].content.toString()))}),i.icalEvent&&Buffer.isBuffer(i.icalEvent.content)&&(i.icalEvent.content=i.icalEvent.content.toString("base64"),i.icalEvent.encoding="base64"),i.alternatives&&i.alternatives.length&&i.alternatives.forEach(e=>{e&&e.content&&Buffer.isBuffer(e.content)&&(e.content=e.content.toString("base64"),e.encoding="base64")}),i.attachments&&i.attachments.length&&i.attachments.forEach(e=>{e&&e.content&&Buffer.isBuffer(e.content)&&(e.content=e.content.toString("base64"),e.encoding="base64")}),i.normalizedHeaders={},Object.keys(i.headers||{}).forEach(e=>{let t=[].concat(i.headers[e]||[]).shift();(t=t&&t.value||t)&&(["references","in-reply-to","message-id","content-id"].includes(e)&&(t=this.message._encodeHeaderValue(e,t)),i.normalizedHeaders[e]=t)}),i.list&&"object"==typeof i.list){this._getListHeaders(i.list).forEach(e=>{i.normalizedHeaders[e.key]=e.value.map(e=>e&&e.value||e).join(", ")})}return i.references&&(i.normalizedHeaders.references=this.message._encodeHeaderValue("references",i.references)),i.inReplyTo&&(i.normalizedHeaders["in-reply-to"]=this.message._encodeHeaderValue("in-reply-to",i.inReplyTo)),e(null,i)})}setMailerHeader(){this.message&&this.data.xMailer&&this.message.setHeader("X-Mailer",this.data.xMailer)}setPriorityHeaders(){if(this.message&&this.data.priority)switch((this.data.priority||"").toString().toLowerCase()){case"high":this.message.setHeader("X-Priority","1 (Highest)"),this.message.setHeader("X-MSMail-Priority","High"),this.message.setHeader("Importance","High");break;case"low":this.message.setHeader("X-Priority","5 (Lowest)"),this.message.setHeader("X-MSMail-Priority","Low"),this.message.setHeader("Importance","Low")}}setListHeaders(){this.message&&this.data.list&&"object"==typeof this.data.list&&this.data.list&&"object"==typeof this.data.list&&this._getListHeaders(this.data.list).forEach(e=>{e.value.forEach(t=>{this.message.addHeader(e.key,t)})})}_getListHeaders(e){return Object.keys(e).map(t=>({key:"list-"+t.toLowerCase().trim(),value:[].concat(e[t]||[]).map(e=>({prepared:!0,foldLines:!0,value:[].concat(e||[]).map(e=>{if("string"==typeof e&&(e={url:e}),e&&e.url){if("id"===t.toLowerCase().trim()){let t=e.comment||"";return t=r.isPlainText(t)?'"'+t+'"':r.encodeWord(t),(e.comment?t+" ":"")+this._formatListUrl(e.url).replace(/^<[^:]+\/{,2}/,"")}let n=e.comment||"";return r.isPlainText(n)||(n=r.encodeWord(n)),this._formatListUrl(e.url)+(e.comment?" ("+n+")":"")}return""}).filter(e=>e).join(", ")}))}))}_formatListUrl(e){return e=e.replace(/[\s<]+|[\s>]+/g,""),/^(https?|mailto|ftp):/.test(e)?"<"+e+">":/^[^@]+@[^@]+$/.test(e)?"<mailto:"+e+">":"<http://"+e+">"}}},function(e,t,n){"use strict";const o=n(9),i=n(347),r=n(222),s=n(249),a=n(63),c=n(79);e.exports=class extends o{constructor(e){let t;super(),"string"==typeof(e=e||{})&&(e={url:e});let n=e.service;"function"==typeof e.getSocket&&(this.getSocket=e.getSocket),e.url&&(t=a.parseConnectionUrl(e.url),n=n||t.service),this.options=a.assign(!1,e,t,n&&s(n)),this.options.maxConnections=this.options.maxConnections||5,this.options.maxMessages=this.options.maxMessages||100,this.logger=a.getLogger(this.options,{component:this.options.component||"smtp-pool"});let o=new r(this.options);this.name="SMTP (pool)",this.version=c.version+"[client:"+o.version+"]",this._rateLimit={counter:0,timeout:null,waiting:[],checkpoint:!1,delta:Number(this.options.rateDelta)||1e3,limit:Number(this.options.rateLimit)||0},this._closed=!1,this._queue=[],this._connections=[],this._connectionCounter=0,this.idling=!0,setImmediate(()=>{this.idling&&this.emit("idle")})}getSocket(e,t){return setImmediate(()=>t(null,!1))}send(e,t){return!this._closed&&(this._queue.push({mail:e,callback:t}),this.idling&&this._queue.length>=this.options.maxConnections&&(this.idling=!1),setImmediate(()=>this._processMessages()),!0)}close(){let e,t=this._connections.length;if(this._closed=!0,clearTimeout(this._rateLimit.timeout),!t&&!this._queue.length)return;for(let n=t-1;n>=0;n--)this._connections[n]&&this._connections[n].available&&((e=this._connections[n]).close(),this.logger.info({tnx:"connection",cid:e.id,action:"removed"},"Connection #%s removed",e.id));if(t&&!this._connections.length&&this.logger.debug({tnx:"connection"},"All connections removed"),!this._queue.length)return;let n=()=>{if(!this._queue.length)return void this.logger.debug({tnx:"connection"},"Pending queue entries cleared");let t=this._queue.shift();if(t&&"function"==typeof t.callback)try{t.callback(new Error("Connection pool was closed"))}catch(t){this.logger.error({err:t,tnx:"callback",cid:e.id},"Callback error for #%s: %s",e.id,t.message)}setImmediate(n)};setImmediate(n)}_processMessages(){let e,t,n;if(this._closed)return;if(!this._queue.length)return void(this.idling||(this.idling=!0,this.emit("idle")));for(t=0,n=this._connections.length;t<n;t++)if(this._connections[t].available){e=this._connections[t];break}if(!e&&this._connections.length<this.options.maxConnections&&(e=this._createConnection()),!e)return void(this.idling=!1);!this.idling&&this._queue.length<this.options.maxConnections&&(this.idling=!0,this.emit("idle"));let o=e.queueEntry=this._queue.shift();o.messageId=(e.queueEntry.mail.message.getHeader("message-id")||"").replace(/[<>\s]/g,""),e.available=!1,this.logger.debug({tnx:"pool",cid:e.id,messageId:o.messageId,action:"assign"},"Assigned message <%s> to #%s (%s)",o.messageId,e.id,e.messages+1),this._rateLimit.limit&&(this._rateLimit.counter++,this._rateLimit.checkpoint||(this._rateLimit.checkpoint=Date.now())),e.send(o.mail,(t,n)=>{if(o===e.queueEntry){try{o.callback(t,n)}catch(t){this.logger.error({err:t,tnx:"callback",cid:e.id},"Callback error for #%s: %s",e.id,t.message)}e.queueEntry=!1}})}_createConnection(){let e=new i(this);return e.id=++this._connectionCounter,this.logger.info({tnx:"pool",cid:e.id,action:"conection"},"Created new pool resource #%s",e.id),e.on("available",()=>{this.logger.debug({tnx:"connection",cid:e.id,action:"available"},"Connection #%s became available",e.id),this._closed?this.close():this._processMessages()}),e.once("error",t=>{if("EMAXLIMIT"!==t.code?this.logger.error({err:t,tnx:"pool",cid:e.id},"Pool Error for #%s: %s",e.id,t.message):this.logger.debug({tnx:"pool",cid:e.id,action:"maxlimit"},"Max messages limit exchausted for #%s",e.id),e.queueEntry){try{e.queueEntry.callback(t)}catch(t){this.logger.error({err:t,tnx:"callback",cid:e.id},"Callback error for #%s: %s",e.id,t.message)}e.queueEntry=!1}this._removeConnection(e),this._continueProcessing()}),e.once("close",()=>{this.logger.info({tnx:"connection",cid:e.id,action:"closed"},"Connection #%s was closed",e.id),this._removeConnection(e),e.queueEntry?setTimeout(()=>{e.queueEntry&&(this.logger.debug({tnx:"pool",cid:e.id,messageId:e.queueEntry.messageId,action:"requeue"},"Re-queued message <%s> for #%s",e.queueEntry.messageId,e.id),this._queue.unshift(e.queueEntry),e.queueEntry=!1),this._continueProcessing()},50):this._continueProcessing()}),this._connections.push(e),e}_continueProcessing(){this._closed?this.close():setTimeout(()=>this._processMessages(),100)}_removeConnection(e){let t=this._connections.indexOf(e);-1!==t&&this._connections.splice(t,1)}_checkRateLimit(e){if(!this._rateLimit.limit)return e();let t=Date.now();return this._rateLimit.counter<this._rateLimit.limit?e():(this._rateLimit.waiting.push(e),this._rateLimit.checkpoint<=t-this._rateLimit.delta?this._clearRateLimit():void(this._rateLimit.timeout||(this._rateLimit.timeout=setTimeout(()=>this._clearRateLimit(),this._rateLimit.delta-(t-this._rateLimit.checkpoint)),this._rateLimit.checkpoint=t)))}_clearRateLimit(){for(clearTimeout(this._rateLimit.timeout),this._rateLimit.timeout=null,this._rateLimit.counter=0,this._rateLimit.checkpoint=!1;this._rateLimit.waiting.length;){let e=this._rateLimit.waiting.shift();setImmediate(e)}}isIdle(){return this.idling}verify(e){let t;e||(t=new Promise((t,n)=>{e=a.callbackPromise(t,n)}));let n=new i(this).auth;return this.getSocket(this.options,(t,o)=>{if(t)return e(t);let i=this.options;o&&o.connection&&(this.logger.info({tnx:"proxy",remoteAddress:o.connection.remoteAddress,remotePort:o.connection.remotePort,destHost:i.host||"",destPort:i.port||"",action:"connected"},"Using proxied socket from %s:%s to %s:%s",o.connection.remoteAddress,o.connection.remotePort,i.host||"",i.port||""),i=a.assign(!1,i),Object.keys(o).forEach(e=>{i[e]=o[e]}));let s=new r(i),c=!1;s.once("error",t=>{if(!c)return c=!0,s.close(),e(t)}),s.once("end",()=>{if(!c)return c=!0,e(new Error("Connection closed"))});let l=()=>{if(!c)return c=!0,s.quit(),e(null,!0)};s.connect(()=>{c||(n?s.login(n,t=>{if(!c)return t?(c=!0,s.close(),e(t)):void l()}):l())})}),t}}},function(e,t,n){"use strict";const o=n(222),i=n(63).assign,r=n(248),s=n(9);e.exports=class extends s{constructor(e){if(super(),this.pool=e,this.options=e.options,this.logger=this.pool.logger,this.options.auth)switch((this.options.auth.type||"").toString().toUpperCase()){case"OAUTH2":{let e=new r(this.options.auth,this.logger);e.provisionCallback=this.pool.mailer&&this.pool.mailer.get("oauth2_provision_cb")||e.provisionCallback,this.auth={type:"OAUTH2",user:this.options.auth.user,oauth2:e,method:"XOAUTH2"},e.on("token",e=>this.pool.mailer.emit("token",e)),e.on("error",e=>this.emit("error",e));break}default:if(!this.options.auth.user&&!this.options.auth.pass)break;this.auth={type:(this.options.auth.type||"").toString().toUpperCase()||"LOGIN",user:this.options.auth.user,credentials:{user:this.options.auth.user||"",pass:this.options.auth.pass,options:this.options.auth.options},method:(this.options.auth.method||"").trim().toUpperCase()||this.options.authMethod||!1}}this._connection=!1,this._connected=!1,this.messages=0,this.available=!0}connect(e){this.pool.getSocket(this.options,(t,n)=>{if(t)return e(t);let r=!1,s=this.options;n&&n.connection&&(this.logger.info({tnx:"proxy",remoteAddress:n.connection.remoteAddress,remotePort:n.connection.remotePort,destHost:s.host||"",destPort:s.port||"",action:"connected"},"Using proxied socket from %s:%s to %s:%s",n.connection.remoteAddress,n.connection.remotePort,s.host||"",s.port||""),s=i(!1,s),Object.keys(n).forEach(e=>{s[e]=n[e]})),this.connection=new o(s),this.connection.once("error",t=>{if(this.emit("error",t),!r)return r=!0,e(t)}),this.connection.once("end",()=>{if(this.close(),r)return;r=!0;let t=setTimeout(()=>{if(r)return;let t=new Error("Unexpected socket close");this.connection&&this.connection._socket&&this.connection._socket.upgrading&&(t.code="ETLS"),e(t)},1e3);try{t.unref()}catch(e){}}),this.connection.connect(()=>{if(!r)return this.auth?void this.connection.login(this.auth,t=>{if(!r){if(r=!0,t)return this.connection.close(),this.emit("error",t),e(t);this._connected=!0,e(null,!0)}}):(r=!0,this._connected=!0,e(null,!0))})})}send(e,t){if(!this._connected)return this.connect(n=>n?t(n):this.send(e,t));let n=e.message.getEnvelope(),o=e.message.messageId(),i=[].concat(n.to||[]);i.length>3&&i.push("...and "+i.splice(2).length+" more"),this.logger.info({tnx:"send",messageId:o,cid:this.id},"Sending message %s using #%s to <%s>",o,this.id,i.join(", ")),e.data.dsn&&(n.dsn=e.data.dsn),this.connection.send(n,e.message.createReadStream(),(e,i)=>{if(this.messages++,e)return this.connection.close(),this.emit("error",e),t(e);i.envelope={from:n.from,to:n.to},i.messageId=o,setImmediate(()=>{let e;this.messages>=this.options.maxMessages?((e=new Error("Resource exhausted")).code="EMAXLIMIT",this.connection.close(),this.emit("error",e)):this.pool._checkRateLimit(()=>{this.available=!0,this.emit("available")})}),t(null,i)})}close(){this._connected=!1,this.auth&&this.auth.oauth2&&this.auth.oauth2.removeAllListeners(),this.connection&&this.connection.close(),this.emit("close")}}},function(e,t,n){"use strict";const o=n(14).Transform;e.exports=class extends o{constructor(e){super(e),this.options=e||{},this._curLine="",this.inByteCount=0,this.outByteCount=0,this.lastByte=!1}_transform(e,t,n){let o,i,r,s=[],a=0,c=0;if(!e||!e.length)return n();for("string"==typeof e&&(e=Buffer.from(e)),this.inByteCount+=e.length,o=0,i=e.length;o<i;o++)46===e[o]?(o&&10===e[o-1]||!o&&(!this.lastByte||10===this.lastByte))&&(r=e.slice(c,o+1),s.push(r),s.push(Buffer.from(".")),a+=r.length+1,c=o+1):10===e[o]&&(o&&13!==e[o-1]||!o&&13!==this.lastByte)&&(o>c?(r=e.slice(c,o),s.push(r),a+=r.length+2):a+=2,s.push(Buffer.from("\r\n")),c=o+1);a?(c<e.length&&(r=e.slice(c),s.push(r),a+=r.length),this.outByteCount+=a,this.push(Buffer.concat(s,a))):(this.outByteCount+=e.length,this.push(e)),this.lastByte=e[e.length-1],n()}_flush(e){let t;t=10===this.lastByte?Buffer.from(".\r\n"):13===this.lastByte?Buffer.from("\n.\r\n"):Buffer.from("\r\n.\r\n"),this.outByteCount+=t.length,this.push(t),e()}}},function(e){e.exports=JSON.parse('{"126":{"host":"smtp.126.com","port":465,"secure":true},"163":{"host":"smtp.163.com","port":465,"secure":true},"1und1":{"host":"smtp.1und1.de","port":465,"secure":true,"authMethod":"LOGIN"},"AOL":{"domains":["aol.com"],"host":"smtp.aol.com","port":587},"DebugMail":{"host":"debugmail.io","port":25},"DynectEmail":{"aliases":["Dynect"],"host":"smtp.dynect.net","port":25},"FastMail":{"domains":["fastmail.fm"],"host":"smtp.fastmail.com","port":465,"secure":true},"GandiMail":{"aliases":["Gandi","Gandi Mail"],"host":"mail.gandi.net","port":587},"Gmail":{"aliases":["Google Mail"],"domains":["gmail.com","googlemail.com"],"host":"smtp.gmail.com","port":465,"secure":true},"Godaddy":{"host":"smtpout.secureserver.net","port":25},"GodaddyAsia":{"host":"smtp.asia.secureserver.net","port":25},"GodaddyEurope":{"host":"smtp.europe.secureserver.net","port":25},"hot.ee":{"host":"mail.hot.ee"},"Hotmail":{"aliases":["Outlook","Outlook.com","Hotmail.com"],"domains":["hotmail.com","outlook.com"],"host":"smtp.live.com","port":587},"iCloud":{"aliases":["Me","Mac"],"domains":["me.com","mac.com"],"host":"smtp.mail.me.com","port":587},"mail.ee":{"host":"smtp.mail.ee"},"Mail.ru":{"host":"smtp.mail.ru","port":465,"secure":true},"Maildev":{"port":1025,"ignoreTLS":true},"Mailgun":{"host":"smtp.mailgun.org","port":465,"secure":true},"Mailjet":{"host":"in.mailjet.com","port":587},"Mailosaur":{"host":"mailosaur.io","port":25},"Mailtrap":{"host":"smtp.mailtrap.io","port":2525},"Mandrill":{"host":"smtp.mandrillapp.com","port":587},"Naver":{"host":"smtp.naver.com","port":587},"One":{"host":"send.one.com","port":465,"secure":true},"OpenMailBox":{"aliases":["OMB","openmailbox.org"],"host":"smtp.openmailbox.org","port":465,"secure":true},"Outlook365":{"host":"smtp.office365.com","port":587,"secure":false},"Postmark":{"aliases":["PostmarkApp"],"host":"smtp.postmarkapp.com","port":2525},"qiye.aliyun":{"host":"smtp.mxhichina.com","port":"465","secure":true},"QQ":{"domains":["qq.com"],"host":"smtp.qq.com","port":465,"secure":true},"QQex":{"aliases":["QQ Enterprise"],"domains":["exmail.qq.com"],"host":"smtp.exmail.qq.com","port":465,"secure":true},"SendCloud":{"host":"smtpcloud.sohu.com","port":25},"SendGrid":{"host":"smtp.sendgrid.net","port":587},"SendinBlue":{"host":"smtp-relay.sendinblue.com","port":587},"SendPulse":{"host":"smtp-pulse.com","port":465,"secure":true},"SES":{"host":"email-smtp.us-east-1.amazonaws.com","port":465,"secure":true},"SES-US-EAST-1":{"host":"email-smtp.us-east-1.amazonaws.com","port":465,"secure":true},"SES-US-WEST-2":{"host":"email-smtp.us-west-2.amazonaws.com","port":465,"secure":true},"SES-EU-WEST-1":{"host":"email-smtp.eu-west-1.amazonaws.com","port":465,"secure":true},"Sparkpost":{"aliases":["SparkPost","SparkPost Mail"],"domains":["sparkpost.com"],"host":"smtp.sparkpostmail.com","port":587,"secure":false},"Tipimail":{"host":"smtp.tipimail.com","port":587},"Yahoo":{"domains":["yahoo.com"],"host":"smtp.mail.yahoo.com","port":465,"secure":true},"Yandex":{"domains":["yandex.ru"],"host":"smtp.yandex.ru","port":465,"secure":true},"Zoho":{"host":"smtp.zoho.com","port":465,"secure":true,"authMethod":"LOGIN"}}')},function(e,t,n){"use strict";const o=n(9),i=n(222),r=n(249),s=n(63),a=n(248),c=n(79);e.exports=class extends o{constructor(e){let t;super(),"string"==typeof(e=e||{})&&(e={url:e});let n=e.service;"function"==typeof e.getSocket&&(this.getSocket=e.getSocket),e.url&&(t=s.parseConnectionUrl(e.url),n=n||t.service),this.options=s.assign(!1,e,t,n&&r(n)),this.logger=s.getLogger(this.options,{component:this.options.component||"smtp-transport"});let o=new i(this.options);this.name="SMTP",this.version=c.version+"[client:"+o.version+"]",this.options.auth&&(this.auth=this.getAuth({}))}getSocket(e,t){return setImmediate(()=>t(null,!1))}getAuth(e){if(!e)return this.auth;let t=!1,n={};if(this.options.auth&&"object"==typeof this.options.auth&&Object.keys(this.options.auth).forEach(e=>{t=!0,n[e]=this.options.auth[e]}),e&&"object"==typeof e&&Object.keys(e).forEach(o=>{t=!0,n[o]=e[o]}),!t)return!1;switch((n.type||"").toString().toUpperCase()){case"OAUTH2":{if(!n.service&&!n.user)return!1;let e=new a(n,this.logger);return e.provisionCallback=this.mailer&&this.mailer.get("oauth2_provision_cb")||e.provisionCallback,e.on("token",e=>this.mailer.emit("token",e)),e.on("error",e=>this.emit("error",e)),{type:"OAUTH2",user:n.user,oauth2:e,method:"XOAUTH2"}}default:return{type:(n.type||"").toString().toUpperCase()||"LOGIN",user:n.user,credentials:{user:n.user||"",pass:n.pass,options:n.options},method:(n.method||"").trim().toUpperCase()||this.options.authMethod||!1}}}send(e,t){this.getSocket(this.options,(n,o)=>{if(n)return t(n);let r=!1,a=this.options;o&&o.connection&&(this.logger.info({tnx:"proxy",remoteAddress:o.connection.remoteAddress,remotePort:o.connection.remotePort,destHost:a.host||"",destPort:a.port||"",action:"connected"},"Using proxied socket from %s:%s to %s:%s",o.connection.remoteAddress,o.connection.remotePort,a.host||"",a.port||""),a=s.assign(!1,a),Object.keys(o).forEach(e=>{a[e]=o[e]}));let c=new i(a);c.once("error",e=>{if(!r)return r=!0,c.close(),t(e)}),c.once("end",()=>{if(r)return;let e=setTimeout(()=>{if(r)return;r=!0;let e=new Error("Unexpected socket close");c&&c._socket&&c._socket.upgrading&&(e.code="ETLS"),t(e)},1e3);try{e.unref()}catch(e){}});let l=()=>{let n=e.message.getEnvelope(),o=e.message.messageId(),i=[].concat(n.to||[]);i.length>3&&i.push("...and "+i.splice(2).length+" more"),e.data.dsn&&(n.dsn=e.data.dsn),this.logger.info({tnx:"send",messageId:o},"Sending message %s to <%s>",o,i.join(", ")),c.send(n,e.message.createReadStream(),(e,i)=>{if(r=!0,c.close(),e)return this.logger.error({err:e,tnx:"send"},"Send error for %s: %s",o,e.message),t(e);i.envelope={from:n.from,to:n.to},i.messageId=o;try{return t(null,i)}catch(e){this.logger.error({err:e,tnx:"callback"},"Callback error for %s: %s",o,e.message)}})};c.connect(()=>{if(r)return;let n=this.getAuth(e.data.auth);n?c.login(n,e=>{if(n&&n!==this.auth&&n.oauth2&&n.oauth2.removeAllListeners(),!r)return e?(r=!0,c.close(),t(e)):void l()}):l()})})}verify(e){let t;return e||(t=new Promise((t,n)=>{e=s.callbackPromise(t,n)})),this.getSocket(this.options,(t,n)=>{if(t)return e(t);let o=this.options;n&&n.connection&&(this.logger.info({tnx:"proxy",remoteAddress:n.connection.remoteAddress,remotePort:n.connection.remotePort,destHost:o.host||"",destPort:o.port||"",action:"connected"},"Using proxied socket from %s:%s to %s:%s",n.connection.remoteAddress,n.connection.remotePort,o.host||"",o.port||""),o=s.assign(!1,o),Object.keys(n).forEach(e=>{o[e]=n[e]}));let r=new i(o),a=!1;r.once("error",t=>{if(!a)return a=!0,r.close(),e(t)}),r.once("end",()=>{if(!a)return a=!0,e(new Error("Connection closed"))});let c=()=>{if(!a)return a=!0,r.quit(),e(null,!0)};r.connect(()=>{if(a)return;let t=this.getAuth({});t?r.login(t,t=>{if(!a)return t?(a=!0,r.close(),e(t)):void c()}):c()})}),t}close(){this.auth&&this.auth.oauth2&&this.auth.oauth2.removeAllListeners(),this.emit("close")}}},function(e,t,n){"use strict";const o=n(118).spawn,i=n(79),r=n(223),s=n(250),a=n(63);e.exports=class{constructor(e){e=e||{},this._spawn=o,this.options=e||{},this.name="Sendmail",this.version=i.version,this.path="sendmail",this.args=!1,this.winbreak=!1,this.logger=a.getLogger(this.options,{component:this.options.component||"sendmail"}),e&&("string"==typeof e?this.path=e:"object"==typeof e&&(e.path&&(this.path=e.path),Array.isArray(e.args)&&(this.args=e.args),this.winbreak=["win","windows","dos","\r\n"].includes((e.newline||"").toString().toLowerCase())))}send(e,t){e.message.keepBcc=!0;let n,o,i,a,c=e.data.envelope||e.message.getEnvelope(),l=e.message.messageId();n=this.args?["-i"].concat(this.args).concat(c.to):["-i"].concat(c.from?["-f",c.from]:[]).concat(c.to);let p=n=>{if(!i)return i=!0,"function"==typeof t?n?t(n):t(null,{envelope:e.data.envelope||e.message.getEnvelope(),messageId:l,response:"Messages queued for delivery"}):void 0};try{o=this._spawn(this.path,n)}catch(e){return this.logger.error({err:e,tnx:"spawn",messageId:l},"Error occurred while spawning sendmail. %s",e.message),p(e)}if(!o)return p(new Error("sendmail was not found"));{o.on("error",e=>{this.logger.error({err:e,tnx:"spawn",messageId:l},"Error occurred when sending message %s. %s",l,e.message),p(e)}),o.once("exit",e=>{if(!e)return p();let t;t=127===e?new Error("Sendmail command not found, process exited with code "+e):new Error("Sendmail exited with code "+e),this.logger.error({err:t,tnx:"stdin",messageId:l},"Error sending message %s to sendmail. %s",l,t.message),p(t)}),o.once("close",p),o.stdin.on("error",e=>{this.logger.error({err:e,tnx:"stdin",messageId:l},"Error occurred when piping message %s to sendmail. %s",l,e.message),p(e)});let t=[].concat(c.to||[]);t.length>3&&t.push("...and "+t.splice(2).length+" more"),this.logger.info({tnx:"send",messageId:l},"Sending message %s to <%s>",l,t.join(", ")),a=this.winbreak?new r:new s;let n=e.message.createReadStream();a.once("error",e=>{this.logger.error({err:e,tnx:"stdin",messageId:l},"Error occurred when generating message %s. %s",l,e.message),o.kill("SIGINT"),p(e)}),n.once("error",e=>a.emit("error",e)),n.pipe(a).pipe(o.stdin)}}}},function(e,t,n){"use strict";const o=n(79),i=n(63),r=n(223),s=n(250);e.exports=class{constructor(e){e=e||{},this.options=e||{},this.name="StreamTransport",this.version=o.version,this.logger=i.getLogger(this.options,{component:this.options.component||"stream-transport"}),this.winbreak=["win","windows","dos","\r\n"].includes((e.newline||"").toString().toLowerCase())}send(e,t){e.message.keepBcc=!0;let n=e.data.envelope||e.message.getEnvelope(),o=e.message.messageId(),i=[].concat(n.to||[]);i.length>3&&i.push("...and "+i.splice(2).length+" more"),this.logger.info({tnx:"send",messageId:o},"Sending message %s to <%s> using %s line breaks",o,i.join(", "),this.winbreak?"<CR><LF>":"<LF>"),setImmediate(()=>{let n,i,a;try{a=this.winbreak?new r:new s,n=e.message.createReadStream(),i=n.pipe(a),n.on("error",e=>i.emit("error",e))}catch(e){return this.logger.error({err:e,tnx:"send",messageId:o},"Creating send stream failed for %s. %s",o,e.message),t(e)}if(!this.options.buffer)return i.once("error",e=>{this.logger.error({err:e,tnx:"send",messageId:o},"Failed creating message for %s. %s",o,e.message)}),t(null,{envelope:e.data.envelope||e.message.getEnvelope(),messageId:o,message:i});let c=[],l=0;i.on("readable",()=>{let e;for(;null!==(e=i.read());)c.push(e),l+=e.length}),i.once("error",e=>(this.logger.error({err:e,tnx:"send",messageId:o},"Failed creating message for %s. %s",o,e.message),t(e))),i.on("end",()=>t(null,{envelope:e.data.envelope||e.message.getEnvelope(),messageId:o,message:Buffer.concat(c,l)}))})}}},function(e,t,n){"use strict";const o=n(79),i=n(63);e.exports=class{constructor(e){e=e||{},this.options=e||{},this.name="JSONTransport",this.version=o.version,this.logger=i.getLogger(this.options,{component:this.options.component||"json-transport"})}send(e,t){e.message.keepBcc=!0;let n=e.data.envelope||e.message.getEnvelope(),o=e.message.messageId(),i=[].concat(n.to||[]);i.length>3&&i.push("...and "+i.splice(2).length+" more"),this.logger.info({tnx:"send",messageId:o},"Composing JSON structure of %s to <%s>",o,i.join(", ")),setImmediate(()=>{e.normalize((e,i)=>e?(this.logger.error({err:e,tnx:"send",messageId:o},"Failed building JSON structure for %s. %s",o,e.message),t(e)):(delete i.envelope,delete i.normalizedHeaders,t(null,{envelope:n,messageId:o,message:this.options.skipEncoding?i:JSON.stringify(i)})))})}}},function(e,t,n){"use strict";const o=n(9),i=n(79),r=n(63),s=n(223);e.exports=class extends o{constructor(e){super(),e=e||{},this.options=e||{},this.ses=this.options.SES,this.name="SESTransport",this.version=i.version,this.logger=r.getLogger(this.options,{component:this.options.component||"ses-transport"}),this.maxConnections=Number(this.options.maxConnections)||1/0,this.connections=0,this.sendingRate=Number(this.options.sendingRate)||1/0,this.sendingRateTTL=null,this.rateInterval=1e3,this.rateMessages=[],this.pending=[],this.idling=!0,setImmediate(()=>{this.idling&&this.emit("idle")})}send(e,t){return this.connections>=this.maxConnections?(this.idling=!1,this.pending.push({mail:e,callback:t})):this._checkSendingRate()?void this._send(e,(...e)=>{setImmediate(()=>t(...e)),this._sent()}):(this.idling=!1,this.pending.push({mail:e,callback:t}))}_checkRatedQueue(){if(this.connections>=this.maxConnections||!this._checkSendingRate())return;if(!this.pending.length)return void(this.idling||(this.idling=!0,this.emit("idle")));let e=this.pending.shift();this._send(e.mail,(...t)=>{setImmediate(()=>e.callback(...t)),this._sent()})}_checkSendingRate(){clearTimeout(this.sendingRateTTL);let e=Date.now(),t=!1;for(let n=this.rateMessages.length-1;n>=0;n--)this.rateMessages[n].ts>=e-this.rateInterval&&(!t||this.rateMessages[n].ts<t)&&(t=this.rateMessages[n].ts),this.rateMessages[n].ts<e-this.rateInterval&&!this.rateMessages[n].pending&&this.rateMessages.splice(n,1);if(this.rateMessages.length<this.sendingRate)return!0;let n=Math.max(t+1001,e+20);this.sendingRateTTL=setTimeout(()=>this._checkRatedQueue(),e-n);try{this.sendingRateTTL.unref()}catch(e){}return!1}_sent(){this.connections--,this._checkRatedQueue()}isIdle(){return this.idling}_send(e,t){let n={ts:Date.now(),pending:!0};this.connections++,this.rateMessages.push(n);let o=e.data.envelope||e.message.getEnvelope(),i=e.message.messageId(),r=[].concat(o.to||[]);r.length>3&&r.push("...and "+r.splice(2).length+" more"),this.logger.info({tnx:"send",messageId:i},"Sending message %s to <%s>",i,r.join(", "));setImmediate(()=>(t=>{e.data._dkim||(e.data._dkim={}),e.data._dkim.skipFields&&"string"==typeof e.data._dkim.skipFields?e.data._dkim.skipFields+=":date:message-id":e.data._dkim.skipFields="date:message-id";let n=e.message.createReadStream(),o=n.pipe(new s),i=[],r=0;o.on("readable",()=>{let e;for(;null!==(e=o.read());)i.push(e),r+=e.length}),n.once("error",e=>o.emit("error",e)),o.once("error",e=>{t(e)}),o.once("end",()=>t(null,Buffer.concat(i,r)))})((r,s)=>{if(r)return this.logger.error({err:r,tnx:"send",messageId:i},"Failed creating message for %s. %s",i,r.message),n.pending=!1,t(r);let a={RawMessage:{Data:s},Source:o.from,Destinations:o.to};Object.keys(e.data.ses||{}).forEach(t=>{a[t]=e.data.ses[t]}),this.ses.sendRawEmail(a,(e,r)=>{if(e)return this.logger.error({err:e,tnx:"send"},"Send error for %s: %s",i,e.message),n.pending=!1,t(e);let a=this.ses.config&&this.ses.config.region||"us-east-1";"us-east-1"===a&&(a="email"),n.pending=!1,t(null,{envelope:{from:o.from,to:o.to},messageId:"<"+r.MessageId+(/@/.test(r.MessageId)?"":"@"+a+".amazonses.com")+">",response:r.MessageId,raw:s})})}))}verify(e){let t;return e||(t=new Promise((t,n)=>{e=r.callbackPromise(t,n)})),this.ses.sendRawEmail({RawMessage:{Data:"From: invalid@invalid\r\nTo: invalid@invalid\r\n Subject: Invalid\r\n\r\nInvalid"},Source:"invalid@invalid",Destinations:["invalid@invalid"]},t=>t&&"InvalidParameterValue"!==t.code?e(t):e(null,!0)),t}}}]));